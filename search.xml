<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>运行中的mongo减少内存占用</title>
      <link href="/2021/09/17/centos/centos-mongo-memory/"/>
      <url>/2021/09/17/centos/centos-mongo-memory/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>最近查看公司机器的内存占用情况，发现mongod大约占了50%的内存。<br>命令：<code>ps auxc|head -1;ps auxc|grep -v PID|sort -rn -k +4|head;</code><br>原来<code>内存默认使用的是(系统内存-1GB)*50%</code>（据说是3.4版本+）。</p><p>这也太坑了，服务器又不是专门用作DB的，还有其他进程也要吃内存。</p><p>运行中的mongod，也不敢restart，查询了可能的运行中清理内存。<br><font color=red>注意：没有在正式环境中执行过，仅作参考。</font></p><span id="more"></span><h3 id="方法1-这个应该可以"><a href="#方法1-这个应该可以" class="headerlink" title="方法1(这个应该可以)"></a>方法1(这个应该可以)</h3><p>关闭所有的数据库:<br><code>db.adminCommand(&#123;closeAllDatabases: 1&#125;)</code><br>或者<code>use admin; db.runCommand(&#123;closeAllDatabases: 1&#125;)</code></p><p>使用<code>crontab</code>定时执行<code>mongo --eval &quot;db.adminCommand(&#123;closeAllDatabases: 1&#125;)&quot;</code>?也许可以</p><blockquote><p>有新的数据进来的话,会重新开数据库的</p></blockquote><h3 id="方法2-没试过-不知道进程是否会重启"><a href="#方法2-没试过-不知道进程是否会重启" class="headerlink" title="方法2(没试过,不知道进程是否会重启)"></a>方法2(没试过,不知道进程是否会重启)</h3><p>要安装<code>cgroups</code>，正式环境中没有，没试过，不清楚进程会不会重启</p><ol><li><code>cgcreate -g memory:DBLimitedGroup</code> </li><li><code>echo 16G &gt; /sys/fs/cgroup/memory/DBLimitedGroup/memory.limit_in_bytes</code></li><li><code>sync; echo 3 &gt; /proc/sys/vm/drop_caches</code></li><li><code>cgclassify -g memory:DBLimitedGroup $(pidof mongod)</code></li></ol><h3 id="方法3-应该要重启的，没有试过"><a href="#方法3-应该要重启的，没有试过" class="headerlink" title="方法3(应该要重启的，没有试过)"></a>方法3(应该要重启的，没有试过)</h3><p><code>mongod.conf</code>增加<code>wiredTigerCacheSizeGB=8</code>，然后<code>mongod reload</code><br>或者<br><code>/usr/bin/mongod --config /etc/mongod.conf --fork --wiredTigerCacheSizeGB 8</code></p><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="https://www.techpaste.com/2016/04/limit-mongodb-memory-usage/">https://www.techpaste.com/2016/04/limit-mongodb-memory-usage/</a></li><li><a href="https://www.cnblogs.com/On-my-way/p/9708225.html">https://www.cnblogs.com/On-my-way/p/9708225.html</a></li><li><a href="https://www.cnblogs.com/wt11/p/9291583.html">https://www.cnblogs.com/wt11/p/9291583.html</a></li><li><a href="https://stackoverflow.com/questions/6861184/is-there-any-option-to-limit-mongodb-memory-usage">https://stackoverflow.com/questions/6861184/is-there-any-option-to-limit-mongodb-memory-usage</a></li><li><a href="https://mongodb-documentation.readthedocs.io/en/latest/reference/command/listDatabases.html#gsc.tab=0">https://mongodb-documentation.readthedocs.io/en/latest/reference/command/listDatabases.html#gsc.tab=0</a></li><li><a href="https://segmentfault.com/q/1010000002953588">https://segmentfault.com/q/1010000002953588</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> mongo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> mongo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>共享Android手机上的音视频到智能电视上</title>
      <link href="/2021/08/13/mobile/mobile-dlna-server/"/>
      <url>/2021/08/13/mobile/mobile-dlna-server/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="server端"><a href="#server端" class="headerlink" title="server端"></a><code>server端</code></h2><p>下载地址:</p><ul><li><a href="https://play.google.com/store/apps/details?id=com.al.dlnaserver">[fq]Google Play</a></li><li><a href="https://apkpure.com/cn/dlnaserver/com.al.dlnaserver">[fq]ApkPure</a></li><li><a href="/downloads/binary/DLNAServer_v2.14_apkpure.com.apk">本地下载</a></li></ul><p>安装到自己的手机上，然后点击右上角的+，添加需要共享的视频/音频<br>确保可以后台运行</p><h2 id="client端"><a href="#client端" class="headerlink" title="client端"></a><code>client端</code></h2><p>下载<a href="https://www.videolan.org/vlc/download-android.html">VLC for Android</a><br>安装到<code>某盒子</code>或者<code>智能电视</code>上<br>确保<code>server端</code>和<code>client端</code>在同一个局域网中</p><p>打开VLC，稍等片刻就可以在<code>本地网络</code>中看到了<br>如果看不到的话,就<code>重启</code>下server端</p>]]></content>
      
      
      <categories>
          
          <category> 手机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>农历公历转换</title>
      <link href="/2021/08/09/other/other-lunar2solar/"/>
      <url>/2021/08/09/other/other-lunar2solar/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>农历转公历是没有规律的，所以只能根据已有的数据转换</strong><br>香港天文台的数据：<a href="https://www.hko.gov.hk/tc/gts/time/conversion1_text.htm#">https://www.hko.gov.hk/tc/gts/time/conversion1_text.htm#</a></p><p>自己转换出了一个<code>lunar.db</code><a href="/downloads/binary/lunar.db">(点击下载)</a>，用<code>sqilte3</code>打开</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">sqlite3 lunar.db <span class="string">&quot;SELECT solar from lunar2solar where lunar=\&quot;2023-02-22\&quot;&quot;</span></span></span><br><span class="line">2023-03-13</span><br><span class="line">2023-04-12</span><br></pre></td></tr></table></figure><p>自己随便写了一个农历转公历的接口，其实就是从<code>lunar.db</code>中查询数据而已<br>很随意的，性能没法保证的<br><code>https://tools.web.mingilin.com/lunar2solar/lunar2solar.php?lunar=2023-02-22</code><br>日期格式必须是YYYY-MM-DD</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ curl --silent https://tools.web.mingilin.com/lunar2solar/lunar2solar.php?lunar=2023-02-22 | jq -r <span class="string">&#x27;.data | .[].solar&#x27;</span></span><br><span class="line">2023-03-13</span><br><span class="line">2023-04-12</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Win10下git clone ssh免密</title>
      <link href="/2021/08/08/windows/windows-git-clone-nopass/"/>
      <url>/2021/08/08/windows/windows-git-clone-nopass/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="git-for-windows"><a href="#git-for-windows" class="headerlink" title="git for windows"></a><code>git for windows</code></h2><ol><li>启动<code>ssh-agent</code>服务<ol><li><code>Win+s</code>搜索<code>服务</code>,以管理员身份运行</li><li>设置<code>OpenSSH Authentication Agent</code>为开机启动</li></ol></li><li><code>ssh-add</code>增加私钥<br>私钥放到<code>C:\Users\用户名</code>目录下,<code>ssh-add %USERPROFILE%\ssh_keys\id_rsa</code><br>可以创建一个开机启动.bat(<code>Win+R</code>-&gt;<code>shell:startup</code>)<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 启动win10_ssh-agent</span><br><span class="line"><span class="built_in">echo</span> 环境变量增加GIT_SSH=C:\WINDOWS\System32\OpenSSH\ssh.exe</span><br><span class="line"><span class="function">C:\<span class="title">WINDOWS</span>\<span class="title">System32</span>\<span class="title">OpenSSH</span>\<span class="title">ssh</span>-<span class="title">agent.exe</span></span></span><br><span class="line"><span class="function"><span class="title">ssh</span>-<span class="title">add</span> %<span class="title">USERPROFILE</span>%\<span class="title">ssh_keys</span>\<span class="title">id_rsa</span></span></span><br><span class="line"><span class="function"><span class="title">ssh</span>-<span class="title">add</span> %<span class="title">USERPROFILE</span>%\<span class="title">ssh_keys</span>\<span class="title">id_rsa2</span></span></span><br></pre></td></tr></table></figure></li><li>修改git配置<ol><li><code>Win+s</code>搜索<code>编辑系统环境变量</code></li><li>增加系统环境变量<code>GIT_SSH=C:\WINDOWS\System32\OpenSSH\ssh.exe</code></li></ol></li><li>完成<br><code>git clone ssh://xxx</code>应该就可以正常工作了</li></ol><h2 id="TortoiseGIT"><a href="#TortoiseGIT" class="headerlink" title="TortoiseGIT"></a><code>TortoiseGIT</code></h2><ol><li>方法1:<ol><li>先设置好<code>git for windows</code></li><li>修改配置(<code>Settings</code> -&gt; <code>Network</code> -&gt; <code>SSH Client</code>)<br>修改为<code>C:\WINDOWS\System32\OpenSSH\ssh.exe</code></li></ol></li><li>方法2:<ol><li>启动<code>Pageant</code>，添加私钥.ppk</li><li>修改配置(<code>Settings</code> -&gt; <code>Network</code> -&gt; <code>SSH Client</code>)<br>修改为<code>Your\TortoiseGit\Path\bin\TortoisePlink.exe</code></li></ol></li></ol>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【转】DAVx5无法开启OpenTasks/Tasks.org权限的问题</title>
      <link href="/2021/07/30/other/other-davx5-sync/"/>
      <url>/2021/07/30/other/other-davx5-sync/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="tabs" id="tab"><ul class="nav-tabs"><li class="tab active"><a href="#tab-1">原文</a></li><li class="tab"><a href="#tab-2">附加</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tab-1"><blockquote><p>原文链接: <a href="https://blog.wanfajie.com/2021/02/566">https://blog.wanfajie.com/2021/02/566</a></p></blockquote><p>小米6手机（MIUI 11 20.1.16）中使用 DAVx5 显示缺少权限、无法同步 Tasks/OpenTasks 中任务。并且在 “设置” -&gt; “应用权限” 中点击 “OpenTasks权限”/“Tasks权限” 开关无法打开。查看 DAVx5 日志发现以下四项权限被禁止：</p><ul><li>org.dmfs.permission.READ_TASKS: denied</li><li>org.dmfs.permission.WRITE_TASKS: denied</li><li>org.tasks.permission.READ_TASKS: denied</li><li>org.tasks.permission.WRITE_TASKS: denied</li></ul><p>令人困惑的是，MIUI 既不给出授权提示，在权限管理中也找不到自定义应用权限授权的地方。对 MIUI 的“设置”地毯式搜索后，终于找到了解决方法。</p><ol><li>首先安装好 DAVx5 及 OpenTasks/Tasks.org 应用。</li><li>在“全部参数”中点击5次“MIUI 版本”，开启开发者模式。</li><li>在“开发者选项”中，关闭位于最下面的几个选项中的“启用MIUI优化”。</li><li>回到桌面，长按 DAVx5 应用的图标，点击“应用信息”。<br>P.S.: 此时，应用信息界面变了个样子。如果是通过“设置”进入“应用信息”的话，界面将保持 MIUI 的原状。</li><li>然后，点击“应用信息”界面中的“权限”。进入“应用权限”界面后，你会在最下方看到“其他权限”选项。</li><li>进入“其他权限”，权限列表中将出现 “Tasks” 之类的权限，打开权限开关。<br>进入 DAVx5 的 “设置” -&gt; “应用权限”，此时就可以开启 “OpenTasks权限”/“Tasks权限” 开关并正常同步 OpenTasks 中的数据。</li></ol><p>最后，建议再重新开启“启用MIUI优化”。关闭优化后，许多设置像是重置了一样，一来重新设置嫌麻烦，二来开启MIUI优化手机使用起来于我而言也没什么不足。网络上对MIUI优化众说纷纭，就看各位自行判断了。</p></div><div class="tab-pane" id="tab-2"><ol><li>在<code>Google Play</code>上<code>DAVx5</code>需要米，在<a href="https://f-droid.org/"><code>F-Droid</code></a>免费；</li><li>按照原文的方法，第一次重新“开启MIUI优化”后，<code>DAVx5</code>权限被重置了，<br>又重新关闭再开启，<code>DAVx5</code>可以用了，<br>可能成功与否要看人品；</li><li><code>Tasks.org</code>需要订购后才能使用<code>DAVx5</code>同步，没米，果断放弃，用<code>OpenTasks</code>；</li><li>使用<a href="https://radicale.org/3.0.html"><code>Radicale</code></a>自建<code>CalDAV</code>和<code>CardDAV</code>Server，真香，<br>如果配合docker就更香；</li><li>PC上用<code>Thunder Bird</code>+<code>TbSync</code>插件，管理日程和联系人；</li></ol></div></div></div>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Termux(Android)配置</title>
      <link href="/2021/07/29/centos/centos-termux/"/>
      <url>/2021/07/29/centos/centos-termux/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>最近要接手一些运维的工作<br>有时候需要远程更新下<br>对比了几个安卓的ssh客户端,发现<code>termux</code>最好用了(可以很方便的将迁移sessions)(<code>Termius</code>也挺好的)</p><span id="more"></span><h2 id="修改源"><a href="#修改源" class="headerlink" title="修改源"></a>修改源</h2><p><code>termux-change-repo</code></p><h2 id="根目录地址"><a href="#根目录地址" class="headerlink" title="根目录地址"></a>根目录地址</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$PREFIX</span></span></span><br><span class="line">/data/data/com.termux/files/usr</span><br></pre></td></tr></table></figure><h2 id="安装sshd服务"><a href="#安装sshd服务" class="headerlink" title="安装sshd服务"></a>安装<code>sshd</code>服务</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pkg install termux-services</span><br><span class="line">pkg install openssh</span><br><span class="line">sv-enable sshd</span><br><span class="line">sv start sshd</span><br></pre></td></tr></table></figure><p>默认端口 <code>8022</code><br>现在就可以用ssh登录了,用<code>sftp</code>发送文件了</p><h2 id="设置Termux软键盘"><a href="#设置Termux软键盘" class="headerlink" title="设置Termux软键盘"></a>设置Termux软键盘</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ~/.termux/termux.properties</span></span></span><br><span class="line">extra-keys = [ \</span><br><span class="line"> [&#x27;|&#x27;, &#x27;~&#x27;, &#x27;/&#x27;, &#x27;.&#x27;, &#x27;-&#x27;, &#x27;_&#x27;, &#x27;ENTER&#x27;], \</span><br><span class="line"> [&#x27;ESC&#x27;, &#x27;TAB&#x27;, &#x27;HOME&#x27;,&#x27;UP&#x27;,&#x27;END&#x27;,&#x27;DEL&#x27;, &#x27;exit&#x27;], \</span><br><span class="line"> [&#x27;CTRL&#x27;,&#x27;ALT&#x27;,&#x27;LEFT&#x27;,&#x27;DOWN&#x27;,&#x27;RIGHT&#x27;, &#x27;BKSP&#x27;, &#x27;KEYBOARD&#x27;] \</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ul><li>grep 中文问题<br><a href="https://unix.stackexchange.com/questions/580139/termux-grep-fails-to-detect-chinese-character">相同问题的链接</a>, 解决方式:<code>pkg install busybox</code>, 使用<code>busybox grep</code></li></ul><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://mirrors.tuna.tsinghua.edu.cn/help/termux/">https://mirrors.tuna.tsinghua.edu.cn/help/termux/</a></li><li><a href="https://wiki.termux.com/wiki/Termux-services">https://wiki.termux.com/wiki/Termux-services</a></li><li><a href="https://wiki.termux.com/wiki/Touch_Keyboard">https://wiki.termux.com/wiki/Touch_Keyboard</a></li></ol><h2 id="附带自动生成的远程登录的脚本"><a href="#附带自动生成的远程登录的脚本" class="headerlink" title="附带自动生成的远程登录的脚本"></a>附带自动生成的远程登录的脚本</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">eval &quot;$(curl --silent https://www.mingilin.com/downloads/code/printcolor.sh)&quot;</span><br><span class="line">CACHE_DIR=~/.cache/</span><br><span class="line">mkdir -p $CACHE_DIR</span><br><span class="line">CFG_FILE=$&#123;CACHE_DIR&#125;/ssh_test_cfg.cfg</span><br><span class="line">if [ &quot;$(uname -o)&quot; == &quot;Android&quot; ];then</span><br><span class="line">    GREP=&quot;busybox grep&quot;</span><br><span class="line">else</span><br><span class="line">    GREP=grep</span><br><span class="line">fi</span><br><span class="line">MYSSH_KEY_DIR=~/myssh</span><br><span class="line">cat &gt; $CFG_FILE &lt;&lt;EOF</span><br><span class="line">&#123;&quot;id&quot;:&quot;7&quot;, &quot;group&quot;:[&quot;&quot;,&quot;0. 内网机器&quot;], &quot;name&quot;:&quot;DNS服务器-192.168.50.12&quot;, &quot;user&quot;:&quot;root&quot;, &quot;host&quot;:&quot;192.168.50.12&quot;, &quot;port&quot;:&quot;9022&quot;&#125;</span><br><span class="line">&#123;&quot;id&quot;:&quot;63&quot;, &quot;group&quot;:[&quot;&quot;,&quot;Z101. vagrant&quot;], &quot;name&quot;:&quot;192.168.56.10&quot;, &quot;user&quot;:&quot;root&quot;, &quot;host&quot;:&quot;192.168.56.10&quot;, &quot;port&quot;:&quot;22&quot;&#125;</span><br><span class="line">&#123;&quot;id&quot;:&quot;64&quot;, &quot;group&quot;:[&quot;&quot;,&quot;Z101. vagrant&quot;], &quot;name&quot;:&quot;192.168.56.11&quot;, &quot;user&quot;:&quot;root&quot;, &quot;host&quot;:&quot;192.168.56.11&quot;, &quot;port&quot;:&quot;22&quot;&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">function show_list() &#123;</span><br><span class="line">    filter=$1</span><br><span class="line">    group=&quot;&quot;</span><br><span class="line">    while read line_t; do</span><br><span class="line">        if [ &quot;$filter&quot; == &quot;&quot; ]; then</span><br><span class="line">            line=$line_t</span><br><span class="line">        else</span><br><span class="line">            line=$(echo $line_t | $&#123;GREP&#125; &quot;$filter&quot;)</span><br><span class="line">        fi</span><br><span class="line">        if [ &quot;$line&quot; == &quot;&quot; ]; then</span><br><span class="line">            continue</span><br><span class="line">        fi</span><br><span class="line">        group1=$(echo $line | jq &#x27;.group | join(&quot;&quot;)&#x27;)</span><br><span class="line">        port=$(echo $line | jq .port | sed &#x27;s/&quot;//g&#x27;)</span><br><span class="line">        if [ &quot;$port&quot; == &quot;0&quot; ]; then</span><br><span class="line">            continue</span><br><span class="line">        fi</span><br><span class="line">        if [ &quot;$group&quot; == &quot;$group1&quot; ]; then</span><br><span class="line">            echo -n &quot; &quot;</span><br><span class="line">            echo $line | jq &#x27;[.id,.name] | join(&quot; ===&gt; &quot;)&#x27; | sed &#x27;s/&quot;//g&#x27;</span><br><span class="line">        else</span><br><span class="line">            group=$group1</span><br><span class="line">            echo &quot;&quot;</span><br><span class="line">            print_info &quot;=======================================================&quot;</span><br><span class="line">            _print_info &quot;&gt;&gt;&gt; &quot;</span><br><span class="line">            print_info $(echo $line | jq -r &#x27;.group | .[1:] | join(&quot; &gt; &quot;)&#x27;)</span><br><span class="line">            print_info &quot;-------------------------------------------------------&quot;</span><br><span class="line">            echo -n &quot; &quot;</span><br><span class="line">            echo $line | jq -r &#x27;[.id,.name] | join(&quot; ===&gt; &quot;)&#x27;</span><br><span class="line">        fi</span><br><span class="line">    done &lt; $CFG_FILE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function login() &#123;</span><br><span class="line">    id=$1</span><br><span class="line">    line=$(cat $CFG_FILE | $&#123;GREP&#125; &quot;\&quot;id\&quot;:\&quot;$id\&quot;&quot;)</span><br><span class="line">    sshhost=$(echo $line | jq -r .host)</span><br><span class="line">    sshport=$(echo $line | jq -r .port)</span><br><span class="line">    sshuser=$(echo $line | jq -r .user)</span><br><span class="line">    print_info &quot;===&gt; login $sshuser@$sshhost port:$sshport&quot;</span><br><span class="line">    ssh -o GSSAPIAuthentication=no -o StrictHostKeyChecking=no -p $sshport $sshuser@$sshhost</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function start_sshagent() &#123;</span><br><span class="line">    [ ! -d $MYSSH_KEY_DIR ] &amp;&amp; echo &quot;[error] not found dir: $MYSSH_KEY_DIR&quot; &amp;&amp; exit</span><br><span class="line"></span><br><span class="line">    eval $(ssh-agent)</span><br><span class="line">    for i in $(find $MYSSH_KEY_DIR -type f); do</span><br><span class="line">        ssh-add -q $i</span><br><span class="line">    done</span><br><span class="line">    ssh-add -l</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function stop_sshagent() &#123;</span><br><span class="line">    eval $(ssh-agent -k)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function help() &#123;</span><br><span class="line">    print_info &quot;=======================================&quot;</span><br><span class="line">    print_info &quot;show_list         - list all sessions  &quot;</span><br><span class="line">    print_info &quot;show_list group   - list group sessions&quot;</span><br><span class="line">    print_info &quot;login id          - login&quot;</span><br><span class="line">    print_info &quot;=======================================&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">    &quot;login&quot;)</span><br><span class="line">        start_sshagent</span><br><span class="line">        login $2</span><br><span class="line">        stop_sshagent</span><br><span class="line">        ;;</span><br><span class="line">    &quot;show_list&quot;)</span><br><span class="line">        show_list $2</span><br><span class="line">        ;;</span><br><span class="line">    *) </span><br><span class="line">        help</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> termux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> termux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>screen</title>
      <link href="/2021/07/04/centos/centos-screentool/"/>
      <url>/2021/07/04/centos/centos-screentool/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>个人经常使用的是<code>tmux</code>, 使用<code>tmuxinator</code>管理session</p><p>现在需要接手一些运维工作，但是默认安装的是<code>screen</code>，因此需要一些<code>screen</code>的知识</p><p>用惯了<code>tmuxinator</code>，也想使用类似的工具管理<code>screen</code>的session</p><blockquote><p>其实就是简单的生成不同的<code>screenrc</code>配置，使用<code>screen -c xxx.rc</code>调用不同的配置</p></blockquote><div class="tabs" id="tab"><ul class="nav-tabs"><li class="tab active"><a href="#tab-1">效果图</a></li><li class="tab"><a href="#tab-2">HELP</a></li><li class="tab"><a href="#tab-3">源码</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tab-1"><p><img src="/downloads/assets/screentool.png" alt="效果图"></p></div><div class="tab-pane" id="tab-2"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">$ screentool</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt;&gt; COMMAND &lt;&lt;&lt;&lt;&lt;</span><br><span class="line">new session      # create new session</span><br><span class="line">ls               # list all session</span><br><span class="line">edit session     # edit session config</span><br><span class="line">rm session       # remove session config</span><br><span class="line">start session    # start session</span><br><span class="line">stop session     # stop session</span><br><span class="line">status session   # status session</span><br><span class="line">install binname  # install screentool</span><br><span class="line">exec session cmd # exec &quot;cmd&quot;(use quotes)</span><br><span class="line">  cmd:</span><br><span class="line">    1. a command(ex. python)</span><br><span class="line">    2. -t python 10 python</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt;&gt; KEYBINDINGS &lt;&lt;&lt;&lt;&lt;</span><br><span class="line">+---------------+---------------------+</span><br><span class="line">| ctrl-a d      | detach              |</span><br><span class="line">| ctrl-a c      | 创建 window         |</span><br><span class="line">| ctrl-a k      | 关闭 window         |</span><br><span class="line">| ctrl-a A      | 重命名 windows      |</span><br><span class="line">| ctrl-a w      | 显示所有窗口        |</span><br><span class="line">|---------------+---------------------|</span><br><span class="line">| ctrl-a 0~9    | 切换窗口            |</span><br><span class="line">| ctrl-a ctrl-a | 快速切换窗口        |</span><br><span class="line">| ctrl-a Tab    | 切换到另一个(分屏)  |</span><br><span class="line">| ctrl-a p      | prev window         |</span><br><span class="line">| ctrl-a n      | next window         |</span><br><span class="line">|---------------+---------------------|</span><br><span class="line">| ctrl-a S      | 水平分屏            |</span><br><span class="line">| ctrl-a |      | 垂直分屏            |</span><br><span class="line">| ctrl-a Q      | 去除分屏            |</span><br><span class="line">|---------------+---------------------|</span><br><span class="line">| ctrl-a [      | copy                |</span><br><span class="line">|               | 空格是开始/结束选择 |</span><br><span class="line">| ctrl-a ]      | paste               |</span><br><span class="line">+---------------+---------------------+</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="tab-3"><p>附带<a href="/downloads/code/screentool/myscreen"><code>源码</code></a></p></div></div></div>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> screen </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>推荐两个安卓下的桌面股票插件</title>
      <link href="/2020/12/04/other/other-deskstock-android/"/>
      <url>/2020/12/04/other/other-deskstock-android/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/downloads/assets/deskstock.jpg" alt="效果图"></p><p>上面是：<a href="https://play.google.com/store/apps/details?id=top.ministock"><strong>桌面股票</strong></a><br>下面是：<a href="https://play.google.com/store/apps/details?id=com.virsir.android.smartstockcn"><strong>机灵股票</strong></a></p><p>插件是极好的，就是股票不赚钱😂<br>原来<code>股票精灵</code>挺好用的，现在已经废掉了😂</p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自用的NGINX+MYSQL+PHP集成环境</title>
      <link href="/2020/12/04/other/other-mywnmp/"/>
      <url>/2020/12/04/other/other-mywnmp/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>分享一个自用的web集成环境<br>在其他人的基础上修改的，现在实在找不到是在哪个基础上修改的，抱歉<br>只要有点开发基础，就可以快速的自定义组件，目前包括：</p><ul><li>NGINX + PHP + MYSQL</li><li>MONGO</li><li>REDIS + MEMCACHED</li><li>XLIGHT(FTP SERVER)</li><li>OpenSSH-Win64</li></ul><p>链接: <a href="https://pan.baidu.com/s/1xi2MzcR6P7lNrQ3JItYXUQ">https://pan.baidu.com/s/1xi2MzcR6P7lNrQ3JItYXUQ</a> 提取码: w15d<br><img src="/downloads/assets/mywnmp_qrcode.jpg" alt="二维码"> </p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ERLANG解决“证书出错，请登录微信支付商户平台下载证书”</title>
      <link href="/2020/12/04/erlang/erlang-wx-pay/"/>
      <url>/2020/12/04/erlang/erlang-wx-pay/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="解决“证书出错，请登录微信支付商户平台下载证书”的核心代码"><a href="#解决“证书出错，请登录微信支付商户平台下载证书”的核心代码" class="headerlink" title="解决“证书出错，请登录微信支付商户平台下载证书”的核心代码"></a>解决“证书出错，请登录微信支付商户平台下载证书”的核心代码</h3><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">request_post</span><span class="params">(Url, Path, &#123;data, Str&#125;)</span> -&gt;</span></span><br><span class="line">    ReqUrl = lists:concat([Url, Path]),</span><br><span class="line">    <span class="comment">%% +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line">    <span class="comment">%% 😊这个是核心的核心😊</span></span><br><span class="line">    SSLOptions = [</span><br><span class="line">        &#123;keyfile,<span class="string">&quot;apiclient_key.pem&quot;</span>&#125;,</span><br><span class="line">        &#123;certfile,<span class="string">&quot;apiclient_cert.pem&quot;</span>&#125;</span><br><span class="line">    ],</span><br><span class="line">    HTTPOptions = [&#123;ssl, SSLOptions&#125;, &#123;timeout, <span class="number">5000</span>&#125;, &#123;version, <span class="string">&quot;HTTP/1.1&quot;</span>&#125;],</span><br><span class="line">    <span class="comment">%% +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line">    Request = &#123;ReqUrl, [], <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>, iolist_to_binary(Str)&#125;,</span><br><span class="line">    httpc:request(post, Request, HTTPOptions, []).</span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="使用xmerl解析xml"><a href="#使用xmerl解析xml" class="headerlink" title="使用xmerl解析xml"></a>使用<code>xmerl</code>解析xml</h3><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">scan_str</span><span class="params">(Str)</span> -&gt;</span></span><br><span class="line">    &#123;XmlElement, _Rest&#125; = xmerl_scan:string(Str, [&#123;space, normalize&#125;]),</span><br><span class="line">    [XmlElement1] = xmerl_lib:remove_whitespace([XmlElement]),</span><br><span class="line">    XmlElement1.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">value_of</span><span class="params">(Key, #xmlElement&#123;&#125; = X)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">case</span> xmerl_xs:select(Key, X) <span class="keyword">of</span></span><br><span class="line">        [#xmlElement&#123;&#125; = Find] -&gt;</span><br><span class="line">            de_cdata(xmerl_xs:value_of(Find));</span><br><span class="line">        [] -&gt;</span><br><span class="line">            []</span><br><span class="line">    <span class="keyword">end</span>.</span><br><span class="line"><span class="function"><span class="title">de_cdata</span><span class="params">(<span class="string">&quot;![CDATA[&quot;</span> ++ Data)</span> -&gt;</span></span><br><span class="line">    [_,_|Data1] = lists:reverse(Data),</span><br><span class="line">    unescape_str(lists:reverse(Data1));</span><br><span class="line"><span class="function"><span class="title">de_cdata</span><span class="params">(Data)</span> -&gt;</span></span><br><span class="line">    unescape_str(Data).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">unescape_str</span><span class="params">(Str)</span> -&gt;</span></span><br><span class="line">    Str1 = unicode:characters_to_binary(Str),</span><br><span class="line">    GtEsc  = re:replace(Str1, <span class="string">&quot;&amp;amp;&quot;</span>, <span class="string">&quot;\\&amp;&quot;</span>, [global]),</span><br><span class="line">    LtEsc  = re:replace(GtEsc,  <span class="string">&quot;&amp;gt;&quot;</span>,  <span class="string">&quot;&gt;&quot;</span>,   [global]),</span><br><span class="line">    AmpEsc = re:replace(LtEsc,  <span class="string">&quot;&amp;lt;&quot;</span>,  <span class="string">&quot;&lt;&quot;</span>,   [global]),</span><br><span class="line">    Text   = re:replace(AmpEsc, <span class="string">&quot;&amp;amp;&quot;</span>, <span class="string">&quot;\\&amp;&quot;</span>, [global]),</span><br><span class="line">    util:to_list(Text).</span><br></pre></td></tr></table></figure><h3 id="将proplists转换为xml"><a href="#将proplists转换为xml" class="headerlink" title="将proplists转换为xml"></a>将<code>proplists</code>转换为xml</h3><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">export_xml</span><span class="params">(List)</span> -&gt;</span></span><br><span class="line">    Fields = lists:map(</span><br><span class="line">               <span class="keyword">fun</span>(&#123;Key, Value&#125;) -&gt;</span><br><span class="line">                       &#123;Key, [], [util:to_list(Value)]&#125;</span><br><span class="line">               <span class="keyword">end</span>, List),</span><br><span class="line">    Xml = xmerl:export_simple([&#123;xml, Fields&#125;], xmerl_xml, [&#123;prolog, <span class="string">&quot;&quot;</span>&#125;]),</span><br><span class="line">    Xml.</span><br></pre></td></tr></table></figure><h3 id="相对完整的逻辑代码"><a href="#相对完整的逻辑代码" class="headerlink" title="相对完整的逻辑代码"></a>相对完整的逻辑代码</h3><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">notice_wx</span><span class="params">(UserName, PlayerId, Amount, OrderNum)</span> -&gt;</span></span><br><span class="line">    <span class="comment">%% 插入日志</span></span><br><span class="line">    insert_extract_log(OrderNum, Amount),</span><br><span class="line"></span><br><span class="line">    Url = <span class="string">&quot;https://api.mch.weixin.qq.com/mmpaymkttransfers/promotion/transfers&quot;</span>,</span><br><span class="line"></span><br><span class="line">    MchAppId = <span class="string">&quot;wx1234567890&quot;</span>,</span><br><span class="line">    MchId = <span class="number">1234567890</span>,</span><br><span class="line">    Key = <span class="string">&quot;key1234567890&quot;</span>,</span><br><span class="line">    Desc = <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="comment">%% 生成随机字符串</span></span><br><span class="line">    RandStr = util:rand_str(<span class="number">16</span>, <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>),</span><br><span class="line">    DataT = [</span><br><span class="line">            &#123;mch_appid, MchAppId&#125;,</span><br><span class="line">            &#123;mchid, MchId&#125;,</span><br><span class="line">            &#123;device_info, config:server_id()&#125;,</span><br><span class="line">            &#123;nonce_str, RandStr&#125;,</span><br><span class="line">            &#123;partner_trade_no, OrderNum&#125;,</span><br><span class="line">            &#123;openid, UserName&#125;,</span><br><span class="line">            &#123;check_name, <span class="string">&quot;NO_CHECK&quot;</span>&#125;,</span><br><span class="line">            &#123;amount, Amount&#125;,</span><br><span class="line">            &#123;desc, Desc&#125;</span><br><span class="line">           ],</span><br><span class="line">    Data = lists:sort(DataT),</span><br><span class="line">    DataStrList = lists:map( </span><br><span class="line">                    <span class="keyword">fun</span>(&#123;K, V&#125;) -&gt;</span><br><span class="line">                            io_lib:format(<span class="string">&quot;~p=~s&quot;</span>, [K, util:to_list(V)])</span><br><span class="line">                    <span class="keyword">end</span>, Data),</span><br><span class="line">    DataStr1 = string:join(DataStrList, <span class="string">&quot;&amp;&quot;</span>),</span><br><span class="line">    DataStr = lists:concat([DataStr1, <span class="string">&quot;&amp;key=&quot;</span>, Key]),</span><br><span class="line">    Sign = util:md5(DataStr),</span><br><span class="line">    Data1 = [&#123;sign, util:to_upper(Sign)&#125;|Data],</span><br><span class="line">    Str = export_xml(Data1),</span><br><span class="line"></span><br><span class="line">    <span class="comment">%% POST请求</span></span><br><span class="line">    <span class="keyword">case</span> request_post(Url, <span class="string">&quot;&quot;</span>, &#123;data, Str&#125;) <span class="keyword">of</span></span><br><span class="line">        &#123;ok, &#123;&#123;_,<span class="number">200</span>,<span class="string">&quot;OK&quot;</span>&#125;, _, Content&#125;&#125; -&gt;</span><br><span class="line">            Xml = scan_str(Content),</span><br><span class="line">            Val = value_of(<span class="string">&quot;return_code&quot;</span>, Xml),</span><br><span class="line">            <span class="keyword">case</span> Val <span class="keyword">of</span></span><br><span class="line">                <span class="string">&quot;SUCCESS&quot;</span> -&gt; </span><br><span class="line">                    Code = value_of(<span class="string">&quot;result_code&quot;</span>, Xml),</span><br><span class="line">                    <span class="keyword">case</span> Code <span class="keyword">of</span></span><br><span class="line">                        <span class="string">&quot;SUCCESS&quot;</span> -&gt; </span><br><span class="line">                            WxPayNo = value_of(<span class="string">&quot;payment_no&quot;</span>, Xml),</span><br><span class="line">                            <span class="comment">%% 更新日志</span></span><br><span class="line">                            update_extract_log(OrderNum, WxPayNo, ?WX_REDBAT_EXTRACT_STATE_SUCC, <span class="string">&quot;&quot;</span>);</span><br><span class="line">                        <span class="string">&quot;FAIL&quot;</span> -&gt;</span><br><span class="line">                            ErrCode = value_of(<span class="string">&quot;err_code&quot;</span>, Xml),</span><br><span class="line">                            ErrCodeDesc = value_of(<span class="string">&quot;err_code_des&quot;</span>, Xml),</span><br><span class="line">                            <span class="comment">%% 更新日志</span></span><br><span class="line">                            update_extract_log(OrderNum, <span class="string">&quot;&quot;</span>, ErrCode, ErrCodeDesc)</span><br><span class="line">                    <span class="keyword">end</span>;</span><br><span class="line">                <span class="string">&quot;FAIL&quot;</span> -&gt;</span><br><span class="line">                    Msg = value_of(<span class="string">&quot;return_msg&quot;</span>, Xml),</span><br><span class="line">                    update_extract_log(OrderNum, <span class="string">&quot;&quot;</span>, <span class="string">&quot;FAIL&quot;</span>, Msg),</span><br><span class="line">                    ?ERROR_MSG(<span class="string">&quot;return_msg: ~ts&quot;</span>, [utf8_list_to_string(Msg)])</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">        Ret -&gt;</span><br><span class="line">            ?ERROR_MSG(<span class="string">&quot;ret:~p&quot;</span>, [Ret])</span><br><span class="line">    <span class="keyword">end</span>.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">request_post</span><span class="params">(Url, Path, &#123;data, Str&#125;)</span> -&gt;</span></span><br><span class="line">    ReqUrl = lists:concat([Url, Path]),</span><br><span class="line">    SSLOptions = [</span><br><span class="line">        &#123;keyfile,<span class="string">&quot;apiclient_key.pem&quot;</span>&#125;,</span><br><span class="line">        &#123;certfile,<span class="string">&quot;apiclient_cert.pem&quot;</span>&#125;</span><br><span class="line">    ],</span><br><span class="line">    HTTPOptions = [&#123;ssl, SSLOptions&#125;, &#123;timeout, <span class="number">5000</span>&#125;, &#123;version, <span class="string">&quot;HTTP/1.1&quot;</span>&#125;],</span><br><span class="line">    Request = &#123;ReqUrl, [], <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>, iolist_to_binary(Str)&#125;,</span><br><span class="line">    httpc:request(post, Request, HTTPOptions, []).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">scan_str</span><span class="params">(Str)</span> -&gt;</span></span><br><span class="line">    &#123;XmlElement, _Rest&#125; = xmerl_scan:string(Str, [&#123;space, normalize&#125;]),</span><br><span class="line">    [XmlElement1] = xmerl_lib:remove_whitespace([XmlElement]),</span><br><span class="line">    XmlElement1.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">value_of</span><span class="params">(Key, #xmlElement&#123;&#125; = X)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">case</span> xmerl_xs:select(Key, X) <span class="keyword">of</span></span><br><span class="line">        [#xmlElement&#123;&#125; = Find] -&gt;</span><br><span class="line">            de_cdata(xmerl_xs:value_of(Find));</span><br><span class="line">        [] -&gt;</span><br><span class="line">            []</span><br><span class="line">    <span class="keyword">end</span>.</span><br><span class="line"><span class="function"><span class="title">de_cdata</span><span class="params">(<span class="string">&quot;![CDATA[&quot;</span> ++ Data)</span> -&gt;</span></span><br><span class="line">    [_,_|Data1] = lists:reverse(Data),</span><br><span class="line">    unescape_str(lists:reverse(Data1));</span><br><span class="line"><span class="function"><span class="title">de_cdata</span><span class="params">(Data)</span> -&gt;</span></span><br><span class="line">    unescape_str(Data).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">unescape_str</span><span class="params">(Str)</span> -&gt;</span></span><br><span class="line">    Str1 = unicode:characters_to_binary(Str),</span><br><span class="line">    GtEsc  = re:replace(Str1, <span class="string">&quot;&amp;amp;&quot;</span>, <span class="string">&quot;\\&amp;&quot;</span>, [global]),</span><br><span class="line">    LtEsc  = re:replace(GtEsc,  <span class="string">&quot;&amp;gt;&quot;</span>,  <span class="string">&quot;&gt;&quot;</span>,   [global]),</span><br><span class="line">    AmpEsc = re:replace(LtEsc,  <span class="string">&quot;&amp;lt;&quot;</span>,  <span class="string">&quot;&lt;&quot;</span>,   [global]),</span><br><span class="line">    Text   = re:replace(AmpEsc, <span class="string">&quot;&amp;amp;&quot;</span>, <span class="string">&quot;\\&amp;&quot;</span>, [global]),</span><br><span class="line">    util:to_list(Text).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">export_xml</span><span class="params">(List)</span> -&gt;</span></span><br><span class="line">    Fields = lists:map(</span><br><span class="line">               <span class="keyword">fun</span>(&#123;Key, Value&#125;) -&gt;</span><br><span class="line">                       &#123;Key, [], [util:to_list(Value)]&#125;</span><br><span class="line">               <span class="keyword">end</span>, List),</span><br><span class="line">    Xml = xmerl:export_simple([&#123;xml, Fields&#125;], xmerl_xml, [&#123;prolog, <span class="string">&quot;&quot;</span>&#125;]),</span><br><span class="line">    Xml.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">utf8_list_to_string</span><span class="params">(List)</span> -&gt;</span></span><br><span class="line">    unicode:characters_to_list(list_to_binary(List)).</span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="https://pay.weixin.qq.com/wiki/doc/api/tools/mch_pay.php?chapter=14_2">https://pay.weixin.qq.com/wiki/doc/api/tools/mch_pay.php?chapter=14_2</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos7/8超简单安装nginx-quic</title>
      <link href="/2020/11/06/centos/centos-nginx-quic/"/>
      <url>/2020/11/06/centos/centos-nginx-quic/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="https://hg.nginx.org/nginx-quic/shortlog/quic">nginx-quic</a>是nginx正在开发中的支持http3的版本<br>目前网上大部分的文章都是基于源码编译安装的<br><strong>但对于我这种只有一台垃圾服务器的玩家，源码编译不太现实</strong><br>找了好久，终于找到一个可以直接yum安装的版本：<span id="more"></span><br><a href="https://copr.fedorainfracloud.org/coprs/ryoh/nginx-quic/">https://copr.fedorainfracloud.org/coprs/ryoh/nginx-quic/</a><br>其他发行版可能还是要源码编译。。。</p><p>安装后感觉是访问变快了，也可能是心理作用吧</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>For CentOS 7</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install epel-release</span><br><span class="line">sudo yum install centos-release-scl</span><br><span class="line">sudo yum install yum-plugin-copr</span><br><span class="line">sudo yum copr enable ryoh/nginx-quic</span><br><span class="line">sudo yum install nginx-quic</span><br></pre></td></tr></table></figure><p>For CentOS 8</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf install epel-release</span><br><span class="line">sudo dnf copr enable ryoh/nginx-quic</span><br><span class="line">sudo dnf install nginx-quic</span><br></pre></td></tr></table></figure><blockquote><p>备注：nginx 与 nginx-quic 不能共存，注意备份数据</p></blockquote><p>配置：<br>在<code>server&#123;&#125;</code>中添加</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">listen 443 http3 reuseport;  # UDP listener for QUIC+HTTP/3</span><br><span class="line">ssl_protocols TLSv1.3; # QUIC requires TLS 1.3</span><br><span class="line">add_header Alt-Svc &#x27;$http3=&quot;:443&quot;; ma=86400&#x27;; # Advertise that QUIC is available</span><br><span class="line">add_header QUIC-Status $quic;</span><br></pre></td></tr></table></figure><h2 id="检测是否成功"><a href="#检测是否成功" class="headerlink" title="检测是否成功"></a>检测是否成功</h2><ol><li><p><a href="https://http3check.net/">https://http3check.net/</a></p></li><li><p>Firefox启动<br><code>about:config</code><br><code>network.http.http3.enabled</code>设置为<code>true</code><br><img src="/downloads/assets/http3.png" alt="效果图如下"></p></li></ol><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>1 首次启动失败</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx: [emerg] cannot load certificate &quot;/etc/pki/tls/certs/localhost.crt&quot;: BIO_new_file() ...</span><br></pre></td></tr></table></figure><p>是因为在<code>/etc/nginx/vhost.d/http/00-default.conf</code>有配置本地签名<br>可以将其改名 <code>00-default.conf_bak</code> 或者在本地生成一个证书</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/pki/tls/private/localhost.key -out /etc/ssl/certs/localhost.crt</span><br></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://copr.fedorainfracloud.org/coprs/ryoh/nginx-quic/">https://copr.fedorainfracloud.org/coprs/ryoh/nginx-quic/</a></li><li><a href="https://serverfault.com/questions/648534/accidently-removed-localhost-crt-ssl-in-centos-6-what-can-i-do">https://serverfault.com/questions/648534/accidently-removed-localhost-crt-ssl-in-centos-6-what-can-i-do</a></li><li><a href="https://zhuanlan.zhihu.com/p/159100819">https://zhuanlan.zhihu.com/p/159100819</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows下使用命令行将OpenSSH Key转换为ppk</title>
      <link href="/2020/10/14/windows/windows-puttygen-command/"/>
      <url>/2020/10/14/windows/windows-puttygen-command/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>LINUX下可以通过安装<code>putty-tools</code>,使用<code>puttygen</code>转换</p></blockquote><p><strong>Windows下，<code>PUTTYGEN</code>是不支持使用命令行的</strong>，可以使用<code>WinSCP</code>实现命令行下转换：<br><code>WinSCP.com /keygen private_key /output=vagrant.ppk /comment=vagrant</code></p><hr><p>配合<code>pageant.exe</code>，可以实现在vagrant中快速添加key，再使用**<a href="/2019/12/26/windows/windows-kitty-winscp-mtputty/">MTPUTTY</a>**登录虚拟机</p><figure class="highlight bat"><figcaption><span>add_key.bat</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">set</span> &quot;WINSCP_DIR=C:\Program Files (x86)\WinSCP&quot;</span><br><span class="line">&quot;<span class="variable">%WINSCP_DIR%</span>\WinSCP.com&quot; /keygen .vagrant\machines\default\virtualbox\private_key /output=vagrant.ppk /comment=vagrant</span><br><span class="line">pageant.exe vagrant.ppk</span><br><span class="line"><span class="built_in">del</span> vagrant.ppk</span><br></pre></td></tr></table></figure><blockquote><p>备注：使用<code>vagrant ssh-config</code>可以查看具体private key文件位置、ssh端口等信息</p></blockquote><figure class="highlight ruby"><figcaption><span>Vagrantfile</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Vagrant.configure(<span class="string">&quot;2&quot;</span>) <span class="keyword">do</span> <span class="params">|config|</span></span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">system(<span class="string">&#x27;./add_key.bat&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决Google搜索跳转到yahoo</title>
      <link href="/2020/09/17/other/other-google-search-redirect-yahoo/"/>
      <url>/2020/09/17/other/other-google-search-redirect-yahoo/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>个人使用<code>Edge Beta浏览器</code><br>今天使用Google搜索的时候，会跳转到yahoo搜索，很是烦人<br>中间有个跳转链接是<code>www.coolnewtabtheme.com/...</code></p><p><del>一开始有文章说在搜索引擎管理将yahoo的删掉，发现<strong>没用</strong></del></p><blockquote><p><strong>正确的解决方案：</strong><br><strong>禁用所有的扩展，然后一个一个开启，然后验证Google搜索是否正常</strong></p></blockquote><p>个人最后排查出有问题的插件：<code>TabSplit</code>，到<code>Google Web Store</code>看了下，已经没有这个插件了<br>是否用<code>Chrome浏览器</code>就不会有这种安全问题了？？？</p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://forum.vivaldi.net/topic/48969/google-search-switches-automatically-to-yahoo/6">https://forum.vivaldi.net/topic/48969/google-search-switches-automatically-to-yahoo/6</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zeal添加文档的历史版本</title>
      <link href="/2020/08/18/other/other-zeal/"/>
      <url>/2020/08/18/other/other-zeal/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="https://zealdocs.org/">Zeal</a>是支持超多语言的离线文档查看器<br>默认只会下载最新版本，项目中使用旧版本的文档，需要旧版本的文档，记录下添加方式</p><span id="more"></span><p>以<code>Erlang21.2</code>为例记录下，安装旧版本的文档</p><h2 id="找到下载链接"><a href="#找到下载链接" class="headerlink" title="找到下载链接"></a>找到下载链接</h2><p>先从 <a href="https://github.com/Kapeli/feeds">https://github.com/Kapeli/feeds</a> 查看<code>Erlang.xml</code>，内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>23.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ios_version</span>&gt;</span>1<span class="tag">&lt;/<span class="name">ios_version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://sanfrancisco.kapeli.com/feeds/Erlang.tgz<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://london.kapeli.com/feeds/Erlang.tgz<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://newyork.kapeli.com/feeds/Erlang.tgz<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://tokyo.kapeli.com/feeds/Erlang.tgz<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://frankfurt.kapeli.com/feeds/Erlang.tgz<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://singapore.kapeli.com/feeds/Erlang.tgz<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">other-versions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span>23.0<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span>22.3<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span>22.2<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span>22.1<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span>22.0<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span>21.3<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span>21.2<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span>21.1<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">other-versions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br></pre></td></tr></table></figure><p>通过 <a href="https://jlice.top/p/879df/">https://jlice.top/p/879df/</a> 文章获得历史版本链接模板：<br><a href="http://sanfrancisco.kapeli.com/feeds/zzz/versions/%7BDocsetName%7D/%7Bversion%7D/%7BDocsetName%7D.tgz">http://sanfrancisco.kapeli.com/feeds/zzz/versions/{DocsetName}/{version}/{DocsetName}.tgz</a></p><p>替换后的链接：<br><code>http://sanfrancisco.kapeli.com/feeds/zzz/versions/Erlang/21.2/Erlang.tgz</code></p><h2 id="自定义xml"><a href="#自定义xml" class="headerlink" title="自定义xml"></a>自定义xml</h2><p>自定义xml文件名字：<code>Erlang21.2.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>21.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ios_version</span>&gt;</span>1<span class="tag">&lt;/<span class="name">ios_version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://sanfrancisco.kapeli.com/feeds/zzz/versions/Erlang/21.2/Erlang.tgz<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://london.kapeli.com/feeds/zzz/versions/Erlang/21.2/Erlang.tgz<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://newyork.kapeli.com/feeds/zzz/versions/Erlang/21.2/Erlang.tgz<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://tokyo.kapeli.com/feeds/zzz/versions/Erlang/21.2/Erlang.tgz<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://frankfurt.kapeli.com/feeds/zzz/versions/Erlang/21.2/Erlang.tgz<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://singapore.kapeli.com/feeds/zzz/versions/Erlang/21.2/Erlang.tgz<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">other-versions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">other-versions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>Add Feed</code>添加链接<code>file:///E:/web/zeal/Erlang21.2.xml</code></p><blockquote><p>E:/web/zeal/Erlang21.2.xml 是 xml的路径</p></blockquote><h2 id="修改搜索名字"><a href="#修改搜索名字" class="headerlink" title="修改搜索名字"></a>修改搜索名字</h2><p>在zeal安装目录下找到<code>docsets/Erlang21.2.docset/Contents/Info.plist</code>文件，将<code>erlang</code>修改为<code>erlang21</code><br>重启后就可以使用<code>erlang21: lists:seq</code>查询文档了</p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://jlice.top/p/879df/">https://jlice.top/p/879df/</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>powershell实现的股票查看小工具</title>
      <link href="/2020/06/05/windows/window-powershell-stock/"/>
      <url>/2020/06/05/windows/window-powershell-stock/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/downloads/code/stock/stock.gif" alt="效果展示"></p><span id="more"></span><p>包括配置文件(<a href="/downloads/code/stock/stock.json">stock.json</a>)和代码(<a href="/downloads/code/stock/stock.ps1">stock.ps1</a>)</p><blockquote><p><font color=darkred>备注: 下载后将两个文件的编码修改为GBK(CP936)</font></p></blockquote><p>下面是完整的代码:</p><figure class="highlight json"><figcaption><span>配置文件</span><a href="/downloads/code/stock/stock.json">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">&quot;comment_stock_list&quot;</span>: <span class="string">&quot;股票代码,若不是很清楚,使用http://hq.sinajs.cn/list=sh000001看下是否有返回&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;stock_list&quot;</span>: [</span><br><span class="line">        {<span class="attr">&quot;stock_id&quot;</span>: <span class="string">&quot;sz002548&quot;</span>, <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;金新农&quot;</span>},</span><br><span class="line">        {<span class="attr">&quot;stock_id&quot;</span>: <span class="string">&quot;sh603005&quot;</span>, <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;晶方科技&quot;</span>},</span><br><span class="line">        {<span class="attr">&quot;stock_id&quot;</span>: <span class="string">&quot;sz000725&quot;</span>, <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;京东方A&quot;</span>},</span><br><span class="line">        {<span class="attr">&quot;stock_id&quot;</span>: <span class="string">&quot;sh601012&quot;</span>, <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;隆基股份&quot;</span>},</span><br><span class="line">        {<span class="attr">&quot;stock_id&quot;</span>: <span class="string">&quot;sz300722&quot;</span>, <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;新余国科&quot;</span>},</span><br><span class="line">        {<span class="attr">&quot;stock_id&quot;</span>: <span class="string">&quot;sz300564&quot;</span>, <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;筑博设计&quot;</span>},</span><br><span class="line">        {<span class="attr">&quot;stock_id&quot;</span>: <span class="string">&quot;sz000708&quot;</span>, <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;中信特钢&quot;</span>},</span><br><span class="line">        {<span class="attr">&quot;stock_id&quot;</span>: <span class="string">&quot;sz002625&quot;</span>, <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;光启技术&quot;</span>},</span><br><span class="line">        {<span class="attr">&quot;stock_id&quot;</span>: <span class="string">&quot;sz002230&quot;</span>, <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;科大讯飞&quot;</span>},</span><br><span class="line">        {<span class="attr">&quot;stock_id&quot;</span>: <span class="string">&quot;sz002156&quot;</span>, <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;通富微电&quot;</span>}</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;comment_refresh_time&quot;</span>: <span class="string">&quot;刷新时间&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;refresh_time&quot;</span>: <span class="number">10</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><figcaption><span>代码</span><a href="/downloads/code/stock/stock.ps1">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 使用powershell查看股票</span></span><br><span class="line"><span class="comment">## kingwen0302@msn.com</span></span><br><span class="line"><span class="comment">## www.mingilin.com</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$cfgPath</span> = <span class="built_in">Join-Path</span> <span class="variable">$PSScriptRoot</span> <span class="string">&quot;stock.json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadStockCode</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="variable">$json</span> = <span class="built_in">Get-Content</span> <span class="variable">$cfgPath</span> | <span class="built_in">ConvertFrom-Json</span></span><br><span class="line">    <span class="variable">$json</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">## -1: 股票代码;</span></span><br><span class="line"><span class="comment">## 0:&quot;大秦铁路&quot;,股票名字;</span></span><br><span class="line"><span class="comment">## 1:&quot;27.55&quot;,今日开盘价;</span></span><br><span class="line"><span class="comment">## 2:&quot;27.25&quot;,昨日收盘价;</span></span><br><span class="line"><span class="comment">## 3:&quot;26.91&quot;,当前价格;</span></span><br><span class="line"><span class="comment">## 4:&quot;27.55&quot;,今日最高价;</span></span><br><span class="line"><span class="comment">## 5:&quot;26.20&quot;,今日最低价;</span></span><br><span class="line"><span class="comment">## 6:&quot;26.91&quot;,竞买价,即“买一&quot;报价;</span></span><br><span class="line"><span class="comment">## 7:&quot;26.92&quot;,竞卖价,即“卖一&quot;报价;</span></span><br><span class="line"><span class="comment">## 8:&quot;22114263&quot;,成交的股票数,由于股票交易以一百股为基本单位,所以在使用时,通常把该值除以一百;</span></span><br><span class="line"><span class="comment">## 9:&quot;589824680&quot;,成交金额,单位为“元&quot;,为了一目了然,通常以“万元&quot;为成交金额的单位,所以通常把该值除以一万;</span></span><br><span class="line"><span class="comment">## 10:&quot;4695&quot;,“买一&quot;申请4695股,即47手;</span></span><br><span class="line"><span class="comment">## 11:&quot;26.91&quot;,“买一&quot;报价;</span></span><br><span class="line"><span class="comment">## 12:&quot;57590&quot;,“买二&quot;</span></span><br><span class="line"><span class="comment">## 13:&quot;26.90&quot;,“买二&quot;</span></span><br><span class="line"><span class="comment">## 14:&quot;14700&quot;,“买三&quot;</span></span><br><span class="line"><span class="comment">## 15:&quot;26.89&quot;,“买三&quot;</span></span><br><span class="line"><span class="comment">## 16:&quot;14300&quot;,“买四&quot;</span></span><br><span class="line"><span class="comment">## 17:&quot;26.88&quot;,“买四&quot;</span></span><br><span class="line"><span class="comment">## 18:&quot;15100&quot;,“买五&quot;</span></span><br><span class="line"><span class="comment">## 19:&quot;26.87&quot;,“买五&quot;</span></span><br><span class="line"><span class="comment">## 20:&quot;3100&quot;,“卖一&quot;申报3100股,即31手;</span></span><br><span class="line"><span class="comment">## 21:&quot;26.92&quot;,“卖一&quot;报价</span></span><br><span class="line"><span class="comment">## (22, 23), (24, 25), (26,27), (28, 29)分别为“卖二&quot;至“卖四的情况&quot;</span></span><br><span class="line"><span class="comment">## 30:&quot;2008-01-11&quot;,日期;</span></span><br><span class="line"><span class="comment">## 31:&quot;15:05:32&quot;,时间;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ShowOne</span><span class="params">([string]<span class="variable">$content</span>)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$content</span> <span class="operator">-match</span> <span class="string">&quot;^\n<span class="variable">$</span>&quot;</span>) {</span><br><span class="line">    } <span class="keyword">else</span>{</span><br><span class="line">        <span class="variable">$str_splits</span> = <span class="variable">$content</span>.Split(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">        <span class="variable">$stockName</span> = <span class="variable">$str_splits</span>[<span class="number">0</span>].split(<span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable">$myStockId</span> = <span class="variable">$stockName</span>[<span class="number">0</span>].Split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>].Split(<span class="string">&#x27;_&#x27;</span>)[<span class="number">2</span>]</span><br><span class="line">        <span class="variable">$myStock</span> = <span class="variable">$stockName</span>[<span class="number">1</span>]</span><br><span class="line">        <span class="variable">$lastPrice</span> = <span class="variable">$str_splits</span>[<span class="number">2</span>]</span><br><span class="line">        <span class="variable">$nowPrice</span> = <span class="variable">$str_splits</span>[<span class="number">3</span>]</span><br><span class="line">        <span class="variable">$higePrice</span> = <span class="variable">$str_splits</span>[<span class="number">4</span>]</span><br><span class="line">        <span class="variable">$lowPrice</span>= <span class="variable">$str_splits</span>[<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">        <span class="variable">$exchange</span> = (<span class="variable">$str_splits</span>[<span class="number">9</span>] / <span class="number">10000</span>) <span class="operator">-as</span> [<span class="built_in">int</span>]</span><br><span class="line"></span><br><span class="line">        <span class="variable">$buy1Count</span> = (<span class="variable">$str_splits</span>[<span class="number">10</span>] / <span class="number">100</span>) <span class="operator">-as</span> [<span class="built_in">int</span>]</span><br><span class="line">        <span class="variable">$buy1Price</span> = <span class="variable">$str_splits</span>[<span class="number">11</span>]</span><br><span class="line">        <span class="variable">$sale1Count</span> = (<span class="variable">$str_splits</span>[<span class="number">20</span>] / <span class="number">100</span>) <span class="operator">-as</span> [<span class="built_in">int</span>]</span><br><span class="line">        <span class="variable">$sale1Price</span> = <span class="variable">$str_splits</span>[<span class="number">21</span>]</span><br><span class="line"></span><br><span class="line"><span class="variable">$diffPrice</span> = <span class="variable">$nowPrice</span> - <span class="variable">$lastPrice</span></span><br><span class="line">        <span class="variable">$priceP</span> = <span class="variable">$diffPrice</span> / <span class="variable">$lastPrice</span></span><br><span class="line"><span class="comment">#        [double] $a=&quot;{0:0.####}&quot; -f $priceP</span></span><br><span class="line"><span class="comment">#        $b=&quot;{0:p2}&quot; -f $a</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$b</span> = <span class="string">&quot;{0:p2}&quot;</span> <span class="operator">-f</span> <span class="variable">$priceP</span></span><br><span class="line">        <span class="variable">$dp</span>=<span class="string">&quot;{0:0.####}&quot;</span> <span class="operator">-f</span> <span class="variable">$diffPrice</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>([<span class="type">convert</span>]::ToDouble(<span class="variable">$lastPrice</span>) <span class="operator">-gt</span> [<span class="type">convert</span>]::ToDouble(<span class="variable">$nowPrice</span>) ) {</span><br><span class="line">            <span class="variable">$myColor</span>=<span class="string">&quot;Green&quot;</span></span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="variable">$myColor</span>=<span class="string">&quot;Red&quot;</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>([<span class="type">convert</span>]::ToDouble(<span class="variable">$sale1Count</span>) <span class="operator">-gt</span> [<span class="type">convert</span>]::ToDouble(<span class="variable">$buy1Count</span>)) {</span><br><span class="line">            <span class="variable">$saleColor</span> = <span class="string">&quot;DarkGreen&quot;</span></span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="variable">$saleColor</span> = <span class="string">&quot;DarkRed&quot;</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="literal">-NoNewline</span> <span class="literal">-ForegroundColor</span> <span class="variable">$myColor</span> (<span class="string">&quot;<span class="variable">$myStockId</span>&quot;</span>.PadRight(<span class="number">10</span>))</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="literal">-NoNewline</span> <span class="literal">-ForegroundColor</span> <span class="variable">$myColor</span> <span class="string">&quot;<span class="variable">$myStock</span>`t&quot;</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="literal">-NoNewline</span> <span class="literal">-ForegroundColor</span> <span class="variable">$myColor</span> <span class="string">&quot;N<span class="variable">$nowPrice</span>&quot;</span>.PadRight(<span class="number">10</span>) <span class="string">&quot;(&quot;</span> <span class="string">&quot;<span class="variable">$dp</span>&quot;</span>.PadLeft(<span class="number">8</span>) <span class="string">&quot;<span class="variable">$b</span>&quot;</span>.PadLeft(<span class="number">8</span>) <span class="string">&quot;) &quot;</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="literal">-NoNewline</span> <span class="literal">-ForegroundColor</span> <span class="variable">$myColor</span> <span class="string">&quot;H<span class="variable">$higePrice</span>&quot;</span>.PadRight(<span class="number">10</span>)</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="literal">-NoNewline</span> <span class="literal">-ForegroundColor</span> <span class="variable">$myColor</span> <span class="string">&quot;L<span class="variable">$lowPrice</span>&quot;</span>.PadRight(<span class="number">10</span>)</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="literal">-NoNewline</span> <span class="literal">-BackgroundColor</span> <span class="variable">$saleColor</span> <span class="literal">-ForegroundColor</span> <span class="variable">$myColor</span> <span class="string">&quot;S<span class="variable">$sale1Price</span> (<span class="variable">$sale1Count</span>)&quot;</span>.PadRight(<span class="number">20</span>)</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="literal">-NoNewline</span> <span class="literal">-BackgroundColor</span> <span class="variable">$saleColor</span> <span class="literal">-ForegroundColor</span> <span class="variable">$myColor</span> <span class="string">&quot;B<span class="variable">$buy1Price</span> (<span class="variable">$buy1Count</span>)&quot;</span>.PadRight(<span class="number">20</span>)</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="literal">-NoNewline</span> <span class="literal">-ForegroundColor</span> <span class="variable">$myColor</span> (<span class="string">&quot;E<span class="variable">$exchange</span>&quot;</span>).PadRight(<span class="number">6</span>)</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ShowOne2</span><span class="params">([string]<span class="variable">$content</span>)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$content</span> <span class="operator">-match</span> <span class="string">&quot;^\n<span class="variable">$</span>&quot;</span>)</span><br><span class="line">    {</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        <span class="variable">$str_splits</span> = <span class="variable">$content</span>.Split(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">        <span class="variable">$stockName</span> = <span class="variable">$str_splits</span>[<span class="number">0</span>].split(<span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line">        <span class="variable">$myStockId</span> = <span class="variable">$stockName</span>[<span class="number">0</span>].Split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>].Split(<span class="string">&#x27;_&#x27;</span>)[<span class="number">3</span>]</span><br><span class="line">        <span class="variable">$myStock</span> = <span class="variable">$stockName</span>[<span class="number">1</span>]</span><br><span class="line">        <span class="variable">$nowPrice</span> = <span class="variable">$str_splits</span>[<span class="number">1</span>]</span><br><span class="line">        <span class="variable">$ricePrice</span> = <span class="variable">$str_splits</span>[<span class="number">2</span>]</span><br><span class="line">        <span class="variable">$ricePriceP</span> = <span class="variable">$str_splits</span>[<span class="number">3</span>]</span><br><span class="line">        <span class="variable">$mon</span>=<span class="variable">$str_splits</span>[<span class="number">5</span>].Replace(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$ricePrice</span> <span class="operator">-match</span> <span class="string">&#x27;^-&#x27;</span>) {</span><br><span class="line">            <span class="variable">$myColor</span>=<span class="string">&quot;Green&quot;</span></span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="variable">$myColor</span>=<span class="string">&quot;Red&quot;</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="literal">-NoNewline</span> <span class="literal">-ForegroundColor</span> <span class="variable">$myColor</span> (<span class="string">&quot;<span class="variable">$myStockId</span>&quot;</span>.PadRight(<span class="number">10</span>))</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="literal">-NoNewline</span> <span class="literal">-ForegroundColor</span> <span class="variable">$myColor</span> <span class="string">&quot;<span class="variable">$myStock</span>`t&quot;</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="literal">-NoNewline</span> <span class="literal">-ForegroundColor</span> <span class="variable">$myColor</span> <span class="string">&quot;N<span class="variable">$nowPrice</span>&quot;</span>.PadRight(<span class="number">10</span>) <span class="string">&quot;(&quot;</span> <span class="string">&quot;<span class="variable">$ricePrice</span>&quot;</span>.PadLeft(<span class="number">8</span>) <span class="string">&quot;<span class="variable">$ricePriceP</span>%&quot;</span>.PadLeft(<span class="number">8</span>) <span class="string">&quot;) &quot;</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="literal">-NoNewline</span> <span class="literal">-ForegroundColor</span> <span class="variable">$myColor</span> (<span class="string">&quot;M<span class="variable">$mon</span>&quot;</span>.PadRight(<span class="number">20</span>))</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ShowOne4</span><span class="params">([string]<span class="variable">$content</span>)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$content</span> <span class="operator">-match</span> <span class="string">&quot;^\n<span class="variable">$</span>&quot;</span>)</span><br><span class="line">    {</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        <span class="variable">$str_splits</span> = <span class="variable">$content</span>.Split(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">        <span class="variable">$stockName</span> = <span class="variable">$str_splits</span>[<span class="number">0</span>].split(<span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line">        <span class="variable">$myStockId</span> = <span class="variable">$stockName</span>[<span class="number">0</span>].Split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>].Split(<span class="string">&#x27;_&#x27;</span>)[<span class="number">3</span>]</span><br><span class="line">        <span class="variable">$myStock</span> = <span class="variable">$stockName</span>[<span class="number">1</span>]</span><br><span class="line">        <span class="variable">$nowPrice</span> = <span class="variable">$str_splits</span>[<span class="number">1</span>]</span><br><span class="line">        <span class="variable">$ricePrice</span> = <span class="variable">$str_splits</span>[<span class="number">2</span>]</span><br><span class="line">        <span class="variable">$ricePriceP</span> = <span class="variable">$str_splits</span>[<span class="number">3</span>].Replace(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$ricePrice</span> <span class="operator">-match</span> <span class="string">&#x27;^-&#x27;</span>) {</span><br><span class="line">            <span class="variable">$myColor</span>=<span class="string">&quot;Green&quot;</span></span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="variable">$myColor</span>=<span class="string">&quot;Red&quot;</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="literal">-NoNewline</span> <span class="literal">-ForegroundColor</span> <span class="variable">$myColor</span> (<span class="string">&quot;<span class="variable">$myStockId</span>&quot;</span>.PadRight(<span class="number">10</span>))</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="literal">-NoNewline</span> <span class="literal">-ForegroundColor</span> <span class="variable">$myColor</span> <span class="string">&quot;<span class="variable">$myStock</span>`t&quot;</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="literal">-NoNewline</span> <span class="literal">-ForegroundColor</span> <span class="variable">$myColor</span> <span class="string">&quot;N<span class="variable">$nowPrice</span>&quot;</span>.PadRight(<span class="number">10</span>) <span class="string">&quot;(&quot;</span> <span class="string">&quot;<span class="variable">$ricePrice</span>&quot;</span>.PadLeft(<span class="number">8</span>) <span class="string">&quot;<span class="variable">$ricePriceP</span>%&quot;</span>.PadLeft(<span class="number">8</span>) <span class="string">&quot;) &quot;</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ShowOne3</span><span class="params">(<span class="variable">$stockCode</span>)</span></span> {</span><br><span class="line"></span><br><span class="line">    <span class="variable">$date</span> = <span class="built_in">Get-Date</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="literal">-BackgroundColor</span> Blue <span class="string">&quot;配置文件: <span class="variable">$cfgPath</span>&quot;</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="literal">-BackgroundColor</span> DarkRed <span class="string">&quot;刷新时间: <span class="variable">$date</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;=&quot;</span>*<span class="number">130</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="literal">-ForegroundColor</span> Yellow <span class="string">&quot;N-当前价格; H-今日最高价格; L-今日最低价格 B-买1价格,买1数量 S-卖1价格,卖1数量 E-交易金额(万元)&quot;</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="literal">-BackgroundColor</span> DarkRed <span class="string">&quot;`t`t`t`t`t`t`t`tPOWERED BY kingwen0302@msn.com(https://www.mingilin.com)&quot;</span></span><br><span class="line">    <span class="string">&quot;-&quot;</span>*<span class="number">130</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## 显示指数</span></span><br><span class="line">    <span class="variable">$sourceURL</span> = <span class="string">&quot;http://hq.sinajs.cn/list=s_sh000001,s_sz399001&quot;</span></span><br><span class="line">    <span class="variable">$wc</span> = <span class="built_in">New-Object</span> system.net.webclient</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$wc</span>.downloadstring(<span class="variable">$sourceURL</span>)</span><br><span class="line">    <span class="variable">$content</span>.Split(<span class="string">&#x27;;&#x27;</span>) | <span class="built_in">ForEach-Object</span> {ShowOne2 <span class="variable">$_</span> }</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 显示国外指数</span></span><br><span class="line">    <span class="comment">## $sourceURL = &quot;http://hq.sinajs.cn/list=int_dji,int_nasdaq,int_hangseng,int_nikkei,b_TWSE,b_FSSTI&quot;</span></span><br><span class="line">    <span class="comment">## $wc = New-Object system.net.webclient</span></span><br><span class="line">    <span class="comment">## $content = $wc.downloadstring($sourceURL)</span></span><br><span class="line">    <span class="comment">## $content.Split(&#x27;;&#x27;) | ForEach-Object {ShowOne4 $_ }</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;-&quot;</span>*<span class="number">130</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## 显示个股</span></span><br><span class="line">    <span class="variable">$sourceURL</span> = <span class="string">&quot;http://hq.sinajs.cn/list=<span class="variable">$stockCode</span>&quot;</span></span><br><span class="line">    <span class="variable">$wc</span> = <span class="built_in">New-Object</span> system.net.webclient</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$wc</span>.downloadstring(<span class="variable">$sourceURL</span>)</span><br><span class="line">    <span class="variable">$content</span>.Split(<span class="string">&#x27;;&#x27;</span>) | <span class="built_in">ForEach-Object</span> {ShowOne <span class="variable">$_</span> }</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;=&quot;</span>*<span class="number">130</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>) {</span><br><span class="line">    <span class="built_in">Clear-Host</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$json</span> = loadStockCode</span><br><span class="line"></span><br><span class="line">    <span class="variable">$stockCode</span> = <span class="variable">$json</span>.stock_list | <span class="built_in">ForEach-Object</span> {<span class="variable">$_</span>.stock_id}</span><br><span class="line">    <span class="variable">$stockCode</span> = <span class="variable">$stockCode</span> <span class="operator">-Join</span> <span class="string">&quot;,&quot;</span></span><br><span class="line">    ShowOne3 <span class="variable">$stockCode</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$refreshTime</span> = <span class="variable">$json</span>.refresh_time</span><br><span class="line">    <span class="built_in">Start-Sleep</span> <span class="variable">$refreshTime</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>几种开源网盘整理</title>
      <link href="/2020/03/13/centos/centos-filemanager-list/"/>
      <url>/2020/03/13/centos/centos-filemanager-list/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>记录下自己使用过的开源网盘: <code>KODExplorer</code>,<code>NextCloud</code></p></blockquote><span id="more"></span><h2 id="KODExplorer"><a href="#KODExplorer" class="headerlink" title="KODExplorer"></a>KODExplorer</h2><p>芒果云是一个开源网盘,支持在线编辑和预览文件, 付费版功能更多, 该网盘不需要数据库支持<br><a href="http://kodcloud.com/index.html">http://kodcloud.com/index.html</a></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yum install -y http://rpms.remirepo.net/enterprise/remi-release-7.rpm</span><br><span class="line">yum install -y php72 php72-php-fpm nginx php72-php-mbstring php72-php-gd httpd-tools</span><br><span class="line">systemctl enable nginx</span><br><span class="line">systemctl enable php72-php-fpm</span><br><span class="line">systemctl start nginx</span><br><span class="line">systemctl start php72-php-fpm</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 下载源码</span></span></span><br><span class="line">git clone https://github.com/kalcaddle/KODExplorer.git</span><br><span class="line">chmod -Rf 777 ./KODExplorer/*</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 这个一步一定要, 否则会提示权限不足</span></span></span><br><span class="line">chmod 777 ./KODExplorer</span><br></pre></td></tr></table></figure><h3 id="NGINX-配置"><a href="#NGINX-配置" class="headerlink" title="NGINX 配置"></a>NGINX 配置</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 其他配置...</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">charset</span> utf8;</span><br><span class="line">        <span class="attribute">root</span>   /data/KODExplorer;</span><br><span class="line">        <span class="attribute">index</span> index.php;</span><br><span class="line">        <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">autoindex_exact_size</span> <span class="literal">off</span>;</span><br><span class="line">        <span class="attribute">autoindex_localtime</span> <span class="literal">on</span>;</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">         <span class="attribute">root</span>           /data/KODExplorer;</span><br><span class="line">         <span class="attribute">fastcgi_pass</span>   <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">         <span class="attribute">fastcgi_index</span>  index.php;</span><br><span class="line">         <span class="attribute">fastcgi_param</span>  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">         <span class="attribute">fastcgi_connect_timeout</span> <span class="number">75</span>;</span><br><span class="line">         <span class="attribute">fastcgi_read_timeout</span> <span class="number">1200</span>;</span><br><span class="line">         <span class="attribute">fastcgi_send_timeout</span> <span class="number">1200</span>;</span><br><span class="line">         <span class="attribute">include</span>        fastcgi_params;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">## 其他配置...</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /filemanager/ &#123;</span><br><span class="line">        <span class="attribute">root</span> /data/web;</span><br><span class="line">        <span class="attribute">index</span> index.php;</span><br><span class="line">        <span class="attribute">location</span> ~\.php$ &#123;</span><br><span class="line">            <span class="attribute">fastcgi_pass</span>   <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">            <span class="attribute">fastcgi_index</span>  index.php;</span><br><span class="line">            <span class="attribute">fastcgi_param</span>  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">            <span class="attribute">fastcgi_connect_timeout</span> <span class="number">75</span>; </span><br><span class="line">            <span class="attribute">fastcgi_read_timeout</span> <span class="number">1200</span>;</span><br><span class="line">            <span class="attribute">fastcgi_send_timeout</span> <span class="number">1200</span>;</span><br><span class="line">            <span class="attribute">include</span>        fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>不要折腾alias了,太麻烦了,直接root就可以了<br>root要求源码目录地址是/data/web/filemanager/</p></blockquote><h2 id="NextCloud"><a href="#NextCloud" class="headerlink" title="NextCloud"></a>NextCloud</h2><p><a href="https://nextcloud.com/">NextCloud</a>是国外的一款开源网盘，相较于<a href="http://kodcloud.com/">芒果云</a>，个人感觉是客户端比较完善。但是，要求服务器偏高，无奈放弃。</p><!-- more --><h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><ul><li><code>PHP5.6</code>（<a href="https://www.mingilin.com/2017/09/29/centos/centos-php56/">安装方式</a>）<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">rpm -qa | grep php</span></span><br><span class="line">php71w-pdo-7.1.10-1.w6.i386</span><br><span class="line">php71w-opcache-7.1.10-1.w6.i386</span><br><span class="line">mod_php71w-7.1.10-1.w6.i386</span><br><span class="line">php71w-mysql-7.1.10-1.w6.i386</span><br><span class="line">php71w-gd-7.1.10-1.w6.i386</span><br><span class="line">php71w-common-7.1.10-1.w6.i386</span><br><span class="line">php71w-fpm-7.1.10-1.w6.i386</span><br><span class="line">php71w-xml-7.1.10-1.w6.i386</span><br><span class="line">php71w-cli-7.1.10-1.w6.i386</span><br><span class="line">php71w-mbstring-7.1.10-1.w6.i386</span><br></pre></td></tr></table></figure></li><li><code>MYSQL</code>（可选）</li></ul><h3 id="NGINX-配置-1"><a href="#NGINX-配置-1" class="headerlink" title="NGINX 配置"></a>NGINX 配置</h3><figure class="highlight nginx"><figcaption><span>nextcloud配置备份</span><a href="/downloads/code/nextcloud.web.mingilin.com.conf_bak">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> php-handler {</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">    <span class="comment">#server unix:/var/run/php5-fpm.sock;</span></span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="section">server</span> {</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> nextcloud.web.mingilin.com;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Add headers to serve security related headers</span></span><br><span class="line">    <span class="comment"># Before enabling Strict-Transport-Security headers please read into this topic first.</span></span><br><span class="line">    <span class="attribute">add_header</span> Strict-Transport-Security <span class="string">&quot;max-age=15552000; includeSubDomains&quot;</span>;</span><br><span class="line">    <span class="attribute">add_header</span> X-Content-Type-Options nosniff;</span><br><span class="line">    <span class="attribute">add_header</span> X-Frame-Options <span class="string">&quot;SAMEORIGIN&quot;</span>;</span><br><span class="line">    <span class="attribute">add_header</span> X-XSS-Protection <span class="string">&quot;1; mode=block&quot;</span>;</span><br><span class="line">    <span class="attribute">add_header</span> X-Robots-Tag <span class="literal">none</span>;</span><br><span class="line">    <span class="attribute">add_header</span> X-Download-Options noopen;</span><br><span class="line">    <span class="attribute">add_header</span> X-Permitted-Cross-Domain-Policies <span class="literal">none</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># Path to the root of your installation</span></span><br><span class="line">    <span class="attribute">root</span> /data/nextcloud/nextcloud;</span><br><span class="line"> </span><br><span class="line">    <span class="attribute">location</span> = /robots.txt {</span><br><span class="line">        <span class="attribute">allow</span> all;</span><br><span class="line">        <span class="attribute">log_not_found</span> <span class="literal">off</span>;</span><br><span class="line">        <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># The following 2 rules are only needed for the user_webfinger app.</span></span><br><span class="line">    <span class="comment"># Uncomment it if you&#x27;re planning to use this app.</span></span><br><span class="line">    <span class="comment">#rewrite ^/.well-known/host-meta /public.php?service=host-meta last;</span></span><br><span class="line">    <span class="comment">#rewrite ^/.well-known/host-meta.json /public.php?service=host-meta-json last;</span></span><br><span class="line"> </span><br><span class="line">    <span class="attribute">location</span> = /.well-known/carddav {</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> $scheme://$host/remote.php/dav;</span><br><span class="line">    }</span><br><span class="line">    <span class="attribute">location</span> = /.well-known/caldav {</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> $scheme://$host/remote.php/dav;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="attribute">location</span> /.well-known/acme-challenge { }</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># set max upload size</span></span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">512M</span>;</span><br><span class="line">    <span class="attribute">fastcgi_buffers</span> <span class="number">64</span> <span class="number">4K</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># Disable gzip to avoid the removal of the ETag header</span></span><br><span class="line">    <span class="attribute">gzip</span> <span class="literal">off</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># Uncomment if your server is build with the ngx_pagespeed module</span></span><br><span class="line">    <span class="comment"># This module is currently not supported.</span></span><br><span class="line">    <span class="comment">#pagespeed off;</span></span><br><span class="line"> </span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">403</span> /core/templates/<span class="number">403</span>.php;</span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">404</span> /core/templates/<span class="number">404</span>.php;</span><br><span class="line"> </span><br><span class="line">    <span class="attribute">location</span> / {</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^</span> /index.php$uri;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ ^/(?:build|tests|config|lib|3rdparty|templates|data)/</span> {</span><br><span class="line">        <span class="attribute">return</span> <span class="number">404</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ ^/(?:\.|autotest|occ|issue|indie|db_|console)</span> {</span><br><span class="line">        <span class="attribute">return</span> <span class="number">404</span>;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ ^/(?:index|remote|public|cron|core/ajax/update|status|ocs/v[12]|updater/.+|ocs-provider/.+|core/templates/40[34])\.php(?:$|/)</span> {</span><br><span class="line">        <span class="attribute">fastcgi_split_path_info</span><span class="regexp"> ^(.+\.php)(/.*)$</span>;</span><br><span class="line">        <span class="attribute">include</span> fastcgi_params;</span><br><span class="line">        <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">        <span class="attribute">fastcgi_param</span> PATH_INFO $fastcgi_path_info;</span><br><span class="line">        <span class="attribute">fastcgi_param</span> HTTPS <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">fastcgi_param</span> modHeadersAvailable <span class="literal">true</span>; <span class="comment">#Avoid sending the security headers twice</span></span><br><span class="line">        <span class="attribute">fastcgi_param</span> front_controller_active <span class="literal">true</span>;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span> php-handler;</span><br><span class="line">        <span class="attribute">fastcgi_intercept_errors</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">fastcgi_request_buffering</span> <span class="literal">off</span>;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ ^/(?:updater|ocs-provider)(?:$|/)</span> {</span><br><span class="line">        <span class="attribute">try_files</span> $uri $uri/ =<span class="number">404</span>;</span><br><span class="line">        <span class="attribute">index</span> index.php;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># Adding the cache control header for js and css files</span></span><br><span class="line">    <span class="comment"># Make sure it is BELOW the PHP block</span></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~* \.(?:css|js)$</span> {</span><br><span class="line">        <span class="attribute">try_files</span> $uri /index.php$uri$is_args$args;</span><br><span class="line">        <span class="attribute">add_header</span> Cache-Control <span class="string">&quot;public, max-age=7200&quot;</span>;</span><br><span class="line">        <span class="comment"># Add headers to serve security related headers (It is intended to have those duplicated to the ones above)</span></span><br><span class="line">        <span class="comment"># Before enabling Strict-Transport-Security headers please read into this topic first.</span></span><br><span class="line">        <span class="comment">#add_header Strict-Transport-Security &quot;max-age=15552000; includeSubDomains&quot;;</span></span><br><span class="line">        <span class="attribute">add_header</span> X-Content-Type-Options nosniff;</span><br><span class="line">        <span class="attribute">add_header</span> X-Frame-Options <span class="string">&quot;SAMEORIGIN&quot;</span>;</span><br><span class="line">        <span class="attribute">add_header</span> X-XSS-Protection <span class="string">&quot;1; mode=block&quot;</span>;</span><br><span class="line">        <span class="attribute">add_header</span> X-Robots-Tag <span class="literal">none</span>;</span><br><span class="line">        <span class="attribute">add_header</span> X-Download-Options noopen;</span><br><span class="line">        <span class="attribute">add_header</span> X-Permitted-Cross-Domain-Policies <span class="literal">none</span>;</span><br><span class="line">        <span class="comment"># Optional: Don&#x27;t log access to assets</span></span><br><span class="line">        <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~* \.(?:svg|gif|png|html|ttf|woff|ico|jpg|jpeg)$</span> {</span><br><span class="line">        <span class="attribute">try_files</span> $uri /index.php$uri$is_args$args;</span><br><span class="line">        <span class="comment"># Optional: Don&#x27;t log access to other assets</span></span><br><span class="line">        <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl; <span class="comment"># managed by Certbot</span></span><br><span class="line"><span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/mingilin.com/fullchain.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line"><span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/mingilin.com/privkey.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Redirect non-https traffic to https</span></span><br><span class="line">    <span class="attribute">if</span> ($scheme != <span class="string">&quot;https&quot;</span>) {</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://$host$request_uri;</span><br><span class="line">    } <span class="comment"># managed by Certbot</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="数据导入"><a href="#数据导入" class="headerlink" title="数据导入"></a>数据导入</h3><ul><li>安装<code>davfs</code><br>  需要yum源<a href="https://www.mingilin.com/2016/03/10/centos/centos-yum/">rpmforge</a>, 然后<code>yum install davfs2</code></li><li>挂在到本地<br>  <code>mount -t davfs https://nextcloud.web.mingilin.com/remote.php/webdav/ /root/ttt -o username=你的用户名</code></li><li>在<code>/root/ttt</code>目录下增删文件</li></ul><h3 id="已知问题"><a href="#已知问题" class="headerlink" title="已知问题"></a>已知问题</h3><p><code>nextcloud</code>使用遇到的问题：</p><ol><li><em><strong>服务器要求偏高，在512M的机器上玩不转，负载高的吓人</strong></em></li><li>要求数据库支持</li><li>手动修改用户文件不生效，这个<code>KODExplorer</code>就很好用了</li></ol><p>因为第一点，无奈只能放弃使用，虽然客户端确实很完善，有条件的同学可以试下。</p>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> 开源网盘 </tag>
            
            <tag> KODExplorer </tag>
            
            <tag> NextCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>几种常用git server</title>
      <link href="/2020/03/13/centos/centos-gitserver-list/"/>
      <url>/2020/03/13/centos/centos-gitserver-list/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>记录下自己用过的几种<code>git server</code>:<code>GITEA</code>,<code>gitolite3</code>,<code>Gidder/Gitrepo</code></p></blockquote><span id="more"></span><h2 id="GITEA"><a href="#GITEA" class="headerlink" title="GITEA"></a>GITEA</h2><blockquote><p>现在正在用,简单方便,基本的功能都有了</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## install docker</span></span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">yum install -y docker-ce</span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line">systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="comment">## gitea</span></span><br><span class="line">docker pull gitea/gitea:latest</span><br><span class="line">mkdir -p /data/gitea</span><br><span class="line">docker run -d --name=gitea -p 2222:22 -p 3000:3000 -v /data/gitea:/data gitea/gitea:latest</span><br><span class="line">docker update --restart=always gitea</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## nginx config</span></span><br><span class="line"><span class="attribute">cat</span> &gt; /etc/nginx/conf.d/001_<span class="variable">$&#123;DOMAIN&#125;</span>.conf &lt;&lt; <span class="string">&quot;EOF&quot;</span></span><br><span class="line">server &#123;</span><br><span class="line">    <span class="section">server_name</span>  &#123;DOMAIN&#125;;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>; </span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:3000/;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="gitolite3"><a href="#gitolite3" class="headerlink" title="gitolite3"></a>gitolite3</h2><h3 id="准备key"><a href="#准备key" class="headerlink" title="准备key"></a>准备key</h3><p>安装前先准备公钥,私钥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi /data % tree ssh </span><br><span class="line">ssh</span><br><span class="line">├── mingilin</span><br><span class="line">└── mingilin.pub</span><br></pre></td></tr></table></figure><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gitolite3</span><br><span class="line">正在读取软件包列表... 完成</span><br><span class="line">正在分析软件包的依赖关系树       </span><br><span class="line">正在读取状态信息... 完成       </span><br><span class="line">将会安装下列额外的软件包：</span><br><span class="line">  libcommon-sense-perl libjson-perl libjson-xs-perl</span><br><span class="line">建议安装的软件包：</span><br><span class="line">  git-daemon-sysvinit gitweb</span><br><span class="line">下列【新】软件包将被安装：</span><br><span class="line">  gitolite3 libcommon-sense-perl libjson-perl libjson-xs-perl</span><br><span class="line">升级了 0 个软件包，新安装了 4 个软件包，要卸载 0 个软件包，有 100 个软件包未被升级。</span><br><span class="line">需要下载 0 B/336 kB 的软件包。</span><br><span class="line">解压缩后会消耗掉 1,040 kB 的额外空间。</span><br><span class="line">您希望继续执行吗？[Y/n]y</span><br><span class="line">正在预设定软件包 ...</span><br><span class="line">Selecting previously unselected package libjson-perl.</span><br><span class="line">(正在读取数据库 ... 系统当前共安装有 85705 个文件和目录。)</span><br><span class="line">正在解压缩 libjson-perl (从 .../libjson-perl_2.53-1_all.deb) ...</span><br><span class="line">Selecting previously unselected package gitolite3.</span><br><span class="line">正在解压缩 gitolite3 (从 .../gitolite3_3.6.4-1~bpo70+1_all.deb) ...</span><br><span class="line">Selecting previously unselected package libcommon-sense-perl.</span><br><span class="line">正在解压缩 libcommon-sense-perl (从 .../libcommon-sense-perl_3.6-1_all.deb) ...</span><br><span class="line">Selecting previously unselected package libjson-xs-perl.</span><br><span class="line">正在解压缩 libjson-xs-perl (从 .../libjson-xs-perl_2.320-1_armhf.deb) ...</span><br><span class="line">正在处理用于 man-db 的触发器...</span><br><span class="line">正在设置 libjson-perl (2.53-1) ...</span><br><span class="line">正在设置 gitolite3 (3.6.4-1~bpo70+1) ...</span><br><span class="line">初始化空的 Git 版本库于 /var/lib/gitolite3/repositories/gitolite-admin.git/</span><br><span class="line">初始化空的 Git 版本库于 /var/lib/gitolite3/repositories/testing.git/</span><br><span class="line">WARNING: /var/lib/gitolite3/.ssh missing; creating a new one</span><br><span class="line">    (this is normal on a brand new install)</span><br><span class="line">WARNING: /var/lib/gitolite3/.ssh/authorized_keys missing; creating a new one</span><br><span class="line">    (this is normal on a brand new install)</span><br><span class="line">正在设置 libcommon-sense-perl (3.6-1) ...</span><br><span class="line">正在设置 libjson-xs-perl (2.320-1) ...</span><br></pre></td></tr></table></figure><p><strong>在安装过程中提示输入公钥(.pub), 将公钥的绝对路径输入</strong><br>然后等待安装完成<br>在安装过程中有提示</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">初始化空的 Git 版本库于 /var/lib/gitolite3/repositories/gitolite-admin.git/</span><br><span class="line">初始化空的 Git 版本库于 /var/lib/gitolite3/repositories/testing.git/</span><br></pre></td></tr></table></figure><p>查看权限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi ~ % ll /var/lib|grep gitolite3</span><br><span class="line">drwxr-xr-x 5 gitolite3 gitolite3 4.0K  5月 11 09:56 gitolite3</span><br></pre></td></tr></table></figure><p><strong>说明user是gitolite3</strong></p><h3 id="CLONE"><a href="#CLONE" class="headerlink" title="CLONE"></a>CLONE</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cp /data/ssh/mingilin ~/.ssh/id_rsa &amp;&amp; chmod 400 ~/.ssh/id_rsa</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># GITHOST为服务器IP</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 需要打开git端口9418</span></span></span><br><span class="line">git clone gitolite3@GITHOST:gitolite-admin.git</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 方法2</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># SSHHost为SSH IP</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># SSHPort为SSH端口</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># git clone ssh://gitolite3@SSHHost:SSHPort/gitolite-admin.git</span></span></span><br></pre></td></tr></table></figure><p>权限设置请参考<a href="http://www.server-world.info/en/note?os=CentOS_6&p=gitolite&f=4">http://www.server-world.info/en/note?os=CentOS_6&amp;p=gitolite&amp;f=4</a></p><h3 id="修改用户名"><a href="#修改用户名" class="headerlink" title="修改用户名"></a>修改用户名</h3><p>如果觉得<code>gitolite3@xxxx</code>比较别扭的话,使用<code>sudo usermod -l git gitolite3</code>更改用户名</p><p>然后就可以使用<code>git clone ssh://git@SSHHost:SSHPort/xxx.git</code>了</p><h2 id="基于linux-ssh"><a href="#基于linux-ssh" class="headerlink" title="基于linux ssh"></a>基于linux ssh</h2><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -g git</span><br></pre></td></tr></table></figure><h3 id="创建repo"><a href="#创建repo" class="headerlink" title="创建repo"></a>创建repo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /repos</span><br><span class="line">git init --bare /repos/test.git</span><br></pre></td></tr></table></figure><h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.ssh</span><br><span class="line">touch config &amp;&amp; chmod 600 config</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;HostkeyAlgorithms +ssh-dss&quot;</span> &gt;&gt; config</span><br><span class="line">git <span class="built_in">clone</span> ssh://username@ip:port/repos/test.git <span class="built_in">test</span></span><br><span class="line"><span class="comment">## git clone ssh://kingwen0302@192.168.1.100:22/repos/test.git test</span></span><br></pre></td></tr></table></figure><h2 id="Gidder-Gitrepo"><a href="#Gidder-Gitrepo" class="headerlink" title="Gidder/Gitrepo"></a>Gidder/Gitrepo</h2><p><code>Google Play</code>已经找不到这两个软件了<br>个人只备份了一个<a href="/downloads/binary/Gitrepo_0.02.apk">Gitrepo</a></p><h3 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h3><h4 id="Users"><a href="#Users" class="headerlink" title="Users"></a>Users</h4><p><code>setup</code> -&gt; <code>users</code> -&gt; <code>add new user</code></p><h4 id="Repositories"><a href="#Repositories" class="headerlink" title="Repositories"></a>Repositories</h4><p><code>setup</code> -&gt; <code>repositories</code> -&gt; <code>add repository</code> -&gt; <code>add permission</code></p><h3 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h3><p>增加ssh-dss支持</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.ssh</span><br><span class="line">touch config &amp;&amp; chmod 600 config</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;HostkeyAlgorithms +ssh-dss&quot;</span> &gt;&gt; config</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> ssh://username@ip:port/reponame.git</span><br></pre></td></tr></table></figure><h2 id="gitlab"><a href="#gitlab" class="headerlink" title="gitlab"></a>gitlab</h2><blockquote><p>VPS太垃圾,不敢用</p></blockquote><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="http://www.server-world.info/en/note?os=CentOS_6&p=gitolite">http://www.server-world.info/en/note?os=CentOS_6&amp;p=gitolite</a></li><li><a href="http://www.uml.org.cn/pzgl/201404092.asp">http://www.uml.org.cn/pzgl/201404092.asp</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> git </tag>
            
            <tag> gitea </tag>
            
            <tag> gitolite3 </tag>
            
            <tag> git server </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>生成UUID</title>
      <link href="/2020/03/07/misc/misc-uuid/"/>
      <url>/2020/03/07/misc/misc-uuid/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="LIUNX"><a href="#LIUNX" class="headerlink" title="LIUNX"></a>LIUNX</h2><p>如果要写脚本的话,可以用下面的,简单</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/sys/kernel/random/uuid</span><br></pre></td></tr></table></figure><h2 id="WINDOWS"><a href="#WINDOWS" class="headerlink" title="WINDOWS"></a>WINDOWS</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell <span class="literal">-Command</span> <span class="string">&quot;Write-Host (New-Guid)&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
          <category> linux </category>
          
          <category> uuid </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>修改软件的启动时间(windows/linux都可以)</title>
      <link href="/2020/03/07/misc/misc-faketime/"/>
      <url>/2020/03/07/misc/misc-faketime/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>项目中有些功能测试需要修改时间,以前只找到了linux的版本<br>直到昨天在某些论坛上,看到了windows也是有的</p><h2 id="LINUX修改软件的启动时间"><a href="#LINUX修改软件的启动时间" class="headerlink" title="LINUX修改软件的启动时间"></a>LINUX修改软件的启动时间</h2><p><a href="https://github.com/wolfcw/libfaketime">libfaketime</a></p><h2 id="WINDOWS修改软件的启动时间"><a href="#WINDOWS修改软件的启动时间" class="headerlink" title="WINDOWS修改软件的启动时间"></a>WINDOWS修改软件的启动时间</h2><p><a href="http://www.nirsoft.net/utils/run_as_date.html">runasdate</a></p><p>修改时间具体用处就不说了, 比如可以延长软件的试用期, (<em>^__^</em>) 嘻嘻……</p>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>win10 wsl子系统开机自启sshd</title>
      <link href="/2020/02/22/windows/windows-wsl-ssh/"/>
      <url>/2020/02/22/windows/windows-wsl-ssh/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>记录下<code>windows10 wsl</code>安装<code>openssh-server</code>并且开机自启动的过程</p></blockquote><span id="more"></span><h2 id="需要先安装openssh-server"><a href="#需要先安装openssh-server" class="headerlink" title="需要先安装openssh-server"></a>需要先安装<code>openssh-server</code></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install openssh-server</span><br></pre></td></tr></table></figure><p>编辑<code>/etc/ssh/sshd_config</code><br>修改端口,是否可以密码登陆等配置</p><blockquote><p>启动: <code>sudo service ssh --full-restart</code><br>停止: <code>sudo service ssh stop</code></p></blockquote><p>注意: </p><blockquote><p>在<code>Debian</code>wsl中<br>启动是<code>service ssh --full-restart</code><br>不是<code>service sshd --full-restart</code><br>不是笔误</p></blockquote><p>启动后,使用<code>ssh client</code>(<code>putty</code>,<code>xshell</code>等)连接,检测sshd是否启动成功</p><h2 id="添加一个脚本-用于执行启动ssh-server"><a href="#添加一个脚本-用于执行启动ssh-server" class="headerlink" title="添加一个脚本,用于执行启动ssh server"></a>添加一个脚本,用于执行启动<code>ssh server</code></h2><p>例如<code>/etc/init.wsl</code></p><h3 id="编辑init-wsl-sudo-vi-etc-init-wsl"><a href="#编辑init-wsl-sudo-vi-etc-init-wsl" class="headerlink" title="编辑init.wsl(sudo vi /etc/init.wsl)"></a>编辑<code>init.wsl</code>(<code>sudo vi /etc/init.wsl</code>)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">sudo service ssh --full-restart</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 也可以添加其他的自启动命令</span></span></span><br></pre></td></tr></table></figure><h3 id="添加为root可执行"><a href="#添加为root可执行" class="headerlink" title="添加为root可执行"></a>添加为root可执行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /etc/init.wsl</span><br></pre></td></tr></table></figure><h3 id="添加root免密执行-sudo-vi-etc-sudoers"><a href="#添加root免密执行-sudo-vi-etc-sudoers" class="headerlink" title="添加root免密执行(sudo vi /etc/sudoers)"></a>添加root免密执行(<code>sudo vi /etc/sudoers</code>)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># sudo vi /etc/sudoers</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 在Debian wsl中, 显示是只读文件</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 但是可以通过 :w! 强制保存</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 添加下面行, /etc/init.wsl可以免密执行</span></span></span><br><span class="line"><span class="meta">%</span><span class="bash">sudo ALL=NOPASSWD: /etc/init.wsl</span></span><br></pre></td></tr></table></figure><h3 id="测试是否设置成功"><a href="#测试是否设置成功" class="headerlink" title="测试是否设置成功"></a>测试是否设置成功</h3><p>打开一个<code>cmd</code>(<code>powershell</code>)</p><p>执行<code>C:\Windows\System32\bash.exe -c &#39;sudo /etc/init.wsl&#39;</code></p><p>如果成功,则表示上面的配置已经ok了</p><h2 id="增加开机启动脚本"><a href="#增加开机启动脚本" class="headerlink" title="增加开机启动脚本"></a>增加开机启动脚本</h2><h3 id="打开开机启动目录"><a href="#打开开机启动目录" class="headerlink" title="打开开机启动目录"></a>打开开机启动目录</h3><p>按键<code>win+R</code> 输入<code>shell:startup</code>系统会自动打开一个目录</p><h3 id="增加脚本startservice-vbs-名字随便"><a href="#增加脚本startservice-vbs-名字随便" class="headerlink" title="增加脚本startservice.vbs(名字随便)"></a>增加脚本<code>startservice.vbs</code>(名字随便)</h3><p>内容为</p><figure class="highlight vbs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Set</span> ws = WScript.<span class="built_in">CreateObject</span>(<span class="string">&quot;WScript.Shell&quot;</span>)</span><br><span class="line">ws.run <span class="string">&quot;C:\Windows\System32\bash.exe -c &#x27;sudo /etc/init.wsl&#x27;&quot;</span>,<span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="重启电脑"><a href="#重启电脑" class="headerlink" title="重启电脑"></a>重启电脑</h2><p>OK</p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://blog.csdn.net/fuyuande/article/details/90510250">https://blog.csdn.net/fuyuande/article/details/90510250</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
          <category> wsl </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js复制内容到剪切板(Firefox/Chrome/IE通用)</title>
      <link href="/2020/02/20/php/js-copy-to-clipboard/"/>
      <url>/2020/02/20/php/js-copy-to-clipboard/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">copyToClipboard</span>(<span class="params">copyTxt</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> createInput = <span class="built_in">document</span>.createElement(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line">  createInput.value = copyTxt;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(createInput);</span><br><span class="line">  createInput.select(); <span class="comment">// 选择对象</span></span><br><span class="line">  <span class="built_in">document</span>.execCommand(<span class="string">&quot;Copy&quot;</span>); <span class="comment">// 执行浏览器复制命令</span></span><br><span class="line">  createInput.className = <span class="string">&#x27;createInput&#x27;</span>;</span><br><span class="line">  createInput.style.display=<span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">  <span class="comment">//alert(&#x27;复制成功，可以粘贴了！&#x27;);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://blog.csdn.net/qq_31384551/article/details/82117137">https://blog.csdn.net/qq_31384551/article/details/82117137</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows安装DNS Server(Bind9)</title>
      <link href="/2020/01/17/windows/windows-bind9/"/>
      <url>/2020/01/17/windows/windows-bind9/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>记录在windows上安装<code>DNS Server(Bind9)</code>的过程<br>并且配置自定义域名,和添加子域名</p></blockquote><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ol><li><p>从 <a href="%5Bhttp://ftp.isc.org/isc/bind9/%5D">http://ftp.isc.org/isc/bind9/</a>下载最新版本的windows安装包</p></li><li><p>点击<code>BINDInstall.exe</code> 安装服务,填下密码,然后一路默认就可以了</p></li><li><p>到安装后的目录下执行<code>rndc-confgen.exe -a</code>,在<code>etc</code>目录下会生成<code>rndc.key</code>文件</p></li><li><p>将<code>etc</code>目录设置为<code>named</code>用户可以访问</p><p> 右击<code>etc</code>目录 -&gt; 安全 -&gt;  <code>组或用户名</code>增加<code>named</code>用户</p></li><li><p>在<code>etc</code>目录下新建<code>named.conf</code></p> <figure class="highlight bash"><figcaption><span>named/named.conf</span><a href="/downloads/code/named/named.conf">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">options {</span><br><span class="line">    // zone文件的位置</span><br><span class="line">    directory <span class="string">&quot;C:\Program Files\ISC BIND 9\etc&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    // 无法解析的域名就去查询ISP提供的DNS</span><br><span class="line">    // 在下面的IP地址位置上填写ISP的DNS地址</span><br><span class="line">    </span><br><span class="line">    forwarders {</span><br><span class="line">        // 这里配置其他的DNS,用于本地没有配置的域名转向下面的dns查询</span><br><span class="line">        192.168.100.9;</span><br><span class="line">        192.168.100.8;</span><br><span class="line">        // 8.8.8.8;</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    recursion yes;</span><br><span class="line">    dnssec-validation no;</span><br><span class="line">    dnssec-enable no;</span><br><span class="line"></span><br><span class="line">    allow-query-cache {</span><br><span class="line">        any; </span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    // 仅允许本机与192.168.0.0网段内的机器查询</span><br><span class="line">    allow-query { any; };</span><br><span class="line">    // allow-query {</span><br><span class="line">    //     127.0.0.1;</span><br><span class="line">    //     192.168.0.0/24;</span><br><span class="line">    // };</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">logging {</span><br><span class="line">    channel default_debug {</span><br><span class="line">        file <span class="string">&quot;log/named.log&quot;</span>;</span><br><span class="line">        severity dynamic;</span><br><span class="line">    };</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">// 根DNS</span><br><span class="line">zone <span class="string">&quot;.&quot;</span> {</span><br><span class="line">    <span class="built_in">type</span> hint;</span><br><span class="line">    file <span class="string">&quot;zone/root.zone&quot;</span>;</span><br><span class="line">};</span><br><span class="line">// localhost</span><br><span class="line">zone <span class="string">&quot;localhost&quot;</span> IN {</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">&quot;zone/localhost.zone&quot;</span>;</span><br><span class="line">    allow-update { none; };</span><br><span class="line">};</span><br><span class="line">// localhost的反向解析</span><br><span class="line">zone <span class="string">&quot;0.0.127.in-addr.arpa&quot;</span> {</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">&quot;zone/localhost.rev&quot;</span>;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">// 自定义域名解析</span><br><span class="line">zone <span class="string">&quot;example.com&quot;</span> IN {</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">&quot;zone/example.com.zone&quot;</span>;</span><br><span class="line">    allow-update { none; };</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">// 自定义子域名解析</span><br><span class="line">// 只有example.example.com以及a.example.example.com</span><br><span class="line">zone <span class="string">&quot;example.example.com&quot;</span> IN {</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">&quot;zone/example.example.com.zone&quot;</span>;</span><br><span class="line">    allow-update { none; };</span><br><span class="line">};</span><br></pre></td></tr></table></figure></li><li><p>在<a href="ftp://ftp.rs.internic.net/domain/">ftp://ftp.rs.internic.net/domain/</a>下载<code>named.root</code>,<code>root.zone</code>两个文件,放到<code>/etc/zone</code>目录下</p></li><li><p>新建<code>localhost.zone</code>到<code>/etc/zone</code></p> <figure class="highlight bash"><figcaption><span>named/zone/localhost.zone</span><a href="/downloads/code/named/zone/localhost.zone">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$TTL</span> 1D </span><br><span class="line">@ IN SOA localhost. root.localhost. ( </span><br><span class="line"> 2007091701  ; Serial </span><br><span class="line"> 30800  ; Refresh </span><br><span class="line"> 7200  ; Retry </span><br><span class="line"> 604800  ; Expire </span><br><span class="line"> 300 )  ; Minimum </span><br><span class="line"> IN NS localhost. </span><br><span class="line">localhost. IN A 127.0.0.1</span><br></pre></td></tr></table></figure></li><li><p>新建<code>localhost.rev</code>到<code>/etc/zone</code></p> <figure class="highlight bash"><figcaption><span>named/zone/localhost.rev</span><a href="/downloads/code/named/zone/localhost.rev">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$TTL</span> 1D </span><br><span class="line">@ IN SOA localhost. root.localhost. ( </span><br><span class="line"> 2007091701  ; Serial </span><br><span class="line"> 30800  ; Refresh </span><br><span class="line"> 7200  ; Retry </span><br><span class="line"> 604800  ; Expire </span><br><span class="line"> 300 )  ; Minimum </span><br><span class="line">  IN NS localhost. </span><br><span class="line">1  IN PTR localhost.</span><br></pre></td></tr></table></figure></li><li><p>添加自定义域名</p><blockquote><p>将<code>example.com</code>替换成自己的域名即可</p></blockquote> <figure class="highlight bash"><figcaption><span>named/zone/example.com.zone</span><a href="/downloads/code/named/zone/example.com.zone">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">;; 域名解析</span><br><span class="line">;; 用于所有的子域名都使用本文件解析</span><br><span class="line"></span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@ IN SOA ns1.example.com. root.example.com. ( </span><br><span class="line">        2007091701  ; Serial </span><br><span class="line">        30800  ; Refresh </span><br><span class="line">        7200  ; Retry </span><br><span class="line">        604800  ; Expire </span><br><span class="line">        300 )  ; Minimum </span><br><span class="line">    IN  NS  ns1.example.com</span><br><span class="line"></span><br><span class="line">; A记录</span><br><span class="line">ns1 IN  A   192.168.50.100          ; ns1.example.com          </span><br><span class="line">@   IN  A   192.168.50.100          ; example.com</span><br><span class="line">e   IN  A   127.0.0.1               ; e.example.com</span><br><span class="line">a.b IN  A   127.0.0.1               ; a.b.example.com</span><br><span class="line">*   IN  A   127.0.0.1               ; xxxx.example.com</span><br></pre></td></tr></table></figure></li><li><p>添加自定义子域名</p><blockquote><p>将<code>example.example.com</code>替换成自己的子域名即可</p></blockquote> <figure class="highlight bash"><figcaption><span>named/zone/example.example.com.zone</span><a href="/downloads/code/named/zone/example.example.com.zone">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">;; 子域名解析</span><br><span class="line">;; 只解析该子域名,其他的子域名走其他的渠道</span><br><span class="line"></span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@   IN SOA ns1.example.example.com. ns2.example.example.com. (</span><br><span class="line">        2007091701  ; Serial </span><br><span class="line">        30800  ; Refresh </span><br><span class="line">        7200  ; Retry </span><br><span class="line">        604800  ; Expire </span><br><span class="line">        300 )  ; Minimum </span><br><span class="line">    IN  NS  ns1</span><br><span class="line">ns1 IN  A   192.168.50.100      ; ns1.example.example.com</span><br><span class="line">@   IN  A   192.168.50.100      ; example.example.com</span><br></pre></td></tr></table></figure></li><li><p>使用<code>net stop named</code>, <code>net start named</code>停止/启动服务</p></li></ol><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li>[<a href="http://www.yinxi.net/doc/show.php?DocID=10275%5D">http://www.yinxi.net/doc/show.php?DocID=10275]</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> bind9 </tag>
            
            <tag> dns server </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用kitty/putty,winscp,mtputty搭建安全免费的ssh客户端</title>
      <link href="/2019/12/26/windows/windows-kitty-winscp-mtputty/"/>
      <url>/2019/12/26/windows/windows-kitty-winscp-mtputty/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>自从Xshell升级后,免费版单个窗口只能打开四个窗口了<br>破解版的软件(SecureCRT)又不太敢用<br>寻找了很久才自己折腾出来的组合: <code>MTPutty+Kitty+WinScp</code><br>绝对的安全 </p></blockquote><span id="more"></span><p>先来一张界面效果:<br><img src="/downloads/assets/mtputty.png" alt="mtputty"></p><h2 id="需要软件"><a href="#需要软件" class="headerlink" title="需要软件"></a>需要软件</h2><ul><li><a href="http://www.winscp.net/">winscp</a> ftp/sftp客户端</li><li><a href="https://github.com/cyd01/KiTTY">kitty</a> putty分支版本</li><li><a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">putty</a> ssh客户端</li><li><a href="http://ttyplus.com/multi-tabbed-putty/">mtputty</a> 多标签</li></ul><p><code>kitty</code>是<code>putty</code>的一个分支,增加了一些功能,有便携版,不会写注册表</p><h2 id="Command-Line常用选项"><a href="#Command-Line常用选项" class="headerlink" title="Command Line常用选项"></a><code>Command Line</code>常用选项</h2><p><code>-load 主题 IP地址 -ssh -P PORT -l 用户名 -i 私钥.ppk</code><br><code>-load 主题 IP地址 -ssh -P PORT -l 用户名 -pw 密码</code></p><p><code>rz/sz</code>可以通过右击标签页选择<code>Start WinSCP</code>启动<code>WinSCP</code>上传下载</p><h2 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h2><p><a href="/downloads/binary/mtputty.zip">不包括<code>WinSCP</code>的MTPutty.zip</a></p>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssh </tag>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>简单使用tortoisesvn对多个功能同时开发</title>
      <link href="/2019/12/26/windows/windows-svn-project/"/>
      <url>/2019/12/26/windows/windows-svn-project/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>在实际工作中,经常需要停止当前正在开发的功能去修复之前的bug,<br><code>git</code>可以很好的解决这些问题,但是很多公司内部还是使用svn作为版本控制的</p><span id="more"></span><h2 id="简单解决方案"><a href="#简单解决方案" class="headerlink" title="简单解决方案"></a>简单解决方案</h2><p>创建多个相同的版本库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">project</span><br><span class="line">├───trunk_1 (用于开发功能1)</span><br><span class="line">├───trunk_2 (用于开发功能2)</span><br><span class="line">├───trunk_commit (只用于提交)</span><br></pre></td></tr></table></figure><p>功能开发完成后,<br>使用<code>meld</code>或者其他代码合并工具,<br>将代码合并到<code>trunk_commit</code>,<br>然后从<code>trunk_commit</code>提交代码</p><figure class="highlight bat"><figcaption><span>简单例子</span><a href="/downloads/code/commit.bat">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line">@<span class="built_in">set</span> src_root_dir=%~dp0</span><br><span class="line">@<span class="built_in">set</span> dest_root_dir=e:\sgh5\server\trunk_commit</span><br><span class="line">@<span class="built_in">set</span> TortoiseProc=D:\TortoiseSVN\bin\TortoiseProc.exe</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [<span class="number">1</span>]svn update src ...</span><br><span class="line"><span class="variable">%TortoiseProc%</span> /command:update /<span class="built_in">path</span>:<span class="variable">%src_root_dir%</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [<span class="number">2</span>]svn update dest ...</span><br><span class="line"><span class="variable">%TortoiseProc%</span> /command:update /<span class="built_in">path</span>:<span class="variable">%dest_root_dir%</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [<span class="number">3</span>]meld ...</span><br><span class="line">meld <span class="variable">%src_root_dir%</span> <span class="variable">%dest_root_dir%</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [<span class="number">4</span>]compile ...</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">%dest_root_dir%</span></span><br><span class="line"><span class="built_in">start</span> xctl_commit.bat compile</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">%src_root_dir%</span></span><br><span class="line"><span class="built_in">echo</span> [<span class="number">5</span>]commit ...</span><br><span class="line"><span class="variable">%TortoiseProc%</span> /command:commit /<span class="built_in">path</span>:<span class="variable">%dest_root_dir%</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [<span class="number">6</span>]svn update src again ...</span><br><span class="line"><span class="variable">%TortoiseProc%</span> /command:update /<span class="built_in">path</span>:<span class="variable">%src_root_dir%</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [<span class="number">7</span>]finish</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows下修改锁屏壁纸</title>
      <link href="/2019/06/28/windows/windows-change-lock-background/"/>
      <url>/2019/06/28/windows/windows-change-lock-background/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>被流氓软件修改了锁屏壁纸,虽然被流氓了,但还是要知道是怎么做到的</p><span id="more"></span><ol><li><p>注册表修改[<strong>自测并不需要修改</strong>]<br>打开注册表剪辑器: <code>Win+R</code> -&gt; <code>regedit</code><br>依次打开:<br><code>HKEY_LOCAL_MACHINE\SOFTWARE</code><br><code>\Microsoft\Windows\CurrentVersion</code><br><code>\Authentication\LogonUI</code><br><code>\Background\OEMBackground</code></p><blockquote><p>修改为1</p></blockquote></li><li><p>组策略编辑器<br>打开组策略编辑器: <code>Win+R</code> -&gt; <code>gpedit.msc</code><br>依次打开: 计算机配置-&gt;管理模版-&gt;系统-&gt;登录-&gt;始终使用自定义登录背景</p><blockquote><p>选择已启用</p></blockquote></li><li><p>修改背景<br>打开目录: <code>C:\Windows\System32\oobe\info\backgrounds\</code>,若不存在,手动创建<br>将背景图(必须是jpg格式)命名为<code>backgroundDefault.jpg</code>,保存到该目录下</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>erlang httpc使用代理</title>
      <link href="/2019/06/26/erlang/erlang-httpc-proxy/"/>
      <url>/2019/06/26/erlang/erlang-httpc-proxy/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>工作中个别项目需要连接VPN,<br>本地也有项目需要进行<br>连接上vpn后,本地的项目就无法进行</p><p>现在的方法是:</p><ol><li><p>开个虚拟机(virtualbox)</p><ul><li>连接<code>vpn</code></li><li>搭建<code>v2ray server</code></li><li><code>host</code>中添加域名解析</li></ul></li><li><p>物理机</p><ul><li>搭建<code>v2ray client</code>, 所有流量走<code>v2ray</code>, 在<code>route</code>配置规则</li><li><code>host</code>中添加域名解析</li><li>搭建<code>privoxy</code>,将<code>v2ray client</code>的<code>sock5</code>代理转换为<code>http</code>代理  </li></ul></li></ol><p>更新代码:<br>windows: 修改<code>TortoiseSVN</code>的网络设置,添加<code>http</code>代理<br>linux: <code>proxychain4 svn xxx</code></p><p>项目中使用<code>erlang</code>语言</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">httpc:set_options([&#123;proxy, &#123; &#123;<span class="string">&quot;192.168.10.26&quot;</span>, <span class="number">8119</span>&#125;, <span class="string">&quot;&quot;</span> &#125; &#125;]).</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用qpdf对pdf进行分割合并</title>
      <link href="/2019/06/26/centos/centos7-qpdf/"/>
      <url>/2019/06/26/centos/centos7-qpdf/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>最近购买了一台家用打印机MG3080<br>打印机只能打单页,不能打双页<br>需要手动换纸,比较麻烦<br>找了个<a href="https://sourceforge.net/projects/qpdf/">pdf分割合并的工具</a></p><span id="more"></span><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install qpdf</span><br></pre></td></tr></table></figure><p><a href="https://sourceforge.net/projects/qpdf/">windows版本</a></p><h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2><p>查询页数: <code>qpdf src.pdf --show-npages</code><br>分割: <code>qpdf src.pdf --pages src.pdf 1,3,5,7 -- 1357.pdf</code><br>合并: <code>qpdf --empty --pages 1.pdf 3.pdf -- 13.pdf</code></p><h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><figure class="highlight bash"><figcaption><span>split_pdf.sh</span><a href="/downloads/code/split_pdf.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash - </span></span><br><span class="line"><span class="comment">#===============================================================================</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#          FILE: split_pdf.sh</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#         USAGE: ./split_pdf.sh xxx.pdf</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#===============================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#######color code########</span></span><br><span class="line">RED=<span class="string">&quot;31m&quot;</span></span><br><span class="line">GREEN=<span class="string">&quot;32m&quot;</span></span><br><span class="line">YELLOW=<span class="string">&quot;33m&quot;</span></span><br><span class="line">BLUE=<span class="string">&quot;36m&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################</span></span><br><span class="line"><span class="function"><span class="title">colorEcho</span></span>(){</span><br><span class="line">    COLOR=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[<span class="variable">${COLOR}</span><span class="variable">${@:2}</span>\033[0m&quot;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">colorEchoN</span></span>(){</span><br><span class="line">    COLOR=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">echo</span> -n -e <span class="string">&quot;\033[<span class="variable">${COLOR}</span><span class="variable">${@:2}</span>\033[0m&quot;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">CUR_DIR=$(<span class="built_in">cd</span> $(dirname <span class="variable">$0</span>); <span class="built_in">pwd</span>)</span><br><span class="line"></span><br><span class="line">QPDF=<span class="variable">${CUR_DIR}</span>/qpdf-8.4.2/bin/qpdf.exe</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">splitPdf</span></span>(){</span><br><span class="line">    PDF_FILE=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">${PDF_FILE}</span>&quot;</span> == <span class="string">&quot;exit&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        colorEcho <span class="variable">$RED</span> <span class="string">&quot;exit&quot;</span></span><br><span class="line">        <span class="built_in">exit</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [[ ! -e <span class="variable">${PDF_FILE}</span> ]]; <span class="keyword">then</span></span><br><span class="line">        colorEcho <span class="variable">$RED</span> <span class="string">&quot;没有找到该文件&quot;</span></span><br><span class="line">        <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    EXT=<span class="variable">${PDF_FILE##*.}</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">${EXT}</span>&quot;</span> != <span class="string">&quot;pdf&quot;</span> &amp;&amp; <span class="string">&quot;<span class="variable">${EXT}</span>&quot;</span> != <span class="string">&quot;PDF&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        colorEcho <span class="variable">$RED</span> <span class="string">&quot;不是pdf文件&quot;</span></span><br><span class="line">        <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    DEST_DIR=<span class="variable">${PDF_FILE}</span>.d</span><br><span class="line">    mkdir -p <span class="variable">${DEST_DIR}</span></span><br><span class="line">    </span><br><span class="line">    TotalPage=$(<span class="variable">${QPDF}</span> <span class="variable">${PDF_FILE}</span> --show-npages)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">## 逆序</span></span><br><span class="line">    Page1=$(seq 1 2 <span class="variable">$TotalPage</span> | tac | paste -sd,)</span><br><span class="line">    Page2=$(seq 2 2 <span class="variable">$TotalPage</span> | tac | paste -sd,)</span><br><span class="line">    </span><br><span class="line">    <span class="variable">${QPDF}</span> <span class="variable">${PDF_FILE}</span> --pages <span class="variable">${PDF_FILE}</span> <span class="variable">$Page1</span> -- <span class="variable">${DEST_DIR}</span>/1.pdf</span><br><span class="line">    <span class="variable">${QPDF}</span> <span class="variable">${PDF_FILE}</span> --pages <span class="variable">${PDF_FILE}</span> <span class="variable">$Page2</span> -- <span class="variable">${DEST_DIR}</span>/2.pdf</span><br><span class="line"></span><br><span class="line">    colorEcho <span class="variable">$GREEN</span> <span class="string">&quot;分割完成，请在同名目录下查看。&quot;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">colorEcho <span class="variable">$GREEN</span> <span class="string">&quot;-------------------------------------------------------------&quot;</span></span><br><span class="line">colorEcho <span class="variable">$GREEN</span> <span class="string">&quot;欢迎使用pdf分割工具&quot;</span></span><br><span class="line">colorEcho <span class="variable">$GREEN</span> <span class="string">&quot;&quot;</span></span><br><span class="line">colorEcho <span class="variable">$GREEN</span> <span class="string">&quot;该工具基于qpdf,更高级的应用请查看qpdf --help&quot;</span></span><br><span class="line">colorEchoN <span class="variable">$GREEN</span> <span class="string">&quot;该工具会将pdf文件分割成&quot;</span></span><br><span class="line">colorEchoN <span class="variable">$BLUE</span>  <span class="string">&quot;纯单页pdf(1.pdf)&quot;</span></span><br><span class="line">colorEchoN <span class="variable">$GREEN</span> <span class="string">&quot;和&quot;</span></span><br><span class="line">colorEchoN <span class="variable">$BLUE</span>  <span class="string">&quot;纯双页pdf(2.pdf)&quot;</span></span><br><span class="line">colorEcho  <span class="variable">$GREEN</span> <span class="string">&quot;&quot;</span></span><br><span class="line">colorEchoN <span class="variable">$GREEN</span> <span class="string">&quot;分割后的文建保存在&quot;</span></span><br><span class="line">colorEchoN <span class="variable">$BLUE</span>  <span class="string">&quot;pdf文件.d&quot;</span></span><br><span class="line">colorEcho  <span class="variable">$GREEN</span> <span class="string">&quot;目录下&quot;</span></span><br><span class="line">colorEcho <span class="variable">$YELLOW</span> <span class="string">&quot;运行中的warning可以忽略,不影响结果&quot;</span></span><br><span class="line">colorEcho <span class="variable">$GREEN</span> <span class="string">&quot;-------------------------------------------------------------&quot;</span></span><br><span class="line">colorEcho <span class="variable">$GREEN</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    colorEchoN <span class="variable">$GREEN</span> <span class="string">&quot;请输入pdf文件(Ctrl-c/exit-退出,直接拉文件到窗口即可):&quot;</span></span><br><span class="line">    <span class="built_in">read</span> PDF_FILE</span><br><span class="line">    splitPdf <span class="string">&quot;<span class="variable">$PDF_FILE</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><blockquote><p>先打<code>1.pdf</code><br>将打印完成的反过来(不需要调整顺序),再打<code>2.pdf</code></p></blockquote><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol><li>脚本即使省去了每次都要换纸的麻烦,但是还是需要在打印完成后手动调整顺序</li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> qpdf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows下使用Qemu</title>
      <link href="/2019/05/22/windows/windows-qemu/"/>
      <url>/2019/05/22/windows/windows-qemu/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ul><li><p><a href="https://github.com/intel/haxm">haxm</a></p><p>  intel开源的加速qemu驱动</p></li><li><p>tap-windows</p><p>  用于虚拟网卡</p><p>  创建新的虚拟网卡</p><ul><li>tap-windows: Add a new Tap virtual ethernet adapter  </li><li>修改名字为tap0  </li><li>将本地连接(有网络)共享给tap0  </li></ul></li></ul><h2 id="创建虚拟机"><a href="#创建虚拟机" class="headerlink" title="创建虚拟机"></a>创建虚拟机</h2><hr><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 创建盘</span></span></span><br><span class="line">qemu-img create -f raw centos.img 30G</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 启动虚拟机</span></span></span><br><span class="line">qemu-system-x86_64.exe -name test -m 2048 -machine accel=hax -net nic -net tap,ifname=tap0 -cdrom e:/download/CentOS-7-x86_64-Minimal-1810.iso .\centos.img</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># -m 2048 设置内存</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># -machine accel=hax 加速</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># -net nic -net tap,ifname=tap0 网络设置,tap0为上面创建的虚拟网卡</span></span></span><br></pre></td></tr></table></figure><p>使用<code>hax</code>后,启动速度会快很多<br>但在<code>win</code>下,与<code>virtualbox</code>(<code>vagrant</code>)相比,管理起来不是很方便,最终放弃</p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://www.cnblogs.com/bingzhu/p/10746102.html">https://www.cnblogs.com/bingzhu/p/10746102.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决ZIP解压中文乱码的问题</title>
      <link href="/2019/02/25/ubuntu/ubuntu-unar/"/>
      <url>/2019/02/25/ubuntu/ubuntu-unar/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>在备份个人资料的时候,zip文件解压时中文出现乱码<br>网上搜索获得三个解决方案:</p><ol><li><p>使用<code>unzip -O</code>选项<br>但是大部分的发行版中的<code>unzip</code>软件都没有这个参数,至少debian是没有的</p></li><li><p>安装<code>unzip-iconv</code><br>源中都搜索不到这个软件</p></li><li><p><strong>使用<code>unar</code>替代<code>unzip</code>(正确方案)</strong>  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install unar</span><br><span class="line">unar -e utf8 xxx.zip</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>func_merge_runtime</title>
      <link href="/2018/09/13/erlang/erlang-func_merge/"/>
      <url>/2018/09/13/erlang/erlang-func_merge/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><ul><li>将多个模块中的函数使用同一模块调用</li><li>实现类似面向对象<code>继承</code>/<code>重载</code>逻辑</li></ul><span id="more"></span><ul><li><p>瞎折腾</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">例如:</span><br><span class="line">存在`util_lists`, `util_time` 等模块  </span><br><span class="line">使用统一接口`util:func/x`调用, 无需知道`func`具体在哪个模块</span><br></pre></td></tr></table></figure></li></ul><h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><pre><code>需要加载的模块需要先编译</code></pre><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">-compile</span><span class="params">([&#123;parse_transform, func_merge_runtime&#125;])</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 加载a模块的所有导出函数</span></span><br><span class="line">-load_all<span class="params">(a)</span>.</span><br><span class="line"><span class="comment">%% 加载a:f1/0,a:f2/1函数</span></span><br><span class="line">-load_func<span class="params">(&#123;a, [f1/<span class="number">0</span>, f2/<span class="number">1</span>]&#125;)</span>.</span><br></pre></td></tr></table></figure><h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><table><thead><tr><th>erl文件</th><th></th></tr></thead><tbody><tr><td><a href="/downloads/code/func_merge_runtime/func_merge_runtime.erl"><code>func_merge_runtime.erl</code></a></td><td>Parse transform</td></tr><tr><td><a href="/downloads/code/func_merge_runtime/func_a.erl"><code>func_a.erl</code></a></td><td>模块a</td></tr><tr><td><a href="/downloads/code/func_merge_runtime/func_b.erl"><code>func_b.erl</code></a></td><td>模块b</td></tr><tr><td><a href="/downloads/code/func_merge_runtime/func_merge.erl"><code>func_merge.erl</code></a></td><td>合并文件</td></tr><tr><td><a href="/downloads/code/func_merge_runtime/Emakefile"><code>Emakefile</code></a></td><td>emakefile</td></tr><tr><td><a href="/downloads/code/func_merge_runtime/readme.md"><code>readme.md</code></a></td><td>readme</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── ebin</span><br><span class="line">├── Emakefile</span><br><span class="line">├── readme.md</span><br><span class="line">└── src</span><br><span class="line">    ├── func_a.erl</span><br><span class="line">    ├── func_b.erl</span><br><span class="line">    ├── func_merge.erl</span><br><span class="line">    └── func_merge_runtime.erl</span><br></pre></td></tr></table></figure><h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">erl -pa ebin -make</span></span><br><span class="line"></span><br><span class="line">Recompile: src/func_a</span><br><span class="line">Recompile: src/func_b</span><br><span class="line">Recompile: src/func_merge_runtime</span><br><span class="line">Recompile: src/func_merge</span><br><span class="line">Warning: func_b:a/0 function duplicate, Used: a/0 -&gt; func_a:a/0</span><br><span class="line">Warning: func_b:b/0 function duplicate, Used: b/0 -&gt; func_a:b/0</span><br><span class="line">Warning: func_a:a/0 function duplicate, Used: a/0 -&gt; func_a:a/0</span><br><span class="line">Warning: func_a:b/0 function duplicate, Used: b/0 -&gt; func_a:b/0</span><br><span class="line">Warning: a/0 overloaded ...</span><br></pre></td></tr></table></figure><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Eshell V6.<span class="number">3</span>  (abort with ^G)</span><br><span class="line"><span class="number">1</span>&gt; func_merge:module_info().</span><br><span class="line">[&#123;exports,[&#123;a,<span class="number">1</span>&#125;,</span><br><span class="line">           &#123;a,<span class="number">2</span>&#125;,</span><br><span class="line">           &#123;a,<span class="number">0</span>&#125;,</span><br><span class="line">           &#123;b,<span class="number">0</span>&#125;,</span><br><span class="line">           &#123;c,<span class="number">0</span>&#125;,</span><br><span class="line">           &#123;d,<span class="number">0</span>&#125;,</span><br><span class="line">           &#123;module_info,<span class="number">0</span>&#125;,</span><br><span class="line">           &#123;module_info,<span class="number">1</span>&#125;]&#125;,</span><br><span class="line"> &#123;imports,[]&#125;,</span><br><span class="line"> &#123;attributes,[&#123;vsn,[<span class="number">51615201590186967477100822039580749453</span>]&#125;]&#125;,</span><br><span class="line"> &#123;compile,[&#123;options,[error_summary,debug_info,</span><br><span class="line">                     &#123;outdir,<span class="string">&quot;./ebin&quot;</span>&#125;]&#125;,</span><br><span class="line">           &#123;version,<span class="string">&quot;5.0.3&quot;</span>&#125;,</span><br><span class="line">           &#123;time,&#123;<span class="number">2018</span>,<span class="number">9</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">           &#123;source,<span class="string">&quot;e:/zzzz/src/func_merge.erl&quot;</span>&#125;]&#125;]</span><br><span class="line"><span class="number">2</span>&gt; func_merge:a().</span><br><span class="line">func_merge_a</span><br><span class="line"><span class="number">3</span>&gt; func_merge:b().</span><br><span class="line">func_a_b</span><br><span class="line"><span class="number">4</span>&gt; func_merge:c().</span><br><span class="line">func_b_c</span><br><span class="line"><span class="number">5</span>&gt; func_merge:d().</span><br><span class="line">func_b_d</span><br><span class="line"><span class="number">6</span>&gt; func_merge:a(<span class="number">1</span>).</span><br><span class="line">func_merge_a1</span><br><span class="line"><span class="number">7</span>&gt; func_merge:a(<span class="number">2</span>).</span><br><span class="line">func_merge_a2</span><br><span class="line"><span class="number">8</span>&gt; func_merge:a(c).</span><br><span class="line">func_merge_a3</span><br><span class="line"><span class="number">9</span>&gt; </span><br></pre></td></tr></table></figure><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>在修改<code>func_a</code>,<code>func_b</code>模块后,<code>func_merge</code>不会重新编译<br><strong>要手动删除重新编译</strong></p>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql行转列</title>
      <link href="/2018/08/17/mysql/mysql-row-to-col/"/>
      <url>/2018/08/17/mysql/mysql-row-to-col/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>今天看到一个mysql行转列的问题</p><p>将<code>表1</code> 转换为 <code>表2</code></p><p><code>表1</code></p><table><thead><tr><th align="right">year</th><th align="right">month</th><th align="right">amount</th></tr></thead><tbody><tr><td align="right">2011</td><td align="right">1</td><td align="right">1.1</td></tr><tr><td align="right">2011</td><td align="right">2</td><td align="right">1.2</td></tr><tr><td align="right">2011</td><td align="right">3</td><td align="right">1.3</td></tr><tr><td align="right">2011</td><td align="right">4</td><td align="right">1.4</td></tr><tr><td align="right">2012</td><td align="right">1</td><td align="right">2.1</td></tr><tr><td align="right">2012</td><td align="right">2</td><td align="right">2.2</td></tr><tr><td align="right">2012</td><td align="right">3</td><td align="right">2.3</td></tr><tr><td align="right">2012</td><td align="right">4</td><td align="right">2.4</td></tr></tbody></table><p><code>表2</code></p><table><thead><tr><th align="right">year</th><th align="right">m1</th><th align="right">m2</th><th align="right">m3</th><th align="right">m4</th></tr></thead><tbody><tr><td align="right">2011</td><td align="right">1.1</td><td align="right">1.2</td><td align="right">1.3</td><td align="right">1.4</td></tr><tr><td align="right">2012</td><td align="right">2.1</td><td align="right">2.2</td><td align="right">2.3</td><td align="right">2.4</td></tr></tbody></table><span id="more"></span><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>百度获得以下两种方法</p><h3 id="CASE-WHEN"><a href="#CASE-WHEN" class="headerlink" title="CASE WHEN"></a><code>CASE WHEN</code></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    `<span class="keyword">year</span>`,</span><br><span class="line">    <span class="built_in">MAX</span>( <span class="keyword">CASE</span> <span class="keyword">WHEN</span> `<span class="keyword">month</span>` <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span> amount <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">as</span> &quot;m1&quot;,</span><br><span class="line">    <span class="built_in">MAX</span>( <span class="keyword">CASE</span> <span class="keyword">WHEN</span> `<span class="keyword">month</span>` <span class="operator">=</span> <span class="number">2</span> <span class="keyword">THEN</span> amount <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">as</span> &quot;m2&quot;, </span><br><span class="line">    <span class="built_in">MAX</span>( <span class="keyword">CASE</span> <span class="keyword">WHEN</span> `<span class="keyword">month</span>` <span class="operator">=</span> <span class="number">3</span> <span class="keyword">THEN</span> amount <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">as</span> &quot;m3&quot;,</span><br><span class="line">    <span class="built_in">MAX</span>( <span class="keyword">CASE</span> <span class="keyword">WHEN</span> `<span class="keyword">month</span>` <span class="operator">=</span> <span class="number">4</span> <span class="keyword">THEN</span> amount <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">as</span> &quot;m4&quot;</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    test</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> `<span class="keyword">year</span>`;</span><br></pre></td></tr></table></figure><h3 id="GROUP-CONCAT"><a href="#GROUP-CONCAT" class="headerlink" title="GROUP_CONCAT"></a><code>GROUP_CONCAT</code></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="keyword">year</span>, </span><br><span class="line">    SUBSTRING_INDEX(SUBSTRING_INDEX(str, &quot;,&quot;, <span class="number">-4</span>),&quot;,&quot;,<span class="number">1</span>) <span class="keyword">as</span> m1 ,</span><br><span class="line">    SUBSTRING_INDEX(SUBSTRING_INDEX(str, &quot;,&quot;, <span class="number">-3</span>),&quot;,&quot;,<span class="number">1</span>) <span class="keyword">as</span> m2 ,</span><br><span class="line">    SUBSTRING_INDEX(SUBSTRING_INDEX(str, &quot;,&quot;, <span class="number">-2</span>),&quot;,&quot;,<span class="number">1</span>) <span class="keyword">as</span> m3 ,</span><br><span class="line">    SUBSTRING_INDEX(SUBSTRING_INDEX(str, &quot;,&quot;, <span class="number">-1</span>),&quot;,&quot;,<span class="number">1</span>) <span class="keyword">as</span> m4 </span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">year</span>, GROUP_CONCAT(amount) <span class="keyword">as</span> str <span class="keyword">FROM</span> test <span class="keyword">GROUP</span> <span class="keyword">BY</span> `<span class="keyword">year</span>`) <span class="keyword">as</span> t;</span><br></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="http://hchmsguo.iteye.com/blog/555543">http://hchmsguo.iteye.com/blog/555543</a></li><li><a href="https://www.cnblogs.com/crystaltu/p/6699392.html">https://www.cnblogs.com/crystaltu/p/6699392.html</a></li><li><a href="https://www.oschina.net/question/3937294_2285120">https://www.oschina.net/question/3937294_2285120</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>erlang 返回值</title>
      <link href="/2018/08/16/erlang/erlang-return/"/>
      <url>/2018/08/16/erlang/erlang-return/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><code>erlang</code>函数返回的几种方式</p><h2 id="case"><a href="#case" class="headerlink" title="case"></a>case</h2><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> A <span class="keyword">of</span></span><br><span class="line">    <span class="literal">true</span> -&gt;</span><br><span class="line">        <span class="keyword">case</span> B <span class="keyword">of</span></span><br><span class="line">            <span class="literal">true</span> -&gt;</span><br><span class="line">                <span class="keyword">case</span> C <span class="keyword">of</span></span><br><span class="line">                    <span class="literal">true</span> -&gt;</span><br><span class="line">                        ok;</span><br><span class="line">                    <span class="literal">false</span> -&gt;</span><br><span class="line">                        error</span><br><span class="line">                <span class="keyword">end</span>;</span><br><span class="line">            <span class="literal">false</span> -&gt;</span><br><span class="line">                error</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">    <span class="literal">false</span> -&gt;</span><br><span class="line">        error</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure><p>如果判断很多的话, 那么代码可读性就太差了</p><h2 id="if"><a href="#if" class="headerlink" title="if"></a>if</h2><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span></span><br><span class="line">    A -&gt; ok;</span><br><span class="line">    B -&gt; ok;</span><br><span class="line">    C -&gt; ok;</span><br><span class="line">    <span class="literal">true</span> -&gt; error</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>虽然代码看起来规整了,但是变量<code>A</code>,<code>B</code>,<code>C</code>必须先算出结果<br>性能是个问题</p><h2 id="catch-1"><a href="#catch-1" class="headerlink" title="catch-1"></a>catch-1</h2><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">test</span><span class="params">()</span> -&gt;</span></span><br><span class="line">    <span class="keyword">catch</span> test_f1().</span><br><span class="line"><span class="function"><span class="title">test_f1</span><span class="params">()</span> -&gt;</span></span><br><span class="line">    <span class="keyword">case</span> A <span class="keyword">of</span></span><br><span class="line">        <span class="literal">false</span> -&gt; throw(error);</span><br><span class="line">        _ -&gt; ok </span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    <span class="keyword">case</span> B <span class="keyword">of</span></span><br><span class="line">        <span class="literal">false</span> -&gt; throw(error);</span><br><span class="line">        _ -&gt; ok</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    <span class="keyword">case</span> C <span class="keyword">of</span></span><br><span class="line">        <span class="literal">false</span> -&gt; throw(error);</span><br><span class="line">        _ -&gt; ok </span><br><span class="line">    <span class="keyword">end</span>.</span><br></pre></td></tr></table></figure><p>如果<code>test_1/0</code>存在逻辑报错,也会被<code>catch</code><br>需要手动在<code>test/0</code>再加判断</p><h2 id="catch-2"><a href="#catch-2" class="headerlink" title="catch-2"></a>catch-2</h2><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">-define</span><span class="params">(RETURN(Ret)</span>, throw<span class="params">(&#123;catch_return, Ret&#125;)</span>).</span><br><span class="line"><span class="keyword">-define</span><span class="params">(CATCH(A)</span>, mycatch<span class="params">(catch (A)</span>)).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">mycatch</span><span class="params">(&#123;catch_return, Ret&#125;)</span> -&gt;</span> Ret;</span><br><span class="line"><span class="function"><span class="title">mycatch</span><span class="params">(&#123;&#x27;EXIT&#x27;, _Ret&#125; = Catch)</span> -&gt;</span> throw(Catch);</span><br><span class="line"><span class="function"><span class="title">mycatch</span><span class="params">(Ret)</span> -&gt;</span> Ret.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">test</span><span class="params">()</span> -&gt;</span></span><br><span class="line">    ?CATCH(</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> A <span class="keyword">of</span></span><br><span class="line">            <span class="literal">false</span> -&gt; ?RETURN(error);</span><br><span class="line">            _ -&gt; ok </span><br><span class="line">        <span class="keyword">end</span>,</span><br><span class="line">        <span class="keyword">case</span> B <span class="keyword">of</span></span><br><span class="line">            <span class="literal">false</span> -&gt; ?RETURN(error);</span><br><span class="line">            _ -&gt; ok</span><br><span class="line">        <span class="keyword">end</span>,</span><br><span class="line">        <span class="keyword">case</span> C <span class="keyword">of</span></span><br><span class="line">            <span class="literal">false</span> -&gt; ?RETURN(error);</span><br><span class="line">            _ -&gt; ok </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span>).</span><br></pre></td></tr></table></figure><p>个人感觉这个比较好<br>该<code>catch</code>的<code>catch</code>了<br>该<code>throw</code>的也<code>throw</code>了</p>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>目录跳转神器autojump</title>
      <link href="/2018/08/15/centos/centos-autojump/"/>
      <url>/2018/08/15/centos/centos-autojump/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install autojump</span><br></pre></td></tr></table></figure><h2 id="CENTOS-LINUX使用"><a href="#CENTOS-LINUX使用" class="headerlink" title="CENTOS/LINUX使用"></a>CENTOS/LINUX使用</h2><p>安装后,重新打开终端,或执行<code>source etc/profile.d/autojump.sh</code>才可使用<br>在使用<code>j xxxx</code>前,要先<code>cd xxx/xxxx</code>一次<br>然后就可以愉快的使用<code>j xxxx</code>进行跳转了</p><blockquote><p>查看记录/配置文件: <code>j --stat</code></p></blockquote><h2 id="WIN使用"><a href="#WIN使用" class="headerlink" title="WIN使用"></a>WIN使用</h2><p><code>autojump</code>在<code>WINDOWS</code>没有安装成功,而且个人习惯使用<code>PowerShell</code></p><p><code>PowerShell</code>下有一个替代者</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Install-Module</span> ZLocation <span class="literal">-Scope</span> CurrentUser</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> xxxx</span><br><span class="line">z xxxx</span><br></pre></td></tr></table></figure><p>使用方法和<code>autojump</code>类似,只是<code>j</code>换成了<code>z</code></p><blockquote><p>查看记录: <code>Get-ZLocation</code><br>配置文件: <code>C:\Users\Administrator\z-location.txt</code></p></blockquote><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://github.com/vors/ZLocation.git">https://github.com/vors/ZLocation.git</a></li><li><a href="https://github.com/wting/autojump.git">https://github.com/wting/autojump.git</a></li><li><a href="https://github.com/vors/ZLocation/pull/42">https://github.com/vors/ZLocation/pull/42</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用erl_tidy格式化代码宏定义注意</title>
      <link href="/2018/08/09/erlang/erlang-macro/"/>
      <url>/2018/08/09/erlang/erlang-macro/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>自己写了一个rebar3插件,用于格式化代码,基于<code>erl_tidy</code><br>链接地址: <a href="https://github.com/kingwen0302/rebar3_plugin_fmt.git">rebar3_plugin_fmt</a><br>无意中发现一个宏定义的问题</p><p>源代码:</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">-define</span><span class="params">(CALC_PERIOD_RATE, <span class="number">0.6</span>)</span>. <span class="comment">%% 权重概率</span></span><br></pre></td></tr></table></figure><p>格式化后代码:</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">-define</span><span class="params">(CALC_PERIOD_RATE, <span class="number">5.99999999999999977796e-1</span>)</span>. <span class="comment">%% 权重概率</span></span><br></pre></td></tr></table></figure><p>因此,若是小数, 请使用<code>(6/10)</code>这种格式</p>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>proxychains对单个应用代理</title>
      <link href="/2018/08/01/centos/centos7-proxychains/"/>
      <url>/2018/08/01/centos/centos7-proxychains/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#</span></span> </span><br><span class="line">git clone https://github.com/rofl0r/proxychains-ng</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 自行选择版本</span></span></span><br><span class="line">git checkout -b v4.13</span><br><span class="line"></span><br><span class="line">cd proxychains-ng</span><br><span class="line">./configure --prefix=/usr --sysconfdir=/etc</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 生成配置文件</span></span></span><br><span class="line">make install-config</span><br></pre></td></tr></table></figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/proxychains.conf</span><br><span class="line"></span><br><span class="line">dynamic_chain</span><br><span class="line">proxy_dns</span><br><span class="line">localnet 127.0.0.0/255.0.0.0</span><br><span class="line">localnet 10.0.0.0/255.0.0.0</span><br><span class="line">localnet 172.16.0.0/255.240.0.0</span><br><span class="line">localnet 192.168.0.0/255.255.0.0</span><br><span class="line"></span><br><span class="line">[ProxyList]</span><br><span class="line">socks5 192.168.70.71 1080</span><br></pre></td></tr></table></figure><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p><code>proxychains4 git clone https://github.com/rofl0r/proxychains-ng</code></p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol><li>不是所有的都能够代理,至少<code>ping</code>就不行(据说是不支持对icmp代理)</li></ol><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://www.hi-linux.com/posts/48321.html">https://www.hi-linux.com/posts/48321.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos7 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>将linux目录映射到windows本地</title>
      <link href="/2018/07/30/windows/window-mount-by-ssh/"/>
      <url>/2018/07/30/windows/window-mount-by-ssh/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="Dokan-win-sshfs"><a href="#Dokan-win-sshfs" class="headerlink" title="Dokan+win-sshfs"></a><code>Dokan</code>+<code>win-sshfs</code></h2><p>没有实际使用,只做记录</p><ul><li><a href="https://github.com/dokan-dev/dokany/releases">Dokan</a>  </li><li><a href="https://github.com/feo-cz/win-sshfs/releases">win-sshfs</a></li><li><a href="https://www.raidrive.com/Download">RaiDrive</a></li></ul><blockquote><p><code>win-sshfs</code>已经停止更新</p></blockquote><h2 id="SFTP-Net-Drive-个人在用"><a href="#SFTP-Net-Drive-个人在用" class="headerlink" title="SFTP Net Drive(个人在用)"></a><code>SFTP Net Drive</code>(个人在用)</h2><ul><li><a href="https://www.nsoftware.com/download/getfile.aspx?file=free/NDXC-A/setup.exe&name=SFTP+Net+Drive">SFTP Net Drive</a></li></ul><blockquote><p>新发现的<code>RaiDrive</code>似乎更加好用</p></blockquote><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://blog.csdn.net/Site1997/article/details/79048480">https://blog.csdn.net/Site1997/article/details/79048480</a></li><li><a href="https://wsgzao.github.io/post/winsshfs/">https://wsgzao.github.io/post/winsshfs/</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>erlang kvlist,record互转</title>
      <link href="/2018/07/23/erlang/erlang-rec2kvlist/"/>
      <url>/2018/07/23/erlang/erlang-rec2kvlist/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>目前项目中将record结构转换为KVList, 然后保存到mongodb中<br>由于<code>record_info(fields,Record)</code>不支持传入参数,处理从record转换为kvlist比较麻烦</p><span id="more"></span><h2 id="目前做法"><a href="#目前做法" class="headerlink" title="目前做法"></a>目前做法</h2><p>目前的做法是罗列所有的record,如下:</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">save</span><span class="params">(Rec)</span> <span class="title">when</span> <span class="title">is_record</span><span class="params">(Rec, aaa)</span> -&gt;</span></span><br><span class="line">    KvList = lists:zip(erlang:tl(tuple_to_list(Rec), record_info(fields, aaa)),</span><br><span class="line">    <span class="comment">%% 保存到mongodb</span></span><br><span class="line">    save_db(KvList);</span><br><span class="line">save(Rec) when is_record(Rec, bbb) -&gt;</span><br><span class="line">    KvList = lists:zip(erlang:tl(tuple_to_list(Rec), record_info(fields, bbb)),</span><br><span class="line">    <span class="comment">%% 保存到mongodb</span></span><br><span class="line">    save_db(KvList);</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>如果存在<code>#aaa&#123;id = #bbb&#123;&#125;&#125;</code>这种结构,需要一层一层的手动解析</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">-define</span><span class="params">(REC_TO_KVLIST(Rec, RecName)</span>,</span><br><span class="line">        lists:zip<span class="params">(erlang:tl(tuple_to_list(Rec)), record_info(fields, RecName))</span></span><br><span class="line">        ).</span><br><span class="line"></span><br><span class="line">A = #aaa&#123;id = #bbb&#123;&#125;&#125;,</span><br><span class="line">A1 = A#aaa&#123;id = ?REC_TO_KVLIST(A#aaa.id, bbb)&#125;,</span><br><span class="line">A2 = ?REC_TO_KVLIST(A1, aaa),</span><br><span class="line">保存到mongodb中</span><br><span class="line"><span class="function"><span class="title">save_db</span><span class="params">(A2)</span></span></span><br></pre></td></tr></table></figure><p>相应的,从mongodb中读取数据,也要进行多次转换<br>稍微不注意就会出现db升级失败,数据丢失</p><h2 id="可能的解决方法-未在项目中使用"><a href="#可能的解决方法-未在项目中使用" class="headerlink" title="可能的解决方法(未在项目中使用)"></a>可能的解决方法(未在项目中使用)</h2><p><strong>归根到底还是<code>record_info</code>,不支持传入参数</strong><br>搜索github, 发现<a href="https://github.com/okeuday/record_info_runtime.git">record_info_runtime</a></p><table><thead><tr><th>erl文件</th><th></th></tr></thead><tbody><tr><td><a href="/downloads/code/record_info_runtime.erl"><code>record_info_runtime.erl</code></a></td><td>Parse transform for using record_info(size, _) and record_info(fields, _) during runtime<br/>增加了<code>record_init/1</code></td></tr><tr><td><a href="/downloads/code/l2r.erl"><code>l2r.erl</code></a></td><td>record,kvlist互转</td></tr><tr><td><a href="/downloads/code/rec_a.hrl"><code>rec_a.hrl</code></a></td><td>测试头文件</td></tr></tbody></table><h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Eshell V6.<span class="number">3</span>  (abort with ^G)</span><br><span class="line"><span class="number">1</span>&gt; rr(<span class="string">&quot;rec_a.hrl&quot;</span>).</span><br><span class="line">[name,person]</span><br><span class="line"><span class="number">2</span>&gt; KV = l2r:rec_to_kvlist(#person&#123;&#125;).</span><br><span class="line">[&#123;&#x27;__record_name__&#x27;,person&#125;,</span><br><span class="line"> &#123;id,<span class="number">0</span>&#125;,</span><br><span class="line"> &#123;name,[&#123;&#x27;__record_name__&#x27;,name&#125;,&#123;first,<span class="string">&quot;aaa&quot;</span>&#125;,&#123;last,<span class="string">&quot;bbb&quot;</span>&#125;]&#125;,</span><br><span class="line"> &#123;names,[[&#123;&#x27;__record_name__&#x27;,name&#125;,&#123;first,<span class="string">&quot;abc&quot;</span>&#125;,&#123;last,[]&#125;],</span><br><span class="line">         [&#123;&#x27;__record_name__&#x27;,name&#125;,&#123;first,[]&#125;,&#123;last,<span class="string">&quot;def&quot;</span>&#125;]]&#125;,</span><br><span class="line"> &#123;sex,<span class="number">0</span>&#125;]</span><br><span class="line"><span class="number">3</span>&gt; l2r:kvlist_to_rec(KV).</span><br><span class="line">#person&#123;id = <span class="number">0</span>,</span><br><span class="line">        name = #name&#123;first = <span class="string">&quot;aaa&quot;</span>,last = <span class="string">&quot;bbb&quot;</span>&#125;,</span><br><span class="line">        names = [#name&#123;first = <span class="string">&quot;abc&quot;</span>,last = []&#125;,</span><br><span class="line">                 #name&#123;first = [],last = <span class="string">&quot;def&quot;</span>&#125;],</span><br><span class="line">        sex = <span class="number">0</span>&#125;</span><br><span class="line"><span class="number">4</span>&gt; #person&#123;&#125;.</span><br><span class="line">#person&#123;id = <span class="number">0</span>,</span><br><span class="line">        name = #name&#123;first = <span class="string">&quot;aaa&quot;</span>,last = <span class="string">&quot;bbb&quot;</span>&#125;,</span><br><span class="line">        names = [#name&#123;first = <span class="string">&quot;abc&quot;</span>,last = []&#125;,</span><br><span class="line">                 #name&#123;first = [],last = <span class="string">&quot;def&quot;</span>&#125;],</span><br><span class="line">        sex = <span class="number">0</span>&#125;</span><br><span class="line"><span class="number">5</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="最后贴代码凑字数"><a href="#最后贴代码凑字数" class="headerlink" title="最后贴代码凑字数"></a>最后贴代码凑字数</h2><figure class="highlight erlang"><figcaption><span>record_info_runtime.erl</span><a href="/downloads/code/record_info_runtime.erl">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%-*-Mode:erlang;coding:utf-8;tab-width:4;c-basic-offset:4;indent-tabs-mode:()-*-</span></span><br><span class="line"><span class="comment">% ex: set ft=erlang fenc=utf-8 sts=4 ts=4 sw=4 et:</span></span><br><span class="line"><span class="comment">%%%</span></span><br><span class="line"><span class="comment">%%%------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">%%% @doc</span></span><br><span class="line"><span class="comment">%%% ==Record Info Runtime Parse Transform==</span></span><br><span class="line"><span class="comment">%%% Insert private functions into a module if the module contains any</span></span><br><span class="line"><span class="comment">%%% record definitions (including those from header files).  The private</span></span><br><span class="line"><span class="comment">%%% functions inserted are record_info_size/1 and record_info_fields/1, so</span></span><br><span class="line"><span class="comment">%%% the record_info(size, _) and record_info(fields, _) can be called at</span></span><br><span class="line"><span class="comment">%%% runtime, but without exported functions.  The unused function warning</span></span><br><span class="line"><span class="comment">%%% is automatically turned off for the inserted functions, so they</span></span><br><span class="line"><span class="comment">%%% don&#x27;t necessarily need to be used.</span></span><br><span class="line"><span class="comment">%%% @end</span></span><br><span class="line"><span class="comment">%%%</span></span><br><span class="line"><span class="comment">%%% BSD LICENSE</span></span><br><span class="line"><span class="comment">%%% </span></span><br><span class="line"><span class="comment">%%% Copyright (c) 2013, Michael Truog &lt;mjtruog at gmail dot com&gt;</span></span><br><span class="line"><span class="comment">%%% All rights reserved.</span></span><br><span class="line"><span class="comment">%%% </span></span><br><span class="line"><span class="comment">%%% Redistribution and use in source and binary forms, with or without</span></span><br><span class="line"><span class="comment">%%% modification, are permitted provided that the following conditions are met:</span></span><br><span class="line"><span class="comment">%%% </span></span><br><span class="line"><span class="comment">%%%     * Redistributions of source code must retain the above copyright</span></span><br><span class="line"><span class="comment">%%%       notice, this list of conditions and the following disclaimer.</span></span><br><span class="line"><span class="comment">%%%     * Redistributions in binary form must reproduce the above copyright</span></span><br><span class="line"><span class="comment">%%%       notice, this list of conditions and the following disclaimer in</span></span><br><span class="line"><span class="comment">%%%       the documentation and/or other materials provided with the</span></span><br><span class="line"><span class="comment">%%%       distribution.</span></span><br><span class="line"><span class="comment">%%%     * All advertising materials mentioning features or use of this</span></span><br><span class="line"><span class="comment">%%%       software must display the following acknowledgment:</span></span><br><span class="line"><span class="comment">%%%         This product includes software developed by Michael Truog</span></span><br><span class="line"><span class="comment">%%%     * The name of the author may not be used to endorse or promote</span></span><br><span class="line"><span class="comment">%%%       products derived from this software without specific prior</span></span><br><span class="line"><span class="comment">%%%       written permission</span></span><br><span class="line"><span class="comment">%%% </span></span><br><span class="line"><span class="comment">%%% THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND</span></span><br><span class="line"><span class="comment">%%% CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span></span><br><span class="line"><span class="comment">%%% INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span></span><br><span class="line"><span class="comment">%%% OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span></span><br><span class="line"><span class="comment">%%% DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span></span><br><span class="line"><span class="comment">%%% CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></span><br><span class="line"><span class="comment">%%% SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</span></span><br><span class="line"><span class="comment">%%% BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span></span><br><span class="line"><span class="comment">%%% SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span></span><br><span class="line"><span class="comment">%%% INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,</span></span><br><span class="line"><span class="comment">%%% WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span></span><br><span class="line"><span class="comment">%%% NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></span><br><span class="line"><span class="comment">%%% OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span></span><br><span class="line"><span class="comment">%%% DAMAGE.</span></span><br><span class="line"><span class="comment">%%%</span></span><br><span class="line"><span class="comment">%%% @author Michael Truog &lt;mjtruog [at] gmail (dot) com&gt;</span></span><br><span class="line"><span class="comment">%%% @copyright 2013 Michael Truog</span></span><br><span class="line"><span class="comment">%%% @version 1.0.0 {@date} {@time}</span></span><br><span class="line"><span class="comment">%%%------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">-module</span><span class="params">(record_info_runtime)</span>.</span><br><span class="line"><span class="keyword">-author</span><span class="params">(&#x27;mjtruog [at] gmail (dot)</span> com&#x27;).</span><br><span class="line"></span><br><span class="line"><span class="keyword">-export</span><span class="params">([parse_transform/<span class="number">2</span>])</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-record</span><span class="params">(state,</span></span><br><span class="line"><span class="params">    {</span></span><br><span class="line"><span class="params">        records = [], <span class="comment">% stored in reverse order</span></span></span><br><span class="line"><span class="params">        types = dict:new()</span></span><br><span class="line"><span class="params">    })</span>.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">parse_transform</span><span class="params">(Forms, _CompileOptions)</span> -&gt;</span></span><br><span class="line">    <span class="comment">%% {ok, IO} = file:open(&quot;a.txt&quot;, [write]),</span></span><br><span class="line">    <span class="comment">%% io:format(IO, &quot;~p&quot;, [Forms]),</span></span><br><span class="line">    <span class="comment">%% io:close(IO),</span></span><br><span class="line">    forms_process(Forms, [], #state{}).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">forms_process</span><span class="params">([{eof, _} = EOF], L,</span></span></span><br><span class="line"><span class="params"><span class="function">              #state{records = []})</span> -&gt;</span></span><br><span class="line">    <span class="comment">% nothing to do (no records found)</span></span><br><span class="line">    lists:reverse([EOF | L]);</span><br><span class="line"><span class="function"><span class="title">forms_process</span><span class="params">([{eof, _} = EOF], L,</span></span></span><br><span class="line"><span class="params"><span class="function">              #state{records = Records,</span></span></span><br><span class="line"><span class="params"><span class="function">                     types = Types})</span> -&gt;</span></span><br><span class="line">    [{attribute, _, file, _} = FILE |</span><br><span class="line">     NewForms] = lists:reverse([EOF,</span><br><span class="line">                                record_init(Records),</span><br><span class="line">                                record_info_size(Records),</span><br><span class="line">                                record_info_fields(Records),</span><br><span class="line">                                record_info_fieldtypes(Records, Types),</span><br><span class="line">                                record_new(Records),</span><br><span class="line">                                records(Records) | L]),</span><br><span class="line">    [FILE, record_info_f_nowarn() | NewForms];</span><br><span class="line"><span class="function"><span class="title">forms_process</span><span class="params">([{attribute, _Line, record,</span></span></span><br><span class="line"><span class="params"><span class="function">                {Name, _Fields}} = H | Forms], L,</span></span></span><br><span class="line"><span class="params"><span class="function">              #state{records = Records} = State)</span> -&gt;</span></span><br><span class="line">  forms_process(Forms, [H | L],</span><br><span class="line">                State#state{records = [Name | Records]});</span><br><span class="line"><span class="function"><span class="title">forms_process</span><span class="params">([{attribute, _Line, type,</span></span></span><br><span class="line"><span class="params"><span class="function">                {{record, Name}, Fields, _}} = H | Forms], L,</span></span></span><br><span class="line"><span class="params"><span class="function">              State)</span> -&gt;</span></span><br><span class="line">  forms_process(Forms, [H | L],</span><br><span class="line">                type_record_fields(Fields, Name, State));</span><br><span class="line"><span class="function"><span class="title">forms_process</span><span class="params">([H | Forms], L, State)</span> -&gt;</span></span><br><span class="line">    forms_process(Forms, [H | L], State).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_info_f_nowarn</span><span class="params">()</span> -&gt;</span></span><br><span class="line">    {attribute, <span class="number">1</span>, compile,</span><br><span class="line">     {nowarn_unused_function,</span><br><span class="line">      [{records, <span class="number">0</span>},</span><br><span class="line">       {record_new, <span class="number">1</span>},</span><br><span class="line">       {record_info_fieldtypes, <span class="number">1</span>},</span><br><span class="line">       {record_info_fields, <span class="number">1</span>},</span><br><span class="line">       {record_init, <span class="number">1</span>},</span><br><span class="line">       {record_info_size, <span class="number">1</span>}]}}.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">records</span><span class="params">(Records)</span> -&gt;</span></span><br><span class="line">    {function, <span class="number">1</span>, records, <span class="number">0</span>,</span><br><span class="line">     [{clause, <span class="number">1</span>, [], [],</span><br><span class="line">       [records_f(lists:reverse(Records))]}]}.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">records_f</span><span class="params">([Name])</span> -&gt;</span></span><br><span class="line">    {cons, <span class="number">1</span>, {atom, <span class="number">1</span>, Name}, {nil, <span class="number">1</span>}};</span><br><span class="line"><span class="function"><span class="title">records_f</span><span class="params">([Name | Records])</span> -&gt;</span></span><br><span class="line">    {cons, <span class="number">1</span>, {atom, <span class="number">1</span>, Name}, records_f(Records)}.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_new</span><span class="params">(Records)</span> -&gt;</span></span><br><span class="line">    {function, <span class="number">1</span>, record_new, <span class="number">1</span>,</span><br><span class="line">     record_new_f([], Records)}.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_new_f</span><span class="params">(L, [])</span> -&gt;</span></span><br><span class="line">    L;</span><br><span class="line"><span class="function"><span class="title">record_new_f</span><span class="params">(L, [Name | Records])</span> -&gt;</span></span><br><span class="line">    record_new_f([{clause, <span class="number">1</span>,</span><br><span class="line">                   [{atom, <span class="number">1</span>, Name}], [],</span><br><span class="line">                   [{record, <span class="number">1</span>, Name, []}]} | L], Records).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes</span><span class="params">(Records, Types)</span> -&gt;</span></span><br><span class="line">    {function, <span class="number">1</span>, record_info_fieldtypes, <span class="number">1</span>,</span><br><span class="line">     record_info_fieldtypes_f([], Records, Types)}.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes_f_entry_types</span><span class="params">([])</span> -&gt;</span></span><br><span class="line">    {nil, <span class="number">1</span>};</span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes_f_entry_types</span><span class="params">([TypeInfo | TypeList])</span> -&gt;</span></span><br><span class="line">    {cons, <span class="number">1</span>,</span><br><span class="line">     record_info_fieldtypes_f_entry_typeinfo(TypeInfo, false),</span><br><span class="line">     record_info_fieldtypes_f_entry_types(TypeList)}.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes_f_entry_typeinfo_type</span><span class="params">({M, T})</span></span></span><br><span class="line"><span class="function">    <span class="title">when</span> <span class="title">is_atom</span><span class="params">(M)</span>, <span class="title">is_atom</span><span class="params">(T)</span> -&gt;</span></span><br><span class="line">    {tuple, <span class="number">1</span>, [{atom, <span class="number">1</span>, M}, {atom, <span class="number">1</span>, T}]};</span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes_f_entry_typeinfo_type</span><span class="params">(T)</span></span></span><br><span class="line"><span class="function">    <span class="title">when</span> <span class="title">is_atom</span><span class="params">(T)</span> -&gt;</span></span><br><span class="line">    {atom, <span class="number">1</span>, T}.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes_f_entry_typeinfo</span><span class="params">({Type, []}, false)</span> -&gt;</span></span><br><span class="line">    record_info_fieldtypes_f_entry_typeinfo_type(Type);</span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes_f_entry_typeinfo</span><span class="params">({Type, TypeList}, _)</span> -&gt;</span></span><br><span class="line">    {tuple, <span class="number">1</span>,</span><br><span class="line">     [record_info_fieldtypes_f_entry_typeinfo_type(Type),</span><br><span class="line">      record_info_fieldtypes_f_entry_types(TypeList)]};</span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes_f_entry_typeinfo</span><span class="params">(Type, _)</span></span></span><br><span class="line"><span class="function">    <span class="title">when</span> <span class="title">is_atom</span><span class="params">(Type)</span> -&gt;</span></span><br><span class="line">    <span class="comment">% e.g.: any</span></span><br><span class="line">    {atom, <span class="number">1</span>, Type};</span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes_f_entry_typeinfo</span><span class="params">({Type, _Line, Constant}, _)</span></span></span><br><span class="line"><span class="function">    <span class="title">when</span> <span class="title">is_atom</span><span class="params">(Type)</span> -&gt;</span></span><br><span class="line">    <span class="comment">% e.g.: {integer, 1, 128}</span></span><br><span class="line">    {Type, <span class="number">1</span>, Constant};</span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes_f_entry_typeinfo</span><span class="params">(Literal, _)</span> -&gt;</span></span><br><span class="line">    exit({badarg, Literal}).</span><br><span class="line">    <span class="comment">%{string, 1, lists:flatten(io_lib:format(&quot;~p&quot;,[Literal]))}.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes_f_entry</span><span class="params">(FieldName, undefined)</span> -&gt;</span></span><br><span class="line">    {tuple, <span class="number">1</span>,</span><br><span class="line">     [{atom, <span class="number">1</span>, FieldName},</span><br><span class="line">      {atom, <span class="number">1</span>, undefined}]};</span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes_f_entry</span><span class="params">(FieldName, TypeInfo)</span> -&gt;</span></span><br><span class="line">    {tuple, <span class="number">1</span>,</span><br><span class="line">     [{atom, <span class="number">1</span>, FieldName},</span><br><span class="line">      record_info_fieldtypes_f_entry_typeinfo(TypeInfo, true)]}.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes_f_entries</span><span class="params">([{FieldName, TypeInfo}])</span> -&gt;</span></span><br><span class="line">    {cons, <span class="number">1</span>, record_info_fieldtypes_f_entry(FieldName, TypeInfo),</span><br><span class="line">     {nil, <span class="number">1</span>}};</span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes_f_entries</span><span class="params">([{FieldName, TypeInfo} | L])</span> -&gt;</span></span><br><span class="line">    {cons, <span class="number">1</span>, record_info_fieldtypes_f_entry(FieldName, TypeInfo),</span><br><span class="line">     record_info_fieldtypes_f_entries(L)}.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes_f</span><span class="params">(L, [], _Types)</span> -&gt;</span></span><br><span class="line">    L;</span><br><span class="line"><span class="function"><span class="title">record_info_fieldtypes_f</span><span class="params">(L, [Name | Records], Types)</span> -&gt;</span></span><br><span class="line">    ClauseBody = <span class="keyword">case</span> dict:find(Name, Types) <span class="keyword">of</span></span><br><span class="line">        {ok, FieldTypes} -&gt;</span><br><span class="line">            [record_info_fieldtypes_f_entries(lists:reverse(FieldTypes))];</span><br><span class="line">        error -&gt;</span><br><span class="line">            [{lc, <span class="number">1</span>,</span><br><span class="line">              {tuple, <span class="number">1</span>,</span><br><span class="line">               [{var, <span class="number">1</span>, &#x27;FieldName&#x27;},</span><br><span class="line">                {atom, <span class="number">1</span>, undefined}]},</span><br><span class="line">              [{generate, <span class="number">1</span>,</span><br><span class="line">                {var, <span class="number">1</span>, &#x27;FieldName&#x27;},</span><br><span class="line">                {call, <span class="number">1</span>,</span><br><span class="line">                 {atom, <span class="number">1</span>, record_info},</span><br><span class="line">                 [{atom, <span class="number">1</span>, fields},</span><br><span class="line">                  {atom, <span class="number">1</span>, Name}]}}]}]</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    record_info_fieldtypes_f([{clause, <span class="number">1</span>,</span><br><span class="line">                               [{atom, <span class="number">1</span>, Name}], [],</span><br><span class="line">                               ClauseBody} | L], Records, Types).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_init</span><span class="params">(Records)</span> -&gt;</span></span><br><span class="line">    {function, <span class="number">1</span>, record_init, <span class="number">1</span>,</span><br><span class="line">    record_init_f([], Records)}.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_init_f</span><span class="params">(L, [])</span> -&gt;</span></span><br><span class="line">    L;</span><br><span class="line"><span class="function"><span class="title">record_init_f</span><span class="params">(L, [Name|Records])</span> -&gt;</span></span><br><span class="line">    record_init_f([{clause, <span class="number">1</span>,</span><br><span class="line">                   [{atom, <span class="number">1</span>, Name}], [],</span><br><span class="line">                   [{record,<span class="number">1</span>,Name, []}]}|L], Records).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_info_fields</span><span class="params">(Records)</span> -&gt;</span></span><br><span class="line">    {function, <span class="number">1</span>, record_info_fields, <span class="number">1</span>,</span><br><span class="line">     record_info_fields_f([], Records)}.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_info_fields_f</span><span class="params">(L, [])</span> -&gt;</span></span><br><span class="line">    L;</span><br><span class="line"><span class="function"><span class="title">record_info_fields_f</span><span class="params">(L, [Name | Records])</span> -&gt;</span></span><br><span class="line">    record_info_fields_f([{clause, <span class="number">1</span>,</span><br><span class="line">                           [{atom, <span class="number">1</span>, Name}], [],</span><br><span class="line">                           [{call, <span class="number">1</span>,</span><br><span class="line">                             {atom, <span class="number">1</span>, record_info},</span><br><span class="line">                             [{atom, <span class="number">1</span>, fields},</span><br><span class="line">                              {atom, <span class="number">1</span>, Name}]}]} | L], Records).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_info_size</span><span class="params">(Records)</span> -&gt;</span></span><br><span class="line">    {function, <span class="number">1</span>, record_info_size, <span class="number">1</span>,</span><br><span class="line">     record_info_size_f([], Records)}.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">record_info_size_f</span><span class="params">(L, [])</span> -&gt;</span></span><br><span class="line">    L;</span><br><span class="line"><span class="function"><span class="title">record_info_size_f</span><span class="params">(L, [Name | Records])</span> -&gt;</span></span><br><span class="line">    record_info_size_f([{clause, <span class="number">1</span>,</span><br><span class="line">                         [{atom, <span class="number">1</span>, Name}], [],</span><br><span class="line">                         [{call, <span class="number">1</span>,</span><br><span class="line">                           {atom, <span class="number">1</span>, record_info},</span><br><span class="line">                           [{atom, <span class="number">1</span>, size},</span><br><span class="line">                            {atom, <span class="number">1</span>, Name}]}]} | L], Records).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">type_record_field_info</span><span class="params">({type, _Line1, union,</span></span></span><br><span class="line"><span class="params"><span class="function">                        [{atom, _Line2, undefined}, TypeInfo]})</span> -&gt;</span></span><br><span class="line">    type_record_field_info(TypeInfo);</span><br><span class="line"><span class="function"><span class="title">type_record_field_info</span><span class="params">({type, _Line, Type, any})</span> -&gt;</span></span><br><span class="line">    {Type, [any]};</span><br><span class="line"><span class="function"><span class="title">type_record_field_info</span><span class="params">({type, _Line, Type, TypeList})</span> -&gt;</span></span><br><span class="line">    {Type, [type_record_field_info(T) || T &lt;- TypeList]};</span><br><span class="line"><span class="function"><span class="title">type_record_field_info</span><span class="params">({remote_type, _Line1,</span></span></span><br><span class="line"><span class="params"><span class="function">                        [{atom, _Line2, Module},</span></span></span><br><span class="line"><span class="params"><span class="function">                         {atom, _Line3, Type}, Arguments]})</span> -&gt;</span></span><br><span class="line">    {{Module, Type}, Arguments};</span><br><span class="line"><span class="function"><span class="title">type_record_field_info</span><span class="params">(Literal)</span> -&gt;</span></span><br><span class="line">    Literal.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">type_record_fields</span><span class="params">([], _RecordName, State)</span> -&gt;</span></span><br><span class="line">    State;</span><br><span class="line"><span class="function"><span class="title">type_record_fields</span><span class="params">([{record_field, _Line1,</span></span></span><br><span class="line"><span class="params"><span class="function">                     {atom, _Line2, FieldName}, _Value} | Fields],</span></span></span><br><span class="line"><span class="params"><span class="function">                   RecordName, #state{types = Types} = State)</span> -&gt;</span></span><br><span class="line">    Entry = {FieldName, undefined},</span><br><span class="line">    NewTypes = dict:update(RecordName, <span class="keyword">fun</span>(L) -&gt;</span><br><span class="line">        [Entry | L]</span><br><span class="line">    <span class="keyword">end</span>, [Entry], Types),</span><br><span class="line">    type_record_fields(Fields, RecordName, State#state{types = NewTypes});</span><br><span class="line"><span class="function"><span class="title">type_record_fields</span><span class="params">([{typed_record_field, RecordField, TypeInfo} | Fields],</span></span></span><br><span class="line"><span class="params"><span class="function">                   RecordName, #state{types = Types} = State)</span> -&gt;</span></span><br><span class="line">    FieldName = <span class="keyword">case</span> RecordField <span class="keyword">of</span></span><br><span class="line">        {record_field, _Line1,</span><br><span class="line">         {atom, _Line2, Name}, _Value} -&gt;</span><br><span class="line">            Name;</span><br><span class="line">        {record_field, _Line1,</span><br><span class="line">         {atom, _Line2, Name}} -&gt;</span><br><span class="line">            Name</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    Entry = {FieldName, type_record_field_info(TypeInfo)},</span><br><span class="line">    NewTypes = dict:update(RecordName, <span class="keyword">fun</span>(L) -&gt;</span><br><span class="line">        [Entry | L]</span><br><span class="line">    <span class="keyword">end</span>, [Entry], Types),</span><br><span class="line">    type_record_fields(Fields, RecordName, State#state{types = NewTypes}).</span><br></pre></td></tr></table></figure><figure class="highlight erlang"><figcaption><span>rec_a.hrl</span><a href="/downloads/code/rec_a.hrl">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">-record</span><span class="params">(name, {</span></span><br><span class="line"><span class="params">    first = <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="params">    last = <span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="params">})</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-record</span><span class="params">(person, {</span></span><br><span class="line"><span class="params">    id = <span class="number">0</span></span></span><br><span class="line"><span class="params">    ,name = #name{first=<span class="string">&quot;aaa&quot;</span>, last=<span class="string">&quot;bbb&quot;</span>}</span></span><br><span class="line"><span class="params">    ,names = [#name{first=<span class="string">&quot;abc&quot;</span>}, #name{last=<span class="string">&quot;def&quot;</span>}]</span></span><br><span class="line"><span class="params">    ,sex = <span class="number">0</span></span></span><br><span class="line"><span class="params">})</span>.</span><br></pre></td></tr></table></figure><figure class="highlight erlang"><figcaption><span>l2r.erl</span><a href="/downloads/code/l2r.erl">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% coding: latin-1</span></span><br><span class="line"><span class="comment">%%%-----------------------------------------------</span></span><br><span class="line"><span class="comment">%%% @doc</span></span><br><span class="line"><span class="comment">%%%     record,kvlist互转</span></span><br><span class="line"><span class="comment">%%%     包含头文件即可</span></span><br><span class="line"><span class="comment">%%% @end</span></span><br><span class="line"><span class="comment">%%%-----------------------------------------------</span></span><br><span class="line"><span class="keyword">-module</span><span class="params">(l2r)</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-include</span><span class="params">(<span class="string">&quot;rec_a.hrl&quot;</span>)</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-define</span><span class="params">(RECORD_NAME, &#x27;__record_name__&#x27;)</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-define</span><span class="params">(ERROR_MSG(Format, Args)</span>, io:format<span class="params">(<span class="string">&quot;[ERROR]&quot;</span> ++ Format ++ <span class="string">&quot;\n&quot;</span>, Args)</span>).</span><br><span class="line"><span class="keyword">-define</span><span class="params">(INFO_MSG(Format, Args)</span>, io:format<span class="params">(<span class="string">&quot;[INFO]&quot;</span> ++ Format ++ <span class="string">&quot;\n&quot;</span>, Args)</span>).</span><br><span class="line"></span><br><span class="line"><span class="keyword">-compile</span><span class="params">([{parse_transform, record_info_runtime}])</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-export</span><span class="params">([</span></span><br><span class="line"><span class="params">         rec_to_kvlist/<span class="number">1</span>,</span></span><br><span class="line"><span class="params">         kvlist_to_rec/<span class="number">1</span></span></span><br><span class="line"><span class="params">        ])</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-export</span><span class="params">([</span></span><br><span class="line"><span class="params">         records/<span class="number">0</span>,</span></span><br><span class="line"><span class="params">         record_info_fields/<span class="number">1</span>,</span></span><br><span class="line"><span class="params">         record_info_size/<span class="number">1</span></span></span><br><span class="line"><span class="params">        ])</span>.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">rec_to_kvlist</span><span class="params">(Rec)</span> -&gt;</span></span><br><span class="line">    rec_to_kvlist_f1(Rec, <span class="number">1</span>).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">rec_to_kvlist_f1</span><span class="params">(Rec, Depth)</span> <span class="title">when</span> D<span class="title">epth</span> &gt; 10 -&gt;</span></span><br><span class="line">    throw({error, Depth, Rec});</span><br><span class="line"><span class="function"><span class="title">rec_to_kvlist_f1</span><span class="params">(Rec, Depth)</span> <span class="title">when</span> <span class="title">is_tuple</span><span class="params">(Rec)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">case</span> is_record(Rec) <span class="keyword">of</span></span><br><span class="line">        <span class="literal">true</span> -&gt;</span><br><span class="line">            RecName = erlang:element(<span class="number">1</span>, Rec),</span><br><span class="line">            Fields = [?RECORD_NAME|record_info_fields(RecName)],</span><br><span class="line">            Values = tuple_to_list(Rec),</span><br><span class="line">            Fun = <span class="keyword">fun</span>({Field, Value}) <span class="keyword">when</span> is_tuple(Value) -&gt;</span><br><span class="line">                          {Field, rec_to_kvlist_f1(Value, Depth + <span class="number">1</span>)};</span><br><span class="line">                     ({Field, Value}) <span class="keyword">when</span> is_list(Value) -&gt;</span><br><span class="line">                          {Field, [rec_to_kvlist_f1(V, Depth + <span class="number">1</span>) || V &lt;- Value]};</span><br><span class="line">                     ({Field, Value}) -&gt;</span><br><span class="line">                          {Field, Value}</span><br><span class="line">                  <span class="keyword">end</span>,</span><br><span class="line">            lists:map(Fun, lists:zip(Fields, Values));</span><br><span class="line">        <span class="literal">false</span> -&gt;</span><br><span class="line">            Rec</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"><span class="function"><span class="title">rec_to_kvlist_f1</span><span class="params">(Val, _)</span> -&gt;</span> Val.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">kvlist_to_rec</span><span class="params">(KvList)</span> <span class="title">when</span> <span class="title">is_list</span><span class="params">(KvList)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">case</span> proplists:get_value(?RECORD_NAME, KvList) <span class="keyword">of</span></span><br><span class="line">        undefined -&gt;</span><br><span class="line">            Fun = <span class="keyword">fun</span>(Val) -&gt; kvlist_to_rec(Val) <span class="keyword">end</span>,</span><br><span class="line">            lists:map(Fun, KvList);</span><br><span class="line">        RecName -&gt;</span><br><span class="line">            InitList = lists:zip(</span><br><span class="line">                         [?RECORD_NAME|record_info_fields(RecName)],</span><br><span class="line">                         tuple_to_list(record_init(RecName))),</span><br><span class="line">            Fun = <span class="keyword">fun</span>(Field) -&gt;</span><br><span class="line">                          <span class="keyword">case</span> proplists:get_value(Field, KvList) <span class="keyword">of</span></span><br><span class="line">                              undefined -&gt;</span><br><span class="line">                                  proplists:get_value(Field, InitList);</span><br><span class="line">                              Val <span class="keyword">when</span> is_list(Val) -&gt;</span><br><span class="line">                                  kvlist_to_rec(Val);</span><br><span class="line">                              Val -&gt;</span><br><span class="line">                                  Val</span><br><span class="line">                          <span class="keyword">end</span></span><br><span class="line">                  <span class="keyword">end</span>,</span><br><span class="line">            list_to_tuple(lists:map(Fun, [?RECORD_NAME|record_info_fields(RecName)]))</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"><span class="function"><span class="title">kvlist_to_rec</span><span class="params">(KvList)</span> -&gt;</span> KvList.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">is_record</span><span class="params">(Rec)</span> <span class="title">when</span> <span class="title">is_tuple</span><span class="params">(Rec)</span>, <span class="title">tuple_size</span><span class="params">(Rec)</span> &gt;= 1 -&gt;</span></span><br><span class="line">    RecName = erlang:element(<span class="number">1</span>, Rec),</span><br><span class="line"></span><br><span class="line">    is_list(record_info_fields(RecName))</span><br><span class="line">    <span class="keyword">andalso</span> length(tuple_to_list(Rec)) =:= record_info_size(RecName);</span><br><span class="line"><span class="function"><span class="title">is_record</span><span class="params">(_Other)</span> -&gt;</span> <span class="literal">false</span>.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS使用YUM安装特定版本的软件</title>
      <link href="/2018/07/18/centos/centos-yum-install-soft/"/>
      <url>/2018/07/18/centos/centos-yum-install-soft/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>使用<code>--showduplicates</code>参数列出所有版本</p><span id="more"></span><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum search wget</span><br><span class="line">=================================================================================== N/S matched: wget ===================================================================================</span><br><span class="line">wget.x86_64 : A utility for retrieving files using the HTTP or FTP protocols</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost ~]# yum search wget --showduplicates</span><br><span class="line">============================================================ N/S matched: wget =============================================================</span><br><span class="line">wget-1.14-10.el7_0.1.x86_64 : A utility for retrieving files using the HTTP or FTP protocols</span><br><span class="line">wget-1.14-15.el7_4.1.x86_64 : A utility for retrieving files using the HTTP or FTP protocols</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum list wget</span><br><span class="line">Installed Packages</span><br><span class="line">wget.x86_64      1.14-10.el7_0.1       @base</span><br><span class="line">Available Packages</span><br><span class="line">wget.x86_64      1.14-15.el7_4.1       base</span><br><span class="line">[root@localhost ~]#</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost ~]# yum list wget --showduplicates</span><br><span class="line">Installed Packages</span><br><span class="line">wget.x86_64      1.14-10.el7_0.1       @base</span><br><span class="line">Available Packages</span><br><span class="line">wget.x86_64      1.14-15.el7_4.1       base</span><br></pre></td></tr></table></figure><p><strong>但是不建议安装前版本的软件,有可能出现不满足依赖的报错</strong></p>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> yum </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>加快erlang编译</title>
      <link href="/2018/07/12/windows/windows-erlang-make/"/>
      <url>/2018/07/12/windows/windows-erlang-make/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>最近在学习<code>powershell</code>,随便写了个可以加快编译的脚本<br>不得不说,<code>powershell</code>算是<code>windows</code>下最好用的脚本工具了<br>理论上这个脚本也是可以在linux下使用的, <a href="https://docs.microsoft.com/en-us/powershell/scripting/setup/installing-powershell-core-on-linux?view=powershell-6">powershell安装教程</a><br><strong>windows下的脚本要用gbk编码</strong>,蛋疼…<br>linux下加快编译的脚本请移步<a href="https://www.mingilin.com/2018/02/08/erlang/erlang-quick-make/">ERLANG快速编译脚本</a></p><span id="more"></span><hr><p>脚本基本原理是找出项目中修改时间大于<code>timefile</code>的最后修改时间的文件,然后分段编译<br><strong>脚本请手动修改编码为gbk,否则报错</strong><br>下面脚本对应的目录结构如下:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">proj_root</span><br><span class="line">  ├─src</span><br><span class="line">  ├─include</span><br><span class="line">  ├─ebin</span><br><span class="line">  │  └─mmake.beam</span><br><span class="line">  ├─script</span><br><span class="line">  │  ├─ctl.ps1</span><br><span class="line">  │  └─funlib.ps1</span><br><span class="line">  ├─Emakefile</span><br><span class="line">  └─timefile</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><figcaption><span>ctl.ps1</span><a href="/downloads/code/ctl.ps1">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding:gbk</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$cur_dir</span> = <span class="built_in">Split-Path</span> <span class="variable">$MyInvocation</span>.MyCommand.Path</span><br><span class="line"><span class="variable">$dir_main</span> = <span class="string">&quot;<span class="variable">$cur_dir</span>/../&quot;</span></span><br><span class="line"><span class="variable">$dir_erl</span> = <span class="variable">$dir_main</span></span><br><span class="line"><span class="variable">$dir_log</span> = <span class="string">&quot;<span class="variable">$dir_erl</span>/logs&quot;</span></span><br><span class="line"><span class="variable">$werl</span> = <span class="string">&quot;werl&quot;</span></span><br><span class="line"><span class="variable">$erl</span> = <span class="string">&quot;erl&quot;</span></span><br><span class="line"><span class="variable">$node_name</span> = <span class="string">&quot;cymmo&quot;</span></span><br><span class="line"><span class="variable">$node_domain</span> = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line"><span class="variable">$cookie</span> = <span class="string">&quot;cy_log&quot;</span></span><br><span class="line"><span class="variable">$erl_port_min</span> = <span class="number">41001</span></span><br><span class="line"><span class="variable">$erl_port_max</span> = <span class="number">41100</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$param_kernel</span> = <span class="string">&quot;-kernel inet_dist_listen_min <span class="variable">$erl_port_min</span> -kernel inet_dist_listen_max <span class="variable">$erl_port_max</span>&quot;</span></span><br><span class="line"><span class="variable">$param_other</span> = <span class="string">&quot;+P 204800 -smp enable -server_base <span class="variable">$dir_main</span> -setcookie <span class="variable">$cookie</span>&quot;</span></span><br><span class="line"><span class="variable">$param_env</span> = <span class="string">&quot;-evn ERL_MAX_PORTS 10240&quot;</span></span><br><span class="line"><span class="variable">$param_pa</span> = <span class="string">&quot;-pa <span class="variable">$dir_erl</span>/config -pa <span class="variable">$dir_erl</span>/ebin -pa <span class="variable">$dir_erl</span>/baseebin&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$param_config_game</span> = <span class="string">&quot;-config <span class="variable">$dir_erl</span>/config/run_game&quot;</span></span><br><span class="line"><span class="variable">$game_dump_log_file</span> = <span class="string">&quot;-env ERL_CRASH_DUMP <span class="variable">$dir_log</span>/game_crash.dump&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$conf</span> = <span class="selector-tag">@</span>{</span><br><span class="line">    cur_dir            = <span class="variable">$cur_dir</span>;</span><br><span class="line">    dir_main           = <span class="variable">$dir_main</span>;</span><br><span class="line">    dir_erl            = <span class="variable">$dir_erl</span>;</span><br><span class="line">    dir_log            = <span class="variable">$dir_log</span>;</span><br><span class="line">    werl               = <span class="variable">$werl</span>;</span><br><span class="line">    erl                = <span class="variable">$erl</span>;</span><br><span class="line">    node_name          = <span class="variable">$node_name</span>;</span><br><span class="line">    node_domain        = <span class="variable">$node_domain</span>;</span><br><span class="line">    cookie             = <span class="variable">$cookie</span>;</span><br><span class="line">    erl_port_min       = <span class="variable">$erl_port_min</span>;</span><br><span class="line">    erl_port_max       = <span class="variable">$erl_port_max</span>;</span><br><span class="line"></span><br><span class="line">    param_kernel       = <span class="variable">$param_kernel</span>;</span><br><span class="line">    param_other        = <span class="variable">$param_other</span>;</span><br><span class="line">    param_env          = <span class="variable">$param_env</span>;</span><br><span class="line">    param_pa           = <span class="variable">$param_pa</span>;</span><br><span class="line">    </span><br><span class="line">    param_config_game  = <span class="variable">$param_config_game</span>;</span><br><span class="line">    game_dump_log_file = <span class="variable">$game_dump_log_file</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">. (<span class="built_in">Join-Path</span> <span class="variable">$conf</span>[<span class="string">&quot;cur_dir&quot;</span>] funlib.ps1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$args</span>.Count <span class="operator">-eq</span> <span class="number">0</span>) {</span><br><span class="line">    fun_wait_input <span class="variable">$conf</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span> {</span><br><span class="line">    fun_run <span class="variable">$conf</span> <span class="variable">$args</span>[<span class="number">0</span>]</span><br><span class="line">}</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><figcaption><span>funlib.ps1</span><a href="/downloads/code/funlib.ps1">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding:gbk</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun_make</span><span class="params">(<span class="variable">$conf</span>)</span></span>{</span><br><span class="line">    <span class="variable">$src</span> = <span class="variable">$conf</span>[<span class="string">&quot;dir_main&quot;</span>] + <span class="string">&quot;/src&quot;</span></span><br><span class="line">    <span class="variable">$inc</span> = <span class="variable">$conf</span>[<span class="string">&quot;dir_main&quot;</span>] + <span class="string">&quot;/include&quot;</span></span><br><span class="line">    <span class="variable">$timefile</span> = <span class="variable">$conf</span>[<span class="string">&quot;dir_main&quot;</span>] + <span class="string">&quot;/timefile&quot;</span></span><br><span class="line">    <span class="variable">$latestTime</span> = <span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$timefile</span>).LastWriteTime</span><br><span class="line">    <span class="variable">$now</span> = <span class="variable">$</span>(<span class="built_in">Get-Date</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_hrl_str</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">begin</span>{ <span class="variable">$list</span> = <span class="selector-tag">@</span>() }</span><br><span class="line">        <span class="keyword">process</span>{ <span class="variable">$list</span> += <span class="variable">$_</span>.Name }</span><br><span class="line">        <span class="keyword">end</span>{</span><br><span class="line">            <span class="variable">$str</span> = <span class="variable">$list</span> <span class="operator">-join</span> <span class="string">&quot;|&quot;</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$str</span> <span class="operator">-ne</span> <span class="string">&quot;&quot;</span>){</span><br><span class="line">                <span class="variable">$str</span> = <span class="string">&quot;(<span class="variable">$str</span>)&quot;</span></span><br><span class="line">            }</span><br><span class="line">            <span class="variable">$str</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="variable">$chhrl_str</span> = <span class="built_in">Get-ChildItem</span> <span class="variable">$inc</span> <span class="literal">-Include</span> *.hrl <span class="literal">-Recurse</span> | <span class="built_in">Where-Object</span> {<span class="variable">$_</span>.LastWriteTime <span class="operator">-gt</span> <span class="variable">$latestTime</span>} | get_hrl_str</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 使用管道获取变化的文件</span></span><br><span class="line">    <span class="comment">## 1. 获取所有文件</span></span><br><span class="line">    <span class="comment">## 2. 检测变化文件</span></span><br><span class="line">    <span class="comment">## 3. 生成文件全名列表</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_erl_list</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="comment">## 每次编译100个文件,防止文件过多造成字符串过长报错</span></span><br><span class="line">        <span class="comment">## https://support.microsoft.com/zh-cn/help/830473/command-prompt-cmd-exe-command-line-string-limitation</span></span><br><span class="line">        <span class="keyword">begin</span>{</span><br><span class="line">            <span class="variable">$ii</span> = <span class="number">0</span></span><br><span class="line">            <span class="variable">$list1</span> = <span class="selector-tag">@</span>()</span><br><span class="line">            <span class="variable">$list</span> = <span class="selector-tag">@</span>()</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">process</span>{</span><br><span class="line">            <span class="variable">$f</span> = <span class="variable">$_</span>.FullName <span class="operator">-replace</span> <span class="string">&quot;\\&quot;</span>, <span class="string">&quot;/&quot;</span></span><br><span class="line">            <span class="variable">$f</span> = <span class="string">&quot;`\`&quot;<span class="variable">$f</span>`\`&quot;&quot;</span></span><br><span class="line">            <span class="variable">$list1</span> += <span class="variable">$f</span></span><br><span class="line">            <span class="variable">$i</span>++</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$i</span> % <span class="number">2</span> <span class="operator">-eq</span> <span class="number">0</span>){</span><br><span class="line">                <span class="variable">$list</span> += <span class="variable">$list1</span> <span class="operator">-join</span> <span class="string">&quot;,&quot;</span></span><br><span class="line">                <span class="variable">$i</span> = <span class="number">0</span></span><br><span class="line">                <span class="variable">$list1</span> = <span class="selector-tag">@</span>()</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">end</span>{</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$list1</span>){</span><br><span class="line">                <span class="variable">$list</span> += <span class="variable">$list1</span> <span class="operator">-join</span> <span class="string">&quot;,&quot;</span></span><br><span class="line">            }</span><br><span class="line">            <span class="variable">$list</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="variable">$erl_list</span> = <span class="built_in">Get-ChildItem</span> <span class="variable">$src</span> <span class="literal">-Include</span> *.erl <span class="literal">-Exclude</span> .svn,.git <span class="literal">-Recurse</span> | <span class="built_in">Where-Object</span> {</span><br><span class="line">        <span class="keyword">if</span> ( <span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$_</span>.FullName).LastWriteTime <span class="operator">-gt</span> <span class="variable">$latestTime</span> ){</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$_</span></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$chhrl_str</span> <span class="operator">-eq</span> <span class="string">&quot;&quot;</span>){</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$false</span></span><br><span class="line">        } </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Select-String</span> <span class="literal">-Path</span> <span class="variable">$_</span>.FullName <span class="literal">-Pattern</span> <span class="variable">$chhrl_str</span> <span class="literal">-Quiet</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$_</span></span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$false</span></span><br><span class="line">        }</span><br><span class="line">    } | get_erl_list</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Set-Location</span> <span class="variable">$conf</span>[<span class="string">&quot;dir_erl&quot;</span>]</span><br><span class="line">    <span class="comment">## 在windows下</span></span><br><span class="line">    <span class="comment">## 直接mmake:files(500, [])无效</span></span><br><span class="line">    <span class="comment">## 必须mmake:files(500, [], Opts)</span></span><br><span class="line">    <span class="comment">## why?</span></span><br><span class="line">    <span class="variable">$cmd_str</span> = <span class="string">&#x27;{0} {1} -noshell -eval &quot;{{ok,[{{_, Opts}}|_]}}=file:consult(\&quot;./Emakefile\&quot;),case mmake:files(500,[{2}], Opts) of up_to_date -&gt; init:stop(); _ -&gt; init:stop(1) end&quot;&#x27;</span></span><br><span class="line">    <span class="variable">$compile_status</span> = <span class="variable">$true</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$erl_list</span>.gettype().Name <span class="operator">-eq</span> <span class="string">&quot;String&quot;</span>){</span><br><span class="line">        <span class="variable">$erl_list</span> = <span class="selector-tag">@</span>() + <span class="variable">$erl_list</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> <span class="operator">-lt</span> <span class="variable">$erl_list</span>.Count; <span class="variable">$i</span>++) {</span><br><span class="line">        <span class="variable">$erl_str</span> = <span class="variable">$erl_list</span>[<span class="variable">$i</span>]</span><br><span class="line">        <span class="variable">$cmd</span> = <span class="variable">$cmd_str</span> <span class="operator">-f</span> <span class="variable">$conf</span>[<span class="string">&quot;erl&quot;</span>], <span class="variable">$conf</span>[<span class="string">&quot;param_pa&quot;</span>], <span class="variable">$erl_str</span></span><br><span class="line">        cmd /C <span class="variable">$cmd</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$</span>?) {</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="variable">$compile_status</span> = <span class="variable">$false</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment"># $cmd = $cmd_str -f $conf[&quot;erl&quot;], $conf[&quot;param_pa&quot;], $erl_str</span></span><br><span class="line">    cmd /C <span class="variable">$cmd</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$compile_status</span>) {</span><br><span class="line">        <span class="built_in">Write-Output</span> <span class="string">&quot;=============&gt; 编译成功&quot;</span></span><br><span class="line">        <span class="variable">$now</span>.ToString() | <span class="built_in">Out-File</span> <span class="variable">$timefile</span> <span class="literal">-Append</span></span><br><span class="line">        (<span class="built_in">Get-Item</span> <span class="variable">$timefile</span>).LastWriteTime = <span class="variable">$now</span></span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">        <span class="built_in">Write-Error</span> <span class="string">&quot;==============&gt; 编译失败&quot;</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun_start_game</span> <span class="params">(<span class="variable">$conf</span>)</span></span> {</span><br><span class="line">    <span class="variable">$node_name</span> = <span class="variable">$conf</span>[<span class="string">&quot;node_name&quot;</span>]</span><br><span class="line">    <span class="variable">$node_domain</span> = <span class="variable">$conf</span>[<span class="string">&quot;node_domain&quot;</span>]</span><br><span class="line">    <span class="variable">$param_pa</span> = <span class="variable">$conf</span>[<span class="string">&quot;param_pa&quot;</span>]</span><br><span class="line">    <span class="variable">$param_kernel</span> = <span class="variable">$conf</span>[<span class="string">&quot;param_kernel&quot;</span>] </span><br><span class="line">    <span class="variable">$param_env</span> = <span class="variable">$conf</span>[<span class="string">&quot;param_env&quot;</span>]</span><br><span class="line">    <span class="variable">$game_dump_log_file</span> = <span class="variable">$conf</span>[<span class="string">&quot;game_dump_log_file&quot;</span>]</span><br><span class="line">    <span class="variable">$param_other</span> = <span class="variable">$conf</span>[<span class="string">&quot;param_other&quot;</span>]</span><br><span class="line">    <span class="variable">$param_config_game</span> = <span class="variable">$conf</span>[<span class="string">&quot;param_config_game&quot;</span>]</span><br><span class="line">    <span class="built_in">Set-Location</span> <span class="variable">$conf</span>[<span class="string">&quot;dir_erl&quot;</span>]</span><br><span class="line">    <span class="variable">$arg_str</span> = <span class="string">&quot;-name <span class="variable">$</span>{node_name}_game@<span class="variable">$node_domain</span>&quot;</span></span><br><span class="line">    <span class="variable">$arg_str</span> += <span class="string">&quot; <span class="variable">$param_pa</span> <span class="variable">$param_kernel</span> <span class="variable">$param_env</span>&quot;</span></span><br><span class="line">    <span class="variable">$arg_str</span> += <span class="string">&quot; <span class="variable">$game_dump_log_file</span> <span class="variable">$param_other</span> <span class="variable">$param_config_game</span>&quot;</span></span><br><span class="line">    <span class="variable">$arg_str</span> += <span class="string">&quot;  -hidden -s main -s reloader&quot;</span></span><br><span class="line">    <span class="built_in">Start-Process</span> <span class="literal">-FilePath</span> <span class="variable">$conf</span>[<span class="string">&quot;werl&quot;</span>] <span class="literal">-ArgumentList</span> <span class="variable">$arg_str</span>    </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun_run</span> <span class="params">(<span class="variable">$conf</span>,<span class="variable">$inp</span>)</span></span> {</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$inp</span>) {</span><br><span class="line">        <span class="string">&quot;make&quot;</span> {</span><br><span class="line">            fun_make <span class="variable">$conf</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        }</span><br><span class="line">        <span class="string">&quot;start_game&quot;</span> {</span><br><span class="line">            fun_start_game <span class="variable">$conf</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        }</span><br><span class="line">        Default {</span><br><span class="line">            <span class="built_in">Write-Output</span> <span class="string">&quot;错误的命令&quot;</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">Set-Location</span> <span class="variable">$conf</span>[<span class="string">&quot;cur_dir&quot;</span>]</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun_wait_input</span> <span class="params">(<span class="variable">$conf</span>)</span></span> {</span><br><span class="line">    <span class="variable">$helpText</span> = <span class="string">@&quot;</span></span><br><span class="line"><span class="string">==============================</span></span><br><span class="line"><span class="string">make       : 编译源码</span></span><br><span class="line"><span class="string">start_game : 启动游戏服</span></span><br><span class="line"><span class="string">quit       : 结束运行</span></span><br><span class="line"><span class="string">==============================  </span></span><br><span class="line"><span class="string">&quot;@</span></span><br><span class="line">    <span class="built_in">Write-Output</span> <span class="variable">$helpText</span></span><br><span class="line">    <span class="variable">$inp</span> = <span class="built_in">Read-Host</span> <span class="string">&quot;请选择&quot;</span></span><br><span class="line">    <span class="variable">$inp</span> = <span class="variable">$inp</span>.Trim().ToLower()</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$inp</span>) {</span><br><span class="line">        <span class="string">&quot;&quot;</span>      { </span><br><span class="line">            fun_wait_input <span class="variable">$conf</span> </span><br><span class="line">            <span class="keyword">break</span> </span><br><span class="line">        }</span><br><span class="line">        <span class="string">&quot;quit&quot;</span>  {</span><br><span class="line">            <span class="built_in">Set-Location</span> <span class="variable">$conf</span>[<span class="string">&quot;cur_dir&quot;</span>] </span><br><span class="line">            <span class="keyword">break</span> </span><br><span class="line">        }</span><br><span class="line">        Default { </span><br><span class="line">            fun_run <span class="variable">$conf</span> <span class="variable">$inp</span></span><br><span class="line">            fun_wait_input <span class="variable">$conf</span> </span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
          <category> erlang </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Intellij Idea快捷键</title>
      <link href="/2018/07/11/other/other-idea/"/>
      <url>/2018/07/11/other/other-idea/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><code>Erlang</code>项目,其他成员使用Idea开发,唯独我使用vim开发<br>并不是自己<code>zhuangbility</code>,试着转过去,各种不舒服,再转一次  </p><span id="more"></span><h2 id="首先"><a href="#首先" class="headerlink" title="首先"></a>首先</h2><p><strong>安装完成,首次启动,所有插件都选择<code>disable</code></strong></p><h2 id="插件安装"><a href="#插件安装" class="headerlink" title="插件安装"></a>插件安装</h2><p><code>File</code>-&gt;<code>Setting</code>-&gt;<code>Plugins</code></p><table><thead><tr><th>插件</th><th>描述</th></tr></thead><tbody><tr><td>terminal</td><td>集成命令行</td></tr><tr><td>erlang</td><td>erlang开发</td></tr><tr><td>Markdown Navigator</td><td>Markdown预览</td></tr><tr><td>CodeGlance</td><td>代码mini map</td></tr><tr><td>Translation</td><td>翻译</td></tr><tr><td>BrowseWordAtCaret</td><td>高亮选中单词,快捷键与win冲突<br/>使用鼠标选中</td></tr><tr><td>Key promoter</td><td>快捷键提示</td></tr><tr><td>BashSupport</td><td>bash</td></tr><tr><td>String Manipulation</td><td></td></tr><tr><td>Background image Plus</td><td>设置背景图片<br/>在<code>View</code>-&gt;<code>Set Background Image</code>中设置</td></tr><tr><td>Main Menu toggler</td><td>隐藏/开启菜单栏<br/>Shift_Shift-&gt;view</td></tr></tbody></table><h2 id="字体设置"><a href="#字体设置" class="headerlink" title="字体设置"></a>字体设置</h2><p><code>File</code>-&gt;<code>Setting</code>-&gt;<code>Editor</code>-&gt;<code>Font</code></p><blockquote><p>Font: Consoles<br>Size: 20<br>Line spacing: 1.1</p></blockquote><h2 id="模板设置"><a href="#模板设置" class="headerlink" title="模板设置"></a>模板设置</h2><p>Tab长度设置<br><code>File</code>-&gt;<code>Setting</code>-&gt;<code>Editor</code>-&gt;<code>Code Style</code>-&gt;<code>Erlang</code>-&gt;<code>Tabs and Indents</code></p><blockquote><p>Table size: 4<br>Indent: 4</p></blockquote><p>Author/Company设置<br><code>File</code>-&gt;<code>Setting</code>-&gt;<code>Editor</code>-&gt;<code>File and Code Templates</code>-&gt;<code>Includes</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Erlang Custom Template Variable: </span><br><span class="line">#set( $FULLNAME = &quot;kingwen0302 &lt;kingwen0302@msn.com&gt;&quot; )</span><br><span class="line">#set( $COMPANY = &quot;xxxx&quot; )</span><br></pre></td></tr></table></figure><h2 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h2><p>在安装目录下,修改<code>idea64.exe.vmoptions</code>|<code>idea.exe.vmoptions</code>,<strong>具体值可以根据项目大小以及机子性能修改</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-Xms512m</span><br><span class="line">-Xmx1024m</span><br></pre></td></tr></table></figure><h2 id="自定义扩展工具"><a href="#自定义扩展工具" class="headerlink" title="自定义扩展工具"></a>自定义扩展工具</h2><p><code>File</code>-&gt;<code>Setting</code>-&gt;<code>Tools</code>-&gt;<code>External Tools</code><br>添加erlang编译单个文件:</p><blockquote><p>Name: emake<br>Description: erlang单文件编译<br>Program: erl<br>Arguments:  </p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-noshell</span><br><span class="line">-pa $ProjectFileDir$/baseebin</span><br><span class="line">-eval &quot;make:files([\&quot;$/FileRelativePath$\&quot;]),init:stop(0).&quot;</span><br></pre></td></tr></table></figure><blockquote><p>Working directory: $ProjectFileDir$  </p></blockquote><h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><table><thead><tr><th>个人使用频率</th><th>快捷键</th><th>注释</th></tr></thead><tbody><tr><td>★★★★★</td><td>Ctrl_Shift_N</td><td>快速文件定位</td></tr><tr><td>★★★★★</td><td>Ctrl_F,Ctrl_Shift_F<br/>Ctrl_R,Ctrl_Shift_R</td><td>搜索<br/>替换</td></tr><tr><td>★★★★★</td><td>Ctrl_B<br/>Ctrl_Shift_I</td><td>跳转到定义, 若是定义则显示调用列表<br/>预览函数定义</td></tr><tr><td>★★★★</td><td>Ctrl_E,Ctrl_Tab</td><td>最近打开文件</td></tr><tr><td>★★</td><td>Ctrl_Alt_I,相同位置剪切&amp;&amp;粘贴</td><td>格式化代码</td></tr><tr><td>★★</td><td>Ctrl_D<br/>Ctrl_X,Ctrl_Y</td><td>复制行<br/>删除行</td></tr><tr><td>★</td><td>Ctrl_/</td><td>注释</td></tr><tr><td>★</td><td>Ctrl_↑/↓</td><td>跳到上/下一个函数</td></tr><tr><td>★</td><td>Ctrl_+/-,Ctrl_Shift_+/-</td><td>折叠</td></tr><tr><td>★★★★</td><td>Ctrl_F4,Shift_Click标签页</td><td>关闭标签</td></tr><tr><td>★★★★★</td><td>Alt_1</td><td>开启/关闭项目目录结构</td></tr><tr><td>★★★</td><td>Alt_6</td><td>开启/关闭TODO</td></tr><tr><td>★★★</td><td>Alt_7,Ctrl_F12</td><td>开启/关闭当前文件函数列表</td></tr><tr><td>★★★★★</td><td>Alt_F12</td><td>打开/关闭Terminal</td></tr><tr><td>★</td><td>Ctrl_Alt_[/]</td><td>项目切换</td></tr></tbody></table><h2 id="界面"><a href="#界面" class="headerlink" title="界面"></a>界面</h2><p>隐藏(<code>view</code>-&gt;)</p><blockquote><p><code>Toolbar</code><br><code>Tool Buttons</code><br><code>Status Bar</code><br><code>Navigation Bar</code><br><code>Main Menu</code>  </p></blockquote><h2 id="其他设置"><a href="#其他设置" class="headerlink" title="其他设置"></a>其他设置</h2><h3 id="禁止自动删除行尾空格"><a href="#禁止自动删除行尾空格" class="headerlink" title="禁止自动删除行尾空格"></a>禁止自动删除行尾空格</h3><p><code>File</code>-&gt;<code>Settings</code>-&gt;<code>Editor</code>-&gt;<code>General</code><br><code>Virtual Space</code>先选中<code>Allow placement of caret after end of line</code><br><code>Other</code>修改<code>Strip trailing spaces on Save</code>,选择<code>None</code>即可</p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://www.cnblogs.com/tonycody/p/3257601.html">https://www.cnblogs.com/tonycody/p/3257601.html</a></li><li><a href="https://www.cnblogs.com/jeffen/p/6014868.html">https://www.cnblogs.com/jeffen/p/6014868.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS7源码编译vim8</title>
      <link href="/2018/06/07/centos/centos7-vim8/"/>
      <url>/2018/06/07/centos/centos7-vim8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum -y remove vim</span><br><span class="line">yum -y install gcc ncurses-devel</span><br><span class="line">git <span class="built_in">clone</span> -b v8.1.0037 https://github.com/vim/vim.git </span><br><span class="line"><span class="built_in">cd</span> vim</span><br><span class="line">./configure -enable-pythoninterp -enable-luainterp -enable-multibyte -enable-cscope</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/bin/vim /usr/bin/vim</span><br></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://blog.csdn.net/lj_trestg/article/details/79754268">https://blog.csdn.net/lj_trestg/article/details/79754268</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos7 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos7 </tag>
            
            <tag> vim8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell删除颜色代码</title>
      <link href="/2018/05/25/shell/shell-delete-color-code/"/>
      <url>/2018/05/25/shell/shell-delete-color-code/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -r &quot;s/\x1B\[([0-9]&#123;1,2&#125;(;[0-9]&#123;1,2&#125;)?)?[m|K]//g&quot;</span><br></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li>[<a href="https://stackoverflow.com/questions/17998978/removing-colors-from-output]">https://stackoverflow.com/questions/17998978/removing-colors-from-output]</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决无法在您所在的国家/地区购买google play</title>
      <link href="/2018/05/25/other/other-googleplay/"/>
      <url>/2018/05/25/other/other-googleplay/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>一直无法购买google play上的内容<br>各种百度/google,大多说<code>双币信用卡不支持</code>之类的话<br>经过多次摸索,终于找到了一个可用的流程</p><span id="more"></span><p>步骤:</p><ol><li><p>准备信用卡<br> <code>单币信用卡</code>,<code>双币信用卡</code>都可以<br> 只要google play支持的发卡机构就可以</p></li><li><p>查看付款方式<br> 打开<a href="https://payments.google.com/">https://payments.google.com</a>查看付款方式<br> 如果付款方式中已经有绑定银行卡,检查地址所在地是否是中国,如果是,按照<code>步骤3</code>删除</p></li><li><p>删除付款方式<br> 在设置中,<code>关闭付款资料</code></p></li><li><p>重新添加付款方式<br> 添加付款方式,将地址填为国外地址<br> 这是一个生成假地址的网站<a href="https://www.fakenamegenerator.com/gen-male-us-us.php">https://www.fakenamegenerator.com/gen-male-us-us.php</a></p></li><li><p>扣款成功就可以支付了</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>v2ray配置[个人理解]</title>
      <link href="/2018/04/09/windows/windows-v2ray/"/>
      <url>/2018/04/09/windows/windows-v2ray/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>最近看到这篇的浏览量突然上升了<br>原因自然你懂得的<br>但是这篇是没有实质内容的<br>所以增加一个脚本,快速搭建<code>v2ray+nginx-tls-ws</code>梯子<br>速度相对kcp来说稍慢,但是胜在安全</p><span id="more"></span><p><a href="https://github.com/v2ray/v2ray-core">v2ray</a>据说是新一代的代理神器,没有用过,只知道相对ss,服务器要求高,而且配置复杂无比.</p><p>v2ray没有服务器/客户端区别,只是配置的区别<br>v2ray配置的整体格式如下:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;log&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;api&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;dns&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;stats&quot;</span>: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;routing&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;policy&quot;</span>: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;inbound&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;inboundDetour&quot;</span>: [],</span><br><span class="line">  </span><br><span class="line">  <span class="attr">&quot;outbound&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;outboundDetour&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;transport&quot;</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>json 不支持注释, 评论使用<code>&quot;comment&quot;: &quot;&quot;,</code><br><strong>虽然v2ray开发者有增加注释,实测发现并不能完全解析</strong></p></blockquote><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="log"><a href="#log" class="headerlink" title="log"></a>log</h3><p>日志位置以及日志等级</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;log&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;access&quot;</span>: <span class="string">&quot;e:/vmess/log/access.log&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;error&quot;</span>: <span class="string">&quot;e:/vmess/log/error.log&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;loglevel&quot;</span>: <span class="string">&quot;debug&quot;</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><h3 id="routing"><a href="#routing" class="headerlink" title="routing"></a>routing</h3><p>路由设置,类似firefox的autoproxy/chrome的switchy插件</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;routing&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;strategy&quot;</span>: <span class="string">&quot;rules&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;rules&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;field&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;ip&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;0.0.0.0/8&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;10.0.0.0/8&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;100.64.0.0/10&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;127.0.0.0/8&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;169.254.0.0/16&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;172.16.0.0/12&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;192.0.0.0/24&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;192.0.2.0/24&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;192.168.0.0/16&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;198.18.0.0/15&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;198.51.100.0/24&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;203.0.113.0/24&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;::1/128&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;fc00::/7&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;fe80::/10&quot;</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">&quot;outboundTag&quot;</span>: <span class="string">&quot;blocked&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;routing&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;strategy&quot;</span>: <span class="string">&quot;rules&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;rules&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;field&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;port&quot;</span>: <span class="string">&quot;54-79&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;outboundTag&quot;</span>: <span class="string">&quot;direct&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;field&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;port&quot;</span>: <span class="string">&quot;81-442&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;outboundTag&quot;</span>: <span class="string">&quot;direct&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;field&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;port&quot;</span>: <span class="string">&quot;444-65535&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;outboundTag&quot;</span>: <span class="string">&quot;direct&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;field&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;domain&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;gc.kis.scr.kaspersky-labs.com&quot;</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">&quot;outboundTag&quot;</span>: <span class="string">&quot;direct&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;chinasites&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;outboundTag&quot;</span>: <span class="string">&quot;direct&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;field&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;domain&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;google.com&quot;</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">&quot;outboundTag&quot;</span>: <span class="string">&quot;ss_web&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;field&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;ip&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;0.0.0.0/8&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;10.0.0.0/8&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;100.64.0.0/10&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;127.0.0.0/8&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;169.254.0.0/16&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;172.16.0.0/12&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;192.0.0.0/24&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;192.0.2.0/24&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;192.168.0.0/16&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;198.18.0.0/15&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;198.51.100.0/24&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;203.0.113.0/24&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;::1/128&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;fc00::/7&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;fe80::/10&quot;</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">&quot;outboundTag&quot;</span>: <span class="string">&quot;direct&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;chinaip&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;outboundTag&quot;</span>: <span class="string">&quot;direct&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="inbound-inboundDetour"><a href="#inbound-inboundDetour" class="headerlink" title="inbound / inboundDetour"></a>inbound / inboundDetour</h3><p>接收传入的数据</p><p><code>inbound</code>是配置主入口,必须有配置<br><code>inboundDetour</code>是配置剩余的入口,为列表</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;inbound&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;port&quot;</span>: <span class="number">10086</span>,</span><br><span class="line">        <span class="attr">&quot;protocol&quot;</span>: <span class="string">&quot;vmess&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;clients&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;299c53c1-20bf-598b-c97c-771dabb62a21&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;level&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="attr">&quot;alterId&quot;</span>: <span class="number">64</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;streamSettings&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;network&quot;</span>: <span class="string">&quot;kcp&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;detour&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;to&quot;</span>: <span class="string">&quot;vmess-detour-310971&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;outbound&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;protocol&quot;</span>: <span class="string">&quot;freedom&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;settings&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;inboundDetour&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;port&quot;</span>: <span class="number">1089</span>,</span><br><span class="line">            <span class="attr">&quot;protocol&quot;</span>: <span class="string">&quot;socks&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;auth&quot;</span>: <span class="string">&quot;noauth&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;udp&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">&quot;ip&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;port&quot;</span>: <span class="number">3128</span>,</span><br><span class="line">            <span class="attr">&quot;listen&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;protocol&quot;</span>: <span class="string">&quot;http&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;timeout&quot;</span>: <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;protocol&quot;</span>: <span class="string">&quot;vmess&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;port&quot;</span>: <span class="string">&quot;10000-20000&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;vmess-detour-310971&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;settings&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="attr">&quot;allocate&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;strategy&quot;</span>: <span class="string">&quot;random&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;concurrency&quot;</span>: <span class="number">5</span>,</span><br><span class="line">                <span class="attr">&quot;refresh&quot;</span>: <span class="number">5</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;streamSettings&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;network&quot;</span>: <span class="string">&quot;kcp&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;port&quot;</span>: <span class="number">10087</span>,</span><br><span class="line">            <span class="attr">&quot;protocol&quot;</span>: <span class="string">&quot;vmess&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;clients&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;299c53c1-20bf-598b-c97c-771dabb62a21&quot;</span>,</span><br><span class="line">                        <span class="attr">&quot;level&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                        <span class="attr">&quot;alterId&quot;</span>: <span class="number">64</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;protocol&quot;</span>: <span class="string">&quot;shadowsocks&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;port&quot;</span>: <span class="number">20001</span>,</span><br><span class="line">            <span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;aes-256-cfb&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;dasfdsafdfs&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;udp&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">&quot;level&quot;</span>: <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br></pre></td></tr></table></figure><h3 id="outbound-outboundDetour"><a href="#outbound-outboundDetour" class="headerlink" title="outbound / outboundDetour"></a>outbound / outboundDetour</h3><p>数据的请求地址</p><h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><p>增加一个快速安装的脚本,但是没有自测过</p><blockquote><p>前提: 将<code>www.example.com</code>域名指向当前的服务器IP</p></blockquote><p>流程是:</p><ol><li>安装/配置v2ray</li><li>安装/配置nginx</li><li>使用certbot生成证书</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line"><span class="comment">## 先设置域名</span></span><br><span class="line">DOMAIN=www.example.com</span><br><span class="line">UUID=$(cat /proc/sys/kernel/random/uuid)</span><br><span class="line">UUID_ARR=(<span class="variable">$&#123;UUID//-/ &#125;</span>)</span><br><span class="line">UUID_LAST=<span class="variable">$&#123;UUID_ARR[-1]&#125;</span></span><br><span class="line"></span><br><span class="line">yum install -y epel-release curl git</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装v2ray</span></span><br><span class="line">bash &lt;(curl -L -s https://install.direct/go.sh)</span><br><span class="line">systemctl <span class="built_in">enable</span> v2ray</span><br><span class="line">cat &gt; /etc/v2ray/config.json &lt;&lt; <span class="string">&quot;EOF&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;inbounds&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;port&quot;</span>: 10000,</span><br><span class="line">      <span class="string">&quot;listen&quot;</span>:<span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;protocol&quot;</span>: <span class="string">&quot;vmess&quot;</span>,</span><br><span class="line">      <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;clients&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="string">&quot;&#123;UUID&#125;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;alterId&quot;</span>: 64</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;streamSettings&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;network&quot;</span>: <span class="string">&quot;ws&quot;</span>,</span><br><span class="line">        <span class="string">&quot;wsSettings&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/&#123;UUID_LAST&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;outbounds&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;protocol&quot;</span>: <span class="string">&quot;freedom&quot;</span>,</span><br><span class="line">      <span class="string">&quot;settings&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sed -i <span class="string">&quot;s/&#123;UUID&#125;/<span class="variable">$&#123;UUID&#125;</span>/g&quot;</span> /etc/v2ray/config.json</span><br><span class="line">sed -i <span class="string">&quot;s/&#123;UUID_LAST&#125;/<span class="variable">$&#123;UUID_LAST&#125;</span>/g&quot;</span> /etc/v2ray/config.json</span><br><span class="line">systemctl restart v2ray</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装nginx</span></span><br><span class="line">yum install -y nginx</span><br><span class="line">systemctl <span class="built_in">enable</span> nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">## 弄一个正常的网址</span></span><br><span class="line">git <span class="built_in">clone</span> xxxx /data/web/<span class="variable">$&#123;DOMAIN&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## nginx config</span></span><br><span class="line">cat &gt; /etc/nginx/conf.d/001_<span class="variable">$&#123;DOMAIN&#125;</span>.conf &lt;&lt; <span class="string">&quot;EOF&quot;</span></span><br><span class="line">server &#123;</span><br><span class="line">    server_name  &#123;DOMAIN&#125;;</span><br><span class="line">    listen 80; </span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /data/web/&#123;DOMAIN&#125;;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location /&#123;UUID_LAST&#125; &#123;</span><br><span class="line">        proxy_pass       http://127.0.0.1:10000;</span><br><span class="line">        proxy_redirect             off;</span><br><span class="line">        proxy_http_version         1.1;</span><br><span class="line">        proxy_set_header Upgrade   <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">        proxy_set_header Host      <span class="variable">$http_host</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sed -i <span class="string">&quot;s/&#123;DOMAIN&#125;/<span class="variable">$&#123;DOMAIN&#125;</span>/g&quot;</span> /etc/nginx/conf.d/001_<span class="variable">$&#123;DOMAIN&#125;</span>.conf</span><br><span class="line">systemctl restart nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">## 选择Redirect</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/certbot/certbot.git ~/certbot</span><br><span class="line"><span class="built_in">cd</span> ~ &amp;&amp; ./certbot-auto</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[V2RAY]------------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;UUID: <span class="variable">$&#123;UUID&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;DOMAIN: <span class="variable">$&#123;DOMAIN&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;PORT: 443&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ALTERID: 64&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;WS_PATH: /<span class="variable">$&#123;UUID_LAST&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[V2RAY]------------------------------&quot;</span></span><br></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://www.v2ray.com/chapter_02/">https://www.v2ray.com/chapter_02/</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> v2ray </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VirtualBox下Linux虚机扩容</title>
      <link href="/2018/03/21/centos/centos-virtualbox-partition-extend/"/>
      <url>/2018/03/21/centos/centos-virtualbox-partition-extend/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>使用<code>vagrant</code>搭建开发环境,部分box默认的空间太小,需要扩容<br>非专业人员,只是百度出的结果,亲测有效</p><span id="more"></span><h2 id="虚机硬盘扩容"><a href="#虚机硬盘扩容" class="headerlink" title="虚机硬盘扩容"></a>虚机硬盘扩容</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">VBoxManage clonehd box_disk1.vmdk  box_disk1.vdi --format VDI</span><br><span class="line">VBoxManage modifyhd box_disk1.vdi --resize 60000</span><br></pre></td></tr></table></figure><p><em><strong><code>vmdk</code>格式磁盘不支持扩容, 要先将<code>vmdk</code>转换为<code>vdi</code></strong></em></p><p>修改磁盘配置</p><blockquote><p><code>设置</code>-&gt;<code>存储</code>-&gt;<code>控制器</code>,使用<code>box_disk1.vdi</code>替换掉<code>box_disk1.vmdk</code></p></blockquote><h2 id="查看当前操作系统的空间情况"><a href="#查看当前操作系统的空间情况" class="headerlink" title="查看当前操作系统的空间情况"></a>查看当前操作系统的空间情况</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost qqjy]# df -h</span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root  6.7G  2.1G  4.7G  31% /</span><br><span class="line">devtmpfs                 487M     0  487M   0% /dev</span><br><span class="line">tmpfs                    497M     0  497M   0% /dev/shm</span><br><span class="line">tmpfs                    497M  6.6M  490M   2% /run</span><br><span class="line">tmpfs                    497M     0  497M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1                497M  122M  375M  25% /boot</span><br><span class="line">vagrant                  406G   61G  345G  16% /vagrant</span><br><span class="line">tmpfs                    100M     0  100M   0% /run/user/0</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost qqjy]# fdisk -l</span><br><span class="line"></span><br><span class="line">Disk /dev/sda: 62.9 GB, 62914560000 bytes, 122880000 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x00068d77</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *        2048     1026047      512000   83  Linux</span><br><span class="line">/dev/sda2         1026048    16777215     7875584   8e  Linux LVM</span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/centos-root: 7159 MB, 7159676928 bytes, 13983744 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/centos-swap: 859 MB, 859832320 bytes, 1679360 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br></pre></td></tr></table></figure><p><strong>扩容后的磁盘约60G,实际使用8G,存在未分配的空间</strong><br>现打算将<code>/</code>扩容到55G左右</p><h2 id="将-dev-sda上未分配的磁盘空间分区"><a href="#将-dev-sda上未分配的磁盘空间分区" class="headerlink" title="将/dev/sda上未分配的磁盘空间分区"></a>将<code>/dev/sda</code>上未分配的磁盘空间分区</h2><blockquote><p><code>fdisk /dev/sda</code>-&gt;<code>n</code>-&gt;<code>p</code>-&gt;<code>3</code>-&gt;<code>w</code></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# fdisk /dev/sda</span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain in memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write command.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (2 primary, 0 extended, 2 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): p</span><br><span class="line">Partition number (3,4, default 3): 3</span><br><span class="line">First sector (16777216-122879999, default 16777216):</span><br><span class="line">Using default value 16777216</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (16777216-122879999, default 122879999):</span><br><span class="line">Using default value 122879999</span><br><span class="line">Partition 3 of type Linux and of size 50.6 GiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line"></span><br><span class="line">WARNING: Re-reading the partition table failed with error 16: Device or resource busy.</span><br><span class="line">The kernel still uses the old table. The new table will be used at</span><br><span class="line">the next reboot or after you run partprobe(8) or kpartx(8)</span><br><span class="line">Syncing disks.</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# fdisk -l</span><br><span class="line"></span><br><span class="line">Disk /dev/sda: 62.9 GB, 62914560000 bytes, 122880000 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x00068d77</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *        2048     1026047      512000   83  Linux</span><br><span class="line">/dev/sda2         1026048    16777215     7875584   8e  Linux LVM</span><br><span class="line">/dev/sda3        16777216   122879999    53051392   83  Linux</span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/centos-root: 7159 MB, 7159676928 bytes, 13983744 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/centos-swap: 859 MB, 859832320 bytes, 1679360 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br></pre></td></tr></table></figure><p><strong><code>sda3</code>已经创建成功</strong></p><h2 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure><h2 id="将新建的分区格式化，建立文件系统"><a href="#将新建的分区格式化，建立文件系统" class="headerlink" title="将新建的分区格式化，建立文件系统"></a>将新建的分区格式化，建立文件系统</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkfs.ext4 /dev/sda3</span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS type: Linux</span><br><span class="line">Block size=4096 (log=2)</span><br><span class="line">Fragment size=4096 (log=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">3317760 inodes, 13262848 blocks</span><br><span class="line">663142 blocks (5.00%) reserved for the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=2162163712</span><br><span class="line">405 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8192 inodes per group</span><br><span class="line">Superblock backups stored on blocks:</span><br><span class="line">        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,</span><br><span class="line">        4096000, 7962624, 11239424</span><br><span class="line"></span><br><span class="line">Allocating group tables: done</span><br><span class="line">Writing inode tables: done</span><br><span class="line">Creating journal (32768 blocks): done</span><br><span class="line">Writing superblocks and filesystem accounting information: done</span><br></pre></td></tr></table></figure><h2 id="创建物理卷"><a href="#创建物理卷" class="headerlink" title="创建物理卷"></a>创建物理卷</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# pvcreate /dev/sda3</span><br><span class="line">WARNING: ext4 signature detected on /dev/sda3 at offset 1080. Wipe it? [y/n]: y</span><br><span class="line">  Wiping ext4 signature on /dev/sda3.</span><br><span class="line">  Physical volume &quot;/dev/sda3&quot; successfully created</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# pvdisplay</span><br><span class="line">  --- Physical volume ---</span><br><span class="line">  PV Name               /dev/sda2</span><br><span class="line">  VG Name               centos</span><br><span class="line">  PV Size               7.51 GiB / not usable 3.00 MiB</span><br><span class="line">  Allocatable           yes</span><br><span class="line">  PE Size               4.00 MiB</span><br><span class="line">  Total PE              1922</span><br><span class="line">  Free PE               10</span><br><span class="line">  Allocated PE          1912</span><br><span class="line">  PV UUID               v3Ulr1-lAnh-XdSy-4oGg-CQmE-4aWZ-1Zaxx6</span><br><span class="line"></span><br><span class="line">  &quot;/dev/sda3&quot; is a new physical volume of &quot;50.59 GiB&quot;</span><br><span class="line">  --- NEW Physical volume ---</span><br><span class="line">  PV Name               /dev/sda3</span><br><span class="line">  VG Name</span><br><span class="line">  PV Size               50.59 GiB</span><br><span class="line">  Allocatable           NO</span><br><span class="line">  PE Size               0</span><br><span class="line">  Total PE              0</span><br><span class="line">  Free PE               0</span><br><span class="line">  Allocated PE          0</span><br><span class="line">  PV UUID               UYFro7-8ttA-3eQ9-yZfY-fr3V-d3St-DvM06V</span><br></pre></td></tr></table></figure><h2 id="查看卷组"><a href="#查看卷组" class="headerlink" title="查看卷组"></a>查看卷组</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vgdisplay</span><br><span class="line">  --- Volume group ---</span><br><span class="line">  VG Name               centos</span><br><span class="line">  System ID</span><br><span class="line">  Format                lvm2</span><br><span class="line">  Metadata Areas        1</span><br><span class="line">  Metadata Sequence No  3</span><br><span class="line">  VG Access             read/write</span><br><span class="line">  VG Status             resizable</span><br><span class="line">  MAX LV                0</span><br><span class="line">  Cur LV                2</span><br><span class="line">  Open LV               2</span><br><span class="line">  Max PV                0</span><br><span class="line">  Cur PV                1</span><br><span class="line">  Act PV                1</span><br><span class="line">  VG Size               7.51 GiB</span><br><span class="line">  PE Size               4.00 MiB</span><br><span class="line">  Total PE              1922</span><br><span class="line">  Alloc PE / Size       1912 / 7.47 GiB</span><br><span class="line">  Free  PE / Size       10 / 40.00 MiB</span><br><span class="line">  VG UUID               oN3432-gfKs-TOYw-n8Jy-fu6j-ZR0i-xg1i6y</span><br></pre></td></tr></table></figure><p><strong>目前存在一个7.5G的卷组</strong></p><h2 id="扩展卷组"><a href="#扩展卷组" class="headerlink" title="扩展卷组"></a>扩展卷组</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vgextend centos /dev/sda3</span><br><span class="line">  Volume group &quot;centos&quot; successfully extended</span><br></pre></td></tr></table></figure><h2 id="查看逻辑卷"><a href="#查看逻辑卷" class="headerlink" title="查看逻辑卷"></a>查看逻辑卷</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# lvdisplay</span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/centos/swap</span><br><span class="line">  LV Name                swap</span><br><span class="line">  VG Name                centos</span><br><span class="line">  LV UUID                fy3cy2-d2Pd-eNQ8-DWXO-DaT0-3o6v-Ee2SKq</span><br><span class="line">  LV Write Access        read/write</span><br><span class="line">  LV Creation host, time localhost.localdomain, 2016-08-26 13:30:06 +0800</span><br><span class="line">  LV Status              available</span><br><span class="line">  # open                 2</span><br><span class="line">  LV Size                820.00 MiB</span><br><span class="line">  Current LE             205</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently set to     8192</span><br><span class="line">  Block device           253:1</span><br><span class="line"></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/centos/root</span><br><span class="line">  LV Name                root</span><br><span class="line">  VG Name                centos</span><br><span class="line">  LV UUID                wdrHLD-l66S-jkAF-2fE4-I8NC-liQ9-mEAXKH</span><br><span class="line">  LV Write Access        read/write</span><br><span class="line">  LV Creation host, time localhost.localdomain, 2016-08-26 13:30:07 +0800</span><br><span class="line">  LV Status              available</span><br><span class="line">  # open                 1</span><br><span class="line">  LV Size                6.67 GiB</span><br><span class="line">  Current LE             1707</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently set to     8192</span><br><span class="line">  Block device           253:0</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# df -h</span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root  6.7G  2.1G  4.7G  31% /</span><br><span class="line">devtmpfs                 487M     0  487M   0% /dev</span><br><span class="line">tmpfs                    497M     0  497M   0% /dev/shm</span><br><span class="line">tmpfs                    497M  6.6M  490M   2% /run</span><br><span class="line">tmpfs                    497M     0  497M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1                497M  122M  375M  25% /boot</span><br><span class="line">vagrant                  406G   61G  345G  16% /vagrant</span><br><span class="line">tmpfs                    100M     0  100M   0% /run/user/0</span><br></pre></td></tr></table></figure><h2 id="扩展逻辑卷"><a href="#扩展逻辑卷" class="headerlink" title="扩展逻辑卷"></a>扩展逻辑卷</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# lvextend -L 55G -n /dev/mapper/centos-root</span><br><span class="line">  Size of logical volume centos/root changed from 6.67 GiB (1707 extents) to 55.00 GiB (14080 extents).</span><br><span class="line">  Logical volume root successfully resized.</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# df -h</span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root  6.7G  2.1G  4.7G  31% /</span><br><span class="line">devtmpfs                 487M     0  487M   0% /dev</span><br><span class="line">tmpfs                    497M     0  497M   0% /dev/shm</span><br><span class="line">tmpfs                    497M  6.6M  490M   2% /run</span><br><span class="line">tmpfs                    497M     0  497M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1                497M  122M  375M  25% /boot</span><br><span class="line">vagrant                  406G   61G  345G  16% /vagrant</span><br><span class="line">tmpfs                    100M     0  100M   0% /run/user/0</span><br></pre></td></tr></table></figure><h2 id="调整根逻辑卷大小"><a href="#调整根逻辑卷大小" class="headerlink" title="调整根逻辑卷大小"></a>调整根逻辑卷大小</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# resize2fs /dev/mapper/centos-root</span><br><span class="line">resize2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">resize2fs: Bad magic number in super-block while trying to open /dev/mapper/centos-root</span><br><span class="line">Couldn&#x27;t find valid filesystem superblock.</span><br></pre></td></tr></table></figure><p><strong>这个命令是错误的,使用下面的命令</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# xfs_growfs /dev/mapper/centos-root</span><br><span class="line">meta-data=/dev/mapper/centos-root isize=256    agcount=4, agsize=436992 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=0        finobt=0</span><br><span class="line">data     =                       bsize=4096   blocks=1747968, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=0</span><br><span class="line">log      =internal               bsize=4096   blocks=2560, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line">data blocks changed from 1747968 to 14417920</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# df -h</span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root   55G  2.1G   53G   4% /</span><br><span class="line">devtmpfs                 739M     0  739M   0% /dev</span><br><span class="line">tmpfs                    749M     0  749M   0% /dev/shm</span><br><span class="line">tmpfs                    749M  8.4M  741M   2% /run</span><br><span class="line">tmpfs                    749M     0  749M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1                497M  122M  375M  25% /boot</span><br><span class="line">vagrant                  406G   63G  344G  16% /vagrant</span><br><span class="line">data_server              406G   63G  344G  16% /data/server</span><br><span class="line">tmpfs                    150M     0  150M   0% /run/user/0</span><br></pre></td></tr></table></figure><p>现在已经是55G的空间了</p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li>[<a href="http://blog.csdn.net/wzy0623/article/details/50667442]">http://blog.csdn.net/wzy0623/article/details/50667442]</a></li><li>[<a href="http://blog.csdn.net/a349458532/article/details/52117618]">http://blog.csdn.net/a349458532/article/details/52117618]</a></li><li>[<a href="https://www.cnblogs.com/chenmh/p/5096592.html]">https://www.cnblogs.com/chenmh/p/5096592.html]</a></li><li>[<a href="https://www.linuxidc.com/Linux/2017-06/144722.htm]">https://www.linuxidc.com/Linux/2017-06/144722.htm]</a></li><li>[<a href="https://www.cnblogs.com/pinganzi/p/6478255.html]">https://www.cnblogs.com/pinganzi/p/6478255.html]</a></li><li>[<a href="http://blog.csdn.net/weiguang1017/article/details/52252448]">http://blog.csdn.net/weiguang1017/article/details/52252448]</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> virtualbox </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> virtualbox </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>binary_to_term safe使用的小问题</title>
      <link href="/2018/03/13/erlang/erlang-binary_to_term_safe/"/>
      <url>/2018/03/13/erlang/erlang-binary_to_term_safe/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><code>binary_to_term(Str, [safe])</code>小问题</p><span id="more"></span><p>现有二进制如下, 需要将其转换为mod_gvg<br>出于安全的考虑,需要使用`erlang:binary_to_term(Bin, [safe]).</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Eshell V6.<span class="number">2</span>  (abort with ^G)</span><br><span class="line"><span class="number">1</span>&gt; erlang:term_to_binary(&#123;mod_gvg&#125;).</span><br><span class="line">&lt;&lt;<span class="number">131</span>,<span class="number">104</span>,<span class="number">1</span>,<span class="number">100</span>,<span class="number">0</span>,<span class="number">7</span>,<span class="number">109</span>,<span class="number">111</span>,<span class="number">100</span>,<span class="number">95</span>,<span class="number">103</span>,<span class="number">118</span>,<span class="number">103</span>&gt;&gt;</span><br><span class="line"><span class="number">2</span>&gt; </span><br></pre></td></tr></table></figure><p>现存在模块<code>safe</code></p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">-module</span><span class="params">(safe)</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-export</span><span class="params">([get/<span class="number">1</span>])</span>.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">get</span><span class="params">(mod_gvg)</span> -&gt;</span> <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="title">get</span><span class="params">(_)</span> -&gt;</span> <span class="number">0</span>.</span><br></pre></td></tr></table></figure><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Eshell V6.<span class="number">2</span>  (abort with ^G)</span><br><span class="line"><span class="number">1</span>&gt; safe:module_info().</span><br><span class="line">[&#123;exports,[&#123;get,<span class="number">1</span>&#125;,&#123;module_info,<span class="number">0</span>&#125;,&#123;module_info,<span class="number">1</span>&#125;]&#125;,</span><br><span class="line"> &#123;imports,[]&#125;,</span><br><span class="line"> &#123;attributes,[&#123;vsn,[<span class="number">260324741032660828457261428974125625377</span>]&#125;]&#125;,</span><br><span class="line"> &#123;compile,[&#123;options,[]&#125;,</span><br><span class="line">           &#123;version,<span class="string">&quot;5.0.2&quot;</span>&#125;,</span><br><span class="line">           &#123;time,&#123;<span class="number">2018</span>,<span class="number">3</span>,<span class="number">13</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">43</span>&#125;&#125;,</span><br><span class="line">           &#123;source,<span class="string">&quot;e:/ff/safe.erl&quot;</span>&#125;]&#125;]</span><br><span class="line"><span class="number">2</span>&gt; erlang:binary_to_term(&lt;&lt;<span class="number">131</span>,<span class="number">104</span>,<span class="number">1</span>,<span class="number">100</span>,<span class="number">0</span>,<span class="number">7</span>,<span class="number">109</span>,<span class="number">111</span>,<span class="number">100</span>,<span class="number">95</span>,<span class="number">103</span>,<span class="number">118</span>,<span class="number">103</span>&gt;&gt;, [safe]).</span><br><span class="line">** exception error: bad argument</span><br><span class="line">     in function  binary_to_term/<span class="number">2</span></span><br><span class="line">        called as binary_to_term(&lt;&lt;<span class="number">131</span>,<span class="number">104</span>,<span class="number">1</span>,<span class="number">100</span>,<span class="number">0</span>,<span class="number">7</span>,<span class="number">109</span>,<span class="number">111</span>,<span class="number">100</span>,<span class="number">95</span>,<span class="number">103</span>,<span class="number">118</span>,<span class="number">103</span>&gt;&gt;,</span><br><span class="line">                                 [safe])</span><br><span class="line"><span class="number">3</span>&gt; </span><br></pre></td></tr></table></figure><p>明明<code>mod_gvg</code>已经在<code>safe</code>代码中,为什么还是提示失败?<br>将代码修改如下:</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">-module</span><span class="params">(safe)</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-export</span><span class="params">([get/<span class="number">1</span>])</span>.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">get</span><span class="params">(mod_gvg)</span> -&gt;</span> <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="title">get</span><span class="params">(_)</span> -&gt;</span> <span class="number">0</span>.</span><br></pre></td></tr></table></figure><p>再次执行,一切ok</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Eshell V6.<span class="number">2</span>  (abort with ^G)</span><br><span class="line"><span class="number">1</span>&gt; safe:module_info().</span><br><span class="line">[&#123;exports,[&#123;get,<span class="number">1</span>&#125;,&#123;module_info,<span class="number">0</span>&#125;,&#123;module_info,<span class="number">1</span>&#125;]&#125;,</span><br><span class="line"> &#123;imports,[]&#125;,</span><br><span class="line"> &#123;attributes,[&#123;vsn,[<span class="number">50307215724812432190773629780968579091</span>]&#125;]&#125;,</span><br><span class="line"> &#123;compile,[&#123;options,[]&#125;,</span><br><span class="line">           &#123;version,<span class="string">&quot;5.0.2&quot;</span>&#125;,</span><br><span class="line">           &#123;time,&#123;<span class="number">2018</span>,<span class="number">3</span>,<span class="number">13</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">45</span>&#125;&#125;,</span><br><span class="line">           &#123;source,<span class="string">&quot;e:/ff/safe.erl&quot;</span>&#125;]&#125;]</span><br><span class="line"><span class="number">2</span>&gt; erlang:binary_to_term(&lt;&lt;<span class="number">131</span>,<span class="number">104</span>,<span class="number">1</span>,<span class="number">100</span>,<span class="number">0</span>,<span class="number">7</span>,<span class="number">109</span>,<span class="number">111</span>,<span class="number">100</span>,<span class="number">95</span>,<span class="number">103</span>,<span class="number">118</span>,<span class="number">103</span>&gt;&gt;, [safe]).</span><br><span class="line">&#123;mod_gvg&#125;</span><br><span class="line"><span class="number">3</span>&gt; </span><br></pre></td></tr></table></figure><p>说明在编译代码时,编译器有做优化,将</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get(mod_gvg) -&gt; 0;</span><br><span class="line">get(_) -&gt; 0.</span><br></pre></td></tr></table></figure><p>简化为<code>get(_) -&gt; 0.</code><br>因此, 如果要标明原子存在, 需要是<strong>有用</strong>的代码.</p><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li>[<a href="http://erlang.org/doc/man/erlang.html#binary_to_term-2]">http://erlang.org/doc/man/erlang.html#binary_to_term-2]</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ConEmu(Cmder)分屏</title>
      <link href="/2018/03/07/windows/windows-conemu-split/"/>
      <url>/2018/03/07/windows/windows-conemu-split/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><code>设置</code> -&gt; <code>启动</code> -&gt; <code>环境</code>：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 输入 vs, sp 分屏</span></span><br><span class="line"><span class="comment">## vs 是垂直分屏</span></span><br><span class="line">alias vs=cmd <span class="literal">-new_console</span>:sTHn</span><br><span class="line"><span class="comment">## sp 是水平分屏</span></span><br><span class="line">alias <span class="built_in">sp</span>=cmd <span class="literal">-new_console</span>:sTVn</span><br></pre></td></tr></table></figure><span id="more"></span><p>更复杂的分屏代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmd /K ctl.bat -new_console:n:d:&quot;E:\syjy\server\trunk\script&quot;:t:启动脚本</span><br><span class="line">cmd /K tail -f console.log -cur_console:s1TVn:d:&quot;E:\syjy\server\trunk\logs\game\&quot;:t:游戏服</span><br><span class="line">cmd /K tail -f console.log -new_console:s1THn:d:&quot;E:\syjy\server\trunk\logs\cross\&quot;:t:跨服</span><br><span class="line">cmd /K tail -f console.log -new_console:s2THn:d:&quot;E:\syjy\server\trunk\logs\mgr\&quot;:t:管理服</span><br><span class="line">cmd /K my_ssh.bat -new_console:s1THn:d:&quot;E:\my_ssh&quot;:t:SSH</span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="https://conemu.github.io/en/SplitScreen.html">https://conemu.github.io/en/SplitScreen.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ConEmu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用Plink+Privoxy为svn提供代理</title>
      <link href="/2018/02/13/windows/windows-plink-proxy-svn/"/>
      <url>/2018/02/13/windows/windows-plink-proxy-svn/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>即使过年回家,也要安排值班,坑坑坑<br>公司提供了vpn,但是无法更新代码,更加的坑<br>只能使用奇思淫巧了</p><span id="more"></span><h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><p>需要有内网服务器权限(也可以自己在电脑上搭建,但是关机就没办法了)</p><h2 id="需要软件"><a href="#需要软件" class="headerlink" title="需要软件"></a>需要软件</h2><ol><li><a href="https://www.putty.org/">Putty</a></li><li><a href="https://sourceforge.net/projects/ijbswa/">Privoxy</a></li></ol><h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><ol><li><p>Putty<br>plink用于建立SSH隧道,实现<code>socks5代理</code><br><code>plink -C -N -D 127.0.0.1:7000 -i 个人秘钥.ppk 用户名@IP</code></p><blockquote><p>-C 启用压缩<br>-D 端口转发<br>-i xxx.ppk 是使用私钥(ppk如何转换,请自行百度)</p></blockquote></li><li><p>Privoxy<br><code>Privoxy</code>可以将<code>socks5代理</code>转换为<code>http代理</code><br>在配置文件中增加</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">forward-socks5 / 127.0.0.1:7000 .</span><br><span class="line">listen-address 127.0.0.1:8118</span><br></pre></td></tr></table></figure></li><li><p>svn</p><ul><li>Windows<br>使用<code>TortoiseSVN</code>的同学可以在<code>Settings</code>-&gt;<code>Network</code>中设置代理</li><li>Linux<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.subversion/servers</span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line">http-proxy-host = 127.0.0.1</span><br><span class="line">http-proxy-port = 8118</span><br></pre></td></tr></table></figure></li></ul></li><li><p>完成<br>现在可以更新代码了</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> svn </tag>
            
            <tag> putty </tag>
            
            <tag> privoxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ERLANG快速编译脚本</title>
      <link href="/2018/02/08/erlang/erlang-quick-make/"/>
      <url>/2018/02/08/erlang/erlang-quick-make/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>项目中使用<code>mmake:all/1</code>进行编译,但是这会遍历所有文件,效率不是很高</p><p>先<code>svn up</code>, 然后执行下面的脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">fun_quick_make</span></span>()&#123;</span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$SERVER_DIR</span></span><br><span class="line">    <span class="comment">## 获取变化的头文件</span></span><br><span class="line">    hrl_file_list=$(find . -newer time_file -regex .*.hrl -<span class="built_in">exec</span> basename &#123;&#125; \;)</span><br><span class="line">    hrl_f_list=<span class="variable">$hrl_file_list</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## 获取关联的头文件</span></span><br><span class="line">    all_hrl_files=$(find include -name <span class="string">&quot;*.hrl&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;hrl_file_list[@]&#125;</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="comment">## for j in $(ag &quot;$i&quot; include/**/* | awk -F &quot;:&quot; &#x27;&#123;print $1&#125;&#x27;); do</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> $(grep <span class="string">&quot;<span class="variable">$i</span>&quot;</span> <span class="variable">$all_hrl_files</span> | awk -F <span class="string">&quot;:&quot;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>); <span class="keyword">do</span></span><br><span class="line">            hrl_f_list=<span class="string">&quot;<span class="subst">$(basename $j)</span> <span class="variable">$hrl_f_list</span>&quot;</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## 获取变化的erl文件</span></span><br><span class="line">    erl_file_list=<span class="string">&quot;\&quot;src/main.erl\&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> $(find . -newer time_file -regex .*.erl); <span class="keyword">do</span></span><br><span class="line">        erl_file_list=<span class="string">&quot;<span class="variable">$erl_file_list</span>,\&quot;<span class="variable">$&#123;i/.\//&#125;</span>\&quot;&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## 获取关联的erl文件</span></span><br><span class="line">    all_files=$(find . -name <span class="string">&quot;*.erl&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;hrl_f_list[@]&#125;</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        <span class="comment">## why??? php_ssh call fail</span></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        <span class="comment">## for j in $(ag --ignore &quot;robot&quot; &quot;$i&quot; **/* | awk -F &quot;:&quot; &#x27;&#123;print $1&#125;&#x27; | grep &quot;.erl&quot;); do</span></span><br><span class="line">        <span class="comment">##     erl_file_list=&quot;$erl_file_list,\&quot;$j\&quot;&quot;</span></span><br><span class="line">        <span class="comment">## done</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> $(grep <span class="string">&quot;<span class="variable">$i</span>&quot;</span> <span class="variable">$all_files</span> | awk -F <span class="string">&quot;:&quot;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;/robot/&quot;</span>); <span class="keyword">do</span></span><br><span class="line">            erl_file_list=<span class="string">&quot;<span class="variable">$erl_file_list</span>,\&quot;<span class="variable">$&#123;j/.\//&#125;</span>\&quot;&quot;</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## 使用`mmake:files/2`编译</span></span><br><span class="line">    <span class="variable">$&#123;ERL&#125;</span> -pa <span class="variable">$&#123;SERVER_EBIN&#125;</span> -pa <span class="variable">$&#123;SERVER_BASEEBIN&#125;</span> -noshell -<span class="built_in">eval</span> <span class="string">&quot;case mmake:files(500,[<span class="variable">$erl_file_list</span>]) of up_to_date -&gt; init:stop(); _ -&gt; init:stop(1) end&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;$?&quot;</span> == <span class="string">&quot;0&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        touch time_file</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>erlang使用RE进行字符串替换的坑</title>
      <link href="/2018/02/05/erlang/erlang-re-and/"/>
      <url>/2018/02/05/erlang/erlang-re-and/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>erlang使用RE进行字符串替换时”&amp;”特殊处理</p><span id="more"></span><h2 id="找问题"><a href="#找问题" class="headerlink" title="找问题"></a>找问题</h2><p>先来贴一段代码</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">replace</span><span class="params">(String, [])</span> -&gt;</span></span><br><span class="line">    String;</span><br><span class="line"><span class="function"><span class="title">replace</span><span class="params">(String, [&#123;RE,Replacement&#125;|Left])</span> -&gt;</span></span><br><span class="line">    NewString = replace(String, RE, Replacement),</span><br><span class="line">    replace(NewString, Left).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">replace</span><span class="params">(String, RE, Replacement)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">case</span> re:run(String, RE) <span class="keyword">of</span></span><br><span class="line">        nomatch -&gt; String;</span><br><span class="line">        _ -&gt;</span><br><span class="line">            NewString = re:replace(String, RE, NewReplacement, [&#123;return,list&#125;]),</span><br><span class="line">            replace(NewString, RE, Replacement)</span><br><span class="line">    <span class="keyword">end</span>.</span><br></pre></td></tr></table></figure><p>这块代码有两个问题:</p><ol><li>[小问题]在11,12行可以使用<code>re:replace(String, RE, NewReplacement, [&#123;return,list&#125;, global])</code>代替</li><li>[大问题]这块代码会造成死循环, 重现方式:<code>replace(&quot;abcdefg&quot;, [&#123;&quot;a&quot;, &quot;&amp;&quot;&#125;]).</code></li></ol><h2 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h2><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% 替换字符串内容</span></span><br><span class="line"><span class="comment">%% A = re:replace(&quot;a&amp;b&quot;, &quot;&amp;&quot;, &quot;\\\\\\&amp;&quot;, [&#123;return,list&#125;]).</span></span><br><span class="line"><span class="comment">%% util:replace(&quot;&#123;0&#125;aaa&#123;1&#125;&quot;, [&#123;&quot;\\&#123;0\\&#125;&quot;, A&#125;]).</span></span><br><span class="line"><span class="comment">%% util:replace(&quot;&#123;0&#125;aaa&#123;1&#125;&quot;, [&#123;&quot;\\&#123;0\\&#125;&quot;, &quot;a&amp;b&quot;&#125;]).</span></span><br><span class="line"><span class="function"><span class="title">replace</span><span class="params">(String, [])</span> -&gt;</span></span><br><span class="line">    String;</span><br><span class="line"><span class="function"><span class="title">replace</span><span class="params">(String, [&#123;RE,Replacement&#125;|Left])</span> -&gt;</span></span><br><span class="line">    NewString = replace(String, RE, Replacement),</span><br><span class="line">    replace(NewString, Left).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">replace</span><span class="params">(String, RE, Replacement)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">case</span> re:run(String, RE) <span class="keyword">of</span></span><br><span class="line">        nomatch -&gt; String;</span><br><span class="line">        _ -&gt;</span><br><span class="line">            NewReplacement = re:replace(Replacement, <span class="string">&quot;&amp;&quot;</span>, <span class="string">&quot;\\\\\\&amp;&quot;</span>, [global, &#123;return,list&#125;]),</span><br><span class="line">            NewString = re:replace(String, RE, NewReplacement, [&#123;return,list&#125;, global]),</span><br><span class="line">            NewString</span><br><span class="line">    <span class="keyword">end</span>.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用Xming+Putty实现显示LinuxGUI</title>
      <link href="/2018/02/05/windows/windows-xming-putty/"/>
      <url>/2018/02/05/windows/windows-xming-putty/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>使用Xming+Putty实现显示LinuxGUI</p><span id="more"></span><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul><li><code>Windows</code>(客户端)<ul><li>下载安装<a href="https://sourceforge.net/projects/xming/files/Xming/">Xming</a>,<a href="https://sourceforge.net/projects/xming/files/Xming-fonts/">Xming-Fonts</a></li></ul></li></ul><ul><li><code>Linux</code>(服务器)<ul><li><code>yum install -y xauth</code>,重新登录,如果<code>echo $DISPLAY</code>有输出表示成功</li><li><code>yum -y groupinstall fonts</code>,安装各种字体,否则中文乱码</li><li><code>/etc/ssh/sshd_config</code>文件中增加<code>X11 Forwarding yes</code> </li></ul></li></ul><h2 id="Xming设置"><a href="#Xming设置" class="headerlink" title="Xming设置"></a>Xming设置</h2><h3 id="修改字体大小"><a href="#修改字体大小" class="headerlink" title="修改字体大小"></a>修改字体大小</h3><p><code>Xming右击</code> -&gt; <code>属性</code> -&gt; <code>-dpi 96</code> </p><h3 id="其他设置"><a href="#其他设置" class="headerlink" title="其他设置"></a>其他设置</h3><p>启动<code>XLaunch</code>按步骤设置(默认设置即可) </p><h2 id="Xming窗口启动"><a href="#Xming窗口启动" class="headerlink" title="Xming窗口启动"></a>Xming窗口启动</h2><h3 id="putty-需要先连接-再启动GUI应用"><a href="#putty-需要先连接-再启动GUI应用" class="headerlink" title="putty(需要先连接,再启动GUI应用)"></a>putty(需要先连接,再启动GUI应用)</h3><ol><li>勾选<code>Enable X11 forwarding</code>, 如果是使用命令行的话<code>putty -ssh -X</code></li><li>其他配置按照正常的配置</li><li>连接成功后, 使用命令启动GUI程序, 比如<code>gvim</code></li></ol><h3 id="plink-直接启动应用-不会有命令窗口"><a href="#plink-直接启动应用-不会有命令窗口" class="headerlink" title="plink(直接启动应用,不会有命令窗口)"></a>plink(直接启动应用,不会有命令窗口)</h3><ol><li>创建<a href="/downloads/assets/RunHiddenConsole.exe">RunHiddenConsole</a>快捷方式</li><li>目标增加<code>plink -ssh -X -P 端口 -pw 密码 用户名@127.0.0.1 gvim</code></li></ol><h2 id="截图"><a href="#截图" class="headerlink" title="截图"></a>截图</h2><p><img src="/downloads/assets/gnome-terminal.png" alt="gnome-terminal"></p><h2 id="已知问题"><a href="#已知问题" class="headerlink" title="已知问题"></a>已知问题</h2><ul><li>尽管可以在<code>windows</code>下显示界面,但是大部分软件的字体确实不怎么好看</li><li><code>yum</code>安装的emacs会崩溃,请源码编译安装</li></ul>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Xming </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下安装mosh server</title>
      <link href="/2017/11/22/centos/centos-mosh/"/>
      <url>/2017/11/22/centos/centos-mosh/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>MOSH使用UDP进行传输,实现基本的ssh功能,在短时间内断网/切换网络能够保证连接不会断开.</p><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mosh</span><br></pre></td></tr></table></figure><h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><p>按照ssh的连接即可,只是把协议修改为mosh</p>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> mosh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTML调用本地EXE程序</title>
      <link href="/2017/11/03/other/other-html-call-exe/"/>
      <url>/2017/11/03/other/other-html-call-exe/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>HTML调用本地EXE程序</p><span id="more"></span><h2 id="方法1-ActiveXObject"><a href="#方法1-ActiveXObject" class="headerlink" title="方法1-ActiveXObject"></a>方法1-ActiveXObject</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;javascript&quot;</span>&gt;</span><span class="javascript">          </span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">RunExe</span>(<span class="params"></span>)</span>&#123;  </span></span><br><span class="line"><span class="javascript">        w = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;WScript.Shell&quot;</span>);</span></span><br><span class="line"><span class="javascript">        w.run(<span class="string">&#x27;notepad.exe e:/a.bat&#x27;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">    &#125;  </span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;form1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Run&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;return RunExe()&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>简单但是不通用,只支持IE</p></blockquote><h2 id="方法2-URIScheme"><a href="#方法2-URIScheme" class="headerlink" title="方法2-URIScheme"></a>方法2-URIScheme</h2><p>创建流程:</p><blockquote><p><code>CMD</code> -&gt; <code>regedit</code><br><code>选中HKEY_CLASSES_ROOT右击</code> -&gt; <code>新建 项</code> -&gt; <code>myprotocol</code><br><code>选中myprotocol右击</code> -&gt; <code>新建 项</code> -&gt; <code>DefaultIcon</code><br><code>选中myprotocol右击</code> -&gt; <code>新建 项</code> -&gt; <code>Shell</code><br><code>选中myprotocol右击</code> -&gt; <code>新建 字符串值</code> -&gt; <code>URL Protocol</code><br><code>选中DefaultIcon</code> -&gt; <code>修改默认 值为C:\windows\notepad.exe</code><br><code>选中Shell右击</code> -&gt; <code>新建 项</code> -&gt; <code>open</code><br><code>选中open右击</code> -&gt; <code>新建 项</code> -&gt; <code>command</code><br><code>选中command右击</code> -&gt; <code>修改默认 值为C:\windows\notepad.exe %1</code></p></blockquote><p>导出的结果如下:</p><figure class="highlight plaintext"><figcaption><span>myprotocol.reg</span><a href="/downloads/code/myprotocol.reg">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\myprotocol]</span><br><span class="line">@=&quot;ZM Protocol&quot;</span><br><span class="line">&quot;URL Protocol&quot;=&quot;E:\\test.bat %1&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\myprotocol\DefaultIcon]</span><br><span class="line">@=&quot;C:\\Windows\\notepad.exe&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\myprotocol\shell]</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\myprotocol\shell\open]</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\myprotocol\shell\open\command]</span><br><span class="line">@=&quot;E:\\test.bat %1&quot;</span><br></pre></td></tr></table></figure><p>调用方法:<br>在浏览器中输入<code>myprotocol://e:/a.bat/</code><br>提示错误的文件路径<br><strong>这个是因为传入的参数错误,打印发现%1被设置为<code>myprotocol://e:/a.bat/</code>,而不是预想的<code>e:/a.bat</code></strong><br>因此需要处理传入的参数</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">rem e:/test.bat</span></span><br><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">set</span> arg=%<span class="number">1</span></span><br><span class="line"><span class="built_in">set</span> arg1=<span class="variable">%arg:~13,-1%</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">%arg1%</span></span><br><span class="line"><span class="built_in">start</span> notepad <span class="variable">%arg1%</span></span><br><span class="line"><span class="comment">rem pause</span></span><br></pre></td></tr></table></figure><p>其中13是<code>myprotocol://</code>的长度<br><code>%arg:~13,-1%</code>是取<code>arg</code>字符串的第13个~倒数第二个的子串</p><p>一切OK了<br>现在html中简单一行就可以调用了<br><code>&lt;a href=&quot;myprotocol://e:/a.bat/&quot;&gt;打开a.bat&lt;/a&gt;</code></p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li>[<a href="https://msdn.microsoft.com/en-us/library/aa767914(v=vs.85).aspx]">https://msdn.microsoft.com/en-us/library/aa767914(v=vs.85).aspx]</a></li><li>[<a href="http://www.voidcn.com/article/p-ehydagiu-uv.html]">http://www.voidcn.com/article/p-ehydagiu-uv.html]</a></li><li>[<a href="http://www.yihaomen.com/article/other/212.htm]">http://www.yihaomen.com/article/other/212.htm]</a></li><li>[<a href="http://www.jb51.net/article/37278.htm]">http://www.jb51.net/article/37278.htm]</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
            <tag> URIScheme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下supervisor简单配置</title>
      <link href="/2017/10/25/centos/centos-supervisor/"/>
      <url>/2017/10/25/centos/centos-supervisor/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>supervisor就是用Python开发的一套通用的进程管理程序,可以监控程序状态, 并且可以重启</p><span id="more"></span><h3 id="简单配置"><a href="#简单配置" class="headerlink" title="简单配置"></a>简单配置</h3><p>配置文件在<code>/etc/supervisor/conf.d</code>目录下<br>配置很简单,更加详细的配置查看<a href="http://www.supervisord.org/">http://www.supervisord.org/</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[program:frps]</span><br><span class="line">user=root</span><br><span class="line">directory=/root/frp/frp_server/</span><br><span class="line">command=/root/frp/frp_server/frps -c /root/frp/frp_server/frps.ini</span><br><span class="line">process_name=%(program_name)s</span><br><span class="line">autostart=true</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[program:kcptun]</span><br><span class="line">user=kcptun</span><br><span class="line">directory=/usr/local/kcptun</span><br><span class="line">command=/usr/local/kcptun/server_linux_386 -c &quot;/usr/local/kcptun/server-config.json&quot;</span><br><span class="line">process_name=%(program_name)s</span><br><span class="line">autostart=true</span><br><span class="line">redirect_stderr=true</span><br><span class="line">stdout_logfile=/var/log/kcptun/server.log</span><br><span class="line">stdout_logfile_maxbytes=1MB</span><br><span class="line">stdout_logfile_backups=0</span><br></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="http://www.supervisord.org/">http://www.supervisord.org/</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> supervisor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下查看图片/视频的创建时间</title>
      <link href="/2017/10/20/centos/centos-image-videos-info/"/>
      <url>/2017/10/20/centos/centos-image-videos-info/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>最近在整理手机上的图片和视频(没办法,空间太小了,该删除的就的删除)<br>但是图片/视频的命名乱七八糟的,需要按照时间进行命名<br>用到两个工具:<code>exiv2（查看图片的exif信息）</code>,<code>mediainfo（查看视频的信息）</code></p><span id="more"></span><h2 id="exiv2"><a href="#exiv2" class="headerlink" title="exiv2"></a>exiv2</h2><blockquote><p><code>yum install exiv2</code></p></blockquote><h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p><code>exiv2 a.jpg</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">File name       : a.jpg</span><br><span class="line">...</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment">## Image timestamp 即为拍摄时间</span></span></span><br><span class="line">Image timestamp : 2017:01:21 13:15:48</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>查询单个：<code>exiv2 -g &quot;Exif.Image.DateTime&quot; a.jpg</code><br>列出所有：<code>exiv2 -pt a.jpg</code></p><h3 id="修改exif"><a href="#修改exif" class="headerlink" title="修改exif"></a>修改exif</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">date=&quot;2020:01:01&quot;</span><br><span class="line">time=&quot;10:00:00&quot;</span><br><span class="line">exiv2 -M&quot;set Exif.Image.DateTime Ascii $date $time&quot; \</span><br><span class="line">      -M&quot;set Exif.Photo.DateTimeOriginal Ascii $date $time&quot; \</span><br><span class="line">      -M&quot;set Exif.Photo.DateTimeDigitized Ascii $date $time&quot; $file </span><br></pre></td></tr></table></figure><h3 id="删除exif"><a href="#删除exif" class="headerlink" title="删除exif"></a>删除exif</h3><p><code>exiv2 rm a.jpg</code></p><h3 id="重命名"><a href="#重命名" class="headerlink" title="重命名"></a>重命名</h3><p><code>exiv2 -F -r &quot;IMG_%Y%m%d_%H%M%S&quot; rename *.jpg</code></p><blockquote><p>-F 强制重命名<br>-r 自定义名字格式</p></blockquote><h2 id="mediainfo"><a href="#mediainfo" class="headerlink" title="mediainfo"></a>mediainfo</h2><blockquote><p><code>yum install mediainfo</code><br><strong>需要有epel源</strong></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> mediainfo 084503060416d183f2c33000.mp4</span></span><br><span class="line">General</span><br><span class="line">Complete name                            : 084503060416d183f2c33000.mp4</span><br><span class="line">...</span><br><span class="line">Encoded date                             : UTC 2016-04-06 00:45:10</span><br><span class="line">Tagged date                              : UTC 2016-04-06 00:45:10</span><br><span class="line">...</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment">## Encoded date 即为创建时间,但是要注意是UTC时间</span></span></span><br></pre></td></tr></table></figure><p>剩下就是自己实现脚本了</p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="http://blog.sina.com.cn/s/blog_64a43f760100o0p3.html">http://blog.sina.com.cn/s/blog_64a43f760100o0p3.html</a></li><li><a href="http://tieba.baidu.com/p/3338501642">http://tieba.baidu.com/p/3338501642</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
          <category> exiv2 </category>
          
          <category> mediainfo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> exiv2 </tag>
            
            <tag> mediainfo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用svn命令合并版本</title>
      <link href="/2017/09/30/shell/shell-svn-merge/"/>
      <url>/2017/09/30/shell/shell-svn-merge/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>使用svn命令合并版本, 一个没有实际使用过的脚本, 备份下</p><span id="more"></span><figure class="highlight sh"><figcaption><span>svn_merge.sh</span><a href="/downloads/code/svn_merge.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash - </span></span><br><span class="line"><span class="comment">#===============================================================================</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#          FILE: svn_merge.sh</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#         USAGE: ./svn_merge.sh </span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#   DESCRIPTION: </span></span><br><span class="line"><span class="comment">#               合并脚本</span></span><br><span class="line"><span class="comment">#               1. 根据版本依次合并</span></span><br><span class="line"><span class="comment">#               2. 遇到冲突使用Ctrl-C中断</span></span><br><span class="line"><span class="comment">#               3. 解决冲突后再次执行,继续合并</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#       OPTIONS: ---</span></span><br><span class="line"><span class="comment">#  REQUIREMENTS: ---</span></span><br><span class="line"><span class="comment">#          BUGS: ---</span></span><br><span class="line"><span class="comment">#         NOTES: ---</span></span><br><span class="line"><span class="comment">#        AUTHOR: kingwen0302, kingwen0302@msn.com</span></span><br><span class="line"><span class="comment">#  ORGANIZATION: </span></span><br><span class="line"><span class="comment">#       CREATED: 2017/5/12 16:15</span></span><br><span class="line"><span class="comment">#      REVISION:  ---</span></span><br><span class="line"><span class="comment">#===============================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -o nounset                              <span class="comment"># Treat unset variables as an error</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line">SRC_SVN_URL=http://svn_url/server/trunk</span><br><span class="line">SVN_USER=<span class="string">&quot;svn_user&quot;</span></span><br><span class="line">SVN_PASS=<span class="string">&quot;svn_pass&quot;</span></span><br><span class="line"></span><br><span class="line">SRC_SVN_URL_BASE=$(basename <span class="variable">$SRC_SVN_URL</span>)</span><br><span class="line"></span><br><span class="line">CUR_DIR=$(<span class="built_in">cd</span> $(dirname <span class="variable">$0</span>); <span class="built_in">pwd</span>)</span><br><span class="line"><span class="comment">## 已经合并成功的版本号</span></span><br><span class="line">MERGE_SUCCESS_VERSION=<span class="variable">${CUR_DIR}</span>/versions</span><br><span class="line"><span class="comment">## 已经合并成功的注释</span></span><br><span class="line">MERGE_SUCCESS_COMMENT=<span class="variable">${CUR_DIR}</span>/comment</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> SVN_EDITOR=<span class="string">&quot;vim&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">svn_merge_one</span></span>(){</span><br><span class="line">    version=<span class="variable">$1</span></span><br><span class="line">    <span class="comment">## 如果svn是中文的话,要过滤中文</span></span><br><span class="line">    merge_files=$(svn <span class="built_in">log</span> -r <span class="variable">${version}</span> -qv <span class="variable">${SRC_SVN_URL}</span> --username <span class="variable">${SVN_USER}</span> --password <span class="variable">${SVN_PASS}</span> | grep -v <span class="string">&quot;^r&quot;</span> | grep -v <span class="string">&quot;^Changed paths:&quot;</span> | grep -v <span class="string">&quot;^-------------&quot;</span> | awk <span class="string">&quot;{print \$1\$2}&quot;</span>)</span><br><span class="line"></span><br><span class="line">    base_merge_files=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> <span class="variable">$merge_files</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="variable">$base_merge_files</span> == <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            base_merge_files=$(basename <span class="variable">$f</span>)</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            base_merge_files=<span class="string">&quot;<span class="variable">${base_merge_files}</span> <span class="subst">$(basename $f)</span>&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$base_merge_files</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;==&gt;START MERGE <span class="variable">${version}</span> [<span class="variable">${base_merge_files}</span>]&quot;</span></span><br><span class="line">        <span class="keyword">for</span> f <span class="keyword">in</span> <span class="variable">${merge_files}</span>; <span class="keyword">do</span></span><br><span class="line">            svn_cmd=$(expr substr <span class="variable">$f</span> 1 1)</span><br><span class="line">            f=$(<span class="built_in">echo</span> <span class="variable">$f</span> | sed -e <span class="string">&quot;s/^.//&quot;</span> | sed -e <span class="string">&quot;s/<span class="variable">${SRC_SVN_URL_BASE}</span>//&quot;</span>  | sed -e <span class="string">&quot;s/\/\//\//g&quot;</span> | sed -e <span class="string">&quot;s/\/\//\//g&quot;</span>)</span><br><span class="line">            local_f=<span class="string">&quot;.<span class="variable">$f</span>&quot;</span></span><br><span class="line">            <span class="keyword">case</span> <span class="variable">$svn_cmd</span> <span class="keyword">in</span></span><br><span class="line">                A)</span><br><span class="line">                    tmp=<span class="string">&quot;svn copy --username <span class="variable">${SVN_USER}</span> --password <span class="variable">${SVN_PASS}</span> -r <span class="variable">$version</span> <span class="variable">${SRC_SVN_URL}</span><span class="variable">$f</span> <span class="variable">$local_f</span>&quot;</span></span><br><span class="line">                    ;;</span><br><span class="line">                M)</span><br><span class="line">                    <span class="comment">## tmp=&quot;svn merge --username ${SVN_USER} --password ${SVN_PASS} -r $((version-1)):$version --ignore-ancestry ${SRC_SVN_URL}$f $local_f&quot;</span></span><br><span class="line">                    tmp=<span class="string">&quot;svn merge --username <span class="variable">${SVN_USER}</span> --password <span class="variable">${SVN_PASS}</span> -c <span class="variable">$version</span> --ignore-ancestry <span class="variable">${SRC_SVN_URL}</span><span class="variable">$f</span> <span class="variable">$local_f</span>&quot;</span></span><br><span class="line">                    ;;</span><br><span class="line">                D)</span><br><span class="line">                    tmp=<span class="string">&quot;svn del <span class="variable">$local_f</span>&quot;</span></span><br><span class="line">                    ;;</span><br><span class="line">                *)</span><br><span class="line">                    <span class="built_in">echo</span> <span class="string">&quot;暂不支持的命令&quot;</span></span><br><span class="line">                    <span class="built_in">exit</span></span><br><span class="line">                    ;;</span><br><span class="line">            <span class="keyword">esac</span></span><br><span class="line">            ttmp=$(<span class="variable">$tmp</span>)</span><br><span class="line">            <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;    [FAIL]<span class="variable">$ttmp</span>&quot;</span></span><br><span class="line">                <span class="built_in">exit</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;    [SUCCESS]<span class="variable">$f</span>&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">## 写入合并成功版本号</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$version</span>&quot;</span> &gt;&gt; <span class="variable">${MERGE_SUCCESS_VERSION}</span></span><br><span class="line">        <span class="comment">## 写入合并成功日志</span></span><br><span class="line">        svn <span class="built_in">log</span> -r <span class="variable">${version}</span> -v <span class="variable">${SRC_SVN_URL}</span> --username <span class="variable">${SVN_USER}</span> --password <span class="variable">${SVN_PASS}</span> | grep -v <span class="string">&quot;^r&quot;</span> | grep -v <span class="string">&quot;^Changed paths:&quot;</span> | grep -v <span class="string">&quot;^-------------&quot;</span> | grep -v <span class="string">&quot;^$&quot;</span> | grep -v <span class="string">&quot;^ &quot;</span> &gt;&gt; <span class="variable">${MERGE_SUCCESS_COMMENT}</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;---------------------&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$0</span> version1:version2 version3 &quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;---------------------&quot;</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">## 确保文件存在</span></span><br><span class="line">        touch <span class="variable">${MERGE_SUCCESS_VERSION}</span></span><br><span class="line">        touch <span class="variable">${MERGE_SUCCESS_COMMENT}</span></span><br><span class="line">        <span class="comment">## 获取版本</span></span><br><span class="line">        f_version=$(<span class="built_in">echo</span> <span class="variable">$1</span> | cut -d : -f 1)</span><br><span class="line">        t_version=$(<span class="built_in">echo</span> <span class="variable">$1</span> | cut -d : -f 2)</span><br><span class="line">        <span class="keyword">for</span> version <span class="keyword">in</span> $(seq <span class="variable">$f_version</span> <span class="variable">$t_version</span>); <span class="keyword">do</span></span><br><span class="line">            <span class="comment">## 是否已经合并成功</span></span><br><span class="line">            is_merge_success=0</span><br><span class="line">            <span class="keyword">for</span> v <span class="keyword">in</span> $(cat <span class="variable">${MERGE_SUCCESS_VERSION}</span>); <span class="keyword">do</span></span><br><span class="line">                <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">${v}</span>&quot;</span> == <span class="string">&quot;<span class="variable">$version</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                    is_merge_success=1</span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">            <span class="keyword">if</span> [ <span class="variable">$is_merge_success</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">                svn_merge_one <span class="variable">$version</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">mv <span class="variable">${MERGE_SUCCESS_VERSION}</span> <span class="variable">${MERGE_SUCCESS_VERSION}</span>_bak</span><br><span class="line">cat <span class="variable">${MERGE_SUCCESS_COMMENT}</span></span><br><span class="line">mv <span class="variable">${MERGE_SUCCESS_COMMENT}</span> <span class="variable">${MERGE_SUCCESS_COMMENT}</span>_bak</span><br></pre></td></tr></table></figure><p>乱码是因为编码问题, 在windows下使用cp936</p><figure class="highlight sh"><figcaption><span>tor_merge.sh</span><a href="/downloads/code/tor_merge.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## kingwen0302</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## ��һ�����ϲ����뵽������/��֧</span></span><br><span class="line"><span class="comment">## ��windows����, ��˱�����gbk������utf8</span></span><br><span class="line"><span class="comment">## ��Ҫ��װgit for windows</span></span><br><span class="line"><span class="comment">## sh tor_merge.sh ��֧�汾 1,3-4</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"></span><br><span class="line">CUR_DIR=$(<span class="built_in">cd</span> $(dirname <span class="variable">$0</span>); <span class="built_in">pwd</span>)</span><br><span class="line"><span class="comment">## �ȶ����ĵ�ַ</span></span><br><span class="line"><span class="comment">## svn�˺�����</span></span><br><span class="line">SVN_BASE_URL=<span class="string">&quot;svn://url/xxx&quot;</span></span><br><span class="line">SVN_PARAM=<span class="string">&quot;--username kingwen0302 --password xxxxx&quot;</span></span><br><span class="line"><span class="comment">## �ϲ���Դ��ַ</span></span><br><span class="line">SRC_SVN_URL=<span class="string">&quot;<span class="variable">${SVN_BASE_URL}</span>/trunk_cn_s&quot;</span></span><br><span class="line"><span class="comment">## ��ǰĿ¼��� �ȶ�/��֧ Ŀ¼</span></span><br><span class="line">RELATIVE_DIR=<span class="string">&quot;<span class="variable">$CUR_DIR</span>/../&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ## �����ȶ���/��֧��Ŀ¼</span></span><br><span class="line"><span class="comment">## DEST_DIR_LIST=(</span></span><br><span class="line"><span class="comment">## &quot;$CUR_DIR/../trunk_kr_s&quot;</span></span><br><span class="line"><span class="comment">## &quot;$CUR_DIR/../trunk_tw_s&quot;</span></span><br><span class="line"><span class="comment">## ## &quot;$CUR_DIR/../trunk_cn_s&quot;</span></span><br><span class="line"><span class="comment">## &quot;$CUR_DIR/../trunk_vng_s&quot;</span></span><br><span class="line"><span class="comment">## &quot;$CUR_DIR/../branch_cn/jysy_cn_2102700&quot;</span></span><br><span class="line"><span class="comment">## &quot;$CUR_DIR/../branch_cn/jysy_cn_2102701&quot;</span></span><br><span class="line"><span class="comment">## &quot;$CUR_DIR/../branch_kr/jysy_kr_2102700&quot;</span></span><br><span class="line"><span class="comment">## &quot;$CUR_DIR/../branch_vng/jysy_vn_2102700&quot;</span></span><br><span class="line"><span class="comment">## )</span></span><br><span class="line"></span><br><span class="line">DEST_DIR_LIST=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">find_branch_list</span></span>(){</span><br><span class="line">    MIN_VER=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;��Ѱ &gt;=<span class="variable">$MIN_VER</span> �汾�ķ�֧ ...&quot;</span></span><br><span class="line">    stable_dir=$(svn list <span class="variable">$SVN_BASE_URL</span> <span class="variable">$SVN_PARAM</span> | grep trunk_.*_s)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">${stable_dir[@]}</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;�����ȶ���: <span class="variable">$RELATIVE_DIR</span>/<span class="variable">$i</span>&quot;</span></span><br><span class="line">        DEST_DIR_LIST=<span class="string">&quot;<span class="variable">$DEST_DIR_LIST</span> <span class="variable">$RELATIVE_DIR</span>/<span class="variable">$i</span>&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    branch_dir=$(svn list <span class="variable">$SVN_BASE_URL</span> <span class="variable">$SVN_PARAM</span> | grep branch_.*)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">${branch_dir[@]}</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> $(svn list <span class="variable">$SVN_BASE_URL</span>/<span class="variable">$i</span> <span class="variable">$SVN_PARAM</span>); <span class="keyword">do</span></span><br><span class="line">            ver=$(<span class="built_in">echo</span> <span class="variable">$j</span> | grep -Eo <span class="string">&#x27;[0-9]+&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$ver</span>&quot;</span> == <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                ver=0</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ver</span>&quot;</span> -ge <span class="string">&quot;<span class="variable">$MIN_VER</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;���ַ�֧: <span class="variable">$RELATIVE_DIR</span>/<span class="variable">$i</span>/<span class="variable">$j</span>&quot;</span></span><br><span class="line">                DEST_DIR_LIST=<span class="string">&quot;<span class="variable">$DEST_DIR_LIST</span> <span class="variable">$RELATIVE_DIR</span>/<span class="variable">$i</span>/<span class="variable">$j</span>&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">## �ϲ�һ����֧</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">svn_merge_one</span></span>(){</span><br><span class="line">    dest_dir=<span class="variable">$1</span></span><br><span class="line">    version=<span class="variable">$2</span></span><br><span class="line">    <span class="comment">## �������ɵ�ַ</span></span><br><span class="line">    dest_dir=<span class="string">&quot;<span class="subst">$(dirname $dest_dir)</span>/<span class="subst">$(basename $dest_dir)</span>&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">${dest_dir}</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        svn_dir=$(basename $(dirname <span class="variable">${dest_dir}</span>))/$(basename <span class="variable">${dest_dir}</span>)</span><br><span class="line">        svn co <span class="variable">$SVN_PARAM</span> <span class="variable">${SVN_BASE_URL}</span>/<span class="variable">$svn_dir</span> <span class="variable">$dest_dir</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;����Ŀ¼: <span class="variable">${dest_dir}</span>&quot;</span> &amp;&amp; <span class="built_in">cd</span> <span class="variable">$dest_dir</span> &amp;&amp; svn up</span><br><span class="line">    TortoiseProc /<span class="built_in">command</span>:merge /fromurl:<span class="variable">$SRC_SVN_URL</span> /revrange:<span class="variable">${version/:/-}</span> /path:<span class="string">&quot;*&quot;</span> /closeonend:1</span><br><span class="line">    TortoiseProc /<span class="built_in">command</span>:commit /path:<span class="string">&quot;*&quot;</span> /closeonend:1</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">svn_merge</span></span>(){</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ԴUrl: <span class="variable">${SRC_SVN_URL}</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;�汾: <span class="variable">$1</span>&quot;</span></span><br><span class="line">    <span class="keyword">for</span> dest_dir <span class="keyword">in</span> <span class="variable">${DEST_DIR_LIST[@]}</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Ŀ���֧: <span class="variable">${dest_dir}</span>&quot;</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;�Ƿ�ϲ�(Y|N):&quot;</span></span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$REPLY</span> <span class="keyword">in</span></span><br><span class="line">            Y|y)</span><br><span class="line">                svn_merge_one <span class="variable">$dest_dir</span> <span class="variable">$1</span></span><br><span class="line">                ;;</span><br><span class="line">            *)</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;��ȡ���˱��κϲ�&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">help</span></span>(){</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ʹ��1: <span class="variable">$0</span> BRANCH_VERSION ver,ver1:ver2&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ʹ��2: <span class="variable">$0</span> BRANCH_VERSION ver,ver1-ver2&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;example: <span class="variable">$0</span> 2102700 1000,10002-10005&quot;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">BRANCH_VERSION=<span class="variable">$1</span></span><br><span class="line">SVN_VERSION=<span class="variable">$2</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$BRANCH_VERSION</span>&quot;</span> == <span class="string">&quot;&quot;</span> || <span class="string">&quot;<span class="variable">$SVN_VERSION</span>&quot;</span> == <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">help</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    find_branch_list <span class="variable">$BRANCH_VERSION</span></span><br><span class="line">    svn_merge <span class="variable">${SVN_VERSION}</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> svn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> svn </tag>
            
            <tag> shell </tag>
            
            <tag> merge </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用libreoffice将xlsx转换为html文件</title>
      <link href="/2017/09/30/shell/shell-soffice/"/>
      <url>/2017/09/30/shell/shell-soffice/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>使用<code>libreoffice</code>将<code>xlsx</code>转换为<code>html</code>文件</p><span id="more"></span><figure class="highlight sh"><figcaption><span>xlsx2htm.sh</span><a href="/downloads/code/xlsx2htm.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">XLSX_DIR=<span class="string">&quot;E:/qqjy/plan/004 配置表&quot;</span></span><br><span class="line">OUT_DIR=<span class="string">&quot;E:/aaa&quot;</span></span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$XLSX_DIR</span>&quot;</span></span><br><span class="line">XLSX_FILES=$(ls | grep xlsx | awk <span class="string">&#x27;{printf(&quot;%s:&quot;, $0)}&#x27;</span>)</span><br><span class="line">i=1</span><br><span class="line"><span class="keyword">while</span>((1==1)); <span class="keyword">do</span></span><br><span class="line">    file=$(<span class="built_in">echo</span> <span class="variable">$XLSX_FILES</span> | cut -d <span class="string">&quot;:&quot;</span> -f<span class="variable">$i</span>)</span><br><span class="line">    i=$(expr <span class="variable">$i</span> + 1)</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$file</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;convert <span class="variable">$file</span>&quot;</span></span><br><span class="line">        soffice --headless --invisible --convert-to htm <span class="string">&quot;<span class="variable">$file</span>&quot;</span> --outdir <span class="variable">$OUT_DIR</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> libreoffice </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
            <tag> libreoffice </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS6下安装php56</title>
      <link href="/2017/09/29/centos/centos-php56/"/>
      <url>/2017/09/29/centos/centos-php56/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>centos6默认安装的是php5.3<br>现在要升级到php5.6+</p><span id="more"></span><h3 id="卸载旧版本php"><a href="#卸载旧版本php" class="headerlink" title="卸载旧版本php"></a>卸载旧版本php</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove php php-common</span><br></pre></td></tr></table></figure><h3 id="增加yum源"><a href="#增加yum源" class="headerlink" title="增加yum源"></a>增加yum源</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-6.noarch.rpm</span><br><span class="line">rpm -Uvh https://mirror.webtatic.com/yum/el6/latest.rpm</span><br></pre></td></tr></table></figure><h3 id="重新安装"><a href="#重新安装" class="headerlink" title="重新安装"></a>重新安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install php56w php56w-fpm php56w-gd php56w-mbstring php56w-mysql php56w-pdo php56w-xml</span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://www.cnblogs.com/savokiss/p/6259816.html">http://www.cnblogs.com/savokiss/p/6259816.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> php </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>erlang wxWidgets</title>
      <link href="/2017/09/28/erlang/erlang-wx/"/>
      <url>/2017/09/28/erlang/erlang-wx/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>工作中需要启动多个节点, 查看日志时,来回切换比较麻烦<br>erlang有wxWidgets用来开发界面,东拼西凑出一个界面,效果图如下:<br><img src="/downloads/assets/wx.png" alt="效果图如下"></p><span id="more"></span><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight erl"><figcaption><span>server_ctl_gui.erl</span><a href="/downloads/code/server_ctl_gui.erl">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% coding: latin-1</span></span><br><span class="line"><span class="comment">%%! -smp enable -name server_ctl_gui@127.0.0.1 -setcookie qqjy -noshell</span></span><br><span class="line"><span class="comment">%%%-----------------------------------------------</span></span><br><span class="line"><span class="comment">%%% 一个界面管理所有节点信息</span></span><br><span class="line"><span class="comment">%%%</span></span><br><span class="line"><span class="comment">%%% escript server_ctl_gui.erl --log_file E:/qqjy/server_ctl_gui.log --project_root E:/qqjy/qqjy_server/config</span></span><br><span class="line"><span class="comment">%%%</span></span><br><span class="line"><span class="comment">%%% 已知问题:</span></span><br><span class="line"><span class="comment">%%% 1. 在使用`RunHiddenConsole erl` 后, `observer:start()`会失效</span></span><br><span class="line"><span class="comment">%%%</span></span><br><span class="line"><span class="comment">%%%-----------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">-include_lib</span><span class="params">(<span class="string">&quot;wx/include/wx.hrl&quot;</span>)</span>.</span><br><span class="line"><span class="keyword">-include_lib</span><span class="params">(<span class="string">&quot;kernel/include/file.hrl&quot;</span>)</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-define</span><span class="params">(APP_NAME, server_ctl_gui)</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-define</span><span class="params">(DEBUG_MSG(Format)</span>, ?DEBUG_MSG<span class="params">(Format, [])</span>).</span><br><span class="line"><span class="comment">%% ?LINE + 1 应该是因为 `-smp ...` 的原因</span></span><br><span class="line"><span class="keyword">-define</span><span class="params">(DEBUG_MSG(Format, Args)</span>,</span><br><span class="line">        lists:foldl<span class="params">(</span></span><br><span class="line"><span class="params">          <span class="keyword">fun</span>(IO, Str) <span class="keyword">when</span> is_pid(IO) -&gt;</span></span><br><span class="line"><span class="params">                  io:format(IO, <span class="string">&quot;~s&quot;</span>, [Str]),</span></span><br><span class="line"><span class="params">                  Str;</span></span><br><span class="line"><span class="params">             (wx, Str) -&gt;</span></span><br><span class="line"><span class="params">                  <span class="keyword">case</span> get_env(parent_pid) <span class="keyword">of</span></span></span><br><span class="line"><span class="params">                      undefined -&gt;</span></span><br><span class="line"><span class="params">                          set_env(wx_log_list, get_env(wx_log_list, []) ++ [Str]);</span></span><br><span class="line"><span class="params">                      _ -&gt;</span></span><br><span class="line"><span class="params">                          lists:foreach(</span></span><br><span class="line"><span class="params">                            <span class="keyword">fun</span>(_X_) -&gt; get_env(parent_pid) ! {log_wx, Str} <span class="keyword">end</span>, </span></span><br><span class="line"><span class="params">                            get_env(wx_log_list, []) ++ [Str]),</span></span><br><span class="line"><span class="params">                          set_env(wx_log_list, [])</span></span><br><span class="line"><span class="params">                  <span class="keyword">end</span>,</span></span><br><span class="line"><span class="params">                  Str;</span></span><br><span class="line"><span class="params">             (_, Str) -&gt;</span></span><br><span class="line"><span class="params">                  io:format(<span class="string">&quot;~ts&quot;</span>, [Str]),</span></span><br><span class="line"><span class="params">                  Str</span></span><br><span class="line"><span class="params">          <span class="keyword">end</span>,</span></span><br><span class="line"><span class="params">          unicode:characters_to_binary(io_lib:format(<span class="string">&quot;~s ~p [line:~p] &quot;</span> ++ Format ++ <span class="string">&quot;~n&quot;</span>, [time_format(), self(), ?LINE + <span class="number">1</span> | Args])),</span></span><br><span class="line"><span class="params">          lists:usort([undefined, wx, application:get_env(?APP_NAME, log_pid, undefined)])</span></span><br><span class="line"><span class="params">         )</span>).</span><br><span class="line"></span><br><span class="line"><span class="keyword">-record</span><span class="params">(wx_elem_cfg, {</span></span><br><span class="line"><span class="params">          id = <span class="number">0</span>,</span></span><br><span class="line"><span class="params">          name = <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="params">          type = <span class="number">0</span>, <span class="comment">%% button | text</span></span></span><br><span class="line"><span class="params">          start_cmd_list = [],  <span class="comment">%% 字符串命令 | {call, {M, F, A}}, {mfa, {Fun, Args}}</span></span></span><br><span class="line"><span class="params">          over_cmd_list = [],</span></span><br><span class="line"><span class="params">          node = undefined,</span></span><br><span class="line"><span class="params">          log_file = <span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="params">         })</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-record</span><span class="params">(wx_elem_state, {</span></span><br><span class="line"><span class="params">          id = <span class="number">0</span>,</span></span><br><span class="line"><span class="params">          wx,</span></span><br><span class="line"><span class="params">          status = over, <span class="comment">%% over | start</span></span></span><br><span class="line"><span class="params">          log_pid</span></span><br><span class="line"><span class="params">         })</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-record</span><span class="params">(state, {</span></span><br><span class="line"><span class="params">          frame,</span></span><br><span class="line"><span class="params">          btn_list = [],</span></span><br><span class="line"><span class="params">          text_list = [],</span></span><br><span class="line"><span class="params">          log_wx,</span></span><br><span class="line"><span class="params">          pid</span></span><br><span class="line"><span class="params">         })</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-define</span><span class="params">(START_STR, <span class="string">&quot;【开启】&quot;</span>)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(CLOSE_STR, <span class="string">&quot;【关闭】&quot;</span>)</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 按钮</span></span><br><span class="line"><span class="keyword">-define</span><span class="params">(BUTTON_SIZE_X, <span class="number">100</span>)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(BUTTON_SIZE_Y, <span class="number">30</span>)</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 日志框</span></span><br><span class="line"><span class="keyword">-define</span><span class="params">(TEXT_SIZE_X, <span class="number">1680</span>)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(TEXT_SIZE_Y, <span class="number">400</span>)</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 初始化显示行数</span></span><br><span class="line"><span class="keyword">-define</span><span class="params">(SHOW_LINES_INIT, <span class="number">10</span>)</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-define</span><span class="params">(ERL_HEAD, <span class="string">&quot;RunHiddenConsole D:/erl6.2/bin/erl +P 6400 -smp auto -pa ../ebin -noshell -noinput -setcookie qqjy -boot start_sasl &quot;</span>)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(WERL_HEAD, <span class="string">&quot;start D:/erl6.2/bin/werl +P 6400 -smp auto -pa ../ebin -setcookie qqjy &quot;</span>)</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 节点名字</span></span><br><span class="line"><span class="keyword">-define</span><span class="params">(NODE_GAME,  &#x27;qqjy_game1@<span class="number">127.0</span>.<span class="number">0.1</span>&#x27;)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(NODE_GAME_2,&#x27;qqjy_game2@<span class="number">127.0</span>.<span class="number">0.1</span>&#x27;)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(NODE_CROSS, &#x27;qqjy_cross1@<span class="number">127.0</span>.<span class="number">0.1</span>&#x27;)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(NODE_MGR,   &#x27;qqjy_mgr1@<span class="number">127.0</span>.<span class="number">0.1</span>&#x27;)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(NODE_FLASH, &#x27;qqjy_game_flash1@<span class="number">127.0</span>.<span class="number">0.1</span>&#x27;)</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 节点启动命令</span></span><br><span class="line"><span class="keyword">-define</span><span class="params">(START_GAME_CMD,     ?ERL_HEAD ++ <span class="string">&quot;-name &quot;</span> ++ atom_to_list(?NODE_GAME)   ++ <span class="string">&quot; -config run_game -s main server_start&quot;</span>)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(START_GAME_2_CMD,   ?ERL_HEAD ++ <span class="string">&quot;-name &quot;</span> ++ atom_to_list(?NODE_GAME_2) ++ <span class="string">&quot; -config run_game2 -s main server_start&quot;</span>)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(START_CROSS_CMD,    ?ERL_HEAD ++ <span class="string">&quot;-name &quot;</span> ++ atom_to_list(?NODE_CROSS)  ++ <span class="string">&quot; -config run_cross -s main server_start&quot;</span>)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(START_MGR_CMD,      ?ERL_HEAD ++ <span class="string">&quot;-name &quot;</span> ++ atom_to_list(?NODE_MGR)    ++ <span class="string">&quot; -config run_mgr -s main server_start&quot;</span>)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(START_FLASH_CMD,    ?ERL_HEAD ++ <span class="string">&quot;-name &quot;</span> ++ atom_to_list(?NODE_FLASH)  ++ <span class="string">&quot; -config flash -s main flash_start&quot;</span>)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(START_MAKE,         ?WERL_HEAD ++ <span class="string">&quot;-eval \&quot;case u:d() of up_to_date -&gt; timer:sleep(5000), init:stop(); _ -&gt; error end\&quot;&quot;</span>)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(START_MAKE_FUNC,    ?WERL_HEAD ++ <span class="string">&quot;-eval \&quot;case u:m([fair_1v1]) of up_to_date -&gt; timer:sleep(60000), init:stop(); _ -&gt; error end\&quot;&quot;</span>)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(START_GAME_DEBUG,   ?WERL_HEAD ++ <span class="string">&quot;-name debug_1@127.0.0.1 -remsh &quot;</span>     ++ atom_to_list(?NODE_GAME))</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(START_CROSS_DEBUG,  ?WERL_HEAD ++ <span class="string">&quot;-name debug_cross@127.0.0.1 -remsh &quot;</span> ++ atom_to_list(?NODE_CROSS))</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(START_MGR_DEBUG,    ?WERL_HEAD ++ <span class="string">&quot;-name debug_mgr@127.0.0.1 -remsh &quot;</span>   ++ atom_to_list(?NODE_MGR))</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(START_GUI_DEBUG,    ?WERL_HEAD ++ <span class="string">&quot;-name debug_gui@127.0.0.1 -remsh &quot;</span>   ++ atom_to_list(&#x27;server_ctl_gui@<span class="number">127.0</span>.<span class="number">0.1</span>&#x27;))</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 日志文件</span></span><br><span class="line"><span class="keyword">-define</span><span class="params">(FILE_GAME_LOG,  <span class="string">&quot;E:/qqjy/qqjy_server/logs/game_200001/console.txt&quot;</span>)</span>.</span><br><span class="line"><span class="keyword">-define</span><span class="params">(FILE_CROSS_LOG, <span class="string">&quot;E:/qqjy/qqjy_server/logs/cross/console.txt&quot;</span>)</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 玩家列表url</span></span><br><span class="line"><span class="keyword">-define</span><span class="params">(URL_PLAYER_LIST, <span class="string">&quot;http://127.0.0.1:7010/debug/user_list?is_show_guest=1&amp;last_days=10&amp;client=1&quot;</span>)</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 按钮列表, 横向排序</span></span><br><span class="line"><span class="function"><span class="title">wx_btn_list</span><span class="params">()</span> -&gt;</span></span><br><span class="line">    [</span><br><span class="line">     #wx_elem_cfg{</span><br><span class="line">        id = <span class="number">101</span>, name = <span class="string">&quot;游戏服&quot;</span>, type = button,</span><br><span class="line">        start_cmd_list = [?START_GAME_CMD],</span><br><span class="line">        over_cmd_list = [{call, {main, shutdown, []}}],</span><br><span class="line">        node = ?NODE_GAME</span><br><span class="line">       },</span><br><span class="line">     #wx_elem_cfg{</span><br><span class="line">        id = <span class="number">1011</span>, name = <span class="string">&quot;游戏服2&quot;</span>, type = button,</span><br><span class="line">        start_cmd_list = [?START_GAME_2_CMD],</span><br><span class="line">        over_cmd_list = [{call, {main, shutdown, []}}],</span><br><span class="line">        node = ?NODE_GAME_2</span><br><span class="line">       },</span><br><span class="line">     #wx_elem_cfg{</span><br><span class="line">        id = <span class="number">102</span>, name = <span class="string">&quot;跨服&quot;</span>, type = button,</span><br><span class="line">        start_cmd_list = [?START_CROSS_CMD],</span><br><span class="line">        over_cmd_list = [{call, {main, shutdown, []}}],</span><br><span class="line">        node = ?NODE_CROSS</span><br><span class="line">       },</span><br><span class="line">     #wx_elem_cfg{</span><br><span class="line">        id = <span class="number">103</span>, name = <span class="string">&quot;管理服&quot;</span>, type = button,</span><br><span class="line">        start_cmd_list = [?START_MGR_CMD],</span><br><span class="line">        over_cmd_list = [{call, {main, shutdown, []}}],</span><br><span class="line">        node = ?NODE_MGR</span><br><span class="line">       },</span><br><span class="line">     #wx_elem_cfg{</span><br><span class="line">        id = <span class="number">104</span>, name = <span class="string">&quot;FLASH&quot;</span>, type = button,</span><br><span class="line">        start_cmd_list = [?START_FLASH_CMD],</span><br><span class="line">        over_cmd_list = [{call, {main, flash_stop, []}}],</span><br><span class="line">        node = ?NODE_FLASH</span><br><span class="line">       },</span><br><span class="line">     #wx_elem_cfg{</span><br><span class="line">        id = <span class="number">105</span>, name = <span class="string">&quot;一键启动所有服&quot;</span>, type = button,</span><br><span class="line">        start_cmd_list = [</span><br><span class="line">                          ?START_FLASH_CMD,</span><br><span class="line">                          ?START_MGR_CMD,</span><br><span class="line">                          ?START_CROSS_CMD,</span><br><span class="line">                          ?START_GAME_CMD</span><br><span class="line">                         ],</span><br><span class="line">        node = undefined</span><br><span class="line">       },</span><br><span class="line">     #wx_elem_cfg{</span><br><span class="line">        id = <span class="number">106</span>, name = <span class="string">&quot;编译&quot;</span>, type = button,</span><br><span class="line">        start_cmd_list = [?START_MAKE],</span><br><span class="line">        node = undefined</span><br><span class="line">       },</span><br><span class="line">     #wx_elem_cfg{</span><br><span class="line">        id = <span class="number">1061</span>, name = <span class="string">&quot;编译功能&quot;</span>, type = button,</span><br><span class="line">        start_cmd_list = [?START_MAKE_FUNC],</span><br><span class="line">        node = undefined</span><br><span class="line">       },</span><br><span class="line">     #wx_elem_cfg{</span><br><span class="line">        id = <span class="number">107</span>, name = <span class="string">&quot;玩家列表&quot;</span>, type = button,</span><br><span class="line">        start_cmd_list = [{mfa, {<span class="keyword">fun</span> wx_misc:launchDefaultBrowser/<span class="number">1</span>, [?URL_PLAYER_LIST]}}],</span><br><span class="line">        node = undefined</span><br><span class="line">       },</span><br><span class="line">     #wx_elem_cfg{</span><br><span class="line">        id = <span class="number">108</span>, name = <span class="string">&quot;DEBUG_GAME&quot;</span>, type = button,</span><br><span class="line">        start_cmd_list = [?START_GAME_DEBUG],</span><br><span class="line">        node = undefined</span><br><span class="line">       },</span><br><span class="line">     #wx_elem_cfg{</span><br><span class="line">        id = <span class="number">109</span>, name = <span class="string">&quot;DEBUG_CROSS&quot;</span>, type = button,</span><br><span class="line">        start_cmd_list = [?START_CROSS_DEBUG],</span><br><span class="line">        node = undefined</span><br><span class="line">       },</span><br><span class="line">     #wx_elem_cfg{</span><br><span class="line">        id = <span class="number">110</span>, name = <span class="string">&quot;DEBUG_MGR&quot;</span>, type = button,</span><br><span class="line">        start_cmd_list = [?START_MGR_DEBUG],</span><br><span class="line">        node = undefined</span><br><span class="line">       },</span><br><span class="line">     #wx_elem_cfg{</span><br><span class="line">        id = <span class="number">111</span>, name = <span class="string">&quot;DEBUG_GUI&quot;</span>, type = button,</span><br><span class="line">        start_cmd_list = [?START_GUI_DEBUG],</span><br><span class="line">        node = undefined</span><br><span class="line">       }</span><br><span class="line">    ].</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 日志列表, 纵向排序</span></span><br><span class="line">wx_text_list() -&gt;</span><br><span class="line">    [</span><br><span class="line">     #wx_elem_cfg{</span><br><span class="line">        id = <span class="number">201</span>, type = text, name = <span class="string">&quot;游戏服日志&quot;</span>,</span><br><span class="line">        log_file = ?FILE_GAME_LOG</span><br><span class="line">       },</span><br><span class="line">     #wx_elem_cfg{</span><br><span class="line">        id = <span class="number">202</span>, type = text, name = <span class="string">&quot;跨服日志&quot;</span>,</span><br><span class="line">        log_file = ?FILE_CROSS_LOG</span><br><span class="line">       }</span><br><span class="line">    ].</span><br><span class="line"></span><br><span class="line">main(Args) -&gt;</span><br><span class="line">    parse_args(Args),</span><br><span class="line">    application:load({application, ?APP_NAME, []}),</span><br><span class="line">    set_env(parent_pid, self()),</span><br><span class="line">    ?DEBUG_MSG(<span class="string">&quot;欢迎使用GUI版, Powered by kingwen0302&quot;</span>),</span><br><span class="line">    <span class="keyword">case</span> get_env(log_file) <span class="keyword">of</span></span><br><span class="line">        undefined -&gt; ?DEBUG_MSG(<span class="string">&quot;缺少log_file配置&quot;</span>);</span><br><span class="line">        LogFile -&gt;</span><br><span class="line">            {ok, IO} = file:open(LogFile, [append]),</span><br><span class="line">            set_env(log_pid, IO)</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    State = make_window(),</span><br><span class="line">    self() ! {chk},</span><br><span class="line">    loop (State).</span><br><span class="line"></span><br><span class="line">make_window() -&gt;</span><br><span class="line">    <span class="keyword">case</span> get_env(project_root) <span class="keyword">of</span></span><br><span class="line">        undefined -&gt; ?DEBUG_MSG(<span class="string">&quot;缺少project_root配置&quot;</span>);</span><br><span class="line">        Dir -&gt; file:set_cwd(Dir)</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    {ok, RootDir} = file:get_cwd(),</span><br><span class="line">    ?DEBUG_MSG(<span class="string">&quot;项目目录: ~s&quot;</span>, [RootDir]),</span><br><span class="line">    Server = wx:new(),</span><br><span class="line">    Frame = wxFrame:new(Server,</span><br><span class="line">                        -<span class="number">1</span>,</span><br><span class="line">                        <span class="string">&quot;QQJY-国服-开发-节点管理 POWERED BY kingwen0302&quot;</span>,</span><br><span class="line">                        [{size,{<span class="number">0</span>, <span class="number">0</span>}}, {style, ?wxDEFAULT_FRAME_STYLE bor ?wxMAXIMIZE}]</span><br><span class="line">                       ),</span><br><span class="line">    Panel = wxScrolledWindow:new(Frame),</span><br><span class="line">    wxPanel:setBackgroundColour(Panel, ?wxLIGHT_GREY),</span><br><span class="line"></span><br><span class="line">    Sz = wxBoxSizer:new(?wxVERTICAL),</span><br><span class="line"></span><br><span class="line">    ButtonSizer = wxStaticBoxSizer:new(?wxHORIZONTAL, Panel, [{label, <span class="string">&quot;命令按钮&quot;</span>}]),</span><br><span class="line"></span><br><span class="line">    StockSz = wxGridSizer:new(<span class="number">0</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">3</span>),</span><br><span class="line"></span><br><span class="line">    BtnList = create_btn_list(Panel, wx_btn_list()),</span><br><span class="line">    SzFlags = [{proportion, <span class="number">0</span>}, {border, <span class="number">4</span>}, {flag, ?wxALL}],</span><br><span class="line">    [wxSizer:add(StockSz, Btn, SzFlags) || #wx_elem_state{wx = Btn} &lt;- BtnList],</span><br><span class="line">    wxSizer:add(ButtonSizer, StockSz, SzFlags),</span><br><span class="line"></span><br><span class="line">    Log = wxTextCtrl:new(Panel, <span class="number">0</span>, [</span><br><span class="line">                                                    {size, {<span class="number">1000</span>, <span class="number">100</span>}},</span><br><span class="line">                                                    {style, ?wxTE_READONLY bor ?wxTE_MULTILINE}</span><br><span class="line">                                                   ]),</span><br><span class="line">    wxSizer:add(ButtonSizer, Log, SzFlags),</span><br><span class="line">    wxSizer:add(Sz, ButtonSizer, SzFlags),</span><br><span class="line"></span><br><span class="line">    TextList = create_text_list(Panel, wx_text_list()),</span><br><span class="line">    Expand  = [{proportion, <span class="number">0</span>}, {border, <span class="number">4</span>}, {flag, ?wxALL bor ?wxEXPAND}],</span><br><span class="line">    Fun = <span class="keyword">fun</span>(#wx_elem_state{id = Id, wx = Text}) -&gt;</span><br><span class="line">                  Name = <span class="keyword">case</span> lists:keyfind(Id, #wx_elem_cfg.id, wx_text_list()) <span class="keyword">of</span></span><br><span class="line">                             #wx_elem_cfg{name = Name1} -&gt; Name1;</span><br><span class="line">                             _ -&gt; <span class="string">&quot;&quot;</span></span><br><span class="line">                         <span class="keyword">end</span>,</span><br><span class="line">                  TextSizer = wxStaticBoxSizer:new(?wxVERTICAL, Panel, [{label, Name}]),</span><br><span class="line">                  wxSizer:add(TextSizer, Text, Expand),</span><br><span class="line">                  {TextSizer, Expand}</span><br><span class="line">          <span class="keyword">end</span>,</span><br><span class="line">    [wxSizer:add(Sz, TextSizer, Flag) || {TextSizer, Flag} &lt;- lists:map(Fun, TextList)],</span><br><span class="line"></span><br><span class="line">    wxWindow:setSizer(Panel, Sz),</span><br><span class="line">    wxSizer:layout(Sz),</span><br><span class="line">    wxWindow:refresh(Panel),</span><br><span class="line">    wxScrolledWindow:setScrollRate(Panel, <span class="number">5</span>, <span class="number">5</span>),</span><br><span class="line"></span><br><span class="line">    wxFrame:show(Frame),</span><br><span class="line"></span><br><span class="line">    wxFrame:connect(Frame, close_window),</span><br><span class="line">    wxPanel:connect(Panel, command_button_clicked),</span><br><span class="line"></span><br><span class="line">    #state{frame = Frame, btn_list = BtnList, text_list = TextList, log_wx = Log, pid = self()}.</span><br><span class="line"></span><br><span class="line">loop(State) -&gt;</span><br><span class="line">    <span class="keyword">receive</span></span><br><span class="line">        Msg -&gt;</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">catch</span> do_loop(Msg, State) <span class="keyword">of</span></span><br><span class="line">                {&#x27;EXIT&#x27;, Reason} -&gt;</span><br><span class="line">                    ?DEBUG_MSG(<span class="string">&quot;Msg:~p Reason:~p&quot;</span>, [Msg, Reason]),</span><br><span class="line">                    loop(State);</span><br><span class="line">                _ -&gt;</span><br><span class="line">                    loop(State)</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 退出界面</span></span><br><span class="line">do_loop(#wx{event=#wxClose{}}, #state{pid = Pid} = State) -&gt;</span><br><span class="line">    <span class="keyword">if</span></span><br><span class="line">        Pid =/= self() -&gt; Pid ! { -<span class="number">1</span> };</span><br><span class="line">        <span class="literal">true</span> -&gt; ok</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    ?DEBUG_MSG(<span class="string">&quot;~p Closing window&quot;</span>,[self()]),</span><br><span class="line">    close(State),</span><br><span class="line">    ok;</span><br><span class="line"><span class="comment">%% 退出界面</span></span><br><span class="line">do_loop(#wx{id = ?wxID_EXIT, event=#wxCommand{type = command_button_clicked} }, #state{pid = Pid} = State) -&gt;</span><br><span class="line">    <span class="keyword">if</span></span><br><span class="line">        Pid =/= self() -&gt; Pid ! { -<span class="number">1</span> };</span><br><span class="line">        <span class="literal">true</span> -&gt; ok</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    ?DEBUG_MSG(<span class="string">&quot;~p Closing window&quot;</span>,[self()]),</span><br><span class="line">    close(State),</span><br><span class="line">    ok;</span><br><span class="line"><span class="comment">%% 按钮点击</span></span><br><span class="line">do_loop(#wx{id =Id, event=#wxCommand{type = command_button_clicked}}, #state{btn_list = BtnList} = State) -&gt;</span><br><span class="line">    Cfg = lists:keyfind(Id, #wx_elem_cfg.id, wx_btn_list()),</span><br><span class="line">    <span class="keyword">case</span> is_record(Cfg, wx_elem_cfg) <span class="keyword">of</span></span><br><span class="line">        <span class="literal">false</span> -&gt; throw(ok);</span><br><span class="line">        <span class="literal">true</span> -&gt; skip</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    #wx_elem_cfg{start_cmd_list = StartCmdList, over_cmd_list = OverCmdList, node = Node} = Cfg,</span><br><span class="line">    Fun = <span class="keyword">fun</span>(Cmd) <span class="keyword">when</span> is_list(Cmd) -&gt;</span><br><span class="line">                  ?DEBUG_MSG(<span class="string">&quot;字符串命令: ~p&quot;</span>, [Cmd]),</span><br><span class="line">                  spawn(<span class="keyword">fun</span>() -&gt; os:cmd(Cmd) <span class="keyword">end</span>);</span><br><span class="line">             ({call, {M, F, A}}) -&gt;</span><br><span class="line">                  ?DEBUG_MSG(<span class="string">&quot;节点Call: rpc:call(~p, ~p, ~p, ~p)&quot;</span>, [Node, M, F, A]),</span><br><span class="line">                  rpc:call(Node, M, F, A);</span><br><span class="line">             ({mfa, {M, F, A}}) -&gt;</span><br><span class="line">                  ?DEBUG_MSG(<span class="string">&quot;函数调用: ~p:~p Args:~p&quot;</span>, [M, F, A]),</span><br><span class="line">                  apply(M, F, A);</span><br><span class="line">             ({mfa, {F, A}}) -&gt;</span><br><span class="line">                  ?DEBUG_MSG(<span class="string">&quot;函数调用: ~p Args:~p&quot;</span>, [F, A]),</span><br><span class="line">                  apply(F, A)</span><br><span class="line">          <span class="keyword">end</span>,</span><br><span class="line">    <span class="keyword">case</span> lists:keyfind(Id, #wx_elem_state.id, BtnList) <span class="keyword">of</span></span><br><span class="line">        #wx_elem_state{status = over} -&gt;</span><br><span class="line">            ?DEBUG_MSG(<span class="string">&quot;开始 ~p&quot;</span>, [Id]),</span><br><span class="line">            lists:foreach(Fun, StartCmdList);</span><br><span class="line">        #wx_elem_state{status = start} -&gt;</span><br><span class="line">            ?DEBUG_MSG(<span class="string">&quot;关闭 ~p&quot;</span>, [Id]),</span><br><span class="line">            lists:foreach(Fun, OverCmdList);</span><br><span class="line">        _ -&gt; skip</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    loop(State);</span><br><span class="line"><span class="comment">%% 定时检查</span></span><br><span class="line">do_loop({chk}, #state{btn_list = BtnList, text_list = TextList, pid = Pid} = State) -&gt;</span><br><span class="line">    Fun = <span class="keyword">fun</span>(#wx_elem_state{id = Id, wx = Text, log_pid = LogPid} = Elem) -&gt;</span><br><span class="line">                  TailEXE = os:find_executable(<span class="string">&quot;tail&quot;</span>),</span><br><span class="line">                  <span class="keyword">case</span> lists:keyfind(Id, #wx_elem_cfg.id, wx_text_list()) <span class="keyword">of</span></span><br><span class="line">                      #wx_elem_cfg{log_file = LogFile} <span class="keyword">when</span> TailEXE =:= <span class="literal">false</span> -&gt;</span><br><span class="line">                          read_line(Id, Text, LogFile),</span><br><span class="line">                          Elem;</span><br><span class="line">                      #wx_elem_cfg{log_file = LogFile} <span class="keyword">when</span> LogPid =:= undefined -&gt;</span><br><span class="line">                          NewLogPid = spawn_link(<span class="keyword">fun</span>() -&gt; read_line_by_tail(Pid, TailEXE, Id, LogFile) <span class="keyword">end</span>),</span><br><span class="line">                          Elem#wx_elem_state{log_pid = NewLogPid};</span><br><span class="line">                      _ -&gt; Elem</span><br><span class="line">                  <span class="keyword">end</span></span><br><span class="line">          <span class="keyword">end</span>,</span><br><span class="line">    NewTextList = lists:map(Fun, TextList),</span><br><span class="line"></span><br><span class="line">    Fun1 = <span class="keyword">fun</span>(#wx_elem_state{id = Id, wx = Btn} = Elem) -&gt;</span><br><span class="line">                   <span class="keyword">case</span> lists:keyfind(Id, #wx_elem_cfg.id, wx_btn_list()) <span class="keyword">of</span></span><br><span class="line">                       #wx_elem_cfg{name = Name, node = Node} <span class="keyword">when</span> Node =/= undefined -&gt;</span><br><span class="line">                           <span class="keyword">case</span> net_adm:ping(Node) <span class="keyword">of</span></span><br><span class="line">                               pong -&gt;</span><br><span class="line">                                   wxButton:setLabel(Btn, ?CLOSE_STR ++ Name),</span><br><span class="line">                                   Elem#wx_elem_state{status = start};</span><br><span class="line">                               _ -&gt;</span><br><span class="line">                                   wxButton:setLabel(Btn, ?START_STR ++ Name),</span><br><span class="line">                                   Elem#wx_elem_state{status = over}</span><br><span class="line">                           <span class="keyword">end</span>;</span><br><span class="line">                       _ -&gt; Elem</span><br><span class="line">                   <span class="keyword">end</span></span><br><span class="line">           <span class="keyword">end</span>,</span><br><span class="line">    NewBtnList = lists:map(Fun1, BtnList),</span><br><span class="line">    NewState = State#state{btn_list = NewBtnList, text_list = NewTextList},</span><br><span class="line">    <span class="comment">%% 执行完成后在开启下次定时器</span></span><br><span class="line">    erlang:send_after(<span class="number">2000</span>, self(), {chk}),</span><br><span class="line">    loop(NewState);</span><br><span class="line"><span class="comment">%% 使用port的日志输出</span></span><br><span class="line">do_loop({log, Id, Data}, #state{text_list = TextList} = State) -&gt;</span><br><span class="line">    <span class="keyword">case</span> lists:keyfind(Id, #wx_elem_state.id, TextList) <span class="keyword">of</span></span><br><span class="line">        #wx_elem_state{wx = Text} -&gt;</span><br><span class="line">            wxTextCtrl:appendText(Text, Data ++ <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        _ -&gt;</span><br><span class="line">            ?DEBUG_MSG(<span class="string">&quot;Log: Id:~p&quot;</span>, [Id])</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    loop(State);</span><br><span class="line">do_loop({log_wx, Str}, #state{log_wx = Text} = State) -&gt;</span><br><span class="line">    wxTextCtrl:appendText(Text, Str),</span><br><span class="line">    loop(State);</span><br><span class="line">do_loop(Msg, State) -&gt;</span><br><span class="line">    ?DEBUG_MSG(<span class="string">&quot;not match:~p&quot;</span>, [Msg]),</span><br><span class="line">    loop(State).</span><br><span class="line"></span><br><span class="line">read_line_by_tail(Pid, TailEXE, Id, LogFile) -&gt;</span><br><span class="line">    process_flag(trap_exit, true),</span><br><span class="line">    PortOptions = [</span><br><span class="line">                   exit_status,</span><br><span class="line">                   {line, <span class="number">1024</span>},</span><br><span class="line">                   {args, [<span class="string">&quot;-F&quot;</span>, LogFile]},</span><br><span class="line">                   in</span><br><span class="line">                  ],</span><br><span class="line">    Port = erlang:open_port({spawn_executable, TailEXE}, PortOptions),</span><br><span class="line">    read_line_by_tail_loop(Pid, Id, Port).</span><br><span class="line">read_line_by_tail_loop(Pid, Id, Port) -&gt;</span><br><span class="line">    <span class="keyword">receive</span></span><br><span class="line">        {Port, {data, {eol, Data}}} -&gt;</span><br><span class="line">            Pid ! {log, Id, Data},</span><br><span class="line">            read_line_by_tail_loop(Pid, Id, Port);</span><br><span class="line">        {Port, {data, {noeol, Data}}} -&gt;</span><br><span class="line">            Pid ! {log, Id, Data},</span><br><span class="line">            read_line_by_tail_loop(Pid, Id, Port);</span><br><span class="line">        {close} -&gt;</span><br><span class="line">            <span class="comment">%% 结束端口开的系统进程</span></span><br><span class="line">            PortInfo = erlang:port_info(Port),</span><br><span class="line">            erlang:port_close(Port),</span><br><span class="line">            <span class="keyword">case</span> proplists:get_value(os_pid, PortInfo) <span class="keyword">of</span></span><br><span class="line">                undefined -&gt; skip;</span><br><span class="line">                OsPid -&gt; kill_by_os(OsPid)</span><br><span class="line">            <span class="keyword">end</span>,</span><br><span class="line">            ok;</span><br><span class="line">        Any -&gt;</span><br><span class="line">            ?DEBUG_MSG(<span class="string">&quot;Any:~p&quot;</span>, [Any]),</span><br><span class="line">            read_line_by_tail_loop(Pid, Id, Port)</span><br><span class="line">    <span class="keyword">end</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 自己实现的输出</span></span><br><span class="line"><span class="comment">%% 在没有tail的情况下使用</span></span><br><span class="line">read_line(Id, Text, File) -&gt;</span><br><span class="line">    MaxLine = <span class="keyword">case</span> get_env({max_line, Id, File}) <span class="keyword">of</span></span><br><span class="line">                  undefined -&gt; max_line(File) - ?SHOW_LINES_INIT;</span><br><span class="line">                  MaxLine1 -&gt; MaxLine1</span><br><span class="line">              <span class="keyword">end</span>,</span><br><span class="line">    OldCTime = <span class="keyword">case</span> get_env({ctime, Id, File}) <span class="keyword">of</span></span><br><span class="line">                   undefined -&gt; get_ctime(File);</span><br><span class="line">                   CTime1 -&gt; CTime1</span><br><span class="line">               <span class="keyword">end</span>,</span><br><span class="line"></span><br><span class="line">    NowCtime = get_ctime(File),</span><br><span class="line">    MaxLine = <span class="keyword">case</span> OldCTime =:= NowCtime <span class="keyword">of</span></span><br><span class="line">                  <span class="literal">true</span> -&gt; MaxLine;</span><br><span class="line">                  <span class="literal">false</span> -&gt;</span><br><span class="line">                      set_env({max_line, Id, File}, <span class="number">0</span>),</span><br><span class="line">                      <span class="number">0</span></span><br><span class="line">              <span class="keyword">end</span>,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> file:open(File, [read]) <span class="keyword">of</span></span><br><span class="line">        {ok, FD} -&gt;</span><br><span class="line">            set_env({max_line, Id, File}, MaxLine),</span><br><span class="line">            read_line(Id, Text, File, FD, <span class="number">1</span>, MaxLine);</span><br><span class="line">        _ -&gt;</span><br><span class="line">            set_env({max_line, Id, File}, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">end</span>.</span><br><span class="line">read_line(Id, Text, File, FD, Line, MaxLine) -&gt;</span><br><span class="line">    <span class="keyword">case</span> file:read_line(FD) <span class="keyword">of</span></span><br><span class="line">        {ok, Data} <span class="keyword">when</span> Line &gt; MaxLine -&gt;</span><br><span class="line">            wxTextCtrl:appendText(Text, Data),</span><br><span class="line">            set_env({max_line, Id, File}, Line),</span><br><span class="line">            read_line(Id, Text, File, FD, Line + <span class="number">1</span>, MaxLine);</span><br><span class="line">        {ok, _Data} -&gt;</span><br><span class="line">            read_line(Id, Text, File, FD, Line + <span class="number">1</span>, MaxLine);</span><br><span class="line">        eof -&gt;</span><br><span class="line">            file:close(FD)</span><br><span class="line">    <span class="keyword">end</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 获取文件最大行数</span></span><br><span class="line">max_line(File) -&gt;</span><br><span class="line">    <span class="keyword">case</span> file:open(File, [read]) <span class="keyword">of</span></span><br><span class="line">        {ok, FD} -&gt; max_line(FD, <span class="number">0</span>);</span><br><span class="line">        _ -&gt; <span class="number">0</span></span><br><span class="line">    <span class="keyword">end</span>.</span><br><span class="line">max_line(FD, Line) -&gt;</span><br><span class="line">    <span class="keyword">case</span> file:read_line(FD) <span class="keyword">of</span></span><br><span class="line">        {ok, _Data} -&gt;</span><br><span class="line">            max_line(FD, Line + <span class="number">1</span>);</span><br><span class="line">        eof -&gt;</span><br><span class="line">            file:close(FD),</span><br><span class="line">            Line</span><br><span class="line">    <span class="keyword">end</span>.</span><br><span class="line"></span><br><span class="line">get_ctime(File) -&gt;</span><br><span class="line">    <span class="keyword">case</span> file:read_file_info(File) <span class="keyword">of</span></span><br><span class="line">        {ok, #file_info{ctime = Ctime}} -&gt; Ctime;</span><br><span class="line">        _ -&gt; undefined</span><br><span class="line">    <span class="keyword">end</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 创建按钮</span></span><br><span class="line">create_btn_list(Panel, CfgList) -&gt;</span><br><span class="line">    Fun = <span class="keyword">fun</span>(#wx_elem_cfg{id = Id, name = Name}) -&gt;</span><br><span class="line">                  Btn = wxButton:new(Panel, Id, [{label, Name}, {size, {?BUTTON_SIZE_X, ?BUTTON_SIZE_Y}}]),</span><br><span class="line">                  <span class="comment">%% Btn = wxButton:new(Panel, Id, [{label, Name}]),</span></span><br><span class="line">                  #wx_elem_state{id = Id, wx = Btn}</span><br><span class="line">          <span class="keyword">end</span>,</span><br><span class="line">    lists:map(Fun, CfgList).</span><br><span class="line"><span class="comment">%% 创建日志框</span></span><br><span class="line">create_text_list(Panel, CfgList) -&gt;</span><br><span class="line">    Fun = <span class="keyword">fun</span>(#wx_elem_cfg{id = Id}) -&gt;</span><br><span class="line">                  Text = wxTextCtrl:new(Panel, Id, [</span><br><span class="line">                                                    {size, {?TEXT_SIZE_X, ?TEXT_SIZE_Y}},</span><br><span class="line">                                                    {style, ?wxTE_READONLY bor ?wxTE_MULTILINE}</span><br><span class="line">                                                   ]),</span><br><span class="line">                  <span class="comment">%% TextAttr = wxTextAttr:new(),</span></span><br><span class="line">                  <span class="comment">%% wxTextAttr:setBackgroundColour(TextAttr, {255, 0, 0}),</span></span><br><span class="line">                  <span class="comment">%% wxTextAttr:setFont(TextAttr, wxFont:new(20, ?wxDEFAULT, ?wxFONTSTYLE_NORMAL, ?wxFONTWEIGHT_NORMAL)),</span></span><br><span class="line">                  <span class="comment">%% %% TextAttr = wxTextAttr:new({255, 0, 0}, [</span></span><br><span class="line">                  <span class="comment">%% %%                             {colBack, {255, 0, 0}},</span></span><br><span class="line">                  <span class="comment">%% %%                             {font, wxFont:new(20, ?wxDEFAULT, ?wxFONTSTYLE_NORMAL, ?wxFONTWEIGHT_NORMAL)}</span></span><br><span class="line">                  <span class="comment">%% %%                            ]),</span></span><br><span class="line">                  <span class="comment">%% wxTextCtrl:setDefaultStyle(Text, TextAttr),</span></span><br><span class="line">                  #wx_elem_state{id = Id, wx = Text}</span><br><span class="line">          <span class="keyword">end</span>,</span><br><span class="line">    lists:map(Fun, CfgList).</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 界面关闭</span></span><br><span class="line">close(#state{frame = Frame, text_list = TextList}) -&gt;</span><br><span class="line">    Fun = <span class="keyword">fun</span>(#wx_elem_state{log_pid = Pid}) -&gt; Pid ! {close} <span class="keyword">end</span>,</span><br><span class="line">    lists:foreach(Fun, TextList),</span><br><span class="line">    timer:sleep(<span class="number">500</span>),</span><br><span class="line">    wxWindow:destroy(Frame),</span><br><span class="line">    wx:destroy(),</span><br><span class="line">    <span class="keyword">case</span> get_env(log_pid) <span class="keyword">of</span></span><br><span class="line">        undefined -&gt; skip;</span><br><span class="line">        IO -&gt; file:close(IO)</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    kill_by_os(os:getpid()),</span><br><span class="line">    ok.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 结束系统进程</span></span><br><span class="line">kill_by_os(OsPid) -&gt;</span><br><span class="line">    <span class="keyword">case</span> os:type() <span class="keyword">of</span></span><br><span class="line">        {win32, _} -&gt;</span><br><span class="line">            os:cmd(lists:concat([<span class="string">&quot;tskill &quot;</span>, OsPid]));</span><br><span class="line">        _ -&gt;</span><br><span class="line">            os:cmd(lists:concat([<span class="string">&quot;kill -9 &quot;</span>, OsPid]))</span><br><span class="line">    <span class="keyword">end</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 时间格式化</span></span><br><span class="line">time_format() -&gt;</span><br><span class="line">    {{Y, M, D}, {HH, MM, SS}} = calendar:universal_time_to_local_time(calendar:universal_time()),</span><br><span class="line">    I2L = <span class="keyword">fun</span>(I) <span class="keyword">when</span> I &lt; <span class="number">10</span>  -&gt; [$<span class="number">0</span>, $<span class="number">0</span>+I];</span><br><span class="line">             (I)              -&gt; integer_to_list(I)</span><br><span class="line">          <span class="keyword">end</span>,</span><br><span class="line">    io_lib:format(<span class="string">&quot;~s-~s-~s ~s:~s:~s&quot;</span>, [I2L(Y), I2L(M), I2L(D), I2L(HH), I2L(MM), I2L(SS)]).</span><br><span class="line"></span><br><span class="line">parse_args([]) -&gt; ok;</span><br><span class="line">parse_args([Help|_]) <span class="keyword">when</span> Help =:= <span class="string">&quot;-h&quot;</span>;</span><br><span class="line">                          Help =:= <span class="string">&quot;--help&quot;</span> -&gt;</span><br><span class="line">    ?DEBUG_MSG(<span class="string">&quot;================================================&quot;</span>),</span><br><span class="line">    ?DEBUG_MSG(<span class="string">&quot;Args: --log_file FileName --project_root CfgDir &quot;</span>),</span><br><span class="line">    ?DEBUG_MSG(<span class="string">&quot;================================================&quot;</span>),</span><br><span class="line">    halt(<span class="number">0</span>);</span><br><span class="line">parse_args([<span class="string">&quot;--log_file&quot;</span>, FileName|OtherArgs]) -&gt;</span><br><span class="line">    set_env(log_file, FileName),</span><br><span class="line">    parse_args(OtherArgs);</span><br><span class="line">parse_args([<span class="string">&quot;--project_root&quot;</span>, DirName|OtherArgs]) -&gt;</span><br><span class="line">    set_env(project_root, DirName),</span><br><span class="line">    parse_args(OtherArgs);</span><br><span class="line">parse_args([_PosPar|OtherArgs]) -&gt;</span><br><span class="line">    parse_args(OtherArgs).</span><br><span class="line"></span><br><span class="line">set_env(Key, Val) -&gt;</span><br><span class="line">    application:set_env(?APP_NAME, Key, Val).</span><br><span class="line">get_env(Key) -&gt; get_env(Key, undefined).</span><br><span class="line">get_env(Key, Default) -&gt;</span><br><span class="line">    application:get_env(?APP_NAME, Key, Default).</span><br></pre></td></tr></table></figure><figure class="highlight bat"><figcaption><span>server_ctl_gui.bat</span><a href="/downloads/code/server_ctl_gui.bat">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">set</span> FILE_DIR=%~dp0</span><br><span class="line">RunHiddenConsole escript <span class="variable">%FILE_DIR%</span>/server_ctl_gui.erl --log_file <span class="variable">%FILE_DIR%</span>/server_ctl_gui.log --project_root E:/qqjy/qqjy_server/config</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
          <category> wxWidgets </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
            <tag> wxWidgets </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下安装Let’s Encrypt证书</title>
      <link href="/2017/09/15/centos/centos-letsencrypt/"/>
      <url>/2017/09/15/centos/centos-letsencrypt/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>自己搭建的网站提示不安全,因此安装了下<code>Let’s Encrypt</code>证书</p><span id="more"></span><h3 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h3><p><code>python2.7</code> <strong>不需要</strong><br><code>python2.7</code> <strong>不需要</strong><br><code>python2.7</code> <strong>不需要</strong></p><p>重要的事情说三遍, 看有些文章说需要<code>python2.7</code><br>在centos6上折腾了许久,还是无法成功安装证书,试着删除python2.7,重新安装,一切ok</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/letsencrypt/letsencrypt</span><br><span class="line"><span class="built_in">cd</span> letsencrypt</span><br><span class="line">./letsencrypt-auto -email 你的邮件地址</span><br></pre></td></tr></table></figure><p>你的邮件地址是注册用的, 会有一个确认邮件发送到你的邮箱</p><p>按照提示,一步一步操作即可(<code>nginx-&gt;all_web-&gt;redirect</code>)</p><p>生成的文件默认在<code>/etc/letsencrypt</code>目录下</p><p><code>Let’s Encrypt</code>证书有效期是90天, 到期重新执行一遍就可以了<br>也可以使用命令<code>./letsencrypt-auto renew</code></p><p><code>https://github.com/letsencrypt/letsencrypt</code>实际上已经指向<code>https://github.com/certbot/certbot</code>,<br>在<code>https://certbot.eff.org/</code>似乎有更加友好的安装方式, 自己没有试过, 有精力的可以试下</p><p>但是由于自己搭建的个别网站存在<code>防止混合内容</code>, <code>https://</code>不可用, 没办法只好还原</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">if</span> ($scheme != <span class="string">&quot;http&quot;</span>) &#123;</span><br><span class="line">  <span class="attribute">return</span> <span class="number">301</span> http://$host$request_uri;</span><br><span class="line">&#125; <span class="comment"># managed by Certbot</span></span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://www.laozuo.org/7676.html">http://www.laozuo.org/7676.html</a></li><li><a href="http://www.jianshu.com/p/eaac0d082ba2">http://www.jianshu.com/p/eaac0d082ba2</a></li><li><code>帮助: ./letsencrypt-auto --help all</code></li><li><a href="https://letsencrypt.org/">https://letsencrypt.org/</a></li><li><a href="https://certbot.eff.org/">https://certbot.eff.org/</a></li><li><a href="http://www.laozuo.org/2573.html">http://www.laozuo.org/2573.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
          <category> Let’s Encrypt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> Let’s Encrypt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用shadowsocks + kcptun + privoxy搭建代理</title>
      <link href="/2017/07/15/other/other-shadowsocks/"/>
      <url>/2017/07/15/other/other-shadowsocks/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><table><thead><tr><th>socks5代理</th><th>加速</th><th>socks5转http(s)代理</th></tr></thead><tbody><tr><td>shadowsocks</td><td>kcptun(牺牲带宽)</td><td>privoxy</td></tr></tbody></table><span id="more"></span><h2 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h2><ol><li>国外服务器(<strong>搬瓦工有一键安装sock5服务的脚本</strong>)</li><li><a href="https://github.com/shadowsocks/shadowsocks-windows">https://github.com/shadowsocks/shadowsocks-windows</a></li><li><a href="https://github.com/xtaci/kcptun">https://github.com/xtaci/kcptun</a></li><li><a href="https://github.com/kuoruan/shell-scripts">https://github.com/kuoruan/shell-scripts</a></li><li><a href="https://www.privoxy.org/">https://www.privoxy.org/</a></li></ol><blockquote><p>如果是KVM的话, 可以开启<code>tcp_bbr</code>,速度会快很多, <code>OpenVZ</code>就没办法了,不支持</p></blockquote><h2 id="华为手机开启google-play"><a href="#华为手机开启google-play" class="headerlink" title="华为手机开启google play"></a>华为手机开启google play</h2><ol><li><code>手机管家</code> -&gt; <code>权限管理</code> -&gt; <code>应用</code> -&gt; <code>Google Play 商店</code> -&gt; <code>信任此应用</code></li><li><code>手机管家</code> -&gt; <code>权限管理</code> -&gt; <code>应用</code> -&gt; <code>Google Play services for Instant Apps</code> -&gt; <code>信用此应用</code></li><li>Shadowsocks配置文件<br><img src="/downloads/assets/shadowsocks.jpg" alt="代理Google开头的所有服务+下载管理器"></li></ol><h2 id="使用中遇到的问题"><a href="#使用中遇到的问题" class="headerlink" title="使用中遇到的问题"></a>使用中遇到的问题</h2><p>安装其他软件的时候，由于资源占用过高（毕竟只有512M），导致<code>shadowsocks</code>和<code>kcptun</code>异常退出，一直以为是<code>GFW</code>的原因，排查方法：</p><ol><li>检查<code>ps aux | grep kcptun</code>，<code>service supervisord status</code></li><li>检查<code>ps aux | grep ssserver</code></li></ol><p>如果没有启动，则重新启动</p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
            <tag> socks </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>生成pac文件</title>
      <link href="/2017/05/26/other/other-pac/"/>
      <url>/2017/05/26/other/other-pac/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install gfwlist2pac</span><br><span class="line">curl -o gfwlist.txt https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt</span><br><span class="line">gfwlist2pac -i gfwlist.txt -f pac.txt -p __PROXY__</span><br></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://github.com/itcook/gfwlist2pac">https://github.com/itcook/gfwlist2pac</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
            <tag> pac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>erlang下unix时间戳和日期转换</title>
      <link href="/2017/05/23/erlang/erlang-time/"/>
      <url>/2017/05/23/erlang/erlang-time/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>越南时区中,erlang中unix时间戳和日期转换问题</p><span id="more"></span><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>系统: <code>CENTOS 7</code><br>语言: <code>ERLANG OTP 17.5.3</code><br>时区: <code>Asia/Ho_Chi_Minh</code></p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>先来看一段代码</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% util.erl</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">-define</span><span class="params">(SECONDS_FROM_0_TO_1970, <span class="number">62167219200</span>)</span>.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">date_to_time</span><span class="params">(&#123;&#123;_Y, _M, _D&#125;, &#123;_H, _Mi, _S&#125;&#125; = Date)</span> -&gt;</span></span><br><span class="line">    calendar:datetime_to_gregorian_seconds(Date) -</span><br><span class="line">    calendar:datetime_to_gregorian_seconds(calendar:universal_time_to_local_time(&#123;&#123;<span class="number">1970</span>,<span class="number">1</span>,<span class="number">1</span>&#125;, &#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;&#125;)).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">seconds_to_localtime</span><span class="params">(Seconds)</span> -&gt;</span></span><br><span class="line">    DateTime = calendar:gregorian_seconds_to_datetime(Seconds+?SECONDS_FROM_0_TO_1970),</span><br><span class="line">    calendar:universal_time_to_local_time(DateTime).</span><br></pre></td></tr></table></figure><p>这是日期和unix时间戳互转的代码,貌似没错,运行大部分时间也没错<br>但是修改为<code>Asia/Ho_Chi_Minh</code>(东七区)(<code>cp -f /usr/share/zoneinfo/Asia/Ho_Chi_Minh /etc/localtime</code>)</p><p>查看时区也确实是<code>+0700</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# date -R</span><br><span class="line">Mon, 22 May 2017 19:02:21 +0700</span><br></pre></td></tr></table></figure><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&gt; util:seconds_to_localtime(<span class="number">0</span>).</span><br><span class="line">&#123;&#123;<span class="number">1970</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">8</span>,<span class="number">0</span>,<span class="number">0</span>&#125;&#125;</span><br></pre></td></tr></table></figure><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>经排查,发现<code>calendar:universal_time_to_local_time/1</code>存在问题</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">39&gt; calendar:universal_time_to_local_time(&#123;&#123;1970,1,1&#125;,&#123;0,0,0&#125;&#125;).</span><br><span class="line">&#123;&#123;1970,1,1&#125;,&#123;8,0,0&#125;&#125;</span><br><span class="line"></span><br><span class="line">%% 这里应该是&#123;7,0,0&#125;</span><br></pre></td></tr></table></figure><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>手动进行时区修正</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Now = erlang:now(),</span><br><span class="line">LocalTime = calendar:now_to_local_time(Now),</span><br><span class="line">UTCTime = calendar:now_to_universal_time(Now),</span><br><span class="line"></span><br><span class="line">calendar:datetime_to_gregorian_seconds(LocalTime) -</span><br><span class="line">calendar:datetime_to_gregorian_seconds(UTCTime).</span><br></pre></td></tr></table></figure><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% util.erl</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">-define</span><span class="params">(SECONDS_FROM_0_TO_1970, <span class="number">62167219200</span>)</span>.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">date_to_time</span><span class="params">(&#123;&#123;_Y, _M, _D&#125;, &#123;_H, _Mi, _S&#125;&#125; = Date)</span> -&gt;</span></span><br><span class="line">    Now = erlang:now(),</span><br><span class="line">    LocalTime = calendar:now_to_local_time(Now),</span><br><span class="line">    UTCTime = calendar:now_to_universal_time(Now),</span><br><span class="line">    </span><br><span class="line">    calendar:datetime_to_gregorian_seconds(Date) -</span><br><span class="line">    calendar:datetime_to_gregorian_seconds(&#123;&#123;<span class="number">1970</span>,<span class="number">1</span>,<span class="number">1</span>&#125;, &#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;&#125;) -</span><br><span class="line">    <span class="comment">%% 时区修正</span></span><br><span class="line">    calendar:datetime_to_gregorian_seconds(LocalTime) + </span><br><span class="line">    calendar:datetime_to_gregorian_seconds(UTCTime).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">seconds_to_localtime</span><span class="params">(Seconds)</span> -&gt;</span></span><br><span class="line">    Now = erlang:now(),</span><br><span class="line">    LocalTime = calendar:now_to_local_time(Now),</span><br><span class="line">    UTCTime = calendar:now_to_universal_time(Now),</span><br><span class="line"></span><br><span class="line">    Second1 = Seconds + ?SECONDS_FROM_0_TO_1970 + </span><br><span class="line">    <span class="comment">%% 时区修正</span></span><br><span class="line">    calendar:datetime_to_gregorian_seconds(LocalTime) - calendar:datetime_to_gregorian_seconds(UTCTime),</span><br><span class="line">    calendar:gregorian_seconds_to_datetime(Second1).</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell读取yaml文件</title>
      <link href="/2017/05/16/shell/shell-yaml/"/>
      <url>/2017/05/16/shell/shell-yaml/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Shell读取yaml文件</p><span id="more"></span><h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 非本人实现</span></span></span><br><span class="line">function parse_yaml &#123;</span><br><span class="line">   local prefix=$2</span><br><span class="line">   local s=&#x27;[[:space:]]*&#x27; w=&#x27;[a-zA-Z0-9_]*&#x27; fs=$(echo @|tr @ &#x27;\034&#x27;)</span><br><span class="line">   sed -ne &quot;s|^\($s\):|\1|&quot; \</span><br><span class="line">        -e &quot;s|^\($s\)\($w\)$s:$s[\&quot;&#x27;]\(.*\)[\&quot;&#x27;]$s\$|\1$fs\2$fs\3|p&quot; \</span><br><span class="line">        -e &quot;s|^\($s\)\($w\)$s:$s\(.*\)$s\$|\1$fs\2$fs\3|p&quot; $1 |</span><br><span class="line">   awk -F$fs &#x27;&#123;</span><br><span class="line">      indent = length($1)/2;</span><br><span class="line">      vname[indent] = $2;</span><br><span class="line">      for (i in vname) &#123;if (i &gt; indent) &#123;delete vname[i]&#125;&#125;</span><br><span class="line">      if (length($3) &gt; 0) &#123;</span><br><span class="line">         vn=&quot;&quot;; for (i=0; i&lt;indent; i++) &#123;vn=(vn)(vname[i])(&quot;_&quot;)&#125;</span><br><span class="line">         printf(&quot;%s%s%s=\&quot;%s\&quot;\n&quot;, &quot;&#x27;$prefix&#x27;&quot;,vn, $2, $3);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># $1 文件</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># $2 字首</span></span></span><br><span class="line">parse_yaml $1 $2</span><br></pre></td></tr></table></figure><p>可以配合<code>eval $(parse_yaml test.yaml)</code>将配置读出来</p><h2 id="已知问题"><a href="#已知问题" class="headerlink" title="已知问题"></a>已知问题</h2><p>该脚本无法读出下面的格式</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">things:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">first</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">second</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">third</span></span><br></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="http://stackoverflow.com/questions/5014632/how-can-i-parse-a-yaml-file-from-a-linux-shell-script">http://stackoverflow.com/questions/5014632/how-can-i-parse-a-yaml-file-from-a-linux-shell-script</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
            <tag> yaml </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS搭建ngrok服务</title>
      <link href="/2017/05/15/centos/centos-ngrok/"/>
      <url>/2017/05/15/centos/centos-ngrok/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>自建ngrok服务</p><span id="more"></span><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><h3 id="安装GOLANG"><a href="#安装GOLANG" class="headerlink" title="安装GOLANG"></a>安装GOLANG</h3><p>在<a href="https://golang.org/dl/">GOLANG</a>下载1.4.3(<strong>1.4.3在编译时简化很多,推荐使用</strong>)版本的安装包<br>使用<code>tar -C /usr/local  -xzf   go1.4.3.linux-386.tar.gz</code>安装到<code>/usr/local/go</code>目录下<br>并添加环境变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;export GOROOT=/usr/local/go&#x27;&gt;&gt; ~/.bashrc</span><br><span class="line">echo &#x27;export PATH=$PATH:$GOROOT/bin&#x27;&gt;&gt; ~/.bashrc</span><br><span class="line">source  $HOME/.bashrc</span><br></pre></td></tr></table></figure><p>输入命令<code>go</code>是否有帮助</p><h3 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h3><p>增加域名解析:</p><blockquote><p>A记录 tunnel.自己的域名 IP地址<br>A记录 *.tunnel.自己的域名 IP地址</p></blockquote><h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mercurial git bzr subversion</span><br></pre></td></tr></table></figure><h3 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h3><p>保证<code>443</code>,<code>4443</code>端口没有被占用</p><h2 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h2><h3 id="下载-amp-amp-配置"><a href="#下载-amp-amp-配置" class="headerlink" title="下载&amp;&amp;配置"></a>下载&amp;&amp;配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cd $HOME &amp;&amp; git clone https://github.com/inconshreveable/ngrok.git</span><br><span class="line">echo &#x27;export GOPATH=$HOME/ngrok&#x27;&gt;&gt; ~/.bashrc </span><br><span class="line">source  $HOME/.bashrc</span><br><span class="line"></span><br><span class="line">## export NGROK_DOMAIN=&quot;tunnel.mydomain.com&quot;</span><br><span class="line">export NGROK_DOMAIN=&quot;tunnel.自己的域名&quot;</span><br><span class="line"></span><br><span class="line">cd ngrok</span><br><span class="line"></span><br><span class="line">openssl genrsa -out rootCA.key 2048</span><br><span class="line">openssl req -x509 -new -nodes -key rootCA.key -subj &quot;/CN=$NGROK_DOMAIN&quot; -days 5000 -out rootCA.pem</span><br><span class="line">openssl genrsa -out device.key 2048</span><br><span class="line">openssl req -new -key device.key -subj &quot;/CN=$NGROK_DOMAIN&quot; -out device.csr</span><br><span class="line">openssl x509 -req -in device.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out device.crt -days 5000</span><br><span class="line">cp rootCA.pem assets/client/tls/ngrokroot.crt</span><br><span class="line">cp device.crt assets/server/tls/snakeoil.crt</span><br><span class="line">cp device.key assets/server/tls/snakeoil.key</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="交叉编译"><a href="#交叉编译" class="headerlink" title="交叉编译"></a>交叉编译</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">## do_make 没有验证</span><br><span class="line">## 但是流程是这样的</span><br><span class="line">## GOOS支持windows,linux,darwin</span><br><span class="line">## GOARCH支持386,amd64,arm</span><br><span class="line"></span><br><span class="line">## cd /usr/local/go/src/</span><br><span class="line">## GOOS=windows GOARCH=amd64 CGO_ENABLED=0 ./make.bash </span><br><span class="line">## cd ~/ngrok</span><br><span class="line">## GOOS=windows GOARCH=amd64 make release-server release-client</span><br><span class="line"></span><br><span class="line">function do_make()&#123;</span><br><span class="line">    GOOS=$1</span><br><span class="line">    GOARCH=$2</span><br><span class="line">    cd /usr/local/go/src/</span><br><span class="line">    GOOS=$&#123;GOOS&#125; GOARCH=$&#123;GOARCH&#125; CGO_ENABLED=0 ./make.bash</span><br><span class="line">    cd ~/ngrok</span><br><span class="line">    GOOS=$&#123;GOOS&#125; GOARCH=$&#123;GOARCH&#125; make release-server release-client</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">do_make linux 386</span><br><span class="line">do_make linux amd64</span><br><span class="line">do_make windows amd64</span><br><span class="line">do_make windows 386</span><br><span class="line">do_make darwin amd64</span><br></pre></td></tr></table></figure><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><h3 id="服务端启动"><a href="#服务端启动" class="headerlink" title="服务端启动"></a>服务端启动</h3><p><code>bin/ngrokd -domain=&quot;$NGROK_DOMAIN&quot; -httpAddr=&quot;:8000&quot;</code></p><h3 id="客户端启动"><a href="#客户端启动" class="headerlink" title="客户端启动"></a>客户端启动</h3><p>编辑<code>ngrok.cfg</code>文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server_addr: &quot;ngrok.自己的域名:4443&quot;</span><br><span class="line">trust_host_root_certs: false</span><br><span class="line"></span><br><span class="line">tunnels:</span><br><span class="line">    ssh:</span><br><span class="line">        remote_port: 40002</span><br><span class="line">        proto:</span><br><span class="line">            tcp: &quot;:22&quot;</span><br><span class="line">    web:</span><br><span class="line">        subdomain: aaa</span><br><span class="line">        proto:</span><br><span class="line">            http: &quot;:80&quot;</span><br></pre></td></tr></table></figure><p>ngrok –config=ngrok.cfg start ssh web</p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="http://www.tuicool.com/articles/ZraURrq">http://www.tuicool.com/articles/ZraURrq</a></li><li><a href="http://www.sunnyos.com/article-show-48.html">http://www.sunnyos.com/article-show-48.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> ngrok </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>utf8编码</title>
      <link href="/2017/05/09/erlang/erlang-unicode/"/>
      <url>/2017/05/09/erlang/erlang-unicode/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><code>Ỹ</code>是越南语<code>意大利</code>的意思(网上查的,未必准确,不过这个不是重点)<br>从字面上看应该是1个字符<br>用erlang转出来的list也应该是1个<br>BUT ….</p><span id="more"></span><p>通过<a href="http://utf8.supfree.net/">http://utf8.supfree.net/</a>，我们知道：中文<code>我</code>的utf8编码是<code>&amp;#x6211;</code>,对应的10进制是<code>25105</code>。<br>我们继续看字符<code>Ỹ</code>,这个转出来的是[89, 771]，<strong>怎么是两个字符呢？？？</strong></p><p>先来个测试:</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">t</span><span class="params">()</span> -&gt;</span></span><br><span class="line">    A = &lt;&lt;<span class="string">&quot;Ỹ&quot;</span>&gt;&gt;,</span><br><span class="line">    A1 = unicode:characters_to_list(A),</span><br><span class="line">    io:format(<span class="string">&quot;B1: ~w~n&quot;</span>, [A1]),</span><br><span class="line"></span><br><span class="line">    B = &lt;&lt;<span class="string">&quot;我&quot;</span>&gt;&gt;,</span><br><span class="line">    B1 = unicode:characters_to_list(B),</span><br><span class="line">    io:format(<span class="string">&quot;C1: ~w~n&quot;</span>, [B1]).</span><br></pre></td></tr></table></figure><p>执行结果:</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A1: [<span class="number">89</span>,<span class="number">771</span>]</span><br><span class="line">B1: [<span class="number">25105</span>]</span><br></pre></td></tr></table></figure><h2 id="unicode编码规则"><a href="#unicode编码规则" class="headerlink" title="unicode编码规则"></a>unicode编码规则</h2><table><thead><tr><th>Unicode编码(16进制)</th><th>UTF-8 字节流(二进制)</th></tr></thead><tbody><tr><td>000000 - 00007F</td><td>0xxxxxxx</td></tr><tr><td>000080 - 0007FF</td><td>110xxxxx 10xxxxxx</td></tr><tr><td>000800 - 00FFFF</td><td>1110xxxx 10xxxxxx 10xxxxxx</td></tr><tr><td>010000 - 10FFFF</td><td>11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</td></tr></tbody></table><p>上表是utf8的编码规则，具体含义请看<a href="http://blog.sina.com.cn/s/blog_63733daa0100qe9n.html">参考文档-1</a></p><h2 id="问题继续"><a href="#问题继续" class="headerlink" title="问题继续"></a>问题继续</h2><p>继续最开始的问题 …</p><p><code>771</code>对应的16进制是<code>0x303</code>，在<code>000080 - 0007FF</code>范围内，<br><code>771</code>对应的2进制是<code>01100 000011</code>，对应表得出，<code>110 01100(204)  10 000011(131)</code>, 最终编码是<code>0xCC83</code></p><p>同上，<code>89</code>对应的<code>01011001(89)</code>，最终编码是<code>0x59</code></p><p><strong>因此，尽管看起来是一个字符，实际上是两个utf8字符</strong></p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="http://blog.sina.com.cn/s/blog_63733daa0100qe9n.html">http://blog.sina.com.cn/s/blog_63733daa0100qe9n.html</a></li><li><a href="http://blog.csdn.net/sandyen/article/details/1108168">http://blog.csdn.net/sandyen/article/details/1108168</a></li><li><a href="http://utf8.supfree.net/">http://utf8.supfree.net/</a></li><li><a href="http://www.ynzd.org/">http://www.ynzd.org/</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
          <category> utf8 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
            <tag> utf8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo next主题坑</title>
      <link href="/2017/05/07/other/other-hexo-next/"/>
      <url>/2017/05/07/other/other-hexo-next/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>使用hexo搭建个人BLOG<br>使用next主题,<strong>不得不说这是一个错误的决定</strong>,尽管github上star还比较多,但是问题多多<br>如果您也打算使用hexo搭建个人BLOG的话,<strong>请谨慎使用next主题</strong></p><span id="more"></span><p>一个无法解决的问题,不是100%出现,但是绝大部分时间是会遇到的,能否顺利全看RP,蛋疼的要死!!!</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Unhandled rejection <span class="built_in">Error</span>: ENOENT: no such file or directory, open <span class="string">&#x27;D:\blog\blog_www_debug.mingilin.com\themes\next\layout\_scripts\schemes\.swig&#x27;</span></span><br><span class="line">    at <span class="built_in">Error</span> (native)</span><br><span class="line">    at <span class="built_in">Object</span>.fs.openSync (fs.js:<span class="number">640</span>:<span class="number">18</span>)</span><br><span class="line">    at <span class="built_in">Object</span>.fs.readFileSync (fs.js:<span class="number">508</span>:<span class="number">33</span>)</span><br><span class="line">    at <span class="built_in">Object</span>.ret.load (D:\blog\blog_www_debug.mingilin.com\node_modules\swig\lib\loaders\filesystem.js:<span class="number">55</span>:<span class="number">15</span>)</span><br><span class="line">    at compileFile (D:\blog\blog_www_debug.mingilin.com\node_modules\swig\lib\swig.js:<span class="number">695</span>:<span class="number">31</span>)</span><br><span class="line">    at <span class="built_in">Object</span>.eval [<span class="keyword">as</span> tpl] (<span class="built_in">eval</span> at &lt;anonymous&gt; (D:\blog\blog_www_debug.mingilin.com\node_modules\swig\lib\swig.js:<span class="number">498</span>:<span class="number">13</span>), &lt;anonymous&gt;:<span class="number">837</span>:<span class="number">18</span>)</span><br><span class="line">    at compiled (D:\blog\blog_www_debug.mingilin.com\node_modules\swig\lib\swig.js:<span class="number">619</span>:<span class="number">18</span>)</span><br><span class="line">    at _compiled (D:\blog\blog_www_debug.mingilin.com\node_modules\hexo\lib\theme\view.js:<span class="number">127</span>:<span class="number">30</span>)</span><br><span class="line">    at View.render (D:\blog\blog_www_debug.mingilin.com\node_modules\hexo\lib\theme\view.js:<span class="number">29</span>:<span class="number">15</span>)</span><br><span class="line">    at D:\blog\blog_www_debug.mingilin.com\node_modules\hexo\lib\hexo\index.js:<span class="number">390</span>:<span class="number">25</span></span><br><span class="line">    at tryCatcher (D:\blog\blog_www_debug.mingilin.com\node_modules\bluebird\js\release\util.js:<span class="number">16</span>:<span class="number">23</span>)</span><br><span class="line">    at D:\blog\blog_www_debug.mingilin.com\node_modules\bluebird\js\release\method.js:<span class="number">15</span>:<span class="number">34</span></span><br><span class="line">    at RouteStream._read (D:\blog\blog_www_debug.mingilin.com\node_modules\hexo\lib\hexo\router.js:<span class="number">134</span>:<span class="number">3</span>)</span><br><span class="line">    at RouteStream.Readable.read (_stream_readable.js:<span class="number">348</span>:<span class="number">10</span>)</span><br><span class="line">    at resume_ (_stream_readable.js:<span class="number">737</span>:<span class="number">12</span>)</span><br><span class="line">    at _combinedTickCallback (internal/process/next_tick.js:<span class="number">74</span>:<span class="number">11</span>)</span><br><span class="line">    at process._tickCallback (internal/process/next_tick.js:<span class="number">98</span>:<span class="number">9</span>)</span><br></pre></td></tr></table></figure><p>百度/GOOGLE了各种解决方案,下面是网上或者个人使用过的方案:</p><ol><li><a href="http://codebeautify.org/yaml-validator">yaml-validator</a></li><li>修改文件编码</li><li>试过在<code>:</code>后加<code>空格</code></li><li>确保<a href="http://codebeautify.org/yaml-validator">yaml-validator</a>检测通过后,去掉文件最后的空行</li><li>使用debug模式</li></ol><p><strong>但是问题依然存在</strong><br><strong>但是问题依然存在</strong><br><strong>但是问题依然存在</strong></p><p>有人有最终解决方案吗???</p><p><strong>现在一个临时的解决方案是在每次启动前手动改动主题目录下的<code>_config.yml</code>文件</strong></p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://github.com/iissnan/hexo-theme-next/issues/737">https://github.com/iissnan/hexo-theme-next/issues/737</a></li><li><a href="http://jianbing.github.io/2016/04/30/set-up-next/">http://jianbing.github.io/2016/04/30/set-up-next/</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu server修改为中文</title>
      <link href="/2017/05/06/ubuntu/ubuntu-zh/"/>
      <url>/2017/05/06/ubuntu/ubuntu-zh/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ubuntu server使用自己的<a href="https://github.com/kingwen0302/vim.git">vim配置</a>时,提示<code>Cannot set language to &quot;zh_CN.UTF-8&quot;</code>错误,需要修改语言环境.</p><span id="more"></span><p>具体错误如下:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vagrant@vagrant-ubuntu-trusty-64:~/.myvim/vimrc$ sudo vim /etc/default/locale </span><br><span class="line">Error detected while processing /home/vagrant/.myvim/vimrc/first.vim:</span><br><span class="line">line   14:</span><br><span class="line">E197: Cannot set language to &quot;zh_CN.UTF-8&quot;</span><br></pre></td></tr></table></figure><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ol><li><p>修改配置<br>编辑<code>/etc/default/locale</code>,修改为:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">## sudo vim /etc/default/locale</span><br><span class="line">LANG=&quot;zh_CN.UTF-8&quot;</span><br><span class="line">LANGUAGE=&quot;zh_CN:zh&quot;</span><br></pre></td></tr></table></figure></li><li><p>然后执行<code>sudo locale-gen zh_CN.UTF-8</code></p></li><li><p>问题解决</p></li></ol><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="http://blog.csdn.net/feihong247/article/details/7767889">http://blog.csdn.net/feihong247/article/details/7767889</a></li><li><a href="http://blog.sina.com.cn/s/blog_62dd23ed0100qzkl.html">http://blog.sina.com.cn/s/blog_62dd23ed0100qzkl.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu快速设置源</title>
      <link href="/2017/05/04/ubuntu/ubuntu-source/"/>
      <url>/2017/05/04/ubuntu/ubuntu-source/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ubuntu默认源下载速度偏慢,国内环境需要修改源.</p><span id="more"></span><h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#</span></span> </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 快速修改源为aliyun</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#</span></span></span><br><span class="line"></span><br><span class="line">if [[ &quot;$(grep &#x27;aliyun&#x27; /etc/apt/sources.list)&quot; != &quot;&quot; ]]; then</span><br><span class="line">    echo &quot;[ERROR]已经修改!!!&quot;</span><br><span class="line">    exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">sudo mv /etc/apt/sources.list /etc/apt/sources.list.old</span><br><span class="line">grep -v &#x27;^#&#x27; /etc/apt/sources.list.old \</span><br><span class="line">| grep -v &#x27;^$&#x27; \</span><br><span class="line">| sed -e &#x27;s/archive.ubuntu.com/mirrors.aliyun.com/&#x27; -e &#x27;s/security.ubuntu.com/mirrors.aliyun.com/&#x27; \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> ~/sources.list</span></span><br><span class="line">sudo mv ~/sources.list /etc/apt/sources.list</span><br><span class="line">echo &quot;[INFO]修改完成!!!&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 一行代码</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># sudo mv /etc/apt/sources.list /etc/apt/sources.list.old &amp;&amp; grep -v &#x27;^#&#x27; /etc/apt/sources.list.old | grep -v &#x27;^$&#x27; | sed -e &#x27;s/archive.ubuntu.com/mirrors.aliyun.com/&#x27; -e &#x27;s/security.ubuntu.com/mirrors.aliyun.com/&#x27; &gt; ~/sources.list &amp;&amp; sudo mv ~/sources.list /etc/apt/sources.list &amp;&amp; echo &quot;[INFO]修改完成!!!&quot;</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vagrant简单使用</title>
      <link href="/2017/04/25/windows/windows-vagrant/"/>
      <url>/2017/04/25/windows/windows-vagrant/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Vagrant是一个基于Ruby的工具，用于创建和部署虚拟化开发环境。<br>它使用Oracle的开源VirtualBox虚拟化系统，使用Chef创建自动化虚拟环境。</p><p>使用vagrant搭建开发环境优势:  </p><ul><li>运行完全隔离;  </li><li>熟悉linux常用操作;  </li><li><em><strong>GUEST改时间不影响HOST时间</strong></em>  </li></ul><span id="more"></span><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>需要软件:  </p><ul><li>GIT</li><li>VirtualBox-5.1.4-110228-Win</li><li>vagrant_1.8.5.msi</li><li>BOX文件</li></ul><p>将<code>the git root\usr\bin</code>加入环境变量, 确保<code>ssh</code>命令可用</p><p><code>Virtualbox</code>安装成功后，执行：<br><code>VBoxManage.exe setextradata global &quot;VBoxInternal/Devices/VMMDev/0/Config/GetHostTimeDisabled&quot; &quot;1&quot;</code></p><p>设置<code>Virtualbox</code>不同步系统时间</p><h2 id="创建box"><a href="#创建box" class="headerlink" title="创建box"></a>创建box</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">rem centos7是自定义名字</span></span><br><span class="line"><span class="comment">rem E:\centos_7.box是box文件路径</span></span><br><span class="line">vagrant box add centos7 E:\centos_7.box</span><br></pre></td></tr></table></figure><h2 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">rem 切换到项目目录(trunk或者qqjy_cn_版本号)</span></span><br><span class="line"><span class="built_in">cd</span> project_path</span><br><span class="line"><span class="comment">rem 创建开发环境</span></span><br><span class="line">vagrant init centos7</span><br></pre></td></tr></table></figure><p>在生成<code>Vagrantfile</code>文件中添加:</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">config.ssh.username = <span class="string">&quot;root&quot;</span></span><br><span class="line">config.ssh.password = <span class="string">&quot;vagrant&quot;</span></span><br><span class="line"><span class="comment"># 端口映射</span></span><br><span class="line">config.vm.network <span class="string">&quot;forwarded_port&quot;</span>, <span class="symbol">guest:</span> <span class="number">8101</span>, <span class="symbol">host:</span> <span class="number">47010</span></span><br><span class="line"><span class="comment"># 共享文件夹</span></span><br><span class="line">config.vm.synced_folder <span class="string">&quot;./&quot;</span>, <span class="string">&quot;/data/qqjy&quot;</span></span><br><span class="line"><span class="comment"># 执行脚本</span></span><br><span class="line"><span class="comment"># 需要--provision参数</span></span><br><span class="line">config.vm.provision <span class="string">&quot;shell&quot;</span>, <span class="symbol">inline:</span> <span class="string">&lt;&lt;-SHELL</span></span><br><span class="line"><span class="string">  touch /root/.db_status</span></span><br><span class="line"><span class="string">  VER=$(cat /root/.db_status)</span></span><br><span class="line"><span class="string">  if [[ &quot;$VER&quot; == &quot;&quot; ]]; then</span></span><br><span class="line"><span class="string">    echo &quot;deal&quot; &gt; /root/.db_status</span></span><br><span class="line"><span class="string">    cd /data/qqjy/db_script &amp;&amp; mysql -uroot -p123456 -e &quot;create database qqjy_admin; use qqjy_admin; source admin.sql;&quot;</span></span><br><span class="line"><span class="string">  fi</span></span><br><span class="line"><span class="string">  cd /data/qqjy/script &amp;&amp; ./server_ctl.sh make &amp;&amp; ./server_ctl.sh start_all</span></span><br><span class="line"><span class="string">SHELL</span></span><br></pre></td></tr></table></figure><p>多节点配置：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Vagrant.configure(<span class="string">&quot;2&quot;</span>) <span class="keyword">do</span> <span class="params">|config|</span></span><br><span class="line">    <span class="comment"># The most common configuration options are documented and commented below.</span></span><br><span class="line">    <span class="comment"># For a complete reference, please see the online documentation at</span></span><br><span class="line">    <span class="comment"># https://docs.vagrantup.com.</span></span><br><span class="line"></span><br><span class="line">    (<span class="number">1</span>..<span class="number">3</span>).each <span class="keyword">do</span> <span class="params">|i|</span></span><br><span class="line">        config.vm.define <span class="string">&quot;node<span class="subst">#&#123;i&#125;</span>&quot;</span> <span class="keyword">do</span> <span class="params">|node|</span></span><br><span class="line">            node.vm.box = <span class="string">&quot;centos7&quot;</span></span><br><span class="line"></span><br><span class="line">            node.ssh.username = <span class="string">&quot;root&quot;</span></span><br><span class="line">            node.ssh.password = <span class="string">&quot;vagrant&quot;</span></span><br><span class="line"></span><br><span class="line">            node.vm.hostname = <span class="string">&quot;node<span class="subst">#&#123;i&#125;</span>&quot;</span></span><br><span class="line">            node.vm.network <span class="symbol">:forwarded_port</span>, <span class="symbol">guest:</span> <span class="number">22</span>, <span class="symbol">host:</span> <span class="string">&quot;2022<span class="subst">#&#123;i&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">            node.vm.provider <span class="string">&quot;virtualbox&quot;</span> <span class="keyword">do</span> <span class="params">|v|</span></span><br><span class="line">                v.name = <span class="string">&quot;node<span class="subst">#&#123;i&#125;</span>&quot;</span></span><br><span class="line">                <span class="keyword">if</span> i == <span class="number">1</span></span><br><span class="line">                    v.memory = <span class="number">512</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    v.memory = <span class="number">512</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                v.cpus = <span class="number">1</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>使用<code>vagrant up --provision</code>启动</p><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ol><li>导出box<br>打开virtualbox,查看box名称,然后使用：<br><code>vagrant package --output centos7_64_1.box --base server_default_1472191933425_51781</code><br>导出自己的BOX</li></ol><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://wenku.baidu.com/view/a14d3fc5a1c7aa00b52acb38.html">https://wenku.baidu.com/view/a14d3fc5a1c7aa00b52acb38.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
          <category> vagrant </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> vagrant </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GITHUB提高访问速度</title>
      <link href="/2017/03/09/github/github-speed/"/>
      <url>/2017/03/09/github/github-speed/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="https://github.com/">GITHUB</a>虽然未被墙,但是速度真的不敢恭维</p><p>从上面clone代码经常性的失败, 有点抓狂</p><span id="more"></span><h2 id="WEB访问"><a href="#WEB访问" class="headerlink" title="WEB访问"></a>WEB访问</h2><ol><li><p>在<code>http://tool.chinaz.com/dns</code>查询<code>http://github.com</code></p></li><li><p>找到<code>TTL</code>值最低的响应IP <code>192.30.253.113</code></p></li><li><p>将<code>192.30.253.113 github.com</code>添加到<code>HOSTS</code>(<code>C:\Windows\System32\drivers\etc\hosts</code>)中</p></li></ol><h2 id="CLONE"><a href="#CLONE" class="headerlink" title="CLONE"></a>CLONE</h2><ol><li><p>自行查找梯子</p></li><li><p>配置</p><ol><li>GIT<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># git config --global http.proxy http://proxyuser:proxypwd@proxy.server.com:port</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># git config --global https.proxy https://proxyuser:proxypwd@proxy.server.com:port</span></span></span><br><span class="line">git config --global http.proxy http://127.0.0.1:58365</span><br><span class="line">git config --global https.proxy https://127.0.0.1:58365</span><br></pre></td></tr></table></figure></li><li>SHELL<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">## 在命令行中使用代理</span><br><span class="line">## export http_proxy=http://proxyuser:proxypwd@proxy.server.com:8080</span><br><span class="line">## export https_proxy=https://proxyuser:proxypwd@proxy.server.com:8080</span><br></pre></td></tr></table></figure></li><li>WINDOWS<br>添加<code>http_proxy</code>和<code>https_proxy</code>环境变量</li></ol></li></ol><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="http://www.cnblogs.com/fengnovo/p/5959880.html">http://www.cnblogs.com/fengnovo/p/5959880.html</a></li><li><a href="http://www.tuicool.com/articles/a2m6fau">http://www.tuicool.com/articles/a2m6fau</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>erlang下ssh daemon</title>
      <link href="/2017/01/22/erlang/erlang-ssh-daemon/"/>
      <url>/2017/01/22/erlang/erlang-ssh-daemon/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>曾多次在windows下尝试<code>ssh:daemon/2</code>,但是每次用ssh客户端连接都提示<code>找不到匹配的host key算法</code><br>在linux下又可以,一直认为是该接口不支持windows,毕竟windows本身是不支持ssh的</p><p>今天又尝试了下, 原来是自己错了</p><span id="more"></span><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;system_dir, string()&#125;</span><br><span class="line">Sets the system directory, containing the host key files that identifies the host keys for ssh. </span><br><span class="line">The default is /etc/ssh, note that for security reasons this directory is normally only accessible by the root user.</span><br></pre></td></tr></table></figure><p>如上描述,默认是<code>/etc/ssh</code>,但是windows没有<code>/etc/ssh</code>,所以提示<code>找不到匹配的host key算法</code></p><h3 id="生成system-dir需要的key"><a href="#生成system-dir需要的key" class="headerlink" title="生成system_dir需要的key"></a>生成<code>system_dir</code>需要的key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -f config/ssh_daemon/ssh_host_rsa_key</span><br></pre></td></tr></table></figure><h3 id="erlang启动"><a href="#erlang启动" class="headerlink" title="erlang启动"></a>erlang启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1&gt; application:ensure_all_started(ssh).</span><br><span class="line">2&gt; &#123;ok, Pid&#125; = ssh:daemon(10000, [</span><br><span class="line">                                  &#123;system_dir, &quot;config/ssh_daemon&quot;&#125;, </span><br><span class="line">                                  %% 方式1</span><br><span class="line">                                  &#123;user_passwords, [&#123;&quot;aaa&quot;, &quot;123456&quot;&#125;]&#125;,</span><br><span class="line">                                  %% 方式2</span><br><span class="line">                                  &#123;pwdfun, fun(&quot;aaa&quot;, &quot;123456&quot;) -&gt; true; (_, _) -&gt; false end&#125; </span><br><span class="line">                                 ]).</span><br></pre></td></tr></table></figure><h3 id="客户端测试"><a href="#客户端测试" class="headerlink" title="客户端测试"></a>客户端测试</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh aaa@127.0.0.1 -p 10000</span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://erlang.org/doc/apps/ssh/using_ssh.html">http://erlang.org/doc/apps/ssh/using_ssh.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows下安装PHP插件memcache</title>
      <link href="/2016/10/08/windows/windows-memcache/"/>
      <url>/2016/10/08/windows/windows-memcache/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Windows下安装PHP插件memcache</p><span id="more"></span><h3 id="查看PHP信息"><a href="#查看PHP信息" class="headerlink" title="查看PHP信息"></a>查看PHP信息</h3><p>使用<code>phpinfo()</code>查看php信息</p><table><thead><tr><th>PHP Version 5.6.4</th><th></th></tr></thead><tbody><tr><td>Zend Extension Build</td><td>API220131226,<font color="red">TS</font>,VC11</td></tr><tr><td>PHP Extension Build</td><td>API20131226,<font color="red">TS</font>,VC11</td></tr><tr><td>Architecture</td><td><font color="red">x64</font></td></tr></tbody></table><p>从上面的表,可以看出:</p><ol><li>5.6版本</li><li>TS  - Thread Safe</li><li>x64 - 64位</li></ol><h3 id="下载对应版本的php-memcache"><a href="#下载对应版本的php-memcache" class="headerlink" title="下载对应版本的php_memcache"></a>下载对应版本的<code>php_memcache</code></h3><p><a href="https://pecl.php.net/package/memcache/3.0.8/windows">下载地址</a></p><p>将解压后的<code>php_memcache</code>放到<code>php_root_path/ext</code>目录下</p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## php.ini</span><br><span class="line">extension=php_memcache.dll</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>查看<code>phpinfo()</code>, 如果出现memcache表示安装成功</p><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://www.jb51.net/article/63601.htm">http://www.jb51.net/article/63601.htm</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
          <category> php </category>
          
          <category> memcache </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> windows </tag>
            
            <tag> memcache </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建在线Epub阅读平台</title>
      <link href="/2016/10/07/misc/misc-web-epub-reader/"/>
      <url>/2016/10/07/misc/misc-web-epub-reader/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>如果手机/PC不想安装Epub阅读软件, 可以试着个人搭建一个在线阅读epub的平台</p><p>可以保存阅读进度奥, 具体实现原理还不太清楚</p><span id="more"></span><h3 id="需要软件"><a href="#需要软件" class="headerlink" title="需要软件"></a>需要软件</h3><ul><li>PHP</li><li>NGINX(Apache)</li><li><a href="http://calibre-ebook.com/">Calibre</a></li><li><a href="https://github.com/seblucas/cops">cops</a></li><li>nssm</li></ul><h3 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h3><ol><li><p>安装calibre</p></li><li><p>使用nginx搭建cops环境, 具体百度</p></li></ol><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// config_local.php</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// 指向Calibre的Calibre Library目录</span></span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;calibre_directory&#x27;</span>] = <span class="string">&#x27;E:/Calibre Portable/Calibre Library/&#x27;</span>;</span><br><span class="line"><span class="comment">// title</span></span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;cops_title_default&#x27;</span>] = <span class="string">&quot;EPUB阅读平台&quot;</span>;</span><br><span class="line"><span class="comment">// 是否允许下载 0-否 1-是</span></span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;cops_use_url_rewriting&#x27;</span>] = <span class="string">&quot;0&quot;</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows下服务管理-NSSM</title>
      <link href="/2016/10/05/windows/windows-nssm/"/>
      <url>/2016/10/05/windows/windows-nssm/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>NSSM - the Non-Sucking Service Manager</p><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>在<a href="http://nssm.cc/download">nssm.cc</a>下载exe文件,添加到path环境</p><h3 id="添加服务"><a href="#添加服务" class="headerlink" title="添加服务"></a>添加服务</h3><p>以gogs服务安装为例子</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">ECHO</span> off</span><br><span class="line"></span><br><span class="line">:: This script relies on nssm.exe to work.</span><br><span class="line">:: Please, download it and make it available on the system <span class="built_in">path</span>,</span><br><span class="line">:: or <span class="built_in">copy</span> it to the gogs <span class="built_in">path</span>.</span><br><span class="line">:: https://nssm.cc/download</span><br><span class="line">:: This script itself should run <span class="keyword">in</span> the gogs <span class="built_in">path</span>, too.</span><br><span class="line">:: <span class="keyword">In</span> case of startup failure, please read carefully the log file.</span><br><span class="line">:: Make sure Gogs work running manually with &quot;gogs web&quot; before running</span><br><span class="line">:: this script.</span><br><span class="line">:: And, please, read carefully the installation docs first:</span><br><span class="line">:: https://gogs.io/docs/installation</span><br><span class="line">:: To unistall the service, run &quot;nssm remove gogs&quot; and restart Windows.</span><br><span class="line"></span><br><span class="line">:: <span class="built_in">Set</span> the folder where you extracted Gogs. Omit the last slash.</span><br><span class="line"><span class="built_in">SET</span> gogspath=D:\gogs</span><br><span class="line"></span><br><span class="line">nssm install gogs &quot;<span class="variable">%gogspath%</span>\gogs.exe&quot;</span><br><span class="line">nssm <span class="built_in">set</span> gogs AppParameters &quot;web&quot;</span><br><span class="line">nssm <span class="built_in">set</span> gogs Description &quot;A painless self-hosted Git service.&quot;</span><br><span class="line">nssm <span class="built_in">set</span> gogs DisplayName &quot;Gogs - Go Git Service&quot;</span><br><span class="line">nssm <span class="built_in">set</span> gogs <span class="built_in">Start</span> SERVICE_DELAYED_AUTO_START</span><br><span class="line">nssm <span class="built_in">set</span> gogs AppStdout &quot;<span class="variable">%gogspath%</span>\gogs.log&quot;</span><br><span class="line">nssm <span class="built_in">start</span> gogs</span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure><blockquote><p><code>nssm install gogs</code>GUI方式安装服务<br><code>nssm edit gogs</code>可以打开GUI界面,方便配置</p></blockquote><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://nssm.cc/">http://nssm.cc</a></li><li><a href="https://gogs.io/docs/installation/run_as_windows_service">https://gogs.io/docs/installation/run_as_windows_service</a></li><li><code>nssm --help</code></li></ol>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下终端显示xlsx内容</title>
      <link href="/2016/09/07/centos/centos-xlsx2csv/"/>
      <url>/2016/09/07/centos/centos-xlsx2csv/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>在一些特殊情况下, 需要在终端下查看xlsx中的内容<br>该脚本目的在此</p><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install python-pip -y</span><br><span class="line">pip install xlsx2csv</span><br></pre></td></tr></table></figure><h3 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h3><figure class="highlight bash"><figcaption><span>xlsx_to_csv.sh</span><a href="/downloads/code/xlsx_to_csv.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash - </span></span><br><span class="line"><span class="comment">#===============================================================================</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#          FILE: xlsx_to_csv.sh</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#         USAGE: ./xlsx_to_csv.sh </span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#   DESCRIPTION: linux 命令行下查看xlsx文件</span></span><br><span class="line"><span class="comment">#                通过xlsx2csv</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#       OPTIONS: ---</span></span><br><span class="line"><span class="comment">#  REQUIREMENTS: ---</span></span><br><span class="line"><span class="comment">#          BUGS: ---</span></span><br><span class="line"><span class="comment">#         NOTES: ---</span></span><br><span class="line"><span class="comment">#        AUTHOR: YOUR NAME (), </span></span><br><span class="line"><span class="comment">#  ORGANIZATION: </span></span><br><span class="line"><span class="comment">#       CREATED: 2016/09/ 2 18:52</span></span><br><span class="line"><span class="comment">#      REVISION:  ---</span></span><br><span class="line"><span class="comment">#===============================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -o nounset                              <span class="comment"># Treat unset variables as an error</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 生成csv文件</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">xlsx_to_csv</span></span>(){</span><br><span class="line">    <span class="comment">## 删除所有旧版数据</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> $(ls | grep <span class="string">&quot;^xlsx2csv&quot;</span>); <span class="keyword">do</span></span><br><span class="line">        rm <span class="variable">$i</span> -f</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    file_name=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">    xlsx2csv -s 0 -i <span class="string">&quot;<span class="variable">${file_name}</span>&quot;</span> | awk <span class="string">&#x27;/^--------/{++i}{print &gt; &quot;xlsx2csv&quot;i}&#x27;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">## 显示</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">show</span></span>(){</span><br><span class="line">    file_name=<span class="variable">$1</span></span><br><span class="line">    <span class="comment"># cat $file_name | sed &#x27;2,10d&#x27; | sed &#x27;4,6d&#x27; | sed &#x27;s/,,,//g&#x27; | sed &#x27;s/,$//g&#x27; | column -t -s &quot;,&quot; -o &quot;|&quot; | more</span></span><br><span class="line">    cat <span class="variable">$file_name</span> | sed -e <span class="string">&#x27;2,10d&#x27;</span> | sed -e <span class="string">&#x27;4,6d&#x27;</span> -e <span class="string">&#x27;s/,,,//g&#x27;</span> -e <span class="string">&#x27;s/,$//g&#x27;</span> | column -t -s <span class="string">&quot;,&quot;</span> -o <span class="string">&quot;|&quot;</span> | more</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">## 显示subsheet</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">list_file</span></span>(){</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> $(ls | grep <span class="string">&quot;^xlsx2csv&quot;</span>); <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$i</span> &quot;</span></span><br><span class="line">        grep -e <span class="string">&quot;^--------&quot;</span> <span class="variable">$i</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">## help</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">help</span></span>(){</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;----------------------------&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;gen filenmae&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;list&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;show xlsx2csvN&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;----------------------------&quot;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;gen&quot;</span>) xlsx_to_csv <span class="string">&quot;<span class="variable">$2</span>&quot;</span>;;</span><br><span class="line">    <span class="string">&quot;show&quot;</span>) show <span class="variable">$2</span>;;</span><br><span class="line">    <span class="string">&quot;list&quot;</span>) list_file;;</span><br><span class="line">    *) <span class="built_in">help</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Administrator@PC-20160616ZYHV /c/e/q/s/test# bash zm_xlsx.sh 1</span><br><span class="line">----------------------------</span><br><span class="line">gen filenmae</span><br><span class="line">list</span><br><span class="line">show xlsx2csvN</span><br><span class="line">----------------------------</span><br><span class="line">Administrator@PC-20160616ZYHV /c/e/q/s/test# bash zm_xlsx.sh gen &quot;/cygdrive/e/qqjy/plan/004 配置表/039 送花配置表.xlsx&quot; </span><br><span class="line">Administrator@PC-20160616ZYHV /c/e/q/s/test# bash zm_xlsx.sh list</span><br><span class="line">xlsx2csv1 -------- 1 - 送花配置表</span><br><span class="line">Administrator@PC-20160616ZYHV /c/e/q/s/test# bash zm_xlsx.sh show xlsx2csv1 </span><br><span class="line">-------- 1 - 送花配置表</span><br><span class="line">后端·数据类型         |num |str          |num       |num           |num           |num           |num           |num</span><br><span class="line">后端·字段名           |id  |name         |tiem_id   |intimacy      |charm         |sweet_target  |sweet_me      |message</span><br><span class="line">字段名                 |鲜花|名称         |对应道具ID|增加彼此亲密度|增加目标魅力值|增加目标甜蜜度|增加自身甜蜜度|系统推送消息</span><br><span class="line">                       |1   |玫瑰*至真之恋|1290001   |2             |2             |1             |2             |69</span><br><span class="line">                       |2   |玫瑰*白头之恋|1290002   |100           |100           |50            |100           |70</span><br><span class="line">                       |3   |玫瑰*地久之恋|1290003   |600           |600           |300           |600           |71</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> xlsx </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows下安装/配置cygwin</title>
      <link href="/2016/08/23/windows/windows-ssh/"/>
      <url>/2016/08/23/windows/windows-ssh/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Windows下安装/配置cygwin</p><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ol><li>在<a href="https://www.cygwin.com/">Cygwin</a>下载</li><li>[废弃] <code>Use Url</code>使用<a href="http://mirrors.163.com/cygwin/">http://mirrors.163.com/cygwin/</a></li><li>选择<code>openssh</code>, <code>vim</code>, <code>curl</code>, <code>wget</code>, <code>git</code>安装</li></ol><blockquote><p><code>CYGWIN</code>的用户目录是<code>C:\cygwin\home</code>, 并非是<code>C:\User</code>目录, 这个和<code>git for windows</code>是不一样的</p></blockquote><h3 id="SSH配置"><a href="#SSH配置" class="headerlink" title="SSH配置"></a>SSH配置</h3><ol><li><code>ssh-host-config</code>, 一路<code>yes</code></li><li>配置(<code>/etc/sshd_config</code>)<blockquote><p>StrictModes no<br>PubkeyAuthentication yes<br>AuthorizedKeysFile    .ssh/authorized_keys<br>PasswordAuthentication no</p></blockquote></li><li><code>cygrunsrv.exe -S sshd</code></li></ol><h3 id="apt-cyg安装"><a href="#apt-cyg安装" class="headerlink" title="apt-cyg安装"></a>apt-cyg安装</h3><p><code>apt-cyg</code>是<code>CYGWIN</code>下的包管理器, 类似debain下的<code>apt-get</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/transcode-open/apt-cyg.git</span><br><span class="line">cd apt-cyg</span><br><span class="line">install apt-cyg /bin</span><br></pre></td></tr></table></figure><blockquote><p><strong>使用中,存在<code>remove</code>不成功的情况,可以使用<code>setup_x86.exe</code>执行卸载操作</strong></p></blockquote><h3 id="oh-my-zsh"><a href="#oh-my-zsh" class="headerlink" title="oh-my-zsh"></a>oh-my-zsh</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-cyg install zsh wget curl git</span><br><span class="line">sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;</span><br></pre></td></tr></table></figure><blockquote><p><strong>运行偏慢</strong></p></blockquote><h3 id="已知问题"><a href="#已知问题" class="headerlink" title="已知问题"></a>已知问题</h3><ol><li><code>Cygwin ssh Connection closed by ::1</code></li></ol><p>在Win7下Cygwin中，使用ssh localhost命令，出现Connection closed by127.0.0.1的问题。<br>解决方案:<br>    1. 开始——运行——services.msc<br>    2. 右键CYGWINsshd——属性——登录选项卡——选择“此账户”——浏览——高级——立即查找——选择你的账户名（必须为治理员权限）——输进密码（必须要有，空密码不承受）——确定。<br>    3. 重启CYGWINsshd效劳即可。这样就以你的账户的名义启动了这个效劳。而后ssh localhost成功。</p><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://blog.csdn.net/superbinbin1/article/details/10147421">http://blog.csdn.net/superbinbin1/article/details/10147421</a></li><li><a href="http://cyxu2004.blog.163.com/blog/static/4576871820144211116439/">http://cyxu2004.blog.163.com/blog/static/4576871820144211116439/</a></li><li><a href="http://www.blogjava.net/Man/archive/2013/03/12/396334.html">http://www.blogjava.net/Man/archive/2013/03/12/396334.html</a></li><li><a href="https://zhidao.baidu.com/question/305625180780734364.html">https://zhidao.baidu.com/question/305625180780734364.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
          <category> ssh </category>
          
          <category> cygwin </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssh </tag>
            
            <tag> windows </tag>
            
            <tag> cygwin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下挂载ftp服务器</title>
      <link href="/2016/08/23/centos/centos-ftp/"/>
      <url>/2016/08/23/centos/centos-ftp/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>使用curlftpfs挂载ftp服务器到本地</p><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install curlftpfs</span><br></pre></td></tr></table></figure><h3 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curlftpfs -o codepage=utf8 ftp://username:password@192.168.192.168 /ftp</span><br><span class="line"><span class="comment">## codepage:        编码</span></span><br><span class="line"><span class="comment">## username:        FTP用户名</span></span><br><span class="line"><span class="comment">## password:        FTP密码</span></span><br><span class="line"><span class="comment">## 192.168.1.111:   FTP地址</span></span><br><span class="line"><span class="comment">## /ftp:            准备挂载到的路径</span></span><br></pre></td></tr></table></figure><h3 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## fusermount -u /ftp</span></span><br><span class="line">umount /ftp</span><br></pre></td></tr></table></figure><h3 id="开机挂载"><a href="#开机挂载" class="headerlink" title="开机挂载"></a>开机挂载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;curlftpfs#username:password@192.168.1.111 /ftp fuse allow_other,uid=0,gid=0 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> ftp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手机上使用gidder搭建gitserver</title>
      <link href="/2016/07/23/mobile/mobile-gidder/"/>
      <url>/2016/07/23/mobile/mobile-gidder/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>请转到<a href="/2020/03/13/centos/centos-gitserver-list/">几种常用git server</a></p>]]></content>
      
      
      <categories>
          
          <category> 手机 </category>
          
          <category> gidder </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 手机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>erlang 17+ map,record互转</title>
      <link href="/2016/06/08/erlang/erlang-map2record/"/>
      <url>/2016/06/08/erlang/erlang-map2record/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>在OTP17+版本,增加了maps数据结构,maps相对record有很多优良特性<br>但是,很多模块(ets,mnesia)还是以record为基础<br>maps,record互转很有必要</p><span id="more"></span><p>直接贴代码:</p><figure class="highlight erlang"><figcaption><span>m2r.erl</span><a href="/downloads/code/m2r.erl">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% ===========================================================================</span></span><br><span class="line"><span class="comment">%% @doc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%% @end</span></span><br><span class="line"><span class="comment">%% ===========================================================================</span></span><br><span class="line"><span class="keyword">-module</span><span class="params">(m2r)</span>.</span><br><span class="line"><span class="keyword">-author</span><span class="params">(zhaoming)</span>.</span><br><span class="line">-version<span class="params">(<span class="number">1.0</span>)</span>.</span><br><span class="line">-date<span class="params">(&#x27;<span class="number">2016</span>-<span class="number">06</span>-<span class="number">08</span>&#x27;)</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-export</span><span class="params">([</span></span><br><span class="line"><span class="params">         test/<span class="number">0</span></span></span><br><span class="line"><span class="params">        ])</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-record</span><span class="params">(mapRecord, {</span></span><br><span class="line"><span class="params">          a = <span class="number">1</span></span></span><br><span class="line"><span class="params">          ,b = <span class="number">3</span></span></span><br><span class="line"><span class="params">          ,c = <span class="number">2</span></span></span><br><span class="line"><span class="params">          ,d = <span class="number">4</span></span></span><br><span class="line"><span class="params">         })</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-define</span><span class="params">(map_to_record(Map, RecordName), </span></span><br><span class="line"><span class="params">        <span class="comment">%% list_to_tuple(</span></span></span><br><span class="line"><span class="params">        <span class="comment">%%   lists:map( </span></span></span><br><span class="line"><span class="params">        <span class="comment">%%     fun({__K__, __V__}) -&gt; maps:get(__K__, Map, __V__) end, </span></span></span><br><span class="line"><span class="params">        <span class="comment">%%     lists:zip([RecordName|record_info(fields, RecordName)], tuple_to_list(#RecordName{}))</span></span></span><br><span class="line"><span class="params">        <span class="comment">%%    )</span></span></span><br><span class="line"><span class="params">        <span class="comment">%%  )</span></span></span><br><span class="line"><span class="params">        list_to_tuple( [maps:get(__K__, Map, __V__) || {__K__, __V__} &lt;- lists:zip([RecordName|record_info(fields, RecordName)], tuple_to_list(#RecordName{})) ] )</span></span><br><span class="line"><span class="params">       )</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-define</span><span class="params">(record_to_map(RecordName, Record),</span></span><br><span class="line"><span class="params">        <span class="comment">%% lists:foldl(</span></span></span><br><span class="line"><span class="params">        <span class="comment">%%   fun({__K__, __V__}, __Map__) -&gt; maps:put(__K__, __V__, __Map__) end,</span></span></span><br><span class="line"><span class="params">        <span class="comment">%%   #{}, </span></span></span><br><span class="line"><span class="params">        <span class="comment">%%   lists:zip([&#x27;__name__&#x27;|record_info(fields, RecordName)], tuple_to_list(Record))</span></span></span><br><span class="line"><span class="params">        <span class="comment">%%  )</span></span></span><br><span class="line"><span class="params">        maps:from_list(lists:zip([&#x27;__name__&#x27;|record_info(fields, RecordName)], tuple_to_list(Record)))</span></span><br><span class="line"><span class="params">       )</span>.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">test</span><span class="params">()</span> -&gt;</span></span><br><span class="line">    Map = #{&#x27;__name__&#x27; =&gt; mapRecord, <span class="string">&quot;a&quot;</span> =&gt; <span class="number">1</span>, b =&gt; <span class="number">2</span>},</span><br><span class="line">    io:format(<span class="string">&quot;~p~n&quot;</span>, [Map]),</span><br><span class="line">    K = <span class="number">1</span>,</span><br><span class="line">    R = ?map_to_record(Map, mapRecord),</span><br><span class="line">    io:format(<span class="string">&quot;~p~n&quot;</span>, [R]),</span><br><span class="line">    ?record_to_map(mapRecord, #mapRecord{}).</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rebar3配置使用</title>
      <link href="/2016/06/06/erlang/erlang-rebar3/"/>
      <url>/2016/06/06/erlang/erlang-rebar3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><code>rebar3</code>是<code>erlang</code>下的配置管理工具.</p><span id="more"></span><h4 id="编译安装rebar3"><a href="#编译安装rebar3" class="headerlink" title="编译安装rebar3"></a>编译安装<code>rebar3</code></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/erlang/rebar3.git</span><br><span class="line"><span class="built_in">cd</span> rebar3</span><br><span class="line"><span class="comment">## linux</span></span><br><span class="line">./bootstrap</span><br><span class="line">rebar3 <span class="built_in">local</span> install</span><br><span class="line"><span class="comment">## 按照提示,增加$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## windows</span></span><br><span class="line">bootstrap.bat</span><br><span class="line"><span class="comment">## 将生成的rebar3, rebar3.cmd放到path目录下</span></span><br></pre></td></tr></table></figure><h4 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## new template my_project_name</span></span><br><span class="line">rebar3 new release myapp</span><br></pre></td></tr></table></figure><p>目录结构</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$tree</span> </span><br><span class="line">.</span><br><span class="line">├── apps</span><br><span class="line">│   └── myapp</span><br><span class="line">│       └── src</span><br><span class="line">│           ├── myapp_app.erl</span><br><span class="line">│           ├── myapp.app.src</span><br><span class="line">│           └── myapp_sup.erl</span><br><span class="line">├── config</span><br><span class="line">│   ├── sys.config      applications配置</span><br><span class="line">│   └── vm.args         启动参数</span><br><span class="line">├── LICENSE</span><br><span class="line">├── README.md</span><br><span class="line">├── rebar.config        项目开发配置参数</span><br><span class="line">└── rebar.lock</span><br></pre></td></tr></table></figure><h4 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h4><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## rebar.config</span><br><span class="line">&#123;deps, [&#123;cowboy, <span class="string">&quot;1.0.1&quot;</span>&#125;]&#125;.</span><br></pre></td></tr></table></figure><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## myapp.app.src</span><br><span class="line">&#123;applications, [kernel, stdlib, cowboy]&#125;</span><br></pre></td></tr></table></figure><h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## compile自动get依赖</span></span><br><span class="line">rebar3 compile</span><br></pre></td></tr></table></figure><h4 id="配置applications"><a href="#配置applications" class="headerlink" title="配置applications"></a>配置applications</h4><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">## sys.config</span><br><span class="line">[</span><br><span class="line">  &#123; myapp, []&#125;,</span><br><span class="line">  &#123;sasl,[</span><br><span class="line">    <span class="comment">%% minimise shell error logging</span></span><br><span class="line">    &#123;sasl_error_logger,false&#125;,</span><br><span class="line">    <span class="comment">%% only report errors</span></span><br><span class="line">    &#123;errlog_type,error&#125;,</span><br><span class="line">    <span class="comment">%% the log file directory</span></span><br><span class="line">    &#123;error_logger_mf_dir,<span class="string">&quot;./erl_logs&quot;</span>&#125;,</span><br><span class="line">    <span class="comment">%% bytes per logfile</span></span><br><span class="line">    &#123;error_logger_mf_maxbytes,<span class="number">10485760</span>&#125;, <span class="comment">% 10MB</span></span><br><span class="line">    <span class="comment">%% max mumber of log files</span></span><br><span class="line">    &#123;error_logger_mf_maxfiles,<span class="number">10</span>&#125;</span><br><span class="line">    ]&#125;,</span><br><span class="line">  &#123;kernel,[</span><br><span class="line">    &#123;inet_dist_listen_min, <span class="number">4370</span>&#125;,</span><br><span class="line">    &#123;inet_dist_listen_max, <span class="number">5370</span>&#125;</span><br><span class="line">    ]&#125;</span><br><span class="line">].</span><br></pre></td></tr></table></figure><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rebar3 shell</span><br></pre></td></tr></table></figure><h4 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h4><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% 发布选项</span></span><br><span class="line">&#123;relx, [</span><br><span class="line">        ...</span><br><span class="line">        &#123;include_erts, false&#125;,</span><br><span class="line">        &#123;include_src, false&#125;,</span><br><span class="line">        &#123;system_libs, false&#125;</span><br><span class="line">        ...</span><br><span class="line">       ]&#125;.</span><br><span class="line">&#123;profiles, [</span><br><span class="line">            &#123;prod, [</span><br><span class="line">                    &#123;relx, [</span><br><span class="line">                            &#123;include_erts, false&#125;</span><br><span class="line">                           ]&#125;</span><br><span class="line">                   ]&#125;</span><br><span class="line">           ]&#125;.</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rebar3 release</span><br><span class="line">rebar3 as prod tar</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
            <tag> rebar3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>erlang shell下rr使用</title>
      <link href="/2016/05/10/erlang/erlang-rr/"/>
      <url>/2016/05/10/erlang/erlang-rr/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><ol><li><code>rr/1</code>是<code>erlang shell</code>下加载<code>record</code>的定义;</li><li><code>rr</code>只能在<code>erlang shell</code>下调用;</li><li>项目中有N多<code>record</code>定义, 需要快速加载所有的定义;</li></ol><span id="more"></span><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">rr</span><span class="params">()</span> -&gt;</span></span><br><span class="line">    HrlList = get_hrl_list(),</span><br><span class="line">    A = &lt;&lt;<span class="string">&quot;复制下面的代码执行:&quot;</span>&gt;&gt;,</span><br><span class="line">    io:format(<span class="string">&quot;~ts~n&quot;</span>, [A]),</span><br><span class="line">    io:format(<span class="string">&quot;rp([rr(X) || X &lt;- [\&quot;~s\&quot;] ]).~n&quot;</span>, [string:join(HrlList, <span class="string">&quot;\&quot;,\&quot;&quot;</span>)]).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">get_hrl_list</span><span class="params">()</span> -&gt;</span></span><br><span class="line">    &#123;ok, [&#123;DirList, OptList&#125;]&#125; = file:consult(<span class="string">&quot;./Emakefile&quot;</span>),</span><br><span class="line">    F = <span class="keyword">fun</span>(Dir, L) -&gt;</span><br><span class="line">                WildCard = io_lib:format(<span class="string">&quot;~s.hrl&quot;</span>, [Dir]),</span><br><span class="line">                L ++ filelib:wildcard(WildCard)</span><br><span class="line">        <span class="keyword">end</span>,</span><br><span class="line">    F_1 = <span class="keyword">fun</span>(Opt, L) -&gt;</span><br><span class="line">                  <span class="keyword">case</span> Opt <span class="keyword">of</span></span><br><span class="line">                      &#123;i, Include&#125; -&gt;</span><br><span class="line">                          WildCard = io_lib:format(<span class="string">&quot;~s/*.hrl&quot;</span>, [Include]),</span><br><span class="line">                          L ++ filelib:wildcard(WildCard);</span><br><span class="line">                      _ -&gt; L</span><br><span class="line">                  <span class="keyword">end</span></span><br><span class="line">          <span class="keyword">end</span>,</span><br><span class="line">    FileList = lists:foldl(F, [], DirList) ++ lists:foldl(F_1, [], OptList),</span><br><span class="line">    FileList.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>erlang编译指定文件</title>
      <link href="/2016/05/10/erlang/erlang-make/"/>
      <url>/2016/05/10/erlang/erlang-make/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>在工作中,经常遇到需要停下手上的功能修复以往功能的bug<br>只编译指定的文件就很有必要</p><span id="more"></span><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% @doc 编译指定文件</span></span><br><span class="line"><span class="comment">%% @spec m([File::string()]) -&gt; up_to_date | error.</span></span><br><span class="line"><span class="comment">%% &lt;pre&gt;</span></span><br><span class="line"><span class="comment">%% m([&quot;a&quot;, &quot;b&quot;])</span></span><br><span class="line"><span class="comment">%% &lt;/pre&gt;</span></span><br><span class="line"><span class="function"><span class="title">m</span><span class="params">(FileList)</span> -&gt;</span></span><br><span class="line">    ComFileList = get_file_list(FileList, []),</span><br><span class="line">    Rtn = make:files(ComFileList),</span><br><span class="line">    Rtn.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">get_file_list</span><span class="params">([], FileList)</span> -&gt;</span> FileList;</span><br><span class="line"><span class="function"><span class="title">get_file_list</span><span class="params">([File|List], FileList)</span> -&gt;</span></span><br><span class="line">    &#123;ok, [&#123;DirList, _&#125;]&#125; = file:consult(<span class="string">&quot;./Emakefile&quot;</span>),</span><br><span class="line">    F = <span class="keyword">fun</span>(Dir, L) -&gt;</span><br><span class="line">                WildCard = io_lib:format(<span class="string">&quot;~s*~s*.erl&quot;</span>, [Dir, File]),</span><br><span class="line">                L ++ filelib:wildcard(WildCard)</span><br><span class="line">        <span class="keyword">end</span>,</span><br><span class="line">    NewFileList = lists:foldl(F, [], DirList) ++ FileList,</span><br><span class="line">    get_file_list(List, NewFileList).</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下使用sendmail发送html邮件</title>
      <link href="/2016/04/19/centos/centos-sendmail-html/"/>
      <url>/2016/04/19/centos/centos-sendmail-html/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>利用sendmail发送带html格式的邮件</p><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install sendmail</span><br><span class="line">chkconfig sendmail on</span><br><span class="line">service sendmail start</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; mail.txt &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">From: kingwen@msn.com</span></span><br><span class="line"><span class="string">To: aaaa@qq.com</span></span><br><span class="line"><span class="string">Content-type: text/html;charset=UTF-8</span></span><br><span class="line"><span class="string">Subject: test</span></span><br><span class="line"><span class="string">&lt;style type=&quot;text/css&quot;&gt;</span></span><br><span class="line"><span class="string">.container div&#123; width: 300px; margin: 5px; border-style: solid; border-width: 0px; float: left; &#125;</span></span><br><span class="line"><span class="string">.container img&#123; width: 300px; height: auto; &#125;</span></span><br><span class="line"><span class="string">.container p&#123; text-align: center; margin: 0px; font-size: 20px; font-style: italic; &#125;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br><span class="line"><span class="string">&lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;a href=&quot;https://item.taobao.com/item.htm?id=529495434637&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;img src=&quot;https://gd4.alicdn.com/bao/uploaded/i4/TB1r.e5LVXXXXXDXpXXXXXXXXXX_!!0-item_pic.jpg&quot; alt=&quot;活动爆款2016最新短袖A字连衣裙潮流精品个性&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;活动爆款2016最新短袖A字连衣裙潮流精品个性&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">cat mail.txt | sendmail -t</span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://www.linux521.com/2009/system/201206/18170.html">http://www.linux521.com/2009/system/201206/18170.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下SSH代理上网</title>
      <link href="/2016/04/13/centos/centos-ssh-proxy/"/>
      <url>/2016/04/13/centos/centos-ssh-proxy/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>如果有一台国外的服务器, 可以使用SSH实现代理上网.<br>虚拟机用来设置代理, 物理机使用代理上网.<br>也可以不用虚拟机, 用windows下已有的软件.</p><span id="more"></span><h3 id="需要软件"><a href="#需要软件" class="headerlink" title="需要软件"></a>需要软件</h3><ul><li>virtualbox/vmware(安装了linux系统)</li><li>chrome(安装switchsharp)</li></ul><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install tsocks sshpass screen -y</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">## -------------</span></span><br><span class="line"><span class="comment">## proxy.sh</span></span><br><span class="line"><span class="comment">## -------------</span></span><br><span class="line"><span class="built_in">set</span> -o nounset</span><br><span class="line">isOpen=$(netstat -ntlp | grep :1080)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$isOpen</span> == <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    screen -dmS proxy sshpass -p password ssh -D *:1080 user@ip</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;finish&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line">tsocks wget -O google.html www.google.com</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/tsocks.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">server = 127.0.0.1</span></span><br><span class="line"><span class="string">server_type = 5</span></span><br><span class="line"><span class="string">server_port = 1080</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p><code>crontab -e</code>增加:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * bash /your/path/proxy.sh</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> ssh </tag>
            
            <tag> proxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下命令行字典sdcv</title>
      <link href="/2016/03/31/centos/centos-dict/"/>
      <url>/2016/03/31/centos/centos-dict/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>英语太烂,经常需要用到字典<br><code>sdcv</code>是一个比较好的字典,调用的是<code>stardict</code>的数据文件<br><code>sdcv</code>==<code>stardict command line version</code></p><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum install -y glib2-devel gcc-c++ bzip2 tar</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/koreader/sdcv.git ~/sdcv</span><br><span class="line"><span class="built_in">cd</span> ~/sdcv </span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">rm ~/sdcv -rf</span><br></pre></td></tr></table></figure><h3 id="添加字典"><a href="#添加字典" class="headerlink" title="添加字典"></a>添加字典</h3><ol><li>首先确定是否存在默认字典目录<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">mkdir -p /usr/share/stardict/dic</span><br><span class="line">wget http://download.huzheng.org/zh_CN/stardict-langdao-ec-gb-2.4.2.tar.bz2</span><br><span class="line">tar -xvjf stardict-langdao-ec-gb-2.4.2.tar.bz2 -C /usr/share/stardict/dic</span><br><span class="line">rm stardict-langdao-ec-gb-2.4.2.tar.bz2 -f</span><br><span class="line"></span><br><span class="line">wget http://download.huzheng.org/zh_CN/stardict-langdao-ce-gb-2.4.2.tar.bz2</span><br><span class="line">tar -xvjf stardict-langdao-ce-gb-2.4.2.tar.bz2 -C /usr/share/stardict/dic</span><br><span class="line">rm stardict-langdao-ce-gb-2.4.2.tar.bz2 -f</span><br><span class="line">yum install sdcv</span><br></pre></td></tr></table></figure>更多字典可以访问<a href="http://download.huzheng.org/zh_CN/">http://download.huzheng.org/zh_CN/</a></li></ol><h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sdcv hello</span><br></pre></td></tr></table></figure><p>详细命令可以使用<code>sdcv --help</code></p><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://ubuntumanual.org/posts/690/get-a-dictionary-on-your-console-using-sdcv">http://ubuntumanual.org/posts/690/get-a-dictionary-on-your-console-using-sdcv</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> sdcv </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记录下windows下常用软件</title>
      <link href="/2016/03/30/windows/windows-software/"/>
      <url>/2016/03/30/windows/windows-software/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>PC常用软件,备份下.</p><span id="more"></span><h2 id="聊天"><a href="#聊天" class="headerlink" title="聊天"></a>聊天</h2><ol><li><del>QQ</del></li><li>TIM</li><li>Wechat</li></ol><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><ol><li><a href="https://motrix.app/zh-CN/">motrix</a></li></ol><h2 id="编辑器"><a href="#编辑器" class="headerlink" title="编辑器"></a>编辑器</h2><ol><li><a href="https://github.com/kingwen0302/vim">VIM</a></li><li>Sublime Text</li><li><del>VS Code</del></li><li><del>Haroopad(MD编辑器)</del></li></ol><h2 id="虚拟机"><a href="#虚拟机" class="headerlink" title="虚拟机"></a>虚拟机</h2><ol><li><a href="https://www.vagrantup.com/">Vagrant</a></li><li>virtualbox</li><li><del>VMware</del></li></ol><h2 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h2><ol><li>Chrome</li><li>Firefox Developer Edition</li></ol><h2 id="效率"><a href="#效率" class="headerlink" title="效率"></a>效率</h2><ol><li><del>Wox(快捷启动器)</del></li><li><del>WinDock</del></li><li>VistaSwitcher</li><li>Foxmail(邮件客户端)</li><li><del>FileZilla(ftp客户端)</del></li><li>FileZilla Server</li></ol><h2 id="阅读器"><a href="#阅读器" class="headerlink" title="阅读器"></a>阅读器</h2><ol><li>PDF-XChange</li><li><del>wps</del></li><li>calibre</li><li>Libre Office</li></ol><h2 id="安卓模拟器"><a href="#安卓模拟器" class="headerlink" title="安卓模拟器"></a>安卓模拟器</h2><ol><li>MuMu模拟器</li></ol><h2 id="工作相关"><a href="#工作相关" class="headerlink" title="工作相关"></a>工作相关</h2><ol><li><a href="https://gitforwindows.org/">Git for windows</a></li><li>TortoiseSVN</li><li>TortoiseGIT</li><li><a href="http://www.nssm.cc/">nssm</a></li><li><del>Mysql 5.5</del></li><li><a href="https://downloads.mariadb.org/">MariaDB 10.2</a></li><li>Navicat</li><li>WSL</li><li><del>XShell</del></li><li>MTPUTTY + <a href="https://www.putty.org/">PUTTY</a> + WinSCP</li><li><a href="https://conemu.github.io/">ConEmu</a>(DOS仿真器,好用到没朋友)</li><li><a href="http://meldmerge.org/">Meld</a>(文件对比工具,开源免费)</li><li><a href="www.farmanager.com">Far</a>(命令行文件管理器，个人不是很感冒)</li><li>Xming</li></ol><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ol><li><del>花生壳(动态域名)</del></li><li><del>lantern(代理)</del></li><li>shadowsocks</li><li><a href="http://www.privoxy.org/">Privoxy</a></li><li><a href="https://github.com/fatedier/frp">frp</a></li><li><a href="https://hexo.io/">hexo</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>emakefile测试</title>
      <link href="/2016/03/29/erlang/erlang-emakefile/"/>
      <url>/2016/03/29/erlang/erlang-emakefile/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>项目中需要将同一份的源文件发布到不同的目录, 以前的做法是修改<code>Emakefile</code>配置后,使用<code>erl -make</code>生成,有点麻烦.</p><p>我们知道,编译erlang使用<code>erl -make</code>,而<code>erl -make</code>实际上调用的<code>make:all().</code>, 而<code>make:all().</code>会读取当前目录下的<code>Emakefile</code>文件,根据相应的配置来编译文件.</p><p>如上,目前一些特殊的需求无法满足:</p><ol><li>一个文件编译到不同的目录下;</li><li>读取Emakefile,然后修改其中部分参数后再编译(比如,修改outdir);</li><li>如果有Emakefile1, Emakefile2…EmakefileN, 怎么按照每个编译选项编译?</li></ol><p>那如何即使用<code>Emakefile</code>,又能够满足上面的需求呢?</p><span id="more"></span><p>我们先来做一些测试, 用到<code>erlang</code>的<code>make</code>和<code>compile</code>模块.<br>现在我们有目录结构:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── ebin</span><br><span class="line">├── ebin1</span><br><span class="line">├── Emakefile</span><br><span class="line">└── src</span><br><span class="line">    └── a.erl</span><br></pre></td></tr></table></figure><h3 id="正常的Emakefile"><a href="#正常的Emakefile" class="headerlink" title="正常的Emakefile"></a>正常的Emakefile</h3><p>一个正常的<code>Emakefile</code>文件内容:</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;[<span class="string">&quot;./src/*&quot;</span>], [&#123;outdir, <span class="string">&quot;./ebin&quot;</span>&#125;]&#125;.</span><br></pre></td></tr></table></figure><p>现在使用<code>erl -make</code>编译, 结果:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── ebin</span><br><span class="line">│   └── a.beam</span><br><span class="line">├── ebin1</span><br><span class="line">├── Emakefile</span><br><span class="line">└── src</span><br><span class="line">    └── a.erl</span><br></pre></td></tr></table></figure><p>正确编译</p><h3 id="缺少参数的Emakefile"><a href="#缺少参数的Emakefile" class="headerlink" title="缺少参数的Emakefile"></a>缺少参数的Emakefile</h3><p>Emakefile</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;[<span class="string">&quot;./src/*&quot;</span>], []&#125;.</span><br></pre></td></tr></table></figure><p>编译:</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&gt; make:all([&#123;outdir, <span class="string">&quot;./ebin&quot;</span>&#125;]).</span><br><span class="line">Recompile: ./src/a</span><br><span class="line">up_to_date</span><br></pre></td></tr></table></figure><p><strong>结果和预想的结构一致</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── ebin</span><br><span class="line">│   └── a.beam</span><br><span class="line">├── ebin1</span><br><span class="line">├── Emakefile</span><br><span class="line">└── src</span><br><span class="line">    └── a.erl</span><br></pre></td></tr></table></figure><h3 id="修改已经存在的Emakefile参数"><a href="#修改已经存在的Emakefile参数" class="headerlink" title="修改已经存在的Emakefile参数?"></a>修改已经存在的Emakefile参数?</h3><p>一个正常的Emakefile</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;[<span class="string">&quot;./src/*&quot;</span>], [&#123;outdir, <span class="string">&quot;./ebin&quot;</span>&#125;]&#125;.</span><br></pre></td></tr></table></figure><p>新建一个目录<code>mkdir ebin1</code>,作为编译输出目录<br>显示编译完成</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&gt; make:all([&#123;outdir, <span class="string">&quot;./ebin1&quot;</span>&#125;]).</span><br><span class="line">Recompile: ./src/a</span><br><span class="line">up_to_date </span><br></pre></td></tr></table></figure><p>看下结果:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── ebin</span><br><span class="line">│   └── a.beam</span><br><span class="line">├── ebin1</span><br><span class="line">├── Emakefile</span><br><span class="line">└── src</span><br><span class="line">    └── a.erl</span><br></pre></td></tr></table></figure><p><em><strong>结果并没有如我们预料的在ebin1目录下生成文件,这说明make的时候优先Emakefile中的参数</strong></em></p><h3 id="回到最开始的问题"><a href="#回到最开始的问题" class="headerlink" title="回到最开始的问题"></a>回到最开始的问题</h3><p>回到最开始的问题, 解决方法:</p><ol><li>Emakefile只保留公有编译选项, 比如<code>&#123;i, &quot;include&quot;&#125;</code>等;</li><li>个性部分,通过<code>make:all(Options).</code>的<code>Options</code>选项传进去, 比如<code>&#123;outdir, &quot;./ebin&quot;&#125;</code>, <code>&#123;d, debug&#125;</code>等;</li></ol><p>现在贴下小脚本,凑下字数:</p><figure class="highlight erlang"><figcaption><span>my_make.erl</span><a href="/downloads/code/my_make.erl">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% ===========================================================================</span></span><br><span class="line"><span class="comment">%% @doc</span></span><br><span class="line"><span class="comment">%% 个人编译模块</span></span><br><span class="line"><span class="comment">%% 编译所有文件到ebin,ebin1,/data/t/ebin2目录</span></span><br><span class="line"><span class="comment">%% erl -s my_make all ebin ebin1 /data/t/ebin2</span></span><br><span class="line"><span class="comment">%% 编译单个文件到ebin目录</span></span><br><span class="line"><span class="comment">%% erl -s my_make file src/a ebin</span></span><br><span class="line"><span class="comment">%% @end</span></span><br><span class="line"><span class="comment">%% ===========================================================================</span></span><br><span class="line"><span class="keyword">-module</span><span class="params">(my_make)</span>.</span><br><span class="line"><span class="keyword">-author</span><span class="params">(zhaoming)</span>.</span><br><span class="line">-version<span class="params">(<span class="number">1.0</span>)</span>.</span><br><span class="line">-date<span class="params">(&#x27;<span class="number">2016</span>-<span class="number">03</span>-<span class="number">29</span>&#x27;)</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-export</span><span class="params">([all/<span class="number">1</span>, file/<span class="number">1</span>])</span>.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">all</span><span class="params">([])</span> -&gt;</span> </span><br><span class="line">    msg(not_dir),</span><br><span class="line">    erlang:halt();</span><br><span class="line"><span class="function"><span class="title">all</span><span class="params">(OutDirList)</span> -&gt;</span> </span><br><span class="line">    timer:sleep(<span class="number">1000</span>),</span><br><span class="line">    io:format(<span class="string">&quot;~n&quot;</span>),</span><br><span class="line">    Result = do_make(OutDirList),</span><br><span class="line">    msg(Result),</span><br><span class="line">    erlang:halt().</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">do_make</span><span class="params">([])</span> -&gt;</span> up_to_date;</span><br><span class="line"><span class="function"><span class="title">do_make</span><span class="params">([OutDirAtom|OutDirList])</span> -&gt;</span></span><br><span class="line">    OutDir = atom_to_list(OutDirAtom),</span><br><span class="line">    Options = [{outdir, OutDir}, {d, debug}],</span><br><span class="line">    msg(io_lib:format(<span class="string">&quot;Dir:~p&quot;</span>, [filename:absname(OutDir)])),</span><br><span class="line">    <span class="keyword">case</span> filelib:is_dir(OutDir) <span class="keyword">of</span></span><br><span class="line">        <span class="literal">true</span> -&gt; ok;</span><br><span class="line">        <span class="literal">false</span> -&gt; </span><br><span class="line">            ok = filelib:ensure_dir(OutDir), </span><br><span class="line">            ok = file:make_dir(OutDir),</span><br><span class="line">            ok</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    <span class="keyword">case</span> make:all(Options) <span class="keyword">of</span> </span><br><span class="line">        up_to_date -&gt; do_make(OutDirList); </span><br><span class="line">        error -&gt; error</span><br><span class="line">    <span class="keyword">end</span>.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">file</span><span class="params">([File, OutDirAtom|_])</span> -&gt;</span></span><br><span class="line">    do_file(File, OutDirAtom),</span><br><span class="line">    erlang:halt().</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">do_file</span><span class="params">(File, OutDirAtom)</span> -&gt;</span></span><br><span class="line">    {ok, [{_, Options}|_]} = file:consult(<span class="string">&quot;Emakefile&quot;</span>),</span><br><span class="line">    OutDir = atom_to_list(OutDirAtom),</span><br><span class="line">    R = compile:file(atom_to_list(File), Options ++ [{outdir, OutDir}, {d, debug}]),</span><br><span class="line">    msg(R).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">msg</span><span class="params">(Msg)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">case</span> Msg <span class="keyword">of</span></span><br><span class="line">        Msg <span class="keyword">when</span> is_list(Msg); is_binary(Msg) -&gt; </span><br><span class="line">            io:format(<span class="string">&quot;~s~n&quot;</span>, [Msg]);</span><br><span class="line">        _ -&gt; io:format(<span class="string">&quot;~p~n&quot;</span>, [Msg])</span><br><span class="line">    <span class="keyword">end</span>.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下SQUID安装配置</title>
      <link href="/2016/03/24/centos/centos-squid/"/>
      <url>/2016/03/24/centos/centos-squid/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>公司内网限速怎么办?</strong><br>若你满足如下条件,则可以通过<code>squid</code>简单配置实现高速上网.</p><ol><li>你有服务器权限;</li><li>服务器没有限速;</li><li>是个”不法”青年;</li></ol><p>同样的,也可以使用该方法实现通过代理上网限制某些人的”不法”行为.<br>不过,蹭服务器的网络是否就属于”不法”行为呢???</p><span id="more"></span><h3 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h3><p>默认:3128<br>可以在 squid.conf http_port 修改</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install squid -y</span><br><span class="line">chkconfig squid on</span><br><span class="line">service squid start</span><br></pre></td></tr></table></figure><h4 id="修复警告"><a href="#修复警告" class="headerlink" title="修复警告"></a>修复警告</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## /etc/squid/squid.conf</span></span><br><span class="line"><span class="comment">## 在开头增加</span></span><br><span class="line">visible_hostname .</span><br><span class="line"><span class="comment">## QQ无法发送图片</span></span><br><span class="line">acl SSL_ports port 443 80</span><br></pre></td></tr></table></figure><p><a href="http://www.mingilin.com/downloads/code/squid.conf">Centos下的Squid配置文件</a></p><h3 id="权限设置"><a href="#权限设置" class="headerlink" title="权限设置"></a>权限设置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 允许访问外网的IP</span></span><br><span class="line">acl localnet src 10.0.0.0/8</span><br><span class="line">acl localnet src 172.16.0.0/12</span><br><span class="line"><span class="comment">## 允许访问的域名</span></span><br><span class="line">acl allowdomain dstdomain baidu.com</span><br><span class="line">acl allowdomain dstdomain www.baidu.com</span><br><span class="line">http_access deny !allowdomain</span><br><span class="line"><span class="comment">## 增加访问时间限制</span></span><br><span class="line">acl time_time time MTWHF 08:00-12:00 13:00-22:00</span><br><span class="line"><span class="comment">## 增加权限</span></span><br><span class="line">auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/user.pass</span><br><span class="line">auth_param basic children 5</span><br><span class="line">auth_param basic credentialsttl 2 hours</span><br><span class="line">auth_param basic realm <span class="built_in">test</span>  <span class="comment">## test 是创建的角色</span></span><br><span class="line">acl auth_user proxy_auth REQUIRED</span><br><span class="line">http_access allow localnet time_time auth_user</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 增加一个test帐户</span></span><br><span class="line"><span class="comment">## htpasswd的用法：</span></span><br><span class="line"><span class="comment">## 增加用户</span></span><br><span class="line">htpasswd -c /etc/squid/user.pass <span class="built_in">test</span></span><br><span class="line"><span class="comment">## 修改用户密码：</span></span><br><span class="line">htpasswd -d /etc/squid/user.pass <span class="built_in">test</span></span><br><span class="line"><span class="comment">## 删除用户：</span></span><br><span class="line">htpasswd -D /etc/squid/user.pass <span class="built_in">test</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> squid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下访问windows共享目录</title>
      <link href="/2016/03/23/centos/centos-samba/"/>
      <url>/2016/03/23/centos/centos-samba/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>windows下分享的最好方式是网上邻居,共享目录.<br>如果linux作为客户机(台式机)使用的话,免不了要和共享目录打交道.<br>记录下通过samba访问windows共享目录,以及遇到的问题.<br><em>samba4已经发布,可以使用samba4替换下文中的所有命令.</em></p><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 事实上只需要samba-client即可</span></span><br><span class="line">yum -y install samba samba-client</span><br></pre></td></tr></table></figure><h3 id="linux访问windows共享目录"><a href="#linux访问windows共享目录" class="headerlink" title="linux访问windows共享目录"></a>linux访问windows共享目录</h3><h4 id="命令访问"><a href="#命令访问" class="headerlink" title="命令访问"></a>命令访问</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 列出所有的共享目录</span></span><br><span class="line">smbclient -L 192.168.6.65 -U Administrator</span><br><span class="line"><span class="comment">## 输入密码</span></span><br><span class="line">smbclient -L 192.168.6.65 -U Administrator%123456</span><br><span class="line"><span class="comment">## 访问共享目录</span></span><br><span class="line">smbclient //192.168.6.65/share -U Administrator%123456</span><br></pre></td></tr></table></figure><h4 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h4><ol><li><p>命令方式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mount -t cifs -o username=Administrator,password=123456 //192.168.6.65/share /data/windows</span><br><span class="line">umount -l /data/windows</span><br></pre></td></tr></table></figure></li><li><p>fstab方式<br>修改<code>/etc/fstab</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 加入fstab</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;//192.168.6.65/share /data/windows cifs defaults,username=Administrator,password=123456 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br><span class="line"><span class="comment">## 立即生效</span></span><br><span class="line">mount -a</span><br></pre></td></tr></table></figure></li></ol><h3 id="失败"><a href="#失败" class="headerlink" title="失败"></a>失败</h3><ol><li><p>tree connect failed: NT_STATUS_BAD_NETWORK_NAME<br>先检查指定的文件件是否共享了，然后检查共享目录的路径是否正确。</p></li><li><p>session setup failed: NT_STATUS_LOGON_FAILURE<br>检查用-U指定的用户名是否正确；<br>在Windows的开始菜单中，运行<code>secpol.msc</code>，打开安全设置，<code>本地策略</code>-&gt;<code>安全选项</code>-&gt; <code>网络访问：本地账户的共享和安全模型</code>-&gt;<code>选择经典 - 对本地用户进行身份验证，不改变其本来身份</code>；</p></li><li><p>session setup failed: NT_STATUS_LOGON_TYPE_NOT_GRANTED<br>在Windows的开始菜单中，运行<code>secpol.msc</code>，打开安全设置，<code>本地策略</code>-&gt;<code>用户权限分配</code>-&gt;<code>从网络访问此计算机，确认一下是否包含指定的用户</code>；</p></li></ol><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://free.meteor.blog.163.com/blog/static/110977532201252582527111/">http://free.meteor.blog.163.com/blog/static/110977532201252582527111/</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> samba </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一个功能全面的Linux相关网站</title>
      <link href="/2016/03/22/centos/centos-help/"/>
      <url>/2016/03/22/centos/centos-help/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>发现了一个功能全面的linux安装配置网站: <a href="http://www.server-world.info/en">http://www.server-world.info/en</a></p><span id="more"></span>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tmuxinator安装配置</title>
      <link href="/2016/03/21/centos/centos-tmuxinator/"/>
      <url>/2016/03/21/centos/centos-tmuxinator/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Tmuxinator是管理tmux的工具.</p><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install tmuxinator</span><br></pre></td></tr></table></figure><h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><ol><li>支持256色<br>在<code>~/.bashrc</code>中增加<code>export TERM=screen-256color-bce</code></li><li>新增配置</li></ol><ul><li><code>tmuxinator new blog</code></li><li>配置文件在<code>~/.tmuxinator</code>下</li></ul><h3 id="编辑配置"><a href="#编辑配置" class="headerlink" title="编辑配置"></a>编辑配置</h3><p>个人简单配置,将<code>blog.conf</code>修改为<code>blog.yml</code></p><figure class="highlight ruby"><figcaption><span>blog.conf</span><a href="/downloads/code/blog.conf">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ~/.tmuxinator/blog.yml</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">name:</span> blog</span><br><span class="line"><span class="symbol">root:</span> /data/blog</span><br><span class="line"></span><br><span class="line"><span class="comment"># Optional tmux socket</span></span><br><span class="line"><span class="comment"># socket_name: foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Runs before everything. Use it to start daemons etc.</span></span><br><span class="line"><span class="comment"># pre: sudo /etc/rc.d/mysqld start</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Runs in each window and pane before window/pane specific commands. Useful for setting up interpreter versions.</span></span><br><span class="line"><span class="comment"># pre_window: rbenv shell 2.0.0-p247</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pass command line options to tmux. Useful for specifying a different tmux.conf.</span></span><br><span class="line"><span class="comment"># tmux_options: -f ~/.tmux.mac.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Change the command to call tmux.  This can be used by derivatives/wrappers like byobu.</span></span><br><span class="line"><span class="comment"># tmux_command: byobu</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies (by name or index) which window will be selected on project startup. If not set, the first window is used.</span></span><br><span class="line"><span class="comment"># startup_window: logs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls whether the tmux session should be attached to automatically. Defaults to true.</span></span><br><span class="line"><span class="comment"># attach: false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Runs after everything. Use it to attach to tmux with custom options etc.</span></span><br><span class="line"><span class="comment"># post: tmux -CC attach -t blog</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">windows:</span></span><br><span class="line">  - <span class="symbol">editor:</span> vim /data/blog/source/_post/centos</span><br><span class="line">  - <span class="symbol">server:</span> hexo serve</span><br><span class="line">  - <span class="symbol">cmd:</span></span><br></pre></td></tr></table></figure><p>详细的配置请查看<code>man tmuxinator</code>,或者查看<a href="http://hao.jobbole.com/tmuxinator/">参考文档</a></p><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://hao.jobbole.com/tmuxinator/">http://hao.jobbole.com/tmuxinator/</a></li><li><a href="https://github.com/tmuxinator/tmuxinator/issues/84">https://github.com/tmuxinator/tmuxinator/issues/84</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> tmux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下IPTABLES配置</title>
      <link href="/2016/03/18/centos/centos-iptables/"/>
      <url>/2016/03/18/centos/centos-iptables/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>iptables作为centos下的默认防火墙,功能强大的不得了.<br>在一些简单情况下,iptables还可以实现web server(nginx, apache)的一些简单功能.<br>iptables太强大了,所以我对iptables的配置不是很了解,只记录一些常用的,备份下.</p><span id="more"></span><h3 id="升级核-可选"><a href="#升级核-可选" class="headerlink" title="升级核(可选)"></a>升级核(可选)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 可能用到</span></span><br><span class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br><span class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-6-6.el6.elrepo.noarch.rpm</span><br><span class="line">yum --enablerepo=elrepo-kernel install kernel-lt</span><br><span class="line">rpm -ql kernel-lt | grep xt_TEE</span><br></pre></td></tr></table></figure><h3 id="开启linux路由转发功能"><a href="#开启linux路由转发功能" class="headerlink" title="开启linux路由转发功能"></a>开启linux路由转发功能</h3><p>编辑<code>/etc/sysctl.conf</code>文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.ip_forward = 1</span><br></pre></td></tr></table></figure><p>使用<code>sysctl -p</code>立即生效</p><h3 id="内网端口转发"><a href="#内网端口转发" class="headerlink" title="内网端口转发"></a>内网端口转发</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 将80端口转发到4000</span></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-ports 4000</span><br></pre></td></tr></table></figure><h3 id="外网端口转发"><a href="#外网端口转发" class="headerlink" title="外网端口转发"></a>外网端口转发</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 将192.168.6.77:8000 转发到 192.168.1.245:80</span></span><br><span class="line">iptables -t nat -A PREROUTING -d 192.168.6.77 -p tcp --dport 8000 -j DNAT --to-destination 192.168.1.245:80</span><br><span class="line">iptables -t nat -A POSTROUTING -d 192.168.1.245 -p tcp --dport 80 -j SNAT --to-source 192.168.6.77:8000</span><br></pre></td></tr></table></figure><h3 id="开放端口"><a href="#开放端口" class="headerlink" title="开放端口"></a>开放端口</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t filter -A INPUT -p tcp -m state --state NEW -m tcp --dport 21 -j ACCEPT</span><br></pre></td></tr></table></figure><h3 id="清空所有的配置"><a href="#清空所有的配置" class="headerlink" title="清空所有的配置"></a>清空所有的配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -F</span><br><span class="line">iptables -F</span><br></pre></td></tr></table></figure><h3 id="保存配置"><a href="#保存配置" class="headerlink" title="保存配置"></a>保存配置</h3><p><code>service iptables save</code></p><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://www.server110.com/linux/201309/1365.html">http://www.server110.com/linux/201309/1365.html</a></li><li><a href="http://blog.chinaunix.net/uid-22780578-id-3346350.html">http://blog.chinaunix.net/uid-22780578-id-3346350.html</a></li><li><a href="http://www.linuxso.com/linuxpeixun/10332.html">http://www.linuxso.com/linuxpeixun/10332.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下pure-ftpd安装配置</title>
      <link href="/2016/03/18/centos/centos-pure-ftpd/"/>
      <url>/2016/03/18/centos/centos-pure-ftpd/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>最开始接触的<code>ftp服务器</code>是<code>vsftpd</code><br>本着探索的精神试着安装了下<code>pure-ftpd</code><br>毕竟<code>pure-ftpd</code>也是linux下的三大ftp软件之一<br>先对比一下:</p><table><thead><tr><th>–</th><th>vsftpd</th><th>pure-ftpd</th></tr></thead><tbody><tr><td>设置空密码</td><td>否</td><td>是</td></tr><tr><td>支持插件</td><td>否</td><td>是</td></tr><tr><td>配置难度</td><td>难</td><td>简单</td></tr><tr><td>安全性</td><td>据说高点</td><td></td></tr></tbody></table><span id="more"></span><h3 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h3><p><code>pure-ftpd</code>安装配置较<code>vsftpd</code>要简单很多，直接附上脚本；</p><figure class="highlight sh"><figcaption><span>pure-ftpd.sh</span><a href="/downloads/code/pure-ftpd.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## --------------------------------------</span></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line"><span class="comment">## -------------------------------------</span></span><br><span class="line"><span class="comment">## 创建的账户</span></span><br><span class="line">VUSER=ftp_user</span><br><span class="line"><span class="comment">## 账户的默认目录</span></span><br><span class="line">DEFAULT_DIR=/data/ftp_user</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">help</span></span>(){</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;-----------------------------&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; 1 - install&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; 2 - add user&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;     ex. <span class="variable">$0</span> 2 username passwd&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;     help: man pure-pw&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; 3 - uninstall&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;-----------------------------&quot;</span></span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">uninstall</span></span>(){</span><br><span class="line">    yum -y remove pure-ftpd</span><br><span class="line">    rm -rf /etc/pure-ftpd</span><br><span class="line">}</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">install</span></span>(){</span><br><span class="line">    uninstall</span><br><span class="line">    yum -y install pure-ftpd</span><br><span class="line">    <span class="comment">## 修改配置   </span></span><br><span class="line">    cat &gt; /etc/pure-ftpd/pure-ftpd.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">ChrootEveryone              yes</span></span><br><span class="line"><span class="string">BrokenClientsCompatibility  yes</span></span><br><span class="line"><span class="string">MaxClientsNumber            50</span></span><br><span class="line"><span class="string">Daemonize                   yes</span></span><br><span class="line"><span class="string">MaxClientsPerIP             8</span></span><br><span class="line"><span class="string">VerboseLog                  yes</span></span><br><span class="line"><span class="string">DisplayDotFiles             no</span></span><br><span class="line"><span class="string">AnonymousOnly               no</span></span><br><span class="line"><span class="string">NoAnonymous                 yes</span></span><br><span class="line"><span class="string">SyslogFacility              ftp</span></span><br><span class="line"><span class="string">DontResolve                 yes</span></span><br><span class="line"><span class="string">MaxIdleTime                 15</span></span><br><span class="line"><span class="string">PureDB                      /etc/pure-ftpd/pureftpd.pdb</span></span><br><span class="line"><span class="string">PAMAuthentication           yes</span></span><br><span class="line"><span class="string">LimitRecursion              10000 8</span></span><br><span class="line"><span class="string">AnonymousCanCreateDirs      no</span></span><br><span class="line"><span class="string">MaxLoad                     4</span></span><br><span class="line"><span class="string">PassivePortRange            6000 7000</span></span><br><span class="line"><span class="string">AntiWarez                   yes</span></span><br><span class="line"><span class="string">Umask                       133:022</span></span><br><span class="line"><span class="string">MinUID                      100</span></span><br><span class="line"><span class="string">UseFtpUsers                 no</span></span><br><span class="line"><span class="string">AllowUserFXP                no</span></span><br><span class="line"><span class="string">AllowAnonymousFXP           no</span></span><br><span class="line"><span class="string">ProhibitDotFilesWrite       no</span></span><br><span class="line"><span class="string">ProhibitDotFilesRead        no</span></span><br><span class="line"><span class="string">AutoRename                  no</span></span><br><span class="line"><span class="string">AnonymousCantUpload         yes</span></span><br><span class="line"><span class="string">AltLog                      clf:/var/log/pureftpd.log</span></span><br><span class="line"><span class="string">CreateHomeDir               yes</span></span><br><span class="line"><span class="string">PIDFile                     /var/run/pure-ftpd.pid</span></span><br><span class="line"><span class="string">MaxDiskUsage                99</span></span><br><span class="line"><span class="string">CustomerProof               yes</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="comment">## 增加虚拟账号的user</span></span><br><span class="line">    useradd -d <span class="variable">${DEFAULT_DIR}</span> -s /sbin/nologin <span class="variable">${VUSER}</span></span><br><span class="line">    <span class="comment">## 增加端口</span></span><br><span class="line">    iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 21 -j ACCEPT</span><br><span class="line">    iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 6000:7000 -j ACCEPT</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">add_vuser</span></span>(){</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> == <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;user can not empty.&quot;</span></span><br><span class="line">        <span class="built_in">exit</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> == <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;pass can not empty.&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> </span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    ftp_user=<span class="variable">$1</span></span><br><span class="line">    ftp_pass=<span class="variable">$2</span></span><br><span class="line">    mkdir -p <span class="variable">${DEFAULT_DIR}</span>/<span class="variable">${ftp_user}</span></span><br><span class="line">    chown <span class="variable">${VUSER}</span>:<span class="variable">${VUSER}</span> <span class="variable">${DEFAULT_DIR}</span>/<span class="variable">${ftp_user}</span> -R</span><br><span class="line">    pure-pw useradd <span class="variable">${ftp_user}</span> -u<span class="variable">${VUSER}</span> -d <span class="variable">${DEFAULT_DIR}</span>/<span class="variable">${ftp_user}</span></span><br><span class="line">    pure-pw mkdb</span><br><span class="line">    service pure-ftpd restart</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;add finish&quot;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">[1]) install;;</span><br><span class="line">[2]) add_vuser <span class="variable">$2</span> <span class="variable">$3</span>;;</span><br><span class="line">[3]) uninstall;;</span><br><span class="line">*) <span class="built_in">help</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ol><li>如何设置目录只读权限？</li></ol><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://www.lezhizhe.net/archives/129">http://www.lezhizhe.net/archives/129</a></li><li><a href="http://www.centoscn.com/image-text/install/2014/1120/4154.html">http://www.centoscn.com/image-text/install/2014/1120/4154.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> ftp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下Aria2安装以及前端配置</title>
      <link href="/2016/03/17/centos/centos-aria2/"/>
      <url>/2016/03/17/centos/centos-aria2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>先推荐一个windows下基于aria2的下载工具<a href="https://motrix.app/zh-CN/">motrix</a></p><p>公司限制了网络,无法下载大的文件<br>BUT内网服务器没有限制<br>作为一个”不法”青年,在服务器上搭建一个下载机<br>下载机将文件下载到ftp目录下,使用ftp在内网下载</p><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install aria2</span><br></pre></td></tr></table></figure><p>本脚本依赖rpmforge源，需要先添加源</p><h3 id="本地下载"><a href="#本地下载" class="headerlink" title="本地下载"></a>本地下载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## http/ftp/https下载</span></span><br><span class="line">aria2c -c -s 5 http://aaa.com/a.txt</span><br><span class="line"><span class="comment">## BT下载</span></span><br><span class="line">aria2c ./日本爱情动作片.torrent</span><br></pre></td></tr></table></figure><ul><li><code>-c</code>是断点</li><li><code>-s</code>是连接数</li></ul><h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><ol><li><p>增加配置文件<code>/etc/aria2/aria2.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/aria2</span><br><span class="line">cat &gt; /etc/aria2/aria2.conf &lt;&lt; EOF</span><br><span class="line">## 下载目录</span><br><span class="line">dir=/data/ftpuser/down/webdown</span><br><span class="line">disable-ipv6=true</span><br><span class="line">enable-rpc=true</span><br><span class="line">rpc-allow-origin-all=true</span><br><span class="line">rpc-listen-all=true</span><br><span class="line">rpc-listen-port=6800</span><br><span class="line">continue=true</span><br><span class="line">max-concurrent-downloads=3</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li><li><p>开机启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;sudo -u ftpuser aria2c --conf-path=/etc/aria2/aria2.conf&quot;</span> &gt;&gt; /etc/rc.local</span><br></pre></td></tr></table></figure><p>默认，<code>rc.local</code>内的命令是以root用户运行的，若aria2是配合其他程序，比如ftp服务器一起使用的话，建议以ftp用户运行，因此增加<code>sudo -u ftpuser</code>前缀。</p></li></ol><h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><ol><li><p>下载<a href="https://github.com/binux/yaaw.git">YAAW</a>或者<a href="https://github.com/aa65535/yaaw-zh-hans.git">YAAW汉化版</a></p></li><li><p>搜素yaaw下的文件，将<code>localhost</code>修改为实际的IP</p></li><li><p>使用nginx/apache配置服务器</p></li></ol><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://phpquan.com/arm/raspberry-pi-aria2-yaaw-downloader/">http://phpquan.com/arm/raspberry-pi-aria2-yaaw-downloader/</a></li><li><a href="http://www.hx99.net/OS/Linux/201504/36603.html">http://www.hx99.net/OS/Linux/201504/36603.html</a></li><li><a href="http://my.oschina.net/7shell/blog/325120">http://my.oschina.net/7shell/blog/325120</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> aria2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下vsftpd安装配置</title>
      <link href="/2016/03/16/centos/centos-vsftpd/"/>
      <url>/2016/03/16/centos/centos-vsftpd/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文介绍vsftpd的安装和配置，配置后的效果：</p><ul><li>禁止匿名登录</li><li>支持虚拟账户</li></ul><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install vsftpd</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="禁止匿名"><a href="#禁止匿名" class="headerlink" title="禁止匿名"></a>禁止匿名</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## vsftpd.conf</span></span><br><span class="line">anonymous_enable=NO</span><br></pre></td></tr></table></figure><h4 id="限制只能访问本地目录"><a href="#限制只能访问本地目录" class="headerlink" title="限制只能访问本地目录"></a>限制只能访问本地目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## vsftpd.conf</span></span><br><span class="line">chroot_local_user=YES</span><br></pre></td></tr></table></figure><h4 id="设置支持被动模式"><a href="#设置支持被动模式" class="headerlink" title="设置支持被动模式"></a>设置支持被动模式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## vsftpd.conf</span></span><br><span class="line">pasv_enable=YES</span><br><span class="line">pasv_min_port=6000</span><br><span class="line">pasv_max_port=7000</span><br></pre></td></tr></table></figure><h4 id="增加虚拟账号"><a href="#增加虚拟账号" class="headerlink" title="增加虚拟账号"></a>增加虚拟账号</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/vsftpd</span><br><span class="line">cat &gt; vuser &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">ftp1</span></span><br><span class="line"><span class="string">123456</span></span><br><span class="line"><span class="string">ftp2</span></span><br><span class="line"><span class="string">123456</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">db_load -T -t <span class="built_in">hash</span> -f vuser vuser.db</span><br><span class="line"></span><br><span class="line">useradd -d /data/vuser -s /sbin/nologin vuser</span><br></pre></td></tr></table></figure><h4 id="增加虚拟账号的pam认证"><a href="#增加虚拟账号的pam认证" class="headerlink" title="增加虚拟账号的pam认证"></a>增加虚拟账号的pam认证</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/pam.d/vsftpd.vuser &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">auth required pam_userdb.so db=/etc/vsftpd/vuser </span></span><br><span class="line"><span class="string">account required pam_userdb.so db=/etc/vsftpd/vuser</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h4 id="开启虚拟账号"><a href="#开启虚拟账号" class="headerlink" title="开启虚拟账号"></a>开启虚拟账号</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## vsftpd.conf</span></span><br><span class="line">guest_enable=YES</span><br><span class="line">guest_username=vuser</span><br><span class="line">pam_service_name=vsftpd.vuser</span><br></pre></td></tr></table></figure><h4 id="增加虚拟账号登录"><a href="#增加虚拟账号登录" class="headerlink" title="增加虚拟账号登录"></a>增加虚拟账号登录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## vsftpd.conf</span></span><br><span class="line">anon_upload_enable=YES</span><br></pre></td></tr></table></figure><h4 id="不同用户增加不同权限"><a href="#不同用户增加不同权限" class="headerlink" title="不同用户增加不同权限"></a>不同用户增加不同权限</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## vsftpd.conf</span></span><br><span class="line">user_config_dir=/etc/vsftpd/vuser_dir</span><br></pre></td></tr></table></figure><h4 id="每个虚拟用户，一个配置文件"><a href="#每个虚拟用户，一个配置文件" class="headerlink" title="每个虚拟用户，一个配置文件"></a>每个虚拟用户，一个配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 虚拟账户1</span></span><br><span class="line">cat &gt; /etc/vsftpd/vuser_dir/ftp1 &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">local_root=/data/FTP/ftpuser</span></span><br><span class="line"><span class="string">write_enable=YES</span></span><br><span class="line"><span class="string">anon_umask=022</span></span><br><span class="line"><span class="string">anon_world_readable_only=NO</span></span><br><span class="line"><span class="string">anon_upload_enable=YES</span></span><br><span class="line"><span class="string">anon_mkdir_write_enable=YES</span></span><br><span class="line"><span class="string">anon_other_write_enable=YES</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h4 id="增加IP限制"><a href="#增加IP限制" class="headerlink" title="增加IP限制"></a>增加IP限制</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;vsftpd:ALL&quot;</span> &gt;&gt; /etc/hosts.deny</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;vsftpd:192.168.1.0/255.255.255.0&quot;</span> &gt;&gt; /etc/hosts.allow</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;vsftpd:172.16.0.0/255.255.0.0&quot;</span> &gt;&gt; /etc/hosts.allow</span><br></pre></td></tr></table></figure><h3 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h3><p>CENTOS6下vsftpd快速安装+增加虚拟用户的脚本：</p><figure class="highlight bash"><figcaption><span>vsftpd.sh</span><a href="/downloads/code/vsftpd.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## --------------------------------------</span></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line"><span class="comment">## -------------------------------------</span></span><br><span class="line"><span class="comment">## 创建的账户</span></span><br><span class="line">VUSER=ftp_v_user</span><br><span class="line"><span class="comment">## 账户的默认目录</span></span><br><span class="line">DEFAULT_DIR=/data/ftp_v_user</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">help</span></span>(){</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;-----------------------------&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; 1 - install&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; 2 - add user&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;     ex. <span class="variable">$0</span> 2 username passwd&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; 3 - uninstall vsftpd&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; 4 - reload&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;-----------------------------&quot;</span></span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">uninstall</span></span>(){</span><br><span class="line">    yum -y remove vsftpd</span><br><span class="line">    rm -rf /etc/vsftpd</span><br><span class="line">}</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">install</span></span>(){</span><br><span class="line">    uninstall</span><br><span class="line">    yum -y install vsftpd</span><br><span class="line">    <span class="comment">## 修改配置   </span></span><br><span class="line">    cat &gt; /etc/vsftpd/vsftpd.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">anonymous_enable=NO</span></span><br><span class="line"><span class="string">local_enable=YES</span></span><br><span class="line"><span class="string">write_enable=YES</span></span><br><span class="line"><span class="string">local_umask=022</span></span><br><span class="line"><span class="string">anon_upload_enable=YES</span></span><br><span class="line"><span class="string">dirmessage_enable=YES</span></span><br><span class="line"><span class="string">xferlog_enable=YES</span></span><br><span class="line"><span class="string">connect_from_port_20=YES</span></span><br><span class="line"><span class="string">xferlog_std_format=YES</span></span><br><span class="line"><span class="string">chroot_local_user=YES</span></span><br><span class="line"><span class="string">listen=YES</span></span><br><span class="line"><span class="string">userlist_enable=YES</span></span><br><span class="line"><span class="string">tcp_wrappers=YES</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">pasv_enable=YES</span></span><br><span class="line"><span class="string">pasv_min_port=6000</span></span><br><span class="line"><span class="string">pasv_max_port=7000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">guest_enable=YES</span></span><br><span class="line"><span class="string">guest_username=${VUSER}</span></span><br><span class="line"><span class="string">pam_service_name=vsftpd.${VUSER}</span></span><br><span class="line"><span class="string">user_config_dir=/etc/vsftpd/${VUSER}_dir</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="comment">## 增加pam认证</span></span><br><span class="line">    cat &gt; /etc/pam.d/vsftpd.<span class="variable">${VUSER}</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">auth required pam_userdb.so db=/etc/vsftpd/${VUSER}</span></span><br><span class="line"><span class="string">account required pam_userdb.so db=/etc/vsftpd/${VUSER}</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="comment">## 增加虚拟目录</span></span><br><span class="line">    <span class="built_in">cd</span> /etc/vsftpd</span><br><span class="line">    touch <span class="variable">${VUSER}</span></span><br><span class="line">    mkdir <span class="variable">${VUSER}</span>_dir</span><br><span class="line">    <span class="comment">## 增加虚拟账号的user</span></span><br><span class="line">    useradd -d <span class="variable">${DEFAULT_DIR}</span> -s /sbin/nologin <span class="variable">${VUSER}</span></span><br><span class="line">    <span class="comment">## 增加端口</span></span><br><span class="line">    iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 21 -j ACCEPT</span><br><span class="line">    iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 20 -j ACCEPT</span><br><span class="line">    iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 6000:7000 -j ACCEPT</span><br><span class="line">    <span class="comment">## 增加虚拟用户</span></span><br><span class="line">    add_vuser ftptest ftptest</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">create_db</span></span>(){</span><br><span class="line">    db_load -T -t <span class="built_in">hash</span> -f /etc/vsftpd/<span class="variable">${VUSER}</span> /etc/vsftpd/<span class="variable">${VUSER}</span>.db</span><br><span class="line">    service vsftpd restart</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">add_vuser</span></span>(){</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> == <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;user can not empty.&quot;</span></span><br><span class="line">        <span class="built_in">exit</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> == <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;pass can not empty.&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> </span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    ftp_user=<span class="variable">$1</span></span><br><span class="line">    ftp_pass=<span class="variable">$2</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$ftp_user</span> &gt;&gt; /etc/vsftpd/<span class="variable">${VUSER}</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$ftp_pass</span> &gt;&gt; /etc/vsftpd/<span class="variable">${VUSER}</span></span><br><span class="line">    mkdir -p <span class="variable">${DEFAULT_DIR}</span>/<span class="variable">${ftp_user}</span></span><br><span class="line">    chown <span class="variable">${VUSER}</span>:<span class="variable">${VUSER}</span> <span class="variable">${DEFAULT_DIR}</span>/<span class="variable">${ftp_user}</span> -R</span><br><span class="line">    cat &gt; /etc/vsftpd/<span class="variable">${VUSER}</span>_dir/<span class="variable">${ftp_user}</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">local_root=${DEFAULT_DIR}/${ftp_user}</span></span><br><span class="line"><span class="string">write_enable=YES</span></span><br><span class="line"><span class="string">anon_umask=022</span></span><br><span class="line"><span class="string">anon_world_readable_only=NO</span></span><br><span class="line"><span class="string">anon_upload_enable=YES</span></span><br><span class="line"><span class="string">anon_mkdir_write_enable=YES</span></span><br><span class="line"><span class="string">anon_other_write_enable=YES</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    create_db</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;add finish&quot;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">[1]) install;;</span><br><span class="line">[2]) add_vuser <span class="variable">$2</span> <span class="variable">$3</span>;;</span><br><span class="line">[3]) uninstall;;</span><br><span class="line">[4]) create_db;;</span><br><span class="line">*) <span class="built_in">help</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://www.centoscn.com/CentosServer/ftp/2014/1215/4313.html">http://www.centoscn.com/CentosServer/ftp/2014/1215/4313.html</a></li><li><a href="http://jingyan.baidu.com/article/03b2f78c771db45ea237ae28.html">http://jingyan.baidu.com/article/03b2f78c771db45ea237ae28.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> ftp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>erlang下ssh远程执行命令</title>
      <link href="/2016/03/15/erlang/erlang-ssh/"/>
      <url>/2016/03/15/erlang/erlang-ssh/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>个人简单试了下用erlang自带的ssh模块远程登录</p><p>调用命令：</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my_ssh:exec(<span class="string">&quot;192.168.6.77&quot;</span>, <span class="number">22</span>, [&#123;user, <span class="string">&quot;root&quot;</span>&#125;, &#123;password, <span class="string">&quot;123456&quot;</span>&#125;], <span class="string">&quot;export LANG=en.UTF-8 &amp;&amp; ls -l&quot;</span>).</span><br></pre></td></tr></table></figure><span id="more"></span><p>下面贴下代码：</p><figure class="highlight erlang"><figcaption><span>my_ssh.erl</span><a href="/downloads/code/my_ssh.erl">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% ===========================================================================</span></span><br><span class="line"><span class="comment">%% @doc</span></span><br><span class="line"><span class="comment">%% TODO 模块描述.</span></span><br><span class="line"><span class="comment">%% @end</span></span><br><span class="line"><span class="comment">%% ===========================================================================</span></span><br><span class="line"><span class="keyword">-module</span><span class="params">(my_ssh)</span>.</span><br><span class="line"><span class="keyword">-author</span><span class="params">(kingwen0302)</span>.</span><br><span class="line">-version<span class="params">(<span class="number">1.0</span>)</span>.</span><br><span class="line">-date<span class="params">(&#x27;<span class="number">2016</span>-<span class="number">03</span>-<span class="number">15</span>&#x27;)</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">-export</span><span class="params">([exec/<span class="number">4</span>])</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% @doc ssh登录执行命令脚本</span></span><br><span class="line"><span class="comment">%% </span></span><br><span class="line"><span class="comment">%% for example:</span></span><br><span class="line"><span class="comment">%% ```</span></span><br><span class="line"><span class="comment">%% my_ssh:exec(&quot;192.168.6.77&quot;, 22, [{user, &quot;root&quot;}, {password, &quot;123456&quot;}], &quot;export LANG=en.UTF-8 &amp;&amp; ls -l&quot;).</span></span><br><span class="line"><span class="comment">%% &#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">%% 这个只是个测试脚本</span></span><br><span class="line"><span class="comment">%% </span></span><br><span class="line"><span class="keyword">-spec</span> exec<span class="params">(Host, Port, Options, Cmd)</span> -&gt; Return when</span><br><span class="line">    Host        :: string<span class="params">()</span>,</span><br><span class="line">    Port        :: integer<span class="params">()</span>,</span><br><span class="line">    Options     :: list<span class="params">()</span>,</span><br><span class="line">    Cmd         :: string<span class="params">()</span>,</span><br><span class="line">    Return      :: {ExitStatus, Result},</span><br><span class="line">    ExitStatus  :: integer<span class="params">()</span>,</span><br><span class="line">    Result      :: string<span class="params">()</span>.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">exec</span><span class="params">(Host, Port, Options, Cmd)</span> -&gt;</span></span><br><span class="line">    ssh:start(),</span><br><span class="line">    {ok, Ref} = ssh:connect(Host, Port, Options),</span><br><span class="line">    {ok, ChanID} = ssh_connection:session_channel(Ref, infinity),</span><br><span class="line">    <span class="keyword">case</span> ssh_connection:exec(Ref, ChanID, Cmd, infinity) <span class="keyword">of</span></span><br><span class="line">        success -&gt;</span><br><span class="line">            {ExitStatus, ReturnStr} = wait(Ref),</span><br><span class="line">            io:format(<span class="string">&quot;ExitStatus:~p~n&quot;</span>, [ExitStatus]),</span><br><span class="line">            io:format(<span class="string">&quot;ReturnStr:~n~s~n&quot;</span>, [ReturnStr]),</span><br><span class="line">            ok;</span><br><span class="line">        _ -&gt; error</span><br><span class="line">    <span class="keyword">end</span>.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">wait</span><span class="params">(Ref)</span> -&gt;</span></span><br><span class="line">    wait(Ref, <span class="number">0</span>, <span class="string">&quot;&quot;</span>).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">wait</span><span class="params">(Ref, ExitStatus, Str)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">receive</span></span><br><span class="line">        {ssh_cm, Ref, Msg} -&gt;</span><br><span class="line">            <span class="keyword">case</span> Msg <span class="keyword">of</span></span><br><span class="line">                {closed, _ChanID} -&gt;</span><br><span class="line">                    {ExitStatus, Str};</span><br><span class="line">                {data, _ChanID, _, RecvStr} -&gt;</span><br><span class="line">                    NewStr = io_lib:format(<span class="string">&quot;~s~s&quot;</span>, [Str, RecvStr]),</span><br><span class="line">                    wait(Ref, ExitStatus, NewStr);</span><br><span class="line">                {exit_status, _ChanID, Status} -&gt;</span><br><span class="line">                    wait(Ref, Status, Str);</span><br><span class="line">                _ -&gt;</span><br><span class="line">                    wait(Ref, ExitStatus, Str)</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span>.</span><br></pre></td></tr></table></figure><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://erlang.org/doc/apps/ssh/using_ssh.html">http://erlang.org/doc/apps/ssh/using_ssh.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下NGINX+PHP安装及配置</title>
      <link href="/2016/03/15/centos/centos-nginx/"/>
      <url>/2016/03/15/centos/centos-nginx/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>CENTOS下NGINX+PHP简单安装配置</p><span id="more"></span><h2 id="设置源"><a href="#设置源" class="headerlink" title="设置源"></a>设置源</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## nginx.repo</span></span><br><span class="line">[nginx]</span><br><span class="line">name=nginx repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install http://mirrors.ustc.edu.cn/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm</span><br><span class="line">yum -y install nginx</span><br><span class="line">yum -y install php php-common php-iconv php-mbstring php-fpm php-mysql php-pecl-ssh2</span><br></pre></td></tr></table></figure><h2 id="简单配置"><a href="#简单配置" class="headerlink" title="简单配置"></a>简单配置</h2><p>nginx的配置文件在<code>/etc/nginx</code>目录下</p><h3 id="基本规则"><a href="#基本规则" class="headerlink" title="基本规则"></a>基本规则</h3><ol><li>修改路径<code>root or alias</code></li><li>设置php</li><li>防火墙(开放端口80)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT</span><br><span class="line">service iptables save</span><br></pre></td></tr></table></figure></li><li>启动 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 自启动</span></span><br><span class="line">chkconfig php-fpm on</span><br><span class="line">chkconfig nginx on</span><br><span class="line"><span class="comment">## 启动服务</span></span><br><span class="line">service php-fpm restart</span><br><span class="line">service nginx restart</span><br></pre></td></tr></table></figure></li></ol><h3 id="使用域名-端口配置"><a href="#使用域名-端口配置" class="headerlink" title="使用域名+端口配置"></a><strong>使用域名+端口配置</strong></h3><p>例如: <code>www.baidu.com</code>, <code>www.baidu.com:8080</code><br><em><strong>需要更多的域名和端口</strong></em></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## /etc/nginx/conf.d/dev.game.com.conf</span></span><br><span class="line"><span class="comment">## 访问方式: dev.game.com</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>; </span><br><span class="line">    <span class="attribute">server_name</span>  dev.game.com;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123; </span><br><span class="line">        <span class="attribute">root</span>   /data/hero/server/php;</span><br><span class="line">        <span class="attribute">index</span>  index.php index.html index.htm;</span><br><span class="line">        <span class="comment">## 显示目录</span></span><br><span class="line">        <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">autoindex_exact_size</span> <span class="literal">off</span>;</span><br><span class="line">        <span class="attribute">autoindex_localtime</span> <span class="literal">on</span>;</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">    <span class="attribute">location</span> = /50x.html &#123;</span><br><span class="line">        <span class="attribute">root</span>   /usr/share/nginx/html;</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">        <span class="attribute">root</span>           /data/hero/server/php;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span>   <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">        <span class="attribute">fastcgi_index</span>  index.php;</span><br><span class="line">        <span class="attribute">fastcgi_param</span>  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">        <span class="attribute">fastcgi_connect_timeout</span> <span class="number">75</span>; </span><br><span class="line">        <span class="attribute">fastcgi_read_timeout</span> <span class="number">1200</span>;</span><br><span class="line">        <span class="attribute">fastcgi_send_timeout</span> <span class="number">1200</span>;</span><br><span class="line">        <span class="attribute">include</span>        fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用虚拟目录配置"><a href="#使用虚拟目录配置" class="headerlink" title="使用虚拟目录配置"></a><strong>使用虚拟目录配置</strong></h3><p>例如: <code>learn.mingilin.com/rust</code>, <code>learn.mingilin.com/centos_daily</code><br><em><strong>同一个域名和端口下可以建立多个网站</strong></em></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## /etc/nginx/conf.d/default.conf</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>; </span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line">    <span class="attribute">include</span> /etc/nginx/conf.d/vhost.d/<span class="regexp">*.conf</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## /etc/nginx/conf.d/vhost.d/dev.conf</span></span><br><span class="line"><span class="comment">## 访问方式: localhost/hero/server/php</span></span><br><span class="line"><span class="attribute">location</span> /hero/server/php &#123;</span><br><span class="line">    <span class="attribute">root</span>   /data;</span><br><span class="line">    <span class="comment">## alias /data/hero/server/php;</span></span><br><span class="line">    <span class="attribute">index</span>  index.php index.html index.htm;</span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span>   <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">        <span class="attribute">fastcgi_index</span>  index.php;</span><br><span class="line">        <span class="attribute">fastcgi_param</span>  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">        <span class="attribute">fastcgi_connect_timeout</span> <span class="number">75</span>; </span><br><span class="line">        <span class="attribute">fastcgi_read_timeout</span> <span class="number">1200</span>;</span><br><span class="line">        <span class="attribute">fastcgi_send_timeout</span> <span class="number">1200</span>;</span><br><span class="line">        <span class="attribute">include</span>        fastcgi_params;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## /etc/nginx/conf.d/vhost.d/eat.conf</span></span><br><span class="line"><span class="comment">## 访问方式: localhost/eat</span></span><br><span class="line"><span class="attribute">location</span> /eat &#123;</span><br><span class="line">    <span class="attribute">root</span>    /data/help_doc;</span><br><span class="line">    <span class="attribute">index</span>   index.php index.html index.htm;</span><br><span class="line">    <span class="attribute">location</span> ~\.php$ &#123;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span>   <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">        <span class="attribute">fastcgi_index</span>  index.php;</span><br><span class="line">        <span class="attribute">fastcgi_param</span>  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">        <span class="attribute">include</span>        fastcgi_params;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><em><strong>$document_root的设置非常关键, 否则php无法使用</strong></em></p></blockquote><h3 id="http-https代理"><a href="#http-https代理" class="headerlink" title="http/https代理"></a>http/https代理</h3><figure class="highlight nginx"><figcaption><span>server/8080.conf</span><a href="/downloads/code/nginx_proxy_conf\server\8080.conf">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> proxy_server {</span><br><span class="line">    <span class="attribute">server</span> localhost:<span class="number">8081</span>;</span><br><span class="line">    <span class="attribute">server</span> localhost:<span class="number">8082</span>;</span><br><span class="line">    ip_hash;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> {</span><br><span class="line">    <span class="attribute">listen</span>      <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">location</span> / {</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://proxy_server;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   Host             $host;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   X-Real-IP        $remote_addr;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line">        <span class="attribute">proxy_next_upstream</span> <span class="literal">error</span> timeout invalid_header http_500 http_502 http_503 http_504;</span><br><span class="line">        <span class="attribute">proxy_max_temp_file_size</span> <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">proxy_connect_timeout</span>      <span class="number">90</span>;</span><br><span class="line">        <span class="attribute">proxy_send_timeout</span>         <span class="number">90</span>;</span><br><span class="line">        <span class="attribute">proxy_read_timeout</span>         <span class="number">90</span>;</span><br><span class="line">        <span class="attribute">proxy_buffer_size</span>          <span class="number">4k</span>;</span><br><span class="line">        <span class="attribute">proxy_buffers</span>              <span class="number">4</span> <span class="number">32k</span>;</span><br><span class="line">        <span class="attribute">proxy_busy_buffers_size</span>    <span class="number">64k</span>;</span><br><span class="line">        <span class="attribute">proxy_temp_file_write_size</span> <span class="number">64k</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>采用ip_hash的轮询方法,每个ip在一定时间内会被固定的后端服务器<br>可以解决session共享问题</p><h3 id="tcp代理"><a href="#tcp代理" class="headerlink" title="tcp代理"></a>tcp代理</h3><p><strong>需要编译时加入<code>--with-stream</code>参数, 使用<code>nginx -V</code>查询</strong></p><figure class="highlight nginx"><figcaption><span>tcp/8083.conf</span><a href="/downloads/code/nginx_proxy_conf\tcp\8083.conf">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">stream</span> {</span><br><span class="line">    <span class="attribute">upstream</span> mysqld {</span><br><span class="line">        <span class="attribute">server</span> <span class="number">127.0.0.1:3306</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="section">server</span> {</span><br><span class="line">        <span class="attribute">listen</span>      <span class="number">8083</span>;</span><br><span class="line">        <span class="attribute">proxy_pass</span> mysqld;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p><code>stream</code>和<code>http</code>是同级目录</p><figure class="highlight nginx"><figcaption><span>nginx.conf</span><a href="/downloads/code/nginx_proxy_conf\nginx.conf">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">error_log</span>  logs/error.log;</span><br><span class="line"><span class="attribute">error_log</span>  logs/error.log  <span class="literal">notice</span>;</span><br><span class="line"><span class="attribute">error_log</span>  logs/error.log  <span class="literal">info</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> {</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">http</span> {</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">include</span> d:/nginx/conf/server/*.conf;</span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="attribute">include</span> d:/nginx/conf/tcp/*.conf;</span><br></pre></td></tr></table></figure><h2 id="Windows配置"><a href="#Windows配置" class="headerlink" title="Windows配置"></a>Windows配置</h2><ol><li><p>配置与Linux基本相同, 要特殊处理下启动</p></li><li><p>要使用特殊的<a href="./../../res/RunHiddenConsole.exe">工具</a>来执行启动</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="comment">REM Windows 下无效</span></span><br><span class="line"><span class="comment">REM set PHP_FCGI_CHILDREN=5</span></span><br><span class="line"><span class="comment">REM 每个进程处理的最大请求数，或设置为 Windows 环境变量</span></span><br><span class="line"><span class="built_in">set</span> PHP_FCGI_MAX_REQUESTS=<span class="number">1000</span></span><br><span class="line"><span class="built_in">echo</span> Starting PHP FastCGI...</span><br><span class="line"><span class="function">D:</span></span><br><span class="line"><span class="function"><span class="title">cd</span> <span class="title">D</span>:/<span class="title">php</span></span></span><br><span class="line"><span class="function"><span class="title">RunHiddenConsole</span> <span class="title">D</span>:/<span class="title">php</span>/<span class="title">php</span>-<span class="title">cgi.exe</span> -<span class="title">b</span> 127.0.0.1:9000</span></span><br><span class="line"><span class="function"><span class="title">echo</span> <span class="title">Starting</span> <span class="title">nginx</span>...</span></span><br><span class="line"><span class="function"><span class="title">D</span>:</span></span><br><span class="line"><span class="function"><span class="title">cd</span> <span class="title">D</span>:/<span class="title">nginx</span></span></span><br><span class="line"><span class="function"><span class="title">RunHiddenConsole</span> <span class="title">D</span>:/<span class="title">nginx</span>/<span class="title">nginx.exe</span></span></span><br><span class="line"><span class="function"><span class="title">pause</span></span></span><br></pre></td></tr></table></figure> <figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="comment">REM stop_nginx.bat</span></span><br><span class="line"><span class="built_in">echo</span> Stopping nginx...</span><br><span class="line"><span class="built_in">taskkill</span> /F /IM nginx.exe &gt;<span class="built_in">nul</span></span><br><span class="line"><span class="built_in">echo</span> Stopping PHP FastCGI...</span><br><span class="line"><span class="built_in">taskkill</span> /F /IM php-cgi.exe &gt;<span class="built_in">nul</span></span><br><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure></li><li><p>也可以使用<code>nssm</code>注册为服务启动/关闭</p></li><li><p>在erl帮助文档的时候,需要手动跳转下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;refresh&quot;</span> <span class="attr">content</span>=<span class="string">&quot;0;url=doc/index.html&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> nginx </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>erlang与其他语言通信的几种方式</title>
      <link href="/2016/03/10/erlang/erlang-communication/"/>
      <url>/2016/03/10/erlang/erlang-communication/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>一个项目的开发可能涉及若干种语言，前端、后端、后台都有不同的适合的语言，比如在游戏中，前端用<code>C+Lua</code>，后端用<code>Erlang</code>，后台用<code>PHP</code>，不同语言直接的通信就成了一个比较棘手的问题，下面简单讨论几组可能的实现方式：</p><h2 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h2><h3 id="基于自定义协议的Socket请求"><a href="#基于自定义协议的Socket请求" class="headerlink" title="基于自定义协议的Socket请求"></a>基于自定义协议的Socket请求</h3><p>前端（或者后台）与后端约定好协议格式，以协议的方式通信。</p><h3 id="基于HTTP的请求"><a href="#基于HTTP的请求" class="headerlink" title="基于HTTP的请求"></a>基于HTTP的请求</h3><p>后端架设一个HTTP服务器，前端（或者后台）通过HTTP请求将需要执行的命令以参数的形式传递给后端。</p><h2 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h2><p>Erlang开启SSH服务器，前端（或者后台）通过插件SSH登录到Erlang服务器，执行命令。</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Eshell V5.<span class="number">10.4</span>  (abort with ^G)</span><br><span class="line"><span class="number">1</span>&gt; ssh:start().</span><br><span class="line"><span class="number">2</span>&gt; ssh:daemon(<span class="number">10000</span>, [&#123;user_passwords, [&#123;<span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>&#125;]&#125;]).</span><br></pre></td></tr></table></figure><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sshpass -p <span class="number">123456</span> ssh -p <span class="number">10000</span> root@<span class="number">127.0</span>.<span class="number">0.1</span> &#x27;lists:seq(<span class="number">1</span>, <span class="number">10</span>).&#x27;</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql多实例脚本</title>
      <link href="/2016/03/10/mysql/mysql-instance/"/>
      <url>/2016/03/10/mysql/mysql-instance/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="为什么多实例"><a href="#为什么多实例" class="headerlink" title="为什么多实例"></a>为什么多实例</h2><ol><li>[单实例]缺少DBA，无法优化单实例性能；</li><li>[单实例]系统本身设计问题，影响单实例性能；</li><li>[单实例]预料之外，而且不能重启数据库；</li><li>[多实例]克服以上缺点；</li><li>[多实例]某个实例出现问题，不会影响到其他实例；</li></ol><span id="more"></span><h2 id="多实例脚本"><a href="#多实例脚本" class="headerlink" title="多实例脚本"></a>多实例脚本</h2><figure class="highlight bash"><figcaption><span>mysql_instance.sh</span><a href="/downloads/code/mysql_instance.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">PORT=<span class="variable">${MYSQL_PORT}</span></span><br><span class="line">DB_PATH=<span class="variable">${MYSQL_PATH}</span></span><br><span class="line">CNF_PATH=/etc/my.cnf.<span class="variable">${PORT}</span></span><br><span class="line">SOCK_FILE=/tmp/mysql_<span class="variable">${PORT}</span>.sock</span><br><span class="line">DB_PASS=<span class="variable">${DB_PASSWORD}</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;初始化数据库&quot;</span></span><br><span class="line">mysql_install_db --user=mysql --datadir=<span class="variable">${DB_PATH}</span></span><br><span class="line"></span><br><span class="line">cat &gt; <span class="variable">${CNF_PATH}</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string">port=${PORT}</span></span><br><span class="line"><span class="string">datadir=${DB_PATH}</span></span><br><span class="line"><span class="string">socket=${SOCK_FILE}</span></span><br><span class="line"><span class="string">user=mysql</span></span><br><span class="line"><span class="string">symbolic-links=0</span></span><br><span class="line"><span class="string">innodb_file_per_table</span></span><br><span class="line"><span class="string">max_connections=400</span></span><br><span class="line"><span class="string">[mysqld_safe]</span></span><br><span class="line"><span class="string">log-error=/var/log/mysqld_${PORT}.log</span></span><br><span class="line"><span class="string">pid-file=/var/run/mysqld/mysqld_${PORT}.pid</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;启动守护进程&quot;</span></span><br><span class="line">mysqld_safe --defaults-file=<span class="variable">${CNF_PATH}</span> 2&gt;&amp;1 &gt; /dev/null &amp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -S <span class="variable">${SOCK_FILE}</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;.&quot;</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;.&quot;</span></span><br><span class="line">    sleep 1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;初始化密码&quot;</span></span><br><span class="line">mysqladmin -u root password <span class="variable">${DB_PASS}</span> -S <span class="variable">${SOCK_FILE}</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;权限设置&quot;</span></span><br><span class="line">cat &gt; tmp.sql &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;127.0.0.1&#x27; IDENTIFIED BY &#x27;${DB_PASS}&#x27;; </span></span><br><span class="line"><span class="string">flush privileges;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">mysql -uroot -p<span class="variable">${DB_PASS}</span> -S <span class="variable">${SOCK_FILE}</span> -e <span class="string">&quot;source tmp.sql;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;完成&quot;</span></span><br><span class="line"><span class="comment">## 关闭数据库</span></span><br><span class="line"><span class="comment">## mysqladmin -u root -p${DB_PASS} -S ${SOCK_FILE} shutdown</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>erlang下http请求的几种方式</title>
      <link href="/2016/03/10/erlang/erlang-httpc/"/>
      <url>/2016/03/10/erlang/erlang-httpc/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>游戏开发中,需要对接平台SDK<br>验证流程大概是:</p><ol><li>客户端登录平台,获取authorize_code,并发送给服务端</li><li>服务端向平台验证authorize_code,同时获得user_id</li><li>服务端验证通过后进行游戏登录</li></ol><p>验证方式有<code>GET</code>,<code>POST</code>,<code>JSON</code>等方式,用到的是<code>erlang</code>的<code>httpc</code>模块.</p><span id="more"></span><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">inets:start(),</span><br><span class="line">ssl:start().</span><br></pre></td></tr></table></figure><h4 id="GET方式"><a href="#GET方式" class="headerlink" title="GET方式"></a>GET方式</h4><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Url = <span class="string">&quot;http://xxx.com?a=1&amp;b=2&amp;c=3&quot;</span>,</span><br><span class="line">httpc:request(get, &#123;Url, []&#125;, [&#123;timeout, <span class="number">20000</span>&#125;], []).</span><br></pre></td></tr></table></figure><h4 id="POST方式"><a href="#POST方式" class="headerlink" title="POST方式"></a>POST方式</h4><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Url = <span class="string">&quot;http://xxx.com&quot;</span>,</span><br><span class="line">PostStr = <span class="string">&quot;a=1&amp;b=2&amp;c=3&quot;</span>,</span><br><span class="line">httpc:request(post, &#123;Url, [], <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>, PostStr&#125;, [&#123;version, <span class="string">&quot;HTTP/1.1&quot;</span>&#125;, &#123;timeout, <span class="number">10000</span>&#125;], []).</span><br></pre></td></tr></table></figure><h4 id="JSON方式"><a href="#JSON方式" class="headerlink" title="JSON方式"></a>JSON方式</h4><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SendData= [&#123;<span class="string">&quot;sign&quot;</span>, MD5&#125;],</span><br><span class="line">SendJson = rfc4627:encode(to_rfc4627(SendData)),</span><br><span class="line">Url = <span class="string">&quot;http://xxx.com&quot;</span>,</span><br><span class="line">httpc:request(post, &#123;Url, [], <span class="string">&quot;application/json; charset=utf-8&quot;</span>, SendJson&#125;, [&#123;version, <span class="string">&quot;HTTP/1.1&quot;</span>&#125;, &#123;timeout, <span class="number">10000</span>&#125;], []).</span><br></pre></td></tr></table></figure><h4 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h4><ol><li>Url<br>在拼接字符串的时候，<code>Url=Url_1++Url_2</code>,生成的字符串可能是<code>Url= [123, 123, 33, 2]</code>，使用<code>Url = binary_to_list(list_to_binary(TmpUrl))</code>避免；PostStr也类似，如果参数支持binary()的话，果断传递binary()。</li></ol>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
            <tag> httpc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centos下yum安装erlang</title>
      <link href="/2016/03/10/erlang/erlang-yum-install/"/>
      <url>/2016/03/10/erlang/erlang-yum-install/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>源码安装erlang尽管性能上好很多，但各种工具以及编译参数的设置也是一个头疼的事情。</p><p>yum安装具有简单快速的优点：<br>下面是快速安装erlang的脚本</p><ul><li><p><code>R14</code>用<code>epel</code>源</p></li><li><p><code>R16+</code>可以使用下面的脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y wget</span><br><span class="line">rpm --import http://binaries.erlang-solutions.com/debian/erlang_solutions.asc</span><br><span class="line">wget -O /etc/yum.repos.d/erlang_solutions.repo  http://binaries.erlang-solutions.com/rpm/centos/erlang_solutions.repo</span><br><span class="line">yum install -y esl-erlang-R16B03</span><br></pre></td></tr></table></figure></li><li><p><code>R15</code>或者其他版本要么放弃，要么源码安装，没有其他办法了。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安装系统到U盘</title>
      <link href="/2016/03/10/windows/windows-install-to-usb/"/>
      <url>/2016/03/10/windows/windows-install-to-usb/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>安装系统到U盘是一个作死的玩法,且不说io读写速度,驱动也是一个麻烦的问题.<br>虽然不齿,但是还是要知道怎么作死.</p><span id="more"></span><h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><ul><li>virtualbox</li><li>U盘</li></ul><!-- more --><h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><ul><li>创建一个没有虚拟硬盘的虚拟机</li><li>启动虚拟机</li><li>设备 -&gt; 分配USB设备</li><li>finish</li></ul>]]></content>
      
      
      <categories>
          
          <category> windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>生成小图片的数据流</title>
      <link href="/2016/03/10/php/php-data-url/"/>
      <url>/2016/03/10/php/php-data-url/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>经常看到代码中有使用<code>&lt;img src=&quot;data:image/jpg;base64,xxxx&quot; /&gt;</code>格式的图片<br>生成如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$img_file</span> = file_get_contents(<span class="string">&quot;a.png&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;data:image/jpg;base64,&quot;</span>.base64_encode(<span class="variable">$img_file</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>执行<code>php a.php</code>生成</p>]]></content>
      
      
      <categories>
          
          <category> php </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VIM配置</title>
      <link href="/2016/03/10/vim/vim-install/"/>
      <url>/2016/03/10/vim/vim-install/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>丰富的插件成就了编辑器之神<code>vim</code></p><p>个人的<a href="https://github.com/kingwen0302/vim.git">vim配置</a>托管在<a href="https://github.com/">github</a>，具有如下特(chui)点(shui)：  </p><ul><li>适合在linux下使用；   </li><li>使用Bundle管理插件，分分钟完成安装（网络好的情况）；   </li><li>安装方便，可以放到任何有权限访问的目录，只需简单修改两行配置即可；  </li><li>配置简单，每个插件一个配置文件，简单管理； </li></ul>]]></content>
      
      
      <categories>
          
          <category> vim </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows下安装ubuntu</title>
      <link href="/2016/03/10/ubuntu/ubuntu-install/"/>
      <url>/2016/03/10/ubuntu/ubuntu-install/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h4 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h4><ul><li>EasyBCD</li><li>Ubuntu14.04</li><li>MbrFix</li></ul><p>下载地址问百度</p><span id="more"></span><h4 id="硬盘安装"><a href="#硬盘安装" class="headerlink" title="硬盘安装"></a>硬盘安装</h4><ul><li>安装EasyBCD</li><li>运行EasyBCD,添加新条目-&gt;NeoGrub-&gt;安装-&gt;配置<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">title Install Ubuntu</span><br><span class="line">root (hd0,0)</span><br><span class="line">kernel (hd0,0)/vmlinuz boot=casper iso-scan/filename=/ubuntu.iso ro quiet splash locale=zh_CN.UTF-8</span><br><span class="line">initrd (hd0,0)/initrd.lz</span><br></pre></td></tr></table></figure></li><li>将ubuntu.iso放到C盘根目录, 解压其中的**.disk文件夹<strong>和</strong>initrd.lz<strong>和</strong>vmlinuz.efi**文件到C盘根目录<br>initrd.lz 和 mlinuz.efi 在 casper文件夹下</li><li>复制一份vmlinuz.efi, 改名为vmlinuz</li><li>重启计算机</li><li>选择NeoGrub引导器</li><li>加载ubuntu后, <strong>Ctrl+Alt+T</strong>打开终端, 输入<code>sudo umount -l /isodevice</code><br>可以多输入几次, 确保</li><li>安装</li><li>修复引导<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##一般默认就会添加的</span></span><br><span class="line">sudo gedit /etc/default/grub</span><br><span class="line">GRUB_TIMEOUT=<span class="string">&quot;10&quot;</span></span><br><span class="line">sudo update-grub</span><br></pre></td></tr></table></figure></li></ul><h3 id="卸载ubuntu"><a href="#卸载ubuntu" class="headerlink" title="卸载ubuntu"></a>卸载ubuntu</h3><ul><li>下载MbrFix</li><li>管理员运行-&gt;Cmd-&gt;切换到MbrFix所在目录<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mbrfix /drive 0 fixmbr</span><br></pre></td></tr></table></figure></li><li>在windows下将linux的分区删除</li><li>删除bcd<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rem 管理员运行-&gt;Cmd</span><br><span class="line">bcdedit</span><br><span class="line">bcdedit /delete &#123;default&#125;</span><br></pre></td></tr></table></figure></li><li>使用easybcd删除</li></ul><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://www.linuxidc.com/Linux/2014-04/100369.htm">http://www.linuxidc.com/Linux/2014-04/100369.htm</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>erlang性能调优</title>
      <link href="/2016/03/10/erlang/erlang/"/>
      <url>/2016/03/10/erlang/erlang/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><ol><li>通过<code>erlang:process_info(PID, reductions).</code>粗略评估进程的负载，如果值相对其他进程很大的话，负载会很高。</li><li>【不建议使用】通过<code>spawn_opt/4</code>来设置垃圾回收，<code>erlang:system_info(fullsweep_after)</code>，可以使用<code>erl -env ERL_FULLSWEEP_AFTER 0</code>来加快垃圾回收，这个值可以设置为10~20。<span id="more"></span></li><li>垃圾回收是以进程为单位，垃圾回收的时候会导致进程挂起，每一个进程都只有一小部分活跃数据(live data)，所以垃圾回收将会是一个很快的操作。</li><li>垃圾回收可以强制执行<code>erlang:garbage_collect(PID)</code>，但是不建议使用。</li><li>HiPE(High Performance Erlang) 在运算上会快2-3倍。</li><li>节点联通<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% 连接节点</span></span><br><span class="line">net_kernel:connect_node(&#x27;test@localhost&#x27;).</span><br><span class="line"><span class="comment">%% 限定指定节点可以联通</span></span><br><span class="line">net_kernnel:allow(Nodes).</span><br><span class="line"><span class="comment">%% 联通节点</span></span><br><span class="line">net_adm:ping(&#x27;test@localhost&#x27;).</span><br><span class="line"><span class="comment">%% 主动断开节点</span></span><br><span class="line">[net_kernel:disconnect(X) || X &lt;- nodes() -- [List_of_wanted_nodes]].</span><br><span class="line"><span class="comment">%% 在rpc:call时，会自动节点联通</span></span><br><span class="line"><span class="comment">%% 可以设置取消自动联通</span></span><br><span class="line">erl -kernel dist_auto_connect never</span><br></pre></td></tr></table></figure></li><li><code>foo()</code> &gt; <code>bar:foo()</code> &gt; (<code>Mod:Func()</code> ≈<code>F()</code>) &gt; <code>apply(Mod, Func, Args)</code>，匿名函数和apply/3在性能上是比较差的，但是在一般的编程中，这些差异可以忽略。</li><li>进程字典非常的快，但是打破了变量不变的原则，因此在书中都不建议使用，但是确实很快，比ets快一个数量级。但是这个测试也应该存在问题：ets是进程实现的，进程内部和进程之间的操作比较是否不太合理呢？  </li><li>进程间数据共享的几种方式：<ul><li>独立进程（<code>gen_server:call(PID, &#123;get, test&#125;)</code>）</li><li>ETS</li><li>application（<code>application:get(APP, test)</code>）</li><li>mochiglobal模块(动态编译，没有看）</li></ul></li><li>内存泄露排查<br>erlang中的内存泄露有两类，一类是进程内部逻辑，一类是没有正常销毁进程：<br>进程内部的通过<code>erlang:process_info(PID, memory)</code>按照memory占用大小排序，获得最占用内存的进程。<br>进程间通过shell的<code>i()</code>获得没有正常销毁的进程PID，然后<code>erlang:process_info(PID)</code>分析。</li></ol>]]></content>
      
      
      <categories>
          
          <category> erlang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> erlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GITHUB SSH登录</title>
      <link href="/2016/03/10/github/github-ssh-login/"/>
      <url>/2016/03/10/github/github-ssh-login/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>GITHUB支持<code>https</code>,<code>ssh</code>登录，<code>ssh</code>登录方便快捷。</p><span id="more"></span><h4 id="生成public-key"><a href="#生成public-key" class="headerlink" title="生成public key"></a>生成public key</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.ssh</span><br><span class="line"><span class="comment">## 这步很重要，默认ssh只扫描id_rsa</span></span><br><span class="line">cp 自己的key id_rsa</span><br><span class="line">chmod 400 id_rsa</span><br></pre></td></tr></table></figure><h4 id="将key加入github中："><a href="#将key加入github中：" class="headerlink" title="将key加入github中："></a>将key加入github中：</h4><p><code>github</code> -&gt; <code>Settings</code> -&gt; <code>SSH keys</code> -&gt; <code>添加ssh</code></p><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br><span class="line"><span class="comment">## debug</span></span><br><span class="line">ssh -T -v git@github.com</span><br></pre></td></tr></table></figure><p>然后<code>git</code>操作就不需要密码了</p><h4 id="参考文档："><a href="#参考文档：" class="headerlink" title="参考文档："></a>参考文档：</h4><p><a href="http://mqing720.blog.163.com/blog/static/2822000020152157483265/">git连接失败</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TMUX安装配置</title>
      <link href="/2016/03/10/centos/centos-tmux/"/>
      <url>/2016/03/10/centos/centos-tmux/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>TMUX安装配置</p><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><figcaption><span>install_tmux.sh</span><a href="/downloads/code/install_tmux.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">yum -y remove tmux</span><br><span class="line">yum -y install gcc kernel-devel make ncurses-devel</span><br><span class="line"></span><br><span class="line">curl -OL https://github.com/libevent/libevent/releases/download/release-2.0.22-stable/libevent-2.0.22-stable.tar.gz</span><br><span class="line">tar -xvzf libevent-2.0.22-stable.tar.gz</span><br><span class="line"><span class="built_in">cd</span> libevent-2.0.22-stable</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">curl -OL https://github.com/tmux/tmux/releases/download/2.1/tmux-2.1.tar.gz</span><br><span class="line">tar -xvzf tmux-2.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> tmux-2.1</span><br><span class="line">LDFLAGS=<span class="string">&quot;-L/usr/local/lib -Wl,-rpath=/usr/local/lib&quot;</span> ./configure --prefix=/usr/<span class="built_in">local</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><p>tmux类似screen，但是分屏更加强大</p><h3 id="tmux默认的key"><a href="#tmux默认的key" class="headerlink" title="tmux默认的key"></a>tmux默认的key</h3><p>ctrl+b</p><h3 id="几个概念"><a href="#几个概念" class="headerlink" title="几个概念"></a>几个概念</h3><p>会话</p><p>窗口</p><p>pane</p><p>一个会话下可以有多个窗口（c-b w），一个窗口下可以有多个pane（c-b “, c-b %）</p><h3 id="几个常用的快捷键"><a href="#几个常用的快捷键" class="headerlink" title="几个常用的快捷键"></a>几个常用的快捷键</h3><table><thead><tr><th>快捷键</th><th>描述</th></tr></thead><tbody><tr><td>C-b c</td><td>创建一个新的窗口</td></tr><tr><td>C-b n</td><td>切换到下一个窗口</td></tr><tr><td>C-b p</td><td>切换到上一个窗口</td></tr><tr><td>C-b l</td><td>最后一个窗口,和上一个窗口的概念不一样哟,谁试谁知道</td></tr><tr><td>c-b w</td><td>通过上下键选择当前窗口中打开的会话</td></tr><tr><td>C-b 数字</td><td>直接跳到你按的数字所在的窗口</td></tr><tr><td>C-b &amp;</td><td>退出当前窗口</td></tr><tr><td>C-b d</td><td>临时断开会话 断开以后,还可以连上的哟</td></tr><tr><td>C-b “</td><td>分割出来一个窗口</td></tr><tr><td>C-b %</td><td>分割出来一个窗口</td></tr><tr><td>C-b o</td><td>在小窗口中切换</td></tr><tr><td>C-b (方向键)</td><td>pane切换</td></tr><tr><td>C-b !</td><td>关闭所有小窗口</td></tr><tr><td>C-b x</td><td>关闭当前光标处的小窗口</td></tr><tr><td>C-b t</td><td>钟表</td></tr><tr><td>C-b pageup/pagedo</td><td></td></tr><tr><td>C-b Tab</td><td>开启关闭侧边栏（需要插件支持）</td></tr></tbody></table><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><ul><li><p><code>/etc/tmux.conf</code></p></li><li><p><code>~/.tmux.conf</code></p></li><li><p><code>C-b :</code>-&gt;<code>source ~/.tmux.conf</code>-&gt;<code>配置生效</code></p></li></ul><figure class="highlight bash"><figcaption><span>.tmux.conf</span><a href="/downloads/code/.tmux.conf">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">unbind C-a</span><br><span class="line"><span class="built_in">set</span> -g prefix C-b</span><br><span class="line"><span class="built_in">set</span> -g mouse on</span><br><span class="line"><span class="comment">## 使用ctrl-b : -&gt; set mouse off 关闭使用鼠标</span></span><br><span class="line">setw -g mode-keys vi</span><br><span class="line">setw -g utf8 on</span><br><span class="line"><span class="built_in">set</span> -g base-index 1</span><br><span class="line"><span class="built_in">set</span> -g pane-base-index 1</span><br><span class="line"><span class="built_in">set</span> -g monitor-activity off</span><br><span class="line"><span class="built_in">set</span> -g monitor-silence 0</span><br><span class="line"><span class="built_in">set</span> -g bell-action none</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -g @plugin <span class="string">&#x27;tmux-plugins/tpm&#x27;</span></span><br><span class="line"><span class="built_in">set</span> -g @plugin <span class="string">&#x27;tmux-plugins/tmux-sidebar&#x27;</span></span><br><span class="line"><span class="built_in">set</span> -g @plugin <span class="string">&#x27;tmux-plugins/tmux-logging&#x27;</span></span><br><span class="line">run <span class="string">&#x27;~/.tmux/plugins/tpm/tpm&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 新建一个新的tmux</span></span><br><span class="line">tmux new-session -s name</span><br><span class="line"><span class="comment">## -2 是支持256色，否则vim的256色不支持</span></span><br><span class="line">tmux -2 -f ~/.tmux.conf attach-session -t name</span><br></pre></td></tr></table></figure><h3 id="快速创建session小脚本"><a href="#快速创建session小脚本" class="headerlink" title="快速创建session小脚本"></a>快速创建session小脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">## 创建一个会话</span></span><br><span class="line">tmux new-session -d -s <span class="variable">$USER</span></span><br><span class="line"><span class="comment">## 重命名会话的第一个窗口</span></span><br><span class="line">tmux rename-window -t <span class="variable">$USER</span> <span class="string">&#x27;dev&#x27;</span></span><br><span class="line"><span class="comment">## 分割第一个窗口</span></span><br><span class="line">tmux split-window -h -t <span class="variable">$USER</span></span><br><span class="line"><span class="comment">## 分割第一个窗口中的第二个pane</span></span><br><span class="line">tmux split-window -v -t <span class="variable">$USER</span>:0.1</span><br><span class="line"><span class="comment">## 在第一个窗口中的第一个pane运行top命令</span></span><br><span class="line">tmux send-keys -t <span class="variable">$USER</span>:0.0 <span class="string">&#x27;top&#x27;</span> C-m</span><br><span class="line"><span class="comment">## 创建一个新的窗口</span></span><br><span class="line">tmux new-window -n <span class="string">&#x27;stable&#x27;</span> -t <span class="variable">$USER</span></span><br><span class="line"><span class="comment">## 分割新的窗口</span></span><br><span class="line">tmux split-window -h -t <span class="variable">$USER</span>:1</span><br></pre></td></tr></table></figure><h3 id="创建并分割窗口脚本"><a href="#创建并分割窗口脚本" class="headerlink" title="创建并分割窗口脚本"></a>创建并分割窗口脚本</h3><p>包含一个发送命令窗口和N个接收命令窗口</p><figure class="highlight bash"><figcaption><span>myTmux.sh</span><a href="/downloads/code/myTmux.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -----------------------------------</span></span><br><span class="line"><span class="comment">## 生成如下的TMUX窗口</span></span><br><span class="line"><span class="comment">## pane1是发送命令窗口</span></span><br><span class="line"><span class="comment">## 其他panes(接近等高)是接收命令窗口</span></span><br><span class="line"><span class="comment">## -----------------------------------</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## +-------------+------+</span></span><br><span class="line"><span class="comment">## |      0      |CMD:  |</span></span><br><span class="line"><span class="comment">## +-------------+      |</span></span><br><span class="line"><span class="comment">## |      3      |  1   |</span></span><br><span class="line"><span class="comment">## +-------------+      |</span></span><br><span class="line"><span class="comment">## |      2      |      |</span></span><br><span class="line"><span class="comment">## +-------------+------+</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line">PANE_NUM=4</span><br><span class="line"></span><br><span class="line"><span class="comment">## -------------------------</span></span><br><span class="line"><span class="comment">## 内部函数</span></span><br><span class="line"><span class="comment">## -------------------------</span></span><br><span class="line">LOCAL_FILE=<span class="variable">$0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建tmux</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">create</span></span>(){</span><br><span class="line">    tmux new-session -d -s update</span><br><span class="line">    tmux split-window -h -t update -p 30</span><br><span class="line">    <span class="keyword">for</span>((index=0; index&lt;$((<span class="variable">$PANE_NUM</span>-<span class="number">1</span>));index++)); <span class="keyword">do</span></span><br><span class="line">        percent=$(( <span class="number">100</span>  / (<span class="variable">$PANE_NUM</span> - <span class="variable">$index</span>) ))</span><br><span class="line">        tmux split-window -v -t update:0.0 -p <span class="variable">$percent</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    tmux send-keys -t update:0.1 <span class="string">&quot;bash <span class="variable">${LOCAL_FILE}</span>&quot;</span> C-m</span><br><span class="line">    tmux send-keys -t update:0.1 <span class="string">&quot;bash <span class="variable">${LOCAL_FILE}</span> send all &#x27;clear&#x27;&quot;</span> C-m</span><br><span class="line">    tmux send-keys -t update:0.1 <span class="string">&quot;bash <span class="variable">${LOCAL_FILE}</span> confirm&quot;</span> C-m</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">## 发送消息</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">send</span></span>(){</span><br><span class="line">    panes=<span class="variable">$1</span></span><br><span class="line">    cmd=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$panes</span> <span class="keyword">in</span></span><br><span class="line">        <span class="string">&quot;all&quot;</span>)</span><br><span class="line">            send_all <span class="string">&quot;<span class="variable">${cmd}</span>&quot;</span>;;</span><br><span class="line">        *)</span><br><span class="line">            send_one <span class="string">&quot;<span class="variable">$panes</span>&quot;</span> <span class="string">&quot;<span class="variable">$cmd</span>&quot;</span>;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">send_one</span></span>(){</span><br><span class="line">    pane=<span class="variable">$1</span></span><br><span class="line">    cmd=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">    tmux send-keys -t update:0.<span class="variable">$pane</span> <span class="string">&quot;<span class="variable">${cmd}</span>&quot;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">send_all</span></span>(){</span><br><span class="line">    cmd=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">    <span class="keyword">for</span>((index=0; index&lt;=<span class="variable">$PANE_NUM</span>; index++));<span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="variable">$index</span> -ne 1 ]]; <span class="keyword">then</span></span><br><span class="line">            tmux send-keys -t update:0.<span class="variable">$index</span> <span class="string">&quot;<span class="variable">${cmd}</span>&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">## 确认</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">confirm</span></span>(){</span><br><span class="line">    send all <span class="string">&quot;C-m&quot;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">## 帮助文件</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">help</span></span>(){</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;-------------------------------&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; create        -- 创建一个会话&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; send pane cmd -- 发送一个命令&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   pane 可以是 all or pane编号&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   cmd 用引号括起来&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   ctrl-b q 显示pane编号&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; confirm       -- 命令确认&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;-------------------------------&quot;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;create&quot;</span>)</span><br><span class="line">        create;;</span><br><span class="line">    <span class="string">&quot;send&quot;</span>)</span><br><span class="line">        send <span class="string">&quot;<span class="variable">$2</span>&quot;</span> <span class="string">&quot;<span class="variable">$3</span>&quot;</span>;;</span><br><span class="line">    <span class="string">&quot;confirm&quot;</span>)</span><br><span class="line">        confirm;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">help</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> tmux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS下安装gitbook</title>
      <link href="/2016/03/10/centos/centos-gitbook/"/>
      <url>/2016/03/10/centos/centos-gitbook/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装gitbook</span></span><br><span class="line">yum install nodejs npm -y</span><br><span class="line">npm install gitbook-cli -g</span><br><span class="line">gitbook versions:install</span><br><span class="line"><span class="comment">## 安装ebook-convert</span></span><br><span class="line"><span class="comment">## 用于生成epub,mobi,pdf格式的文件</span></span><br><span class="line">sudo -v &amp;&amp; wget -nv -O- https://raw.githubusercontent.com/kovidgoyal/calibre/master/setup/linux-installer.py | sudo python -c <span class="string">&quot;import sys; main=lambda:sys.stderr.write(&#x27;Download failed\n&#x27;); exec(sys.stdin.read()); main()&quot;</span></span><br><span class="line"><span class="comment">## 修复生成epub,mobi报错 </span></span><br><span class="line">yum install ImageMagick</span><br><span class="line">yum install ImageMagick-devel</span><br><span class="line"><span class="comment">## 修复生成pdf报错</span></span><br><span class="line">yum install libXcomposite</span><br></pre></td></tr></table></figure><h2 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装插件</span></span><br><span class="line">gitbook install</span><br><span class="line"><span class="comment">## 生成gitbook</span></span><br><span class="line">gitbook build</span><br><span class="line"><span class="comment">## 测试</span></span><br><span class="line">gitbook serve</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> gitbook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS6安装git1.8</title>
      <link href="/2016/03/10/centos/centos-git1.8/"/>
      <url>/2016/03/10/centos/centos-git1.8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>CENTOS6通过yum源安装git1.8</p><span id="more"></span><h3 id="增加源"><a href="#增加源" class="headerlink" title="增加源"></a>增加源</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/git.repo https://gitlab.com/gitlab-org/gitlab-recipes/raw/master/install/centos/PUIAS_6_computational.repo</span><br></pre></td></tr></table></figure><h3 id="增加key"><a href="#增加key" class="headerlink" title="增加key"></a>增加key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/pki/rpm-gpg/RPM-GPG-KEY-puias http://springdale.math.ias.edu/data/puias/6/x86_64/os/RPM-GPG-KEY-puias &amp;&amp; rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-puias</span><br></pre></td></tr></table></figure><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p><code>yum install -y git</code></p><h3 id="命令整理"><a href="#命令整理" class="headerlink" title="命令整理"></a>命令整理</h3><ul><li><strong>git config</strong><ol><li>--global user.name “kingwen0302” </li><li>--global user.email “<a href="mailto:&#x6b;&#105;&#x6e;&#x67;&#119;&#x65;&#x6e;&#48;&#x33;&#x30;&#x32;&#x40;&#x6d;&#115;&#110;&#46;&#99;&#x6f;&#x6d;">&#x6b;&#105;&#x6e;&#x67;&#119;&#x65;&#x6e;&#48;&#x33;&#x30;&#x32;&#x40;&#x6d;&#115;&#110;&#46;&#99;&#x6f;&#x6d;</a>“</li><li>--global color.ui “auto”</li></ol></li></ul><p>添加一个文件到暂存区<br>一个文件在<code>git add</code>后, 再次编辑后, <code>git commit</code>只提交<code>git add</code>之前的编辑</p><ol><li>-i 交互模式</li><li>-p patch模式</li></ol><ul><li><strong>git branch</strong><ol><li>无参数 列出所有分支</li><li>branch_name 创建分支,已当前的所在分支为父</li><li>new_branch_name father_branch_name 创建分支</li><li>-d branch_name 删除已经合并的分支,没有合并的不能删除</li><li>-D branch_name 强制删除分支</li><li>-m old_branch_name new_branch_name 分支改名</li></ol></li></ul><ul><li><p><strong>git checkout</strong></p><ol><li>branch_name 切换到分支</li><li>-b branch_name exists_branch_name 创建分支branch_name&amp;&amp;切换到分支</li></ol></li><li><p><strong>git status</strong></p><ol><li>Changes to be commited(要提交的变更)</li><li>Changed but not updated(尚未暂存以备提交的变更)</li></ol></li><li><p><strong>git diff</strong></p><ol><li>无参数 对比未暂存的改动</li><li>–cached 对比已暂存的与HEAD的改动</li><li>HEAD 比较工作目录树中暂存和未暂存的改动</li></ol></li><li><p><strong>git commit</strong></p><ol><li>-a 所有文件提交</li><li>-m 注释 可以有多个-m</li><li>–amend 增补提交</li><li>-C HEAD 复用HEAD的提交留言</li></ol></li><li><p><strong>git mv</strong></p></li><li><p><strong>.gitignore</strong></p><ol><li>.gitignore</li><li>.git/info/exclude</li></ol></li><li><p><strong>git merge</strong><br>直接合并(straight merge)<br>压合合并(squashed commits)<br>拣选合并(cherry-picking)</p><ol><li>be_merge_branch 将be_merge_branch合并到当前分支中</li><li>–squash be_merge_branch 将be_merge_branch合并到当前分支的暂存区, 需要手动执行<code>git commit</code>操作</li><li>git cherry-pick 321d76f 将提交名称为321d76f的合并到当前分支</li></ol></li><li><p><strong>git reset</strong></p><ol><li>–hard HEAD  重置为HEAD版本,删除暂存/未暂存的文件</li><li>HEAD 重置为HEAD版本, 暂存/未暂存的文件不删除</li><li>HEAD^ 重置为HEAD前一个版本</li></ol></li><li><p><strong>git log</strong><br>^   HEAD<del>1 是父记录<br>^^  HEAD</del>2 是爷爷记录<br>^^^ HEAD~3 是爸爸的爷爷记录</p><ol><li>-N N为数字 列出最近N条记录</li><li>–since=”5 hours” 最近5小时</li><li>–before=”5 hours” 5小时之前</li><li>18f822e..HEAD 从(18f822e HEAD]范围内的记录</li><li>–pretty=format:”%h %s” 格式化</li></ol></li><li><p><strong>git diff</strong><br>diff 默认是与当前目录树进行对比</p><ol><li>18f822e 对比18f822e与当前目录树对比</li><li>–stat tag/branch 统计代码改动</li></ol></li><li><p><strong>git blame</strong></p><ol><li>file 显示所有的代码记录</li><li>-L 12,13 file</li><li>-L 12,+2 file</li><li>-L 12,-2 file</li><li>-L “/&lt;/body&gt;/“,+2 file</li></ol></li><li><p><strong>git revert</strong></p></li><li><p><strong>git rebase</strong></p><ol><li>重新排序提交</li></ol></li></ul>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> git </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SVN服务器搭建</title>
      <link href="/2016/03/10/centos/centos-svn/"/>
      <url>/2016/03/10/centos/centos-svn/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Subversion安装,配置及权限管理</p><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p><code>yum install -y subversion</code></p><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">svnserve --version</span><br><span class="line">whereis svnserve</span><br></pre></td></tr></table></figure><h3 id="创建多版本库"><a href="#创建多版本库" class="headerlink" title="创建多版本库"></a>创建多版本库</h3><ul><li><p>创建目录+初始化版本库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/svn</span><br><span class="line"><span class="built_in">cd</span> /data/svn</span><br><span class="line"><span class="comment">## 版本库1 </span></span><br><span class="line">mkdir svn_1</span><br><span class="line">svnadmin create svn_1</span><br><span class="line"><span class="comment">## 版本库2 </span></span><br><span class="line">mkdir svn_2</span><br><span class="line">svnadmin create svn_2</span><br></pre></td></tr></table></figure></li><li><p>权限管理<br>在每个版本库下面都有一个conf文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@server conf]<span class="comment"># ls -l svn_1/conf</span></span><br><span class="line">总用量 12  </span><br><span class="line">-rw-r--r--. 1 root root 1080 4月  28 14:31 authz</span><br><span class="line">-rw-r--r--. 1 root root  309 4月  28 14:31 passwd</span><br><span class="line">-rw-r--r--. 1 root root 2283 4月  28 14:32 svnserve.conf</span><br><span class="line"><span class="comment">## passwd是密码文件  </span></span><br><span class="line"><span class="comment">## authz是权限文件  </span></span><br><span class="line"><span class="comment">## svnserve.conf是本版本库的配置文件</span></span><br></pre></td></tr></table></figure></li></ul><p>使用一个密码文件和权限文件管理所有版本库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp svn_1/conf/passwd passwd</span><br><span class="line">cp svn_1/conf/authz authz</span><br></pre></td></tr></table></figure><p>使用svn目录下的passwd和authz文件管理所有版本库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 修改各个版本库的配置文件</span></span><br><span class="line">vim /svn_1/conf/svnserve.conf</span><br><span class="line"><span class="comment">## 不允许匿名</span></span><br><span class="line">anon-access = none</span><br><span class="line">auth-access = write</span><br><span class="line"><span class="comment">## 密码文件位置</span></span><br><span class="line">password-db = ../../passwd</span><br><span class="line"><span class="comment">## 权限文件位置</span></span><br><span class="line">authz-db = ../../authz</span><br><span class="line"></span><br><span class="line"><span class="comment">## 添加用户名, 密码</span></span><br><span class="line">vim /data/svn/passwd</span><br><span class="line">admin = 123456</span><br><span class="line">user = 123456</span><br><span class="line">noauthz = 123456</span><br><span class="line"></span><br><span class="line"><span class="comment">## 权限配置</span></span><br><span class="line">vim /data/svn/authz</span><br><span class="line">[groups]</span><br><span class="line">g_admin = admin</span><br><span class="line">g_user = user</span><br><span class="line">[svn_1:/]</span><br><span class="line">@g_admin = rw</span><br><span class="line">[svn_1:/user]</span><br><span class="line">@g_user = rw</span><br><span class="line">[svn_1:/user/noauthz]</span><br><span class="line">noauthz =</span><br></pre></td></tr></table></figure><p>权限使用自底而上的方式进行控制,如果在当前目录下无法找到该用户的权限, 则查看上一级目录是否有权限<br>,直到根目录位置,例如上例:<br>    - 查看user用户的权限<br>    1. 在访问noauthz目录时,没有user的权限配置,向上一级查看<br>    2. 在user目录由user用户的权限配置,是读写, 因此,user用户具有noauthz目录的权限;<br>    - 查看nozuthz用户的权限<br>    1. 访问noauthz目录, noauthz没有读写该文件的权限,所以noauthz用户没有noauthz目录权限;</p><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p><code>svnserve -d -r /data/svn</code><br>-d 后台运行<br>-r svn的根目录</p><h3 id="开机启动"><a href="#开机启动" class="headerlink" title="开机启动"></a>开机启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --list | grep svnserve</span><br><span class="line">svnserve        0:关闭  1:关闭  2:关闭  3:关闭  4:关闭  5:关闭  6:关闭</span><br><span class="line">chkconfig svnserve on</span><br><span class="line">svnserve        0:关闭  1:关闭  2:启用  3:启用  4:启用  5:启用  6:关闭</span><br></pre></td></tr></table></figure><p>查看在/etc/init.d/svnserve的启动脚本文件,有如下代码:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -f /etc/sysconfig/svnserve ]; <span class="keyword">then</span></span><br><span class="line">    . /etc/sysconfig/svnserve</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 增加配置文件</span></span><br><span class="line">touch /etc/sysconfig/svnserve</span><br><span class="line"><span class="comment">## 增加内容</span></span><br><span class="line">OPTIONS=<span class="string">&quot;-r /data/svn/&quot;</span></span><br><span class="line"><span class="comment">## 这样下次开机就可以自动启动svn服务器了</span></span><br></pre></td></tr></table></figure><h3 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h3><ol><li><p>ip改变后,修改svn地址</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn switch --relocate svn://192.168.0.253/xxx svn://192.168.0.100/xxx --username xxx --password xxx</span><br></pre></td></tr></table></figure></li><li><p>svn提交部分文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">svn status | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | 自定义grep &gt; target.txt</span><br><span class="line">svn ci --targets target.txt</span><br></pre></td></tr></table></figure></li></ol><h3 id="HTTP支持"><a href="#HTTP支持" class="headerlink" title="HTTP支持"></a>HTTP支持</h3><p>svnsverve和http使用不同的密码文件</p><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## apr,apr-util很关键</span></span><br><span class="line">yum install httpd apr apr-util httpd-devel</span><br><span class="line">yum install mod_dav_svn</span><br></pre></td></tr></table></figure><h4 id="修改权限"><a href="#修改权限" class="headerlink" title="修改权限"></a>修改权限</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown apache:apache /data/svn -R</span><br></pre></td></tr></table></figure><h4 id="生成密码"><a href="#生成密码" class="headerlink" title="生成密码"></a>生成密码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /data/svn</span><br><span class="line">htpasswd http_passwd zm1</span><br><span class="line">htpasswd http_passwd zm2</span><br><span class="line">htpasswd http_passwd zm3</span><br></pre></td></tr></table></figure><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## vim /etc/httpd/conf.d/subversion.conf</span></span><br><span class="line">&lt;Location /svn&gt;</span><br><span class="line">DAV svn</span><br><span class="line">SVNParentPath /data/svn</span><br><span class="line">AuthType Basic</span><br><span class="line">AuthName <span class="string">&quot;Authorization SVN&quot;</span></span><br><span class="line">AuthzSVNAccessFile /data/svn/authz</span><br><span class="line">AuthUserFile /data/svn/http_passwd</span><br><span class="line">Require valid-user</span><br><span class="line">&lt;/Location&gt;</span><br></pre></td></tr></table></figure><h4 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service httpd restart</span><br></pre></td></tr></table></figure><h3 id="SVN-SSH"><a href="#SVN-SSH" class="headerlink" title="SVN+SSH"></a>SVN+SSH</h3><h4 id="客户端设置"><a href="#客户端设置" class="headerlink" title="客户端设置"></a>客户端设置</h4><ul><li><code>设置</code>-&gt;<code>Network</code>-&gt;<code>ssh client</code>-&gt;<code>TortoisePlink.exe</code>；</li><li>下载<code>putty</code>, 使用<code>PUTTYGEN.EXE</code>将openssh2格式的密钥改成ppk格式的,使用<code>PAGEANT.EXE</code>增加密钥。</li></ul><h4 id="svn-authz"><a href="#svn-authz" class="headerlink" title="svn authz"></a>svn authz</h4><p>在svn的authz目录中增加：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[/]</span><br><span class="line">root = rw</span><br></pre></td></tr></table></figure><h4 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h4><p>在<code>~/.ssh/authorized_keys</code>对应的public key前面增加如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## /data/svn为svn的根目录</span></span><br><span class="line"><span class="built_in">command</span>=<span class="string">&quot;/usr/bin/svnserve -t -r /data/svn --tunnel-user=root&quot;</span>,no-port-forwarding,no-pty,no-agent-forwarding,no-X11-forwarding</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span>=<span class="string">&quot;/usr/bin/svnserve -t -r /data/svn --tunnel-user=root&quot;</span>,no-port-forwarding,no-pty,no-agent-forwarding,no-X11-forwarding ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAwEXTRkzM+/R8NTIY34ZJDg8/UeXTr+2oFX2PPiCazqwUKiD55EzgMcvaZKvGZ9LcswuNc26febwZEfnQDl0HxbIlH+5tlDGk35A/WrLsi3uekTjkIDIw3Do2xb9QlnDtYXRs24lHExdJQJvV7fOdoG9ZCcdX+bU63q3Qj5DfFCpjmw5ocCVcvWTOOIG2wT++0Jxr6W3vBu6fuCVFq6siOEzXEBRx63pj7uYRNvCs6GsgbQnyKNRyZSiouyrb/qRj1AbqRWGBr8kEofgwwnP3xO61pyovZLOrJ9FsjUxTLaGACoGJioOgu4vqywYXnX3TYnYWgx7MPXb/ayhZtHXHqQ== kingwen@kingwen</span><br></pre></td></tr></table></figure><p>使用<code>svn co svn+ssh://root@192.168.1.245/p1</code> 检出项目<br>此种方式该public key将不能登录ssh</p><h4 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h4><p>直接使用绝对路径checkout项目：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## /data/.svn_repos/p1为项目的绝对路径</span></span><br><span class="line">svn co svn+ssh://root@192.168.1.245/data/.svn_repos/p1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> svn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VPN服务器搭建</title>
      <link href="/2016/03/10/centos/centos-vpn-server/"/>
      <url>/2016/03/10/centos/centos-vpn-server/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><h3 id="服务器搭建"><a href="#服务器搭建" class="headerlink" title="服务器搭建"></a>服务器搭建</h3><figure class="highlight bash"><figcaption><span>vpn.sh</span><a href="/downloads/code/vpn.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## #############################</span></span><br><span class="line"><span class="comment">## VPN服务器安装脚本</span></span><br><span class="line"><span class="comment">## PASSWD_LEN, SERVER_IP要手动配置</span></span><br><span class="line"><span class="comment">## #############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 生成的密码长度</span></span><br><span class="line">PASSWD_LEN=20</span><br><span class="line"><span class="comment">## 服务器IP</span></span><br><span class="line">SERVER_IP=</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">installVPN</span></span>(){</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;begin to install VPN services&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 刪除原有的pptpd&amp;ppp</span></span><br><span class="line">yum remove -y pptpd ppp</span><br><span class="line">iptables --flush POSTROUTING --table nat</span><br><span class="line">iptables --flush FORWARD</span><br><span class="line">rm -rf /etc/pptpd.conf</span><br><span class="line">rm -rf /etc/ppp</span><br><span class="line"></span><br><span class="line">    <span class="comment">## yum安裝除pptpd的包</span></span><br><span class="line">    yum install -y dkms kernel_ppp_mppe ppp</span><br><span class="line">yum -y install make libpcap iptables gcc-c++ logrotate tar cpio perl pam tcp_wrappers</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 安裝pptpd</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="subst">$(rpm -qa pptpd)</span>&quot;</span> == <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        wget ftp://rpmfind.net/linux/epel/6/x86_64/pptpd-1.4.0-3.el6.x86_64.rpm</span><br><span class="line">        rpm -ivh pptpd-1.4.0-3.el6.x86_64.rpm</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## 自动化配置</span></span><br><span class="line">mknod /dev/ppp c 108 0 </span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;mknod /dev/ppp c 108 0&quot;</span> &gt;&gt; /etc/rc.local</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;echo 1 &gt; /proc/sys/net/ipv4/ip_forward&quot;</span> &gt;&gt; /etc/rc.local</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;localip 172.16.36.1&quot;</span> &gt;&gt; /etc/pptpd.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;remoteip 172.16.36.2-254&quot;</span> &gt;&gt; /etc/pptpd.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ms-dns 8.8.8.8&quot;</span> &gt;&gt; /etc/ppp/options.pptpd</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ms-dns 8.8.4.4&quot;</span> &gt;&gt; /etc/ppp/options.pptpd</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 增加密码</span></span><br><span class="line">pass=`openssl rand <span class="variable">${PASSWD_LEN}</span> -base64`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span> pass=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;vpn pptpd <span class="variable">${pass}</span> *&quot;</span> &gt;&gt; /etc/ppp/chap-secrets</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 開放端口</span></span><br><span class="line">    iptables --flush POSTROUTING --table nat</span><br><span class="line">iptables --flush FORWARD</span><br><span class="line">iptables -t nat -A POSTROUTING -s 172.16.36.0/24 -j SNAT --to-source <span class="variable">${SERVER_IP}</span></span><br><span class="line">iptables -A FORWARD -p tcp --syn -s 172.16.36.0/24 -j TCPMSS --set-mss 1356</span><br><span class="line">    iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 53 -j ACCEPT</span><br><span class="line">    iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 1723 -j ACCEPT</span><br><span class="line">    iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 47 -j ACCEPT</span><br><span class="line">    iptables -D INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class="line">    iptables -A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class="line">service iptables save</span><br><span class="line">    </span><br><span class="line">    <span class="comment">## 自启动</span></span><br><span class="line">chkconfig iptables on</span><br><span class="line">chkconfig pptpd on</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 启动</span></span><br><span class="line">service iptables restart</span><br><span class="line">service pptpd start</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;VPN service is installed, your VPN username is vpn, VPN password is <span class="variable">${pass}</span>&quot;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">repaireVPN</span></span>(){</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;begin to repaire VPN&quot;</span>;</span><br><span class="line">    iptables --flush POSTROUTING --table nat</span><br><span class="line">iptables --flush FORWARD</span><br><span class="line">iptables -t nat -A POSTROUTING -s 172.16.36.0/24 -j SNAT --to-source <span class="variable">${SERVER_IP}</span></span><br><span class="line">iptables -A FORWARD -p tcp --syn -s 172.16.36.0/24 -j TCPMSS --set-mss 1356</span><br><span class="line">    iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 53 -j ACCEPT</span><br><span class="line">    iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 1723 -j ACCEPT</span><br><span class="line">    iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 47 -j ACCEPT</span><br><span class="line">    iptables -D INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class="line">    iptables -A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class="line">service iptables save</span><br><span class="line">service iptables restart</span><br><span class="line">service pptpd start</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">addVPNuser</span></span>(){</span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;input user name:&quot;</span></span><br><span class="line"><span class="built_in">read</span> username</span><br><span class="line">    userpassword=$(openssl rand <span class="variable">${PASSWD_LEN}</span> -base64)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;name: <span class="variable">${username}</span>  password: <span class="variable">${userpassword}</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;confirm(Y/N):&quot;</span></span><br><span class="line">    <span class="built_in">read</span> confirm</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$confirm</span> <span class="keyword">in</span></span><br><span class="line">        <span class="string">&quot;Y&quot;</span> | <span class="string">&quot;y&quot;</span> )</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">${username}</span> pptpd <span class="variable">${userpassword}</span> *&quot;</span> &gt;&gt; /etc/ppp/chap-secrets</span><br><span class="line">        service iptables restart</span><br><span class="line">        service pptpd start</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;add user succeed&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;add user fail&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">delVPNuser</span></span>(){</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;all users:&quot;</span></span><br><span class="line">    cat /etc/ppp/chap-secrets | grep -v <span class="string">&#x27;^#&#x27;</span> | awk <span class="string">&#x27;{print $1}&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;please select one:&quot;</span></span><br><span class="line">    <span class="built_in">read</span> vpn_user</span><br><span class="line">    cat /etc/ppp/chap-secrets | grep -v <span class="string">&quot;^<span class="variable">${vpn_user}</span> &quot;</span> &gt; /ect/ppp/chap-secrets</span><br><span class="line">    service iptables restart</span><br><span class="line">    service pptpd start</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;del user succeed&quot;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getVPNInfo</span></span>(){</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;VPN Server IP: <span class="variable">${SERVER_IP}</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;VPN Users:&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;user | -- | password | * &quot;</span></span><br><span class="line">    cat /etc/ppp/chap-secrets | grep -v <span class="string">&#x27;^#&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;VPN link num:&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> $(netstat -nat | grep ESTABLISHED | grep <span class="string">&#x27;:1723&#x27;</span> | wc -l)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">checkConf</span></span>(){</span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">${SERVER_IP}</span>&quot;</span> == <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[31m[ERROR] please set server_ip \033[0m&quot;</span></span><br><span class="line">        <span class="built_in">exit</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;which do you want to?input the number.&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1. install VPN service&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2. repaire VPN service&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;3. add VPN user&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;4. VPN info&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;5. del VPN user&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;please select:&quot;</span></span><br><span class="line"><span class="built_in">read</span> num</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$num</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">[1] ) </span><br><span class="line">    checkConf</span><br><span class="line">    installVPN</span><br><span class="line">    ;;</span><br><span class="line">[2] ) </span><br><span class="line">    repaireVPN</span><br><span class="line">    ;;</span><br><span class="line">[3] ) </span><br><span class="line">    addVPNuser</span><br><span class="line">    ;;</span><br><span class="line">[4] ) </span><br><span class="line">    getVPNInfo</span><br><span class="line">    ;;</span><br><span class="line">[5] )</span><br><span class="line">    delVPNuser</span><br><span class="line">    ;;</span><br><span class="line">*) <span class="built_in">echo</span> <span class="string">&quot;nothing,exit&quot;</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><h3 id="连接数查看"><a href="#连接数查看" class="headerlink" title="连接数查看"></a>连接数查看</h3><p><code>netstat -nat | grep ESTABLISHED | grep &#39;:1723&#39; | wc -l</code></p>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> vpn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rsync服务器搭建</title>
      <link href="/2016/03/10/centos/centos-rsync/"/>
      <url>/2016/03/10/centos/centos-rsync/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install xinetd</span><br><span class="line">service xinetd restart</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="开启"><a href="#开启" class="headerlink" title="开启"></a>开启</h2><p>编辑<code>/etc/xinetd.d/rsync</code>文件，将<code>disable = yes</code>修改为<code>disable = no</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">service rsync</span><br><span class="line">&#123; </span><br><span class="line">    <span class="built_in">disable</span> = no</span><br><span class="line">    .......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用<code>service xinetd restart</code>启动</p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/rsyncd.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">uid = root</span></span><br><span class="line"><span class="string">gid = root</span></span><br><span class="line"><span class="string">use chroot = no</span></span><br><span class="line"><span class="string">max connections = 20</span></span><br><span class="line"><span class="string">secrets file = /etc/rsyncd.secrets</span></span><br><span class="line"><span class="string">log file = /var/log/rsyncd.log</span></span><br><span class="line"><span class="string">pid file = /var/run/rsyncd.pid</span></span><br><span class="line"><span class="string">lock file /var/run/rsyncd.lock</span></span><br><span class="line"><span class="string">[name1]</span></span><br><span class="line"><span class="string">## 目录</span></span><br><span class="line"><span class="string">path = /data/.svn_repos     </span></span><br><span class="line"><span class="string">## 用户名</span></span><br><span class="line"><span class="string">auth users = svn</span></span><br><span class="line"><span class="string">## 是否只读 yes是只读, no是可以上传</span></span><br><span class="line"><span class="string">read only = yes</span></span><br><span class="line"><span class="string">## 这个不知道怎么用</span></span><br><span class="line"><span class="string">## write only = yes</span></span><br><span class="line"><span class="string">## 运行的hosts</span></span><br><span class="line"><span class="string">hosts allow = 192.168.1.253</span></span><br><span class="line"><span class="string">## 是否列出该目录</span></span><br><span class="line"><span class="string">list = true</span></span><br><span class="line"><span class="string">[name2]</span></span><br><span class="line"><span class="string">path = /data/hero/release/gameserver</span></span><br><span class="line"><span class="string">auth users = mjyx</span></span><br><span class="line"><span class="string">read only = yes</span></span><br><span class="line"><span class="string">hosts allow = 102.168.1.253</span></span><br><span class="line"><span class="string">list = true</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">cat &gt; /etc/rsyncd.secrets &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">## 账号:密码</span></span><br><span class="line"><span class="string">svn:passwd</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">chmod 600 /etc/rsyncd.secrets</span><br></pre></td></tr></table></figure><h2 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; rsync.pas &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">passwd</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">chmod 600 rsync.pas</span><br><span class="line"><span class="comment">## 从远程更新</span></span><br><span class="line">rsync -vazrtopguh --progress --password-file=rsync.pas svn@xxx.xxx.xxx.xxx::name1 name1</span><br><span class="line"><span class="comment">## 向远程推送</span></span><br><span class="line">rsync -vazrtopguh --delete --progress --password-file.rsync.pas 本地目录 svn@xxx.xxx.xxx.xxx::name1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> rsync </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS网络设置</title>
      <link href="/2016/03/10/centos/centos-net/"/>
      <url>/2016/03/10/centos/centos-net/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="有线网络配置"><a href="#有线网络配置" class="headerlink" title="有线网络配置"></a>有线网络配置</h2><h3 id="IP设置"><a href="#IP设置" class="headerlink" title="IP设置"></a>IP设置</h3><ul><li>默认下,centos没有开启网络</li><li>网络配置目录: /etc/sysconfig/network-scripts/<span id="more"></span></li><li>修改配置<br><code>vim /etc/sysconfig/network-scripts/ifcfg-eth0</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开机启动</span></span><br><span class="line">ONBOOT=yes </span><br><span class="line"><span class="comment"># 设置静态IP </span></span><br><span class="line"><span class="comment"># 如果要动态,可以使用dhcp,一般情况下, 服务器设置为静态IP比较好 </span></span><br><span class="line">BOOTPROTO=static </span><br><span class="line"><span class="comment"># IP地址 </span></span><br><span class="line">IPADDR=192.168.0.253 </span><br><span class="line"><span class="comment"># 子网掩码 </span></span><br><span class="line">NETMASK=255.255.255.0 </span><br><span class="line"><span class="comment"># 网关 </span></span><br><span class="line">GATEWAY=192.168.0.1 </span><br></pre></td></tr></table></figure></li></ul><h3 id="域名设置"><a href="#域名设置" class="headerlink" title="域名设置"></a>域名设置</h3><ul><li>设置DNS</li><li>配置文件: /etc/resolv.conf</li><li>设置  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolv.conf</span><br><span class="line"><span class="comment">## DNS服务器,下面这两个是google的,也可以添加其他</span></span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">nameserver 1.2.4.8</span><br><span class="line"><span class="comment">## 最后要加上网关nameserver 192.168.0.1</span></span><br></pre></td></tr></table></figure></li><li>重启<br>使用<code>/etc/init.d/network restart</code>重启网络</li></ul><h2 id="无限网络配置"><a href="#无限网络配置" class="headerlink" title="无限网络配置"></a>无限网络配置</h2><p>以wifi ID: my_wifi 密码: wifi_pass  认证方式为WPA2-PSK 为例</p><h3 id="硬件检测"><a href="#硬件检测" class="headerlink" title="硬件检测"></a>硬件检测</h3><p>输入命令<code>iwconfig</code> 如果出现wlanX 证明驱动没有问题;</p><h3 id="修改wlan0配置"><a href="#修改wlan0配置" class="headerlink" title="修改wlan0配置"></a>修改wlan0配置</h3><p>编辑<code>vim /etc/sysconfig/network-script/ifcfg-wlan0</code>,增加:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Wireless</span><br><span class="line">ESSID=<span class="string">&quot;my_wifi&quot;</span></span><br></pre></td></tr></table></figure><h3 id="写入密码"><a href="#写入密码" class="headerlink" title="写入密码"></a>写入密码</h3><p>执行<code>wpa_passphrase my_wifi wifi_pass &gt; /etc/wpa_supplicant/wpa_supplicant.conf</code>,结果如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 结果</span></span><br><span class="line"><span class="comment">## /etc/wpa_supplicant/wpa_supplicant.conf,</span></span><br><span class="line">network=&#123;</span><br><span class="line">  ssid=<span class="string">&quot;my_wifi&quot;</span></span><br><span class="line">  <span class="comment">#psk=&quot;wifi_pass&quot;</span></span><br><span class="line">  psk=<span class="string">&quot;wifi_pass&quot;</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="wpa-supplicant配置"><a href="#wpa-supplicant配置" class="headerlink" title="wpa_supplicant配置"></a>wpa_supplicant配置</h3><p>编辑<code>vim /etc/sysconfig/wpa_supplicant</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INTERFACES=<span class="string">&quot;-iwlan0&quot;</span></span><br><span class="line">DRIVERS=<span class="string">&quot;-Dwext&quot;</span></span><br><span class="line">OTHER_ARGS=<span class="string">&quot;-u -f /var/log/wpa_supplicant.log -P /var/run/wpa_supplicant.pid&quot;</span></span><br></pre></td></tr></table></figure><p>开机启动<code>chkconfig wpa_supplicant --level 3 on</code></p><h3 id="连接my-wifi"><a href="#连接my-wifi" class="headerlink" title="连接my_wifi"></a>连接my_wifi</h3><p>无线搜索: <code>iwlist wlan0 scan | grep ESSID</code><br>无线连接: <code>iwconfig wlan0 essid &quot;my_wifi&quot;</code><br>获取IP  : <code>dhclient wlan0</code><br>测试    : <code>ping www.baidu.com</code></p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ol><li>NetworkManager 和 wpa_supplicant 是不兼容<br>如果只使用无线的话<br>设置桌面环境<code>chkconfig NetworkManager --level 5 on</code><br>设置命令行<code>chkconfig wpa_supplicant --level 3 on</code></li></ol><h3 id="未解决"><a href="#未解决" class="headerlink" title="未解决"></a>未解决</h3><ol><li>固定IP不知道怎么设置?</li><li>自启动不知道怎么设置, 必须手动敲<code>dhclient wlan0</code></li></ol><h3 id="已知问题修复"><a href="#已知问题修复" class="headerlink" title="已知问题修复"></a>已知问题修复</h3><ol><li>device “eth0” does not seem to be present, delaying initialization<br>这个问题一般是更换网卡所致，mac地址不一致<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看网卡mac</span></span><br><span class="line">ifconfig -a</span><br><span class="line">mv ifcfg-eth0 ifcfg-ethx</span><br><span class="line"><span class="comment">## 编辑ifcfg-ethx</span></span><br><span class="line">修改device的名称和mac地址</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> linux </tag>
            
            <tag> 网络设置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS源设置</title>
      <link href="/2016/03/10/centos/centos-yum/"/>
      <url>/2016/03/10/centos/centos-yum/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="网络源"><a href="#网络源" class="headerlink" title="网络源"></a>网络源</h2><h3 id="rpmforge"><a href="#rpmforge" class="headerlink" title="rpmforge"></a>rpmforge</h3><p>rpmforge被CentOS社区认为是安全和稳定的软件库<br>在<a href="http://pkgs.repoforge.org/rpmforge-release/">http://pkgs.repoforge.org/rpmforge-release/</a> 下载对应版本的rpm包   </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh rpmforge-release-0.5.3-1.el6.rf.x86_64.rpm</span><br><span class="line"><span class="comment">## or</span></span><br><span class="line">yum install http://apt.sw.be/redhat/el6/en/x86_64/rpmforge/RPMS/rpmforge-release-0.5.3-1.el6.rf.x86_64.rpm</span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="epel"><a href="#epel" class="headerlink" title="epel"></a>epel</h3><p>在<a href="http://mirrors.ustc.edu.cn/fedora/epel/">http://mirrors.ustc.edu.cn/fedora/epel/</a>下载最新的rpm<br><code>yum install http://mirrors.ustc.edu.cn/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm</code> </p><h3 id="puias"><a href="#puias" class="headerlink" title="puias"></a>puias</h3><p><em><strong>有Git1.9</strong></em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">wget /etc/yum.repos.d/PUIAS_6_computational.repo https://gitlab.com/gitlab-org/gitlab-recipes/raw/master/install/centos/PUIAS_6_computational.repo</span><br><span class="line">wget -O /etc/pki/rpm-gpg/RPM-GPG-KEY-puias http://springdale.math.ias.edu/data/puias/6/x86_64/os/RPM-GPG-KEY-puias</span><br><span class="line">rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-puias</span><br><span class="line">yum-config-manager --<span class="built_in">enable</span> PUIAS_6_computational</span><br><span class="line">yum -y install git</span><br><span class="line">git --version</span><br></pre></td></tr></table></figure><h3 id="node"><a href="#node" class="headerlink" title="node"></a>node</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">curl --silent --location https://rpm.nodesource.com/setup_4.x | bash -</span><br><span class="line">yum -y install nodejs</span><br></pre></td></tr></table></figure><h2 id="本地源"><a href="#本地源" class="headerlink" title="本地源"></a>本地源</h2><p>centos-dvd.iso中已经包含了很多常用的软件, 在没有网络的情况下, 可以使用iso中的文件进行安装;</p><ul><li><p>挂载ISO(通过修改fstab文件完成)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## vim /etc/fstab</span></span><br><span class="line"><span class="comment">## 在文件的最后添加</span></span><br><span class="line"><span class="comment">## iso目录                            挂载位置             类型    方式</span></span><br><span class="line">/data/yum_iso/CentOS-6.5-DVD1.iso    /media/CentOS_DVD_1 iso9660 loop,ro 0 0</span><br></pre></td></tr></table></figure></li><li><p>修改源配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 修改本地源文件</span></span><br><span class="line"><span class="comment">## 配置文件在/etc/yum.repos.d/目录下</span></span><br><span class="line"><span class="comment">## vim /etc/yum.repos.d/CentOS-Media.repo</span></span><br><span class="line">[c6-media]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Media</span><br><span class="line"><span class="comment">## 文件路径</span></span><br><span class="line">baseurl=file:///media/CentOS_DVD_1/</span><br><span class="line">gpgcheck=1</span><br><span class="line"><span class="comment">## 1表示启用该源</span></span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure><p>将其他的repo为后缀的修改为repo_bak或者其他类型的文件</p></li><li><p>重启<br><code>init 6</code></p></li><li><p>检查<br>使用<code>df -h</code>检查，如果出现<code>/data/yum_iso/CentOS-6.5-DVD1.iso  4.2G  4.2G     0 100% /media/CentOS_DVD_1</code>表示成功。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> yum </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CENTOS安装</title>
      <link href="/2016/03/10/centos/install-centos/"/>
      <url>/2016/03/10/centos/install-centos/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><ol><li>使用win32diskimage将下载好的centos-dvd.iso刻录到准备好的U盘中.   <ul><li>UltraISO不能用,会无法引导  </li><li><a href="http://rufus.akeo.ie/?locale=zh_CN">rufus</a>也是一个不错的选择,没有测试centos是否可用,但是ubuntu可用    </li><li><a href="https://www.ventoy.net/cn/index.html">ventoy</a>也是一个不错的选择,不过没有测试过</li></ul></li><li>使用U盘安装,具体可以百度.</li></ol>]]></content>
      
      
      <categories>
          
          <category> centos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo本地环境安装配置</title>
      <link href="/2016/03/09/install-hexo/"/>
      <url>/2016/03/09/install-hexo/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><ul><li>blog Git仓库</li><li>github page 仓库</li><li>centos6.5</li></ul><span id="more"></span><h3 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h3><ol><li><p>下载如下四个文件；</p></li><li><p> 修改<code>MY_BLOG_GIT_URL</code>, <code>MY_BLOG_THEME</code>, <code>MY_BLOG_THEME_NAME</code></p></li><li><p><code>bash install_hexo.sh 1</code></p><figure class="highlight bash"><figcaption><span>脚本入口</span><a href="/downloads/code/install_hexo.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 博客根目录</span></span><br><span class="line">HEXO_ROOT_DIR=/data/blog</span><br><span class="line"><span class="comment">## 博客源文件目录</span></span><br><span class="line">MY_BLOG_GIT_URL=<span class="string">&quot;git@git.coding.net:kingwen0302/kingwen0302.git&quot;</span></span><br><span class="line"><span class="comment">## 博客主题</span></span><br><span class="line">MY_BLOG_THEME=<span class="string">&quot;https://github.com/tufu9441/maupassant-hexo.git&quot;</span></span><br><span class="line">MY_BLOG_THEME_NAME=maupassant</span><br><span class="line"><span class="comment">## 当前目录</span></span><br><span class="line">CUR_DIR=$(<span class="built_in">cd</span> $(dirname <span class="variable">$0</span>); <span class="built_in">pwd</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">install_hexo</span></span>(){</span><br><span class="line">    yum remove nodejs npm -y</span><br><span class="line">    curl --silent --location https://rpm.nodesource.com/setup_4.x | bash -</span><br><span class="line">    yum install -y nodejs</span><br><span class="line">    <span class="comment">## npm install -g cnpm --registry=https://registry.npm.taobao.org</span></span><br><span class="line">    <span class="comment">## cnpm install hexo-cli -g</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">install</span></span>(){</span><br><span class="line">    hexo init <span class="variable">${HEXO_ROOT_DIR}</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">${HEXO_ROOT_DIR}</span></span><br><span class="line">    rm -rf <span class="built_in">source</span></span><br><span class="line">    git <span class="built_in">clone</span> <span class="variable">${MY_BLOG_GIT_URL}</span> <span class="built_in">source</span></span><br><span class="line">    rm -rf themes/landscape</span><br><span class="line">    git <span class="built_in">clone</span> <span class="variable">${MY_BLOG_THEME}</span> themes/<span class="variable">${MY_BLOG_THEME_NAME}</span></span><br><span class="line">    <span class="comment">## HEXO配置替换</span></span><br><span class="line">    <span class="built_in">source</span> <span class="variable">${CUR_DIR}</span>/maupassant_config.sh</span><br><span class="line">    <span class="built_in">source</span> <span class="variable">${CUR_DIR}</span>/post.sh</span><br><span class="line">    <span class="comment">## THEME配置替换</span></span><br><span class="line">    <span class="built_in">source</span> <span class="variable">${CUR_DIR}</span>/maupassant_theme_config.sh</span><br><span class="line">    npm install</span><br><span class="line">    <span class="comment">## 安装deploy</span></span><br><span class="line">    npm install hexo-deployer-git --save</span><br><span class="line">    <span class="comment">## rss支持</span></span><br><span class="line">    npm install hexo-generator-feed --save</span><br><span class="line">    <span class="comment">## sitemap支持</span></span><br><span class="line">    npm install hexo-generator-sitemap --save</span><br><span class="line">    npm install hexo-generator-baidu-sitemap --save</span><br><span class="line">    <span class="comment">## jade模版</span></span><br><span class="line">    npm install hexo-renderer-jade --save</span><br><span class="line">    npm install hexo-renderer-sass --save</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">deploy</span></span>(){</span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">${HEXO_ROOT_DIR}</span>/<span class="built_in">source</span></span><br><span class="line">    git add .</span><br><span class="line">    git commit -m <span class="string">&quot;<span class="subst">$(date)</span> deploy&quot;</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">${HEXO_ROOT_DIR}</span></span><br><span class="line">    hexo g -d</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">help</span></span>(){</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;------------------------------&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; 0 -- install_hexo&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; 1 -- install&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; 2 -- deploy&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;------------------------------&quot;</span></span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">    [0]) install_hexo;;</span><br><span class="line">    [1]) install;;</span><br><span class="line">    [2]) deploy;;</span><br><span class="line">    *)   <span class="built_in">help</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><figcaption><span>hexo的配置文件</span><a href="/downloads/code/maupassant_config.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hexo Configuration</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/configuration.html</span></span><br><span class="line"><span class="comment">## Source: https://github.com/hexojs/hexo/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Site</span></span><br><span class="line">title: 情文</span><br><span class="line">subtitle: 记录点点滴滴</span><br><span class="line">description: </span><br><span class="line">author: kingwen0302</span><br><span class="line">language: zh-CN</span><br><span class="line">timezone: Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## If your site is put in a subdirectory, set url as &#x27;http://yoursite.com/child&#x27; and root as &#x27;/child/&#x27;</span></span><br><span class="line">url: http://www.mingilin.com</span><br><span class="line">root: /</span><br><span class="line">permalink: :year/:month/:day/:title/</span><br><span class="line">permalink_defaults:</span><br><span class="line"></span><br><span class="line"><span class="comment"># Directory</span></span><br><span class="line">source_dir: <span class="built_in">source</span></span><br><span class="line">public_dir: public</span><br><span class="line">tag_dir: tags</span><br><span class="line">archive_dir: archives</span><br><span class="line">category_dir: categories</span><br><span class="line">code_dir: downloads/code</span><br><span class="line">i18n_dir: :lang</span><br><span class="line">skip_render:</span><br><span class="line"></span><br><span class="line"><span class="comment"># Writing</span></span><br><span class="line">new_post_name: :title.md <span class="comment"># File name of new posts</span></span><br><span class="line">default_layout: post</span><br><span class="line">titlecase: <span class="literal">false</span> <span class="comment"># Transform title into titlecase</span></span><br><span class="line">external_link: <span class="literal">true</span> <span class="comment"># Open external links in new tab</span></span><br><span class="line">filename_case: 0</span><br><span class="line">render_drafts: <span class="literal">false</span></span><br><span class="line">post_asset_folder: <span class="literal">false</span></span><br><span class="line">relative_link: <span class="literal">false</span></span><br><span class="line">future: <span class="literal">true</span></span><br><span class="line">highlight:</span><br><span class="line">  <span class="built_in">enable</span>: <span class="literal">true</span></span><br><span class="line">  line_number: <span class="literal">true</span></span><br><span class="line">  auto_detect: <span class="literal">true</span></span><br><span class="line">  tab_replace:</span><br><span class="line"></span><br><span class="line"><span class="comment"># Category &amp; Tag</span></span><br><span class="line">default_category: uncategorized</span><br><span class="line">category_map:</span><br><span class="line">tag_map:</span><br><span class="line"></span><br><span class="line">sitemap:</span><br><span class="line">  path: sitemap.xml</span><br><span class="line">baidusitemap:</span><br><span class="line">  path: baidusitemap.xml</span><br><span class="line"></span><br><span class="line"><span class="comment"># Date / Time format</span></span><br><span class="line"><span class="comment">## Hexo uses Moment.js to parse and display date</span></span><br><span class="line"><span class="comment">## You can customize the date format as defined in</span></span><br><span class="line"><span class="comment">## http://momentjs.com/docs/#/displaying/format/</span></span><br><span class="line">date_format: YYYY-MM-DD</span><br><span class="line">time_format: HH:mm:ss</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pagination</span></span><br><span class="line"><span class="comment">## Set per_page to 0 to disable pagination</span></span><br><span class="line">per_page: 20</span><br><span class="line">pagination_dir: page</span><br><span class="line"></span><br><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="comment">## Plugins: https://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">## Themes: https://hexo.io/themes/</span></span><br><span class="line"><span class="comment">## theme: landscape</span></span><br><span class="line">theme: maupassant</span><br><span class="line"></span><br><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line">deploy:</span><br><span class="line">  - <span class="built_in">type</span>: git</span><br><span class="line">    repository: git@git.coding.net:kingwen0302/kingwen0302.git</span><br><span class="line">    branch: coding-pages</span><br></pre></td></tr></table></figure><figure class="highlight bash"><figcaption><span>maupassant主题配置文件</span><a href="/downloads/code/maupassant_theme_config.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">fancybox: <span class="literal">true</span> <span class="comment">## If you want to use fancybox please set the value to true.</span></span><br><span class="line">duoshuo: kingwen0302 <span class="comment">## Your duoshuo_shortname, e.g. username</span></span><br><span class="line">disqus: <span class="comment">## Your disqus_shortname, e.g. username</span></span><br><span class="line">google_search: <span class="literal">true</span> <span class="comment">## Use Google search, true/false.</span></span><br><span class="line">baidu_search: <span class="comment">## Use Baidu search, true/false.</span></span><br><span class="line">swiftype: <span class="comment">## Your swiftype_key, e.g. m7b11ZrsT8Me7gzApciT</span></span><br><span class="line">tinysou: <span class="comment">## Your tinysou_key, e.g. 4ac092ad8d749fdc6293</span></span><br><span class="line">self_search: <span class="comment">## Use a jQuery-based local search engine, true/false.</span></span><br><span class="line">google_analytics: UA-74683107-1 <span class="comment">## Your Google Analytics tracking id, e.g. UA-42425684-2</span></span><br><span class="line">baidu_analytics: e340a0928b11036ca5deeaf890942c4b <span class="comment">## Your Baidu Analytics tracking id, e.g. 8006843039519956000</span></span><br><span class="line">shareto: <span class="literal">true</span> <span class="comment">## If you want to use the share button please set the value to true.</span></span><br><span class="line">busuanzi: <span class="literal">true</span> <span class="comment">## If you want to use Busuanzi page views please set the value to true.</span></span><br><span class="line"></span><br><span class="line">menu:</span><br><span class="line">  - page: home</span><br><span class="line">    directory: .</span><br><span class="line">    icon: fa-home</span><br><span class="line">  - page: archive</span><br><span class="line">    directory: archives/</span><br><span class="line">    icon: fa-archive</span><br><span class="line">  - page: about</span><br><span class="line">    directory: about/</span><br><span class="line">    icon: fa-user</span><br><span class="line">  - page: rss</span><br><span class="line">    directory: atom.xml</span><br><span class="line">    icon: fa-rss</span><br><span class="line"></span><br><span class="line">widgets: <span class="comment">## Six widgets in sidebar provided: search, category, tag, recent_posts, rencent_comments and links.</span></span><br><span class="line">  - search</span><br><span class="line">  - category</span><br><span class="line">  - tag</span><br><span class="line">  - recent_posts</span><br><span class="line">  - recent_comments</span><br><span class="line">  - links</span><br><span class="line"></span><br><span class="line">links:</span><br><span class="line">  - title: hexo</span><br><span class="line">    url: https://hexo.io/</span><br><span class="line">  - title: 屠夫9441的博客</span><br><span class="line">    url: https://www.haomwei.com/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Static files</span></span><br><span class="line">js: js</span><br><span class="line">css: css</span><br><span class="line"></span><br><span class="line"><span class="comment"># Theme version</span></span><br><span class="line">version: 0.0.0</span><br></pre></td></tr></table></figure><figure class="highlight bash"><figcaption><span>post.sh</span><a href="/downloads/code/post.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: {{ title }}</span><br><span class="line">date: {{ date }}</span><br><span class="line">tags:</span><br><span class="line">toc: <span class="literal">true</span></span><br><span class="line">categories: </span><br><span class="line">---</span><br></pre></td></tr></table></figure></li></ol><h3 id="主动推送百度"><a href="#主动推送百度" class="headerlink" title="主动推送百度"></a>主动推送百度</h3><ol><li><p>插件安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y install python-setuptools</span><br><span class="line">easy_install beautifulsoup4</span><br><span class="line">easy_install requests</span><br><span class="line">yum -y install python-lxml</span><br></pre></td></tr></table></figure></li><li><p>推送脚本</p><figure class="highlight python"><figcaption><span>push.py</span><a href="/downloads/code/push.py">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: LoveNight</span></span><br><span class="line"><span class="comment"># @Date:   2015-11-16 20:45:59</span></span><br><span class="line"><span class="comment"># @Last Modified by:   LoveNight</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2015-11-18 18:07:19</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup <span class="keyword">as</span> BS</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">hexo 博客专用，向百度站长平台提交所有网址</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">本脚本必须放在hexo博客的根目录下执行！需要已安装生成百度站点地图的插件。</span></span><br><span class="line"><span class="string">百度站长平台提交链接：http://zhanzhang.baidu.com/linksubmit/index</span></span><br><span class="line"><span class="string">主动推送：最为快速的提交方式，推荐您将站点当天新产出链接立即通过此方式推送给百度，以保证新链接可以及时被百度收录。</span></span><br><span class="line"><span class="string">从中找到自己的接口调用地址</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## url = 去上面的链接找自己的推送接口</span></span><br><span class="line">url = <span class="string">&quot;http://data.zz.baidu.com/urls?site=www.aaaa.com&amp;token=aaaa&quot;</span></span><br><span class="line">baidu_sitemap = os.path.join(sys.path[<span class="number">0</span>], <span class="string">&#x27;public&#x27;</span>, <span class="string">&#x27;baidusitemap.xml&#x27;</span>)</span><br><span class="line">google_sitemap = os.path.join(sys.path[<span class="number">0</span>], <span class="string">&#x27;public&#x27;</span>, <span class="string">&#x27;sitemap.xml&#x27;</span>)</span><br><span class="line">sitemap = [baidu_sitemap, google_sitemap]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> (os.path.exists(baidu_sitemap) <span class="keyword">or</span> os.path.exists(</span><br><span class="line">    google_sitemap)), <span class="string">&quot;没找到任何网站地图，请检查！&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从站点地图中读取网址列表</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUrls</span>():</span></span><br><span class="line">    urls = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> sitemap:</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(_):</span><br><span class="line">            <span class="comment"># with open(_, &quot;r&quot;, encoding=&quot;utf-8&quot;) as f:</span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(_, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                xml = f.read()</span><br><span class="line">            soup = BS(xml, <span class="string">&quot;xml&quot;</span>)</span><br><span class="line">            tags = soup.find_all(<span class="string">&quot;loc&quot;</span>)</span><br><span class="line">            urls += [x.string <span class="keyword">for</span> x <span class="keyword">in</span> tags]</span><br><span class="line">            <span class="keyword">if</span> _ == baidu_sitemap:</span><br><span class="line">                tags = soup.find_all(<span class="string">&quot;breadCrumb&quot;</span>, url=<span class="literal">True</span>)</span><br><span class="line">                urls += [x[<span class="string">&quot;url&quot;</span>] <span class="keyword">for</span> x <span class="keyword">in</span> tags]</span><br><span class="line">    <span class="keyword">return</span> urls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># POST提交网址列表</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">postUrls</span>(<span class="params">urls</span>):</span></span><br><span class="line">    urls = <span class="built_in">set</span>(urls)  <span class="comment"># 先去重</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;一共提取出 %s 个网址&quot;</span> % <span class="built_in">len</span>(urls))</span><br><span class="line">    data = <span class="string">&quot;\n&quot;</span>.join(urls)</span><br><span class="line">    <span class="keyword">for</span> u <span class="keyword">in</span> urls:</span><br><span class="line">        <span class="built_in">print</span> u</span><br><span class="line">    <span class="keyword">return</span> requests.post(url, data=data).text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    urls = getUrls()</span><br><span class="line">    result = postUrls(urls)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;提交结果：&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="comment">## msvcrt.getch()</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ol><li><a href="http://lovenight.github.io/2015/11/18/%E5%90%91%E7%99%BE%E5%BA%A6%E6%8E%A8%E9%80%81hexo%E5%8D%9A%E5%AE%A2%E6%89%80%E6%9C%89%E9%93%BE%E6%8E%A5%E7%9A%84Python%E8%84%9A%E6%9C%AC/">参考文档1</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
